(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const n of a.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&s(n)}).observe(document,{childList:!0,subtree:!0});function i(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(r){if(r.ep)return;r.ep=!0;const a=i(r);fetch(r.href,a)}})();const Ki=class Ki{constructor(t=0){t<1?(this._ptr=[],this._capacity=0,this._size=0):(this._ptr=new Array(t),this._capacity=t,this._size=0)}at(t){return this._ptr[t]}set(t,i){this._ptr[t]=i}get(t=0){const i=new Array;for(let s=t;s<this._size;s++)i.push(this._ptr[s]);return i}pushBack(t){this._size>=this._capacity&&this.prepareCapacity(this._capacity==0?Ki.DefaultSize:this._capacity*2),this._ptr[this._size++]=t}clear(){this._ptr.length=0,this._size=0}getSize(){return this._size}assign(t,i){this._size<t&&this.prepareCapacity(t);for(let r=0;r<t;r++)this._ptr[r]=i;this._size=t}resize(t,i=null){this.updateSize(t,i,!0)}updateSize(t,i=null,s=!0){if(this._size<t)if(this.prepareCapacity(t),s)for(let a=this._size;a<t;a++)typeof i=="function"?this._ptr[a]=JSON.parse(JSON.stringify(new i)):this._ptr[a]=i;else for(let a=this._size;a<t;a++)this._ptr[a]=i;else{const a=this._size-t;this._ptr.splice(this._size-a,a)}this._size=t}insert(t,i,s){let r=t._index;const a=i._index,n=s._index,o=n-a;this.prepareCapacity(this._size+o);const l=this._size-r;if(l>0)for(let h=0;h<l;h++)this._ptr.splice(r+h,0,null);for(let h=a;h<n;h++,r++)this._ptr[r]=i._vector._ptr[h];this._size=this._size+o}remove(t){return t<0||this._size<=t?!1:(this._ptr.splice(t,1),--this._size,!0)}erase(t){const i=t._index;return i<0||this._size<=i?t:(this._ptr.splice(i,1),--this._size,new Ts(this,i))}prepareCapacity(t){t>this._capacity&&(this._capacity==0?(this._ptr=new Array(t),this._capacity=t):(this._ptr.length=t,this._capacity=t))}begin(){return this._size==0?this.end():new Ts(this,0)}end(){return new Ts(this,this._size)}getOffset(t){const i=new Ki;return i._ptr=this.get(t),i._size=this.get(t).length,i._capacity=this.get(t).length,i}};Ki.DefaultSize=10;let y=Ki,Ts=class ea{constructor(t,i){this._vector=t??null,this._index=i??0}set(t){return this._index=t._index,this._vector=t._vector,this}preIncrement(){return++this._index,this}preDecrement(){return--this._index,this}increment(){return new ea(this._vector,this._index++)}decrement(){return new ea(this._vector,this._index--)}ptr(){return this._vector._ptr[this._index]}substitution(t){return this._index=t._index,this._vector=t._vector,this}notEqual(t){return this._index!=t._index||this._vector!=t._vector}};var On;(e=>{e.csmVector=y,e.iterator=Ts})(On||(On={}));class Xt{append(t,i){return this.s+=i!==void 0?t.substr(0,i):t,this}expansion(t,i){for(let s=0;s<t;s++)this.append(i);return this}getBytes(){return encodeURIComponent(this.s).replace(/%../g,"x").length}getLength(){return this.s.length}isLess(t){return this.s<t.s}isGreat(t){return this.s>t.s}isEqual(t){return this.s==t}isEmpty(){return this.s.length==0}constructor(t){this.s=t}}var Nn;(e=>{e.csmString=Xt})(Nn||(Nn={}));class ui{static createIdInternal(t){return new ui(t)}getString(){return this._id}isEqual(t){return typeof t=="string"?this._id.isEqual(t):t instanceof Xt?this._id.isEqual(t.s):t instanceof ui?this._id.isEqual(t._id.s):!1}isNotEqual(t){return typeof t=="string"?!this._id.isEqual(t):t instanceof Xt?!this._id.isEqual(t.s):t instanceof ui?!this._id.isEqual(t._id.s):!1}constructor(t){if(typeof t=="string"){this._id=new Xt(t);return}this._id=t}}var Un;(e=>{e.CubismId=ui})(Un||(Un={}));class uh{constructor(){this._ids=new y}release(){for(let t=0;t<this._ids.getSize();++t)this._ids.set(t,void 0);this._ids=null}registerIds(t){for(let i=0;i<t.length;i++)this.registerId(t[i])}registerId(t){let i=null;if(typeof t=="string"){if((i=this.findId(t))!=null)return i;i=ui.createIdInternal(t),this._ids.pushBack(i)}else return this.registerId(t.s);return i}getId(t){return this.registerId(t)}isExist(t){return typeof t=="string"?this.findId(t)!=null:this.isExist(t.s)}findId(t){for(let i=0;i<this._ids.getSize();++i)if(this._ids.at(i).getString().isEqual(t))return this._ids.at(i);return null}}var zn;(e=>{e.CubismIdManager=uh})(zn||(zn={}));class st{constructor(){this._tr=new Float32Array(16),this.loadIdentity()}static multiply(t,i,s){const r=new Float32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),a=4;for(let n=0;n<a;++n)for(let o=0;o<a;++o)for(let l=0;l<a;++l)r[o+n*4]+=t[l+n*4]*i[o+l*4];for(let n=0;n<16;++n)s[n]=r[n]}loadIdentity(){const t=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);this.setMatrix(t)}setMatrix(t){for(let i=0;i<16;++i)this._tr[i]=t[i]}getArray(){return this._tr}getScaleX(){return this._tr[0]}getScaleY(){return this._tr[5]}getTranslateX(){return this._tr[12]}getTranslateY(){return this._tr[13]}transformX(t){return this._tr[0]*t+this._tr[12]}transformY(t){return this._tr[5]*t+this._tr[13]}invertTransformX(t){return(t-this._tr[12])/this._tr[0]}invertTransformY(t){return(t-this._tr[13])/this._tr[5]}translateRelative(t,i){const s=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,t,i,0,1]);st.multiply(s,this._tr,this._tr)}translate(t,i){this._tr[12]=t,this._tr[13]=i}translateX(t){this._tr[12]=t}translateY(t){this._tr[13]=t}scaleRelative(t,i){const s=new Float32Array([t,0,0,0,0,i,0,0,0,0,1,0,0,0,0,1]);st.multiply(s,this._tr,this._tr)}scale(t,i){this._tr[0]=t,this._tr[5]=i}multiplyByMatrix(t){st.multiply(t.getArray(),this._tr,this._tr)}clone(){const t=new st;for(let i=0;i<this._tr.length;i++)t._tr[i]=this._tr[i];return t}}var Gn;(e=>{e.CubismMatrix44=st})(Gn||(Gn={}));class Os{constructor(t,i,s,r){this.x=t,this.y=i,this.width=s,this.height=r}getCenterX(){return this.x+.5*this.width}getCenterY(){return this.y+.5*this.height}getRight(){return this.x+this.width}getBottom(){return this.y+this.height}setRect(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height}expand(t,i){this.x-=t,this.y-=i,this.width+=t*2,this.height+=i*2}}var Xn;(e=>{e.csmRect=Os})(Xn||(Xn={}));class tr{static create(){return null}static delete(t){}initialize(t){this._model=t}drawModel(){this.getModel()!=null&&(this.saveProfile(),this.doDrawModel(),this.restoreProfile())}setMvpMatrix(t){this._mvpMatrix4x4.setMatrix(t.getArray())}getMvpMatrix(){return this._mvpMatrix4x4}setModelColor(t,i,s,r){t<0?t=0:t>1&&(t=1),i<0?i=0:i>1&&(i=1),s<0?s=0:s>1&&(s=1),r<0?r=0:r>1&&(r=1),this._modelColor.r=t,this._modelColor.g=i,this._modelColor.b=s,this._modelColor.a=r}getModelColor(){return JSON.parse(JSON.stringify(this._modelColor))}getModelColorWithOpacity(t){const i=this.getModelColor();return i.a*=t,this.isPremultipliedAlpha()&&(i.r*=i.a,i.g*=i.a,i.b*=i.a),i}setIsPremultipliedAlpha(t){this._isPremultipliedAlpha=t}isPremultipliedAlpha(){return this._isPremultipliedAlpha}setIsCulling(t){this._isCulling=t}isCulling(){return this._isCulling}setAnisotropy(t){this._anisotropy=t}getAnisotropy(){return this._anisotropy}getModel(){return this._model}useHighPrecisionMask(t){this._useHighPrecisionMask=t}isUsingHighPrecisionMask(){return this._useHighPrecisionMask}constructor(){this._isCulling=!1,this._isPremultipliedAlpha=!1,this._anisotropy=0,this._model=null,this._modelColor=new vt,this._useHighPrecisionMask=!1,this._mvpMatrix4x4=new st,this._mvpMatrix4x4.loadIdentity()}}var Ie=(e=>(e[e.CubismBlendMode_Normal=0]="CubismBlendMode_Normal",e[e.CubismBlendMode_Additive=1]="CubismBlendMode_Additive",e[e.CubismBlendMode_Multiplicative=2]="CubismBlendMode_Multiplicative",e))(Ie||{});class vt{constructor(t=1,i=1,s=1,r=1){this.r=t,this.g=i,this.b=s,this.a=r}}class Gc{constructor(t,i){this._clippingIdList=t,this._clippingIdCount=i,this._allClippedDrawRect=new Os,this._layoutBounds=new Os,this._clippedDrawableIndexList=[],this._matrixForMask=new st,this._matrixForDraw=new st,this._bufferIndex=0}release(){this._layoutBounds!=null&&(this._layoutBounds=null),this._allClippedDrawRect!=null&&(this._allClippedDrawRect=null),this._clippedDrawableIndexList!=null&&(this._clippedDrawableIndexList=null)}addClippedDrawable(t){this._clippedDrawableIndexList.push(t)}}var jn;(e=>{e.CubismBlendMode=Ie,e.CubismRenderer=tr,e.CubismTextureColor=vt})(jn||(jn={}));const Xc=(e,t,i)=>{Ma.print(e,"[CSM]"+t,i)},xs=(e,t,i)=>{Xc(e,t+`
`,i)},ft=e=>{console.assert(e)};let ts,mt,k,D;ts=(e,...t)=>{xs(ze.LogLevel_Debug,"[D]"+e,t)},mt=(e,...t)=>{xs(ze.LogLevel_Info,"[I]"+e,t)},k=(e,...t)=>{xs(ze.LogLevel_Warning,"[W]"+e,t)},D=(e,...t)=>{xs(ze.LogLevel_Error,"[E]"+e,t)};class Ma{static print(t,i,s){if(t<R.getLoggingLevel())return;const r=R.coreLogFunction;if(!r)return;const a=i.replace(/\{(\d+)\}/g,(n,o)=>s[o]);r(a)}static dumpBytes(t,i,s){for(let r=0;r<s;r++)r%16==0&&r>0?this.print(t,`
`):r%8==0&&r>0&&this.print(t,"  "),this.print(t,"{0} ",[i[r]&255]);this.print(t,`
`)}constructor(){}}var Yn;(e=>{e.CubismDebug=Ma})(Yn||(Yn={}));class ch{constructor(t,i){this.first=t??null,this.second=i??null}}const Zi=class Zi{constructor(t){t!=null?t<1?(this._keyValues=[],this._dummyValue=null,this._size=0):(this._keyValues=new Array(t),this._size=t):(this._keyValues=[],this._dummyValue=null,this._size=0)}release(){this.clear()}appendKey(t){let i=-1;for(let s=0;s<this._size;s++)if(this._keyValues[s].first==t){i=s;break}if(i!=-1){k("The key `{0}` is already append.",t);return}this.prepareCapacity(this._size+1,!1),this._keyValues[this._size]=new ch(t),this._size+=1}getValue(t){let i=-1;for(let s=0;s<this._size;s++)if(this._keyValues[s].first==t){i=s;break}return i>=0?this._keyValues[i].second:(this.appendKey(t),this._keyValues[this._size-1].second)}setValue(t,i){let s=-1;for(let r=0;r<this._size;r++)if(this._keyValues[r].first==t){s=r;break}s>=0?this._keyValues[s].second=i:(this.appendKey(t),this._keyValues[this._size-1].second=i)}isExist(t){for(let i=0;i<this._size;i++)if(this._keyValues[i].first==t)return!0;return!1}clear(){this._keyValues=void 0,this._keyValues=null,this._keyValues=[],this._size=0}getSize(){return this._size}prepareCapacity(t,i){t>this._keyValues.length&&(this._keyValues.length==0?(!i&&t<Zi.DefaultSize&&(t=Zi.DefaultSize),this._keyValues.length=t):(!i&&t<this._keyValues.length*2&&(t=this._keyValues.length*2),this._keyValues.length=t))}begin(){return new Ye(this,0)}end(){return new Ye(this,this._size)}erase(t){const i=t._index;return i<0||this._size<=i?t:(this._keyValues.splice(i,1),--this._size,new Ye(this,i))}dumpAsInt(){for(let t=0;t<this._size;t++)ts("{0} ,",this._keyValues[t]),ts(`
`)}};Zi.DefaultSize=10;let bt=Zi;class Ye{constructor(t,i){this._map=t??new bt,this._index=i??0}set(t){return this._index=t._index,this._map=t._map,this}preIncrement(){return++this._index,this}preDecrement(){return--this._index,this}increment(){return new Ye(this._map,this._index++)}decrement(){const t=new Ye(this._map,this._index);return this._map=t._map,this._index=t._index,this}ptr(){return this._map._keyValues[this._index]}notEqual(t){return this._index!=t._index||this._map!=t._map}}var Hn;(e=>{e.csmMap=bt,e.csmPair=ch,e.iterator=Ye})(Hn||(Hn={}));class Ns{static parseJsonObject(t,i){return Object.keys(t).forEach(s=>{if(typeof t[s]=="boolean"){const r=!!t[s];i.put(s,new Kt(r))}else if(typeof t[s]=="string"){const r=String(t[s]);i.put(s,new yi(r))}else if(typeof t[s]=="number"){const r=Number(t[s]);i.put(s,new zs(r))}else t[s]instanceof Array?i.put(s,Ns.parseJsonArray(t[s])):t[s]instanceof Object?i.put(s,Ns.parseJsonObject(t[s],new gi)):t[s]==null?i.put(s,new ci):i.put(s,t[s])}),i}static parseJsonArray(t){const i=new Pa;return Object.keys(t).forEach(s=>{if(typeof Number(s)=="number")if(typeof t[s]=="boolean"){const a=!!t[s];i.add(new Kt(a))}else if(typeof t[s]=="string"){const a=String(t[s]);i.add(new yi(a))}else if(typeof t[s]=="number"){const a=Number(t[s]);i.add(new zs(a))}else t[s]instanceof Array?i.add(this.parseJsonArray(t[s])):t[s]instanceof Object?i.add(this.parseJsonObject(t[s],new gi)):t[s]==null?i.add(new ci):i.add(t[s]);else if(t[s]instanceof Array)i.add(this.parseJsonArray(t[s]));else if(t[s]instanceof Object)i.add(this.parseJsonObject(t[s],new gi));else if(t[s]==null)i.add(new ci);else{const a=Array(t[s]);for(let n=0;n<a.length;n++)i.add(a[n])}}),i}}const Us="Error: type mismatch",jc="Error: index out of bounds";let _t=class ae{constructor(){}getRawString(t,i){return this.getString(t,i)}toInt(t=0){return t}toFloat(t=0){return t}toBoolean(t=!1){return t}getSize(){return 0}getArray(t=null){return t}getVector(t=new y){return t}getMap(t){return t}getValueByIndex(t){return ae.errorValue.setErrorNotForClientCall(Us)}getValueByString(t){return ae.nullValue.setErrorNotForClientCall(Us)}getKeys(){return ae.dummyKeys}isError(){return!1}isNull(){return!1}isBool(){return!1}isFloat(){return!1}isString(){return!1}isArray(){return!1}isMap(){return!1}equals(t){return!1}isStatic(){return!1}setErrorNotForClientCall(t){return es.errorValue}static staticInitializeNotForClientCall(){Kt.trueValue=new Kt(!0),Kt.falseValue=new Kt(!1),ae.errorValue=new es("ERROR",!0),ae.nullValue=new ci,ae.dummyKeys=new y}static staticReleaseNotForClientCall(){Kt.trueValue=null,Kt.falseValue=null,ae.errorValue=null,ae.nullValue=null,ae.dummyKeys=null}};class gt{constructor(t,i){this._parseCallback=Ns.parseJsonObject,this._error=null,this._lineCount=0,this._root=null,t!=null&&this.parseBytes(t,i,this._parseCallback)}static create(t,i){const s=new gt;return s.parseBytes(t,i,s._parseCallback)?s:(gt.delete(s),null)}static delete(t){}getRoot(){return this._root}static arrayBufferToString(t){const i=new Uint8Array(t);let s="";for(let r=0,a=i.length;r<a;++r)s+="%"+this.pad(i[r].toString(16));return s=decodeURIComponent(s),s}static pad(t){return t.length<2?"0"+t:t}parseBytes(t,i,s){const r=new Array(1),a=gt.arrayBufferToString(t);if(s==null?this._root=this.parseValue(a,i,0,r):this._root=s(JSON.parse(a),new gi),this._error){let n="\0";return n="Json parse error : @line "+(this._lineCount+1)+`
`,this._root=new yi(n),mt("{0}",this._root.getRawString()),!1}else if(this._root==null)return this._root=new es(new Xt(this._error),!1),!1;return!0}getParseError(){return this._error}checkEndOfFile(){return this._root.getArray()[1].equals("EOF")}parseValue(t,i,s,r){if(this._error)return null;let a=null,n=s,o;for(;n<i;n++)switch(t[n]){case"-":case".":case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":{const h=new Array(1);return o=Yc(t.slice(n),h),r[0]=t.indexOf(h[0]),new zs(o)}case'"':return new yi(this.parseString(t,i,n+1,r));case"[":return a=this.parseArray(t,i,n+1,r),a;case"{":return a=this.parseObject(t,i,n+1,r),a;case"n":return n+3<i?(a=new ci,r[0]=n+4):this._error="parse null",a;case"t":return n+3<i?(a=Kt.trueValue,r[0]=n+4):this._error="parse true",a;case"f":return n+4<i?(a=Kt.falseValue,r[0]=n+5):this._error="illegal ',' position",a;case",":return this._error="illegal ',' position",null;case"]":return r[0]=n,null;case`
`:this._lineCount++}return this._error="illegal end of value",null}parseString(t,i,s,r){if(this._error)return null;if(!t)return this._error="string is null",null;let a=s,n,o;const l=new Xt("");let h=s;for(;a<i;a++)switch(n=t[a],n){case'"':return r[0]=a+1,l.append(t.slice(h),a-h),l.s;case"//":if(a++,a-1>h&&l.append(t.slice(h),a-h),h=a+1,a<i)switch(o=t[a],o){case"\\":l.expansion(1,"\\");break;case'"':l.expansion(1,'"');break;case"/":l.expansion(1,"/");break;case"b":l.expansion(1,"\b");break;case"f":l.expansion(1,"\f");break;case"n":l.expansion(1,`
`);break;case"r":l.expansion(1,"\r");break;case"t":l.expansion(1,"	");break;case"u":this._error="parse string/unicord escape not supported";break}else this._error="parse string/escape error"}return this._error="parse string/illegal end",null}parseObject(t,i,s,r){if(this._error)return null;if(!t)return this._error="buffer is null",null;const a=new gi;let n="",o=s,l="";const h=Array(1);let u=!1;for(;o<i;o++){t:for(;o<i;o++)switch(l=t[o],l){case'"':if(n=this.parseString(t,i,o+1,h),this._error)return null;o=h[0],u=!0;break t;case"}":return r[0]=o+1,a;case":":this._error="illegal ':' position";break;case`
`:this._lineCount++}if(!u)return this._error="key not found",null;u=!1;t:for(;o<i;o++)switch(l=t[o],l){case":":u=!0,o++;break t;case"}":this._error="illegal '}' position";break;case`
`:this._lineCount++}if(!u)return this._error="':' not found",null;const c=this.parseValue(t,i,o,h);if(this._error)return null;o=h[0],a.put(n,c);t:for(;o<i;o++)switch(l=t[o],l){case",":break t;case"}":return r[0]=o+1,a;case`
`:this._lineCount++}}return this._error="illegal end of perseObject",null}parseArray(t,i,s,r){if(this._error)return null;if(!t)return this._error="buffer is null",null;let a=new Pa,n=s,o;const l=new Array(1);for(;n<i;n++){const h=this.parseValue(t,i,n,l);if(this._error)return null;n=l[0],h&&a.add(h);t:for(;n<i;n++)switch(o=t[n],o){case",":break t;case"]":return r[0]=n+1,a;case`
`:++this._lineCount}}return a=void 0,this._error="illegal end of parseObject",null}}class zs extends _t{constructor(t){super(),this._value=t}isFloat(){return!0}getString(t,i){const s="\0";return this._value=parseFloat(s),this._stringBuffer=s,this._stringBuffer}toInt(t=0){return parseInt(this._value.toString())}toFloat(t=0){return this._value}equals(t){return typeof t=="number"?Math.round(t)?!1:t==this._value:!1}}class Kt extends _t{isBool(){return!0}toBoolean(t=!1){return this._boolValue}getString(t,i){return this._stringBuffer=this._boolValue?"true":"false",this._stringBuffer}equals(t){return typeof t=="boolean"?t==this._boolValue:!1}isStatic(){return!0}constructor(t){super(),this._boolValue=t}}class yi extends _t{constructor(t){super(),typeof t=="string"&&(this._stringBuffer=t),t instanceof Xt&&(this._stringBuffer=t.s)}isString(){return!0}getString(t,i){return this._stringBuffer}equals(t){return typeof t=="string"?this._stringBuffer==t:t instanceof Xt?this._stringBuffer==t.s:!1}}class es extends yi{isStatic(){return this._isStatic}setErrorNotForClientCall(t){return this._stringBuffer=t,this}constructor(t,i){typeof t=="string"?super(t):super(t),this._isStatic=i}isError(){return!0}}class ci extends _t{isNull(){return!0}getString(t,i){return this._stringBuffer}isStatic(){return!0}setErrorNotForClientCall(t){return this._stringBuffer=t,es.nullValue}constructor(){super(),this._stringBuffer="NullValue"}}class Pa extends _t{constructor(){super(),this._array=new y}release(){for(let t=this._array.begin();t.notEqual(this._array.end());t.preIncrement()){let i=t.ptr();i&&!i.isStatic()&&(i=void 0,i=null)}}isArray(){return!0}getValueByIndex(t){if(t<0||this._array.getSize()<=t)return _t.errorValue.setErrorNotForClientCall(jc);const i=this._array.at(t);return i??_t.nullValue}getValueByString(t){return _t.errorValue.setErrorNotForClientCall(Us)}getString(t,i){const s=i+`[
`;for(let r=this._array.begin();r.notEqual(this._array.end());r.increment()){const a=r.ptr();this._stringBuffer+=i+""+a.getString(i+" ")+`
`}return this._stringBuffer=s+i+`]
`,this._stringBuffer}add(t){this._array.pushBack(t)}getVector(t=null){return this._array}getSize(){return this._array.getSize()}}class gi extends _t{constructor(){super(),this._map=new bt}release(){const t=this._map.begin();for(;t.notEqual(this._map.end());){let i=t.ptr().second;i&&!i.isStatic()&&(i=void 0,i=null),t.preIncrement()}}isMap(){return!0}getValueByString(t){if(t instanceof Xt){const i=this._map.getValue(t.s);return i??_t.nullValue}for(let i=this._map.begin();i.notEqual(this._map.end());i.preIncrement())if(i.ptr().first==t)return i.ptr().second==null?_t.nullValue:i.ptr().second;return _t.nullValue}getValueByIndex(t){return _t.errorValue.setErrorNotForClientCall(Us)}getString(t,i){this._stringBuffer=i+`{
`;const s=this._map.begin();for(;s.notEqual(this._map.end());){const r=s.ptr().first,a=s.ptr().second;this._stringBuffer+=i+" "+r+" : "+a.getString(i+"   ")+` 
`,s.preIncrement()}return this._stringBuffer+=i+`}
`,this._stringBuffer}getMap(t){return this._map}put(t,i){this._map.setValue(t,i)}getKeys(){if(!this._keys){this._keys=new y;const t=this._map.begin();for(;t.notEqual(this._map.end());){const i=t.ptr().first;this._keys.pushBack(i),t.preIncrement()}}return this._keys}getSize(){return this._keys.getSize()}}var Wn;(e=>{e.CubismJson=gt,e.JsonArray=Pa,e.JsonBoolean=Kt,e.JsonError=es,e.JsonFloat=zs,e.JsonMap=gi,e.JsonNullvalue=ci,e.JsonString=yi,e.Value=_t})(Wn||(Wn={}));function Yc(e,t){let i=0;for(let r=1;;r++){const a=e.slice(r-1,r);if(a=="e"||a=="-"||a=="E")continue;const n=e.substring(0,r),o=Number(n);if(isNaN(o))break;i=r}let s=parseFloat(e);return isNaN(s)&&(s=NaN),t[0]=e.slice(i),s}let qt=!1,Ze=!1,Qe=null,Ni=null;const we=Object.freeze({vertexOffset:0,vertexStep:2});function ni(e){e&&(e=void 0)}class R{static startUp(t=null){if(qt)return mt("CubismFramework.startUp() is already done."),qt;if(Qe=t,Qe!=null&&Live2DCubismCore.Logging.csmSetLogFunction(Qe.logFunction),qt=!0,qt){const i=Live2DCubismCore.Version.csmGetVersion(),s=(i&4278190080)>>24,r=(i&16711680)>>16,a=i&65535,n=i;mt("Live2D Cubism Core version: {0}.{1}.{2} ({3})",("00"+s).slice(-2),("00"+r).slice(-2),("0000"+a).slice(-4),n)}return mt("CubismFramework.startUp() is complete."),qt}static cleanUp(){qt=!1,Ze=!1,Qe=null,Ni=null}static initialize(t=0){if(ft(qt),!qt){k("CubismFramework is not started.");return}if(Ze){k("CubismFramework.initialize() skipped, already initialized.");return}_t.staticInitializeNotForClientCall(),Ni=new uh,Live2DCubismCore.Memory.initializeAmountOfMemory(t),Ze=!0,mt("CubismFramework.initialize() is complete.")}static dispose(){if(ft(qt),!qt){k("CubismFramework is not started.");return}if(!Ze){k("CubismFramework.dispose() skipped, not initialized.");return}_t.staticReleaseNotForClientCall(),Ni.release(),Ni=null,tr.staticRelease(),Ze=!1,mt("CubismFramework.dispose() is complete.")}static isStarted(){return qt}static isInitialized(){return Ze}static coreLogFunction(t){Live2DCubismCore.Logging.csmGetLogFunction()&&Live2DCubismCore.Logging.csmGetLogFunction()(t)}static getLoggingLevel(){return Qe!=null?Qe.loggingLevel:5}static getIdManager(){return Ni}constructor(){}}class Hc{}var ze=(e=>(e[e.LogLevel_Verbose=0]="LogLevel_Verbose",e[e.LogLevel_Debug=1]="LogLevel_Debug",e[e.LogLevel_Info=2]="LogLevel_Info",e[e.LogLevel_Warning=3]="LogLevel_Warning",e[e.LogLevel_Error=4]="LogLevel_Error",e[e.LogLevel_Off=5]="LogLevel_Off",e))(ze||{}),$n;(e=>{e.Constant=we,e.csmDelete=ni,e.CubismFramework=R})($n||($n={}));const Ui=1,qn=1,Wc=2,$c=.8,qc=-1,Jc=1,Kc=-2,Zc=2,Qc=-2,tg=2,gh="./Resources/",eg="back_class_normal.png",ig="icon_gear.png",ia=["GaoGao","Haru","Hiyori","Mark","Natori","Rice","Mao","Wanko"],sg=ia.length,rg="Idle",ag="TapBody",Jn="Head",Kn="Body",ng=0,og=1,lg=2,hg=3,ug=ze.LogLevel_Verbose,li=class li{static loadFileAsBytes(t,i){fetch(t).then(s=>s.arrayBuffer()).then(s=>i(s,s.byteLength))}static getDeltaTime(){return this.deltaTime}static updateTime(){this.currentFrame=Date.now(),this.deltaTime=(this.currentFrame-this.lastFrame)/1e3,this.lastFrame=this.currentFrame}static printMessage(t){console.log(t)}};li.lastUpdate=Date.now(),li.currentFrame=0,li.lastFrame=0,li.deltaTime=0;let q=li;class cg{constructor(){this._gl=null,this._gl=null}initialize(t){return this._gl=t.getContext("webgl2"),this._gl?!0:(alert("Cannot initialize WebGL. This browser does not support."),this._gl=null,!1)}release(){}getGl(){return this._gl}}const C=Object.freeze({HitAreaPrefix:"HitArea",HitAreaHead:"Head",HitAreaBody:"Body",PartsIdCore:"Parts01Core",PartsArmPrefix:"Parts01Arm_",PartsArmLPrefix:"Parts01ArmL_",PartsArmRPrefix:"Parts01ArmR_",ParamAngleX:"ParamAngleX",ParamAngleY:"ParamAngleY",ParamAngleZ:"ParamAngleZ",ParamEyeLOpen:"ParamEyeLOpen",ParamEyeLSmile:"ParamEyeLSmile",ParamEyeROpen:"ParamEyeROpen",ParamEyeRSmile:"ParamEyeRSmile",ParamEyeBallX:"ParamEyeBallX",ParamEyeBallY:"ParamEyeBallY",ParamEyeBallForm:"ParamEyeBallForm",ParamBrowLY:"ParamBrowLY",ParamBrowRY:"ParamBrowRY",ParamBrowLX:"ParamBrowLX",ParamBrowRX:"ParamBrowRX",ParamBrowLAngle:"ParamBrowLAngle",ParamBrowRAngle:"ParamBrowRAngle",ParamBrowLForm:"ParamBrowLForm",ParamBrowRForm:"ParamBrowRForm",ParamMouthForm:"ParamMouthForm",ParamMouthOpenY:"ParamMouthOpenY",ParamCheek:"ParamCheek",ParamBodyAngleX:"ParamBodyAngleX",ParamBodyAngleY:"ParamBodyAngleY",ParamBodyAngleZ:"ParamBodyAngleZ",ParamBreath:"ParamBreath",ParamArmLA:"ParamArmLA",ParamArmRA:"ParamArmRA",ParamArmLB:"ParamArmLB",ParamArmRB:"ParamArmRB",ParamHandL:"ParamHandL",ParamHandR:"ParamHandR",ParamHairFront:"ParamHairFront",ParamHairSide:"ParamHairSide",ParamHairBack:"ParamHairBack",ParamHairFluffy:"ParamHairFluffy",ParamShoulderY:"ParamShoulderY",ParamBustX:"ParamBustX",ParamBustY:"ParamBustY",ParamBaseX:"ParamBaseX",ParamBaseY:"ParamBaseY",ParamNONE:"NONE:"});var Zn;(e=>{e.HitAreaBody=C.HitAreaBody,e.HitAreaHead=C.HitAreaHead,e.HitAreaPrefix=C.HitAreaPrefix,e.ParamAngleX=C.ParamAngleX,e.ParamAngleY=C.ParamAngleY,e.ParamAngleZ=C.ParamAngleZ,e.ParamArmLA=C.ParamArmLA,e.ParamArmLB=C.ParamArmLB,e.ParamArmRA=C.ParamArmRA,e.ParamArmRB=C.ParamArmRB,e.ParamBaseX=C.ParamBaseX,e.ParamBaseY=C.ParamBaseY,e.ParamBodyAngleX=C.ParamBodyAngleX,e.ParamBodyAngleY=C.ParamBodyAngleY,e.ParamBodyAngleZ=C.ParamBodyAngleZ,e.ParamBreath=C.ParamBreath,e.ParamBrowLAngle=C.ParamBrowLAngle,e.ParamBrowLForm=C.ParamBrowLForm,e.ParamBrowLX=C.ParamBrowLX,e.ParamBrowLY=C.ParamBrowLY,e.ParamBrowRAngle=C.ParamBrowRAngle,e.ParamBrowRForm=C.ParamBrowRForm,e.ParamBrowRX=C.ParamBrowRX,e.ParamBrowRY=C.ParamBrowRY,e.ParamBustX=C.ParamBustX,e.ParamBustY=C.ParamBustY,e.ParamCheek=C.ParamCheek,e.ParamEyeBallForm=C.ParamEyeBallForm,e.ParamEyeBallX=C.ParamEyeBallX,e.ParamEyeBallY=C.ParamEyeBallY,e.ParamEyeLOpen=C.ParamEyeLOpen,e.ParamEyeLSmile=C.ParamEyeLSmile,e.ParamEyeROpen=C.ParamEyeROpen,e.ParamEyeRSmile=C.ParamEyeRSmile,e.ParamHairBack=C.ParamHairBack,e.ParamHairFluffy=C.ParamHairFluffy,e.ParamHairFront=C.ParamHairFront,e.ParamHairSide=C.ParamHairSide,e.ParamHandL=C.ParamHandL,e.ParamHandR=C.ParamHandR,e.ParamMouthForm=C.ParamMouthForm,e.ParamMouthOpenY=C.ParamMouthOpenY,e.ParamNONE=C.ParamNONE,e.ParamShoulderY=C.ParamShoulderY,e.PartsArmLPrefix=C.PartsArmLPrefix,e.PartsArmPrefix=C.PartsArmPrefix,e.PartsArmRPrefix=C.PartsArmRPrefix,e.PartsIdCore=C.PartsIdCore})(Zn||(Zn={}));class dh{}var Qn;(e=>{e.ICubismModelSetting=dh})(Qn||(Qn={}));var _h=(e=>(e[e.FrequestNode_Groups=0]="FrequestNode_Groups",e[e.FrequestNode_Moc=1]="FrequestNode_Moc",e[e.FrequestNode_Motions=2]="FrequestNode_Motions",e[e.FrequestNode_Expressions=3]="FrequestNode_Expressions",e[e.FrequestNode_Textures=4]="FrequestNode_Textures",e[e.FrequestNode_Physics=5]="FrequestNode_Physics",e[e.FrequestNode_Pose=6]="FrequestNode_Pose",e[e.FrequestNode_HitAreas=7]="FrequestNode_HitAreas",e))(_h||{});class fh extends dh{constructor(t,i){super(),this.version="Version",this.fileReferences="FileReferences",this.groups="Groups",this.layout="Layout",this.hitAreas="HitAreas",this.moc="Moc",this.textures="Textures",this.physics="Physics",this.pose="Pose",this.expressions="Expressions",this.motions="Motions",this.userData="UserData",this.name="Name",this.filePath="File",this.id="Id",this.ids="Ids",this.target="Target",this.idle="Idle",this.tapBody="TapBody",this.pinchIn="PinchIn",this.pinchOut="PinchOut",this.shake="Shake",this.flickHead="FlickHead",this.parameter="Parameter",this.soundPath="Sound",this.fadeInTime="FadeInTime",this.fadeOutTime="FadeOutTime",this.centerX="CenterX",this.centerY="CenterY",this.x="X",this.y="Y",this.width="Width",this.height="Height",this.lipSync="LipSync",this.eyeBlink="EyeBlink",this.initParameter="init_param",this.initPartsVisible="init_parts_visible",this.val="val",this._json=gt.create(t,i),this.getJson()&&(this._jsonValue=new y,this._jsonValue.pushBack(this.getJson().getRoot().getValueByString(this.groups)),this._jsonValue.pushBack(this.getJson().getRoot().getValueByString(this.fileReferences).getValueByString(this.moc)),this._jsonValue.pushBack(this.getJson().getRoot().getValueByString(this.fileReferences).getValueByString(this.motions)),this._jsonValue.pushBack(this.getJson().getRoot().getValueByString(this.fileReferences).getValueByString(this.expressions)),this._jsonValue.pushBack(this.getJson().getRoot().getValueByString(this.fileReferences).getValueByString(this.textures)),this._jsonValue.pushBack(this.getJson().getRoot().getValueByString(this.fileReferences).getValueByString(this.physics)),this._jsonValue.pushBack(this.getJson().getRoot().getValueByString(this.fileReferences).getValueByString(this.pose)),this._jsonValue.pushBack(this.getJson().getRoot().getValueByString(this.hitAreas)))}release(){gt.delete(this._json),this._jsonValue=null}getJson(){return this._json}getModelFileName(){return this.isExistModelFile()?this._jsonValue.at(1).getRawString():""}getTextureCount(){return this.isExistTextureFiles()?this._jsonValue.at(4).getSize():0}getTextureDirectory(){const i=this._jsonValue.at(4).getValueByIndex(0).getRawString().split("/"),s=i.length-1;let r="";for(let a=0;a<s;a++)r+=i[a],a<s-1&&(r+="/");return r}getTextureFileName(t){return this._jsonValue.at(4).getValueByIndex(t).getRawString()}getHitAreasCount(){return this.isExistHitAreas()?this._jsonValue.at(7).getSize():0}getHitAreaId(t){return R.getIdManager().getId(this._jsonValue.at(7).getValueByIndex(t).getValueByString(this.id).getRawString())}getHitAreaName(t){return this._jsonValue.at(7).getValueByIndex(t).getValueByString(this.name).getRawString()}getPhysicsFileName(){return this.isExistPhysicsFile()?this._jsonValue.at(5).getRawString():""}getPoseFileName(){return this.isExistPoseFile()?this._jsonValue.at(6).getRawString():""}getExpressionCount(){return this.isExistExpressionFile()?this._jsonValue.at(3).getSize():0}getExpressionName(t){return this._jsonValue.at(3).getValueByIndex(t).getValueByString(this.name).getRawString()}getExpressionFileName(t){return this._jsonValue.at(3).getValueByIndex(t).getValueByString(this.filePath).getRawString()}getMotionGroupCount(){return this.isExistMotionGroups()?this._jsonValue.at(2).getKeys().getSize():0}getMotionGroupName(t){return this.isExistMotionGroups()?this._jsonValue.at(2).getKeys().at(t):null}getMotionCount(t){return this.isExistMotionGroupName(t)?this._jsonValue.at(2).getValueByString(t).getSize():0}getMotionFileName(t,i){return this.isExistMotionGroupName(t)?this._jsonValue.at(2).getValueByString(t).getValueByIndex(i).getValueByString(this.filePath).getRawString():""}getMotionSoundFileName(t,i){return this.isExistMotionSoundFile(t,i)?this._jsonValue.at(2).getValueByString(t).getValueByIndex(i).getValueByString(this.soundPath).getRawString():""}getMotionFadeInTimeValue(t,i){return this.isExistMotionFadeIn(t,i)?this._jsonValue.at(2).getValueByString(t).getValueByIndex(i).getValueByString(this.fadeInTime).toFloat():-1}getMotionFadeOutTimeValue(t,i){return this.isExistMotionFadeOut(t,i)?this._jsonValue.at(2).getValueByString(t).getValueByIndex(i).getValueByString(this.fadeOutTime).toFloat():-1}getUserDataFile(){return this.isExistUserDataFile()?this.getJson().getRoot().getValueByString(this.fileReferences).getValueByString(this.userData).getRawString():""}getLayoutMap(t){const i=this.getJson().getRoot().getValueByString(this.layout).getMap();if(i==null)return!1;let s=!1;for(const r=i.begin();r.notEqual(i.end());r.preIncrement())t.setValue(r.ptr().first,r.ptr().second.toFloat()),s=!0;return s}getEyeBlinkParameterCount(){if(!this.isExistEyeBlinkParameters())return 0;let t=0;for(let i=0;i<this._jsonValue.at(0).getSize();i++){const s=this._jsonValue.at(0).getValueByIndex(i);if(!(s.isNull()||s.isError())&&s.getValueByString(this.name).getRawString()==this.eyeBlink){t=s.getValueByString(this.ids).getVector().getSize();break}}return t}getEyeBlinkParameterId(t){if(!this.isExistEyeBlinkParameters())return null;for(let i=0;i<this._jsonValue.at(0).getSize();i++){const s=this._jsonValue.at(0).getValueByIndex(i);if(!(s.isNull()||s.isError())&&s.getValueByString(this.name).getRawString()==this.eyeBlink)return R.getIdManager().getId(s.getValueByString(this.ids).getValueByIndex(t).getRawString())}return null}getLipSyncParameterCount(){if(!this.isExistLipSyncParameters())return 0;let t=0;for(let i=0;i<this._jsonValue.at(0).getSize();i++){const s=this._jsonValue.at(0).getValueByIndex(i);if(!(s.isNull()||s.isError())&&s.getValueByString(this.name).getRawString()==this.lipSync){t=s.getValueByString(this.ids).getVector().getSize();break}}return t}getLipSyncParameterId(t){if(!this.isExistLipSyncParameters())return null;for(let i=0;i<this._jsonValue.at(0).getSize();i++){const s=this._jsonValue.at(0).getValueByIndex(i);if(!(s.isNull()||s.isError())&&s.getValueByString(this.name).getRawString()==this.lipSync)return R.getIdManager().getId(s.getValueByString(this.ids).getValueByIndex(t).getRawString())}return null}isExistModelFile(){const t=this._jsonValue.at(1);return!t.isNull()&&!t.isError()}isExistTextureFiles(){const t=this._jsonValue.at(4);return!t.isNull()&&!t.isError()}isExistHitAreas(){const t=this._jsonValue.at(7);return!t.isNull()&&!t.isError()}isExistPhysicsFile(){const t=this._jsonValue.at(5);return!t.isNull()&&!t.isError()}isExistPoseFile(){const t=this._jsonValue.at(6);return!t.isNull()&&!t.isError()}isExistExpressionFile(){const t=this._jsonValue.at(3);return!t.isNull()&&!t.isError()}isExistMotionGroups(){const t=this._jsonValue.at(2);return!t.isNull()&&!t.isError()}isExistMotionGroupName(t){const i=this._jsonValue.at(2).getValueByString(t);return!i.isNull()&&!i.isError()}isExistMotionSoundFile(t,i){const s=this._jsonValue.at(2).getValueByString(t).getValueByIndex(i).getValueByString(this.soundPath);return!s.isNull()&&!s.isError()}isExistMotionFadeIn(t,i){const s=this._jsonValue.at(2).getValueByString(t).getValueByIndex(i).getValueByString(this.fadeInTime);return!s.isNull()&&!s.isError()}isExistMotionFadeOut(t,i){const s=this._jsonValue.at(2).getValueByString(t).getValueByIndex(i).getValueByString(this.fadeOutTime);return!s.isNull()&&!s.isError()}isExistUserDataFile(){const t=this.getJson().getRoot().getValueByString(this.fileReferences).getValueByString(this.userData);return!t.isNull()&&!t.isError()}isExistEyeBlinkParameters(){if(this._jsonValue.at(0).isNull()||this._jsonValue.at(0).isError())return!1;for(let t=0;t<this._jsonValue.at(0).getSize();++t)if(this._jsonValue.at(0).getValueByIndex(t).getValueByString(this.name).getRawString()==this.eyeBlink)return!0;return!1}isExistLipSyncParameters(){if(this._jsonValue.at(0).isNull()||this._jsonValue.at(0).isError())return!1;for(let t=0;t<this._jsonValue.at(0).getSize();++t)if(this._jsonValue.at(0).getValueByIndex(t).getValueByString(this.name).getRawString()==this.lipSync)return!0;return!1}}var to;(e=>{e.CubismModelSettingJson=fh,e.FrequestNode=_h})(to||(to={}));class ds{static create(){return new ds}static delete(t){}setParameters(t){this._breathParameters=t}getParameters(){return this._breathParameters}updateParameters(t,i){this._currentTime+=i;const s=this._currentTime*2*Math.PI;for(let r=0;r<this._breathParameters.getSize();++r){const a=this._breathParameters.at(r);t.addParameterValueById(a.parameterId,a.offset+a.peak*Math.sin(s/a.cycle),a.weight)}}constructor(){this._currentTime=0}}class ai{constructor(t,i,s,r,a){this.parameterId=t??null,this.offset=i??0,this.peak=s??0,this.cycle=r??0,this.weight=a??0}}var eo;(e=>{e.BreathParameterData=ai,e.CubismBreath=ds})(eo||(eo={}));const Qi=class Qi{static create(t=null){return new Qi(t)}static delete(t){}setBlinkingInterval(t){this._blinkingIntervalSeconds=t}setBlinkingSetting(t,i,s){this._closingSeconds=t,this._closedSeconds=i,this._openingSeconds=s}setParameterIds(t){this._parameterIds=t}getParameterIds(){return this._parameterIds}updateParameters(t,i){this._userTimeSeconds+=i;let s,r=0;switch(this._blinkingState){case 2:r=(this._userTimeSeconds-this._stateStartTimeSeconds)/this._closingSeconds,r>=1&&(r=1,this._blinkingState=3,this._stateStartTimeSeconds=this._userTimeSeconds),s=1-r;break;case 3:r=(this._userTimeSeconds-this._stateStartTimeSeconds)/this._closedSeconds,r>=1&&(this._blinkingState=4,this._stateStartTimeSeconds=this._userTimeSeconds),s=0;break;case 4:r=(this._userTimeSeconds-this._stateStartTimeSeconds)/this._openingSeconds,r>=1&&(r=1,this._blinkingState=1,this._nextBlinkingTime=this.determinNextBlinkingTiming()),s=r;break;case 1:this._nextBlinkingTime<this._userTimeSeconds&&(this._blinkingState=2,this._stateStartTimeSeconds=this._userTimeSeconds),s=1;break;case 0:default:this._blinkingState=1,this._nextBlinkingTime=this.determinNextBlinkingTiming(),s=1;break}Qi.CloseIfZero||(s=-s);for(let n=0;n<this._parameterIds.getSize();++n)t.setParameterValueById(this._parameterIds.at(n),s)}constructor(t){if(this._blinkingState=0,this._nextBlinkingTime=0,this._stateStartTimeSeconds=0,this._blinkingIntervalSeconds=4,this._closingSeconds=.1,this._closedSeconds=.05,this._openingSeconds=.15,this._userTimeSeconds=0,this._parameterIds=new y,t!=null)for(let i=0;i<t.getEyeBlinkParameterCount();++i)this._parameterIds.pushBack(t.getEyeBlinkParameterId(i))}determinNextBlinkingTiming(){const t=Math.random();return this._userTimeSeconds+t*(2*this._blinkingIntervalSeconds-1)}};Qi.CloseIfZero=!0;let is=Qi;var mh=(e=>(e[e.EyeState_First=0]="EyeState_First",e[e.EyeState_Interval=1]="EyeState_Interval",e[e.EyeState_Closing=2]="EyeState_Closing",e[e.EyeState_Closed=3]="EyeState_Closed",e[e.EyeState_Opening=4]="EyeState_Opening",e))(mh||{}),io;(e=>{e.CubismEyeBlink=is,e.EyeState=mh})(io||(io={}));const gg=.001,Tr=.5,so="FadeInTime",ro="Link",dg="Groups",_g="Id";class ss{static create(t,i){const s=gt.create(t,i);if(!s)return null;const r=new ss,a=s.getRoot();a.getValueByString(so).isNull()||(r._fadeTimeSeconds=a.getValueByString(so).toFloat(Tr),r._fadeTimeSeconds<0&&(r._fadeTimeSeconds=Tr));const n=a.getValueByString(dg),o=n.getSize();for(let l=0;l<o;++l){const h=n.getValueByIndex(l),u=h.getSize();let c=0;for(let d=0;d<u;++d){const g=h.getValueByIndex(d),_=new rs,m=R.getIdManager().getId(g.getValueByString(_g).getRawString());if(_.partId=m,!g.getValueByString(ro).isNull()){const f=g.getValueByString(ro),b=f.getSize();for(let x=0;x<b;++x){const E=new rs,A=R.getIdManager().getId(f.getValueByIndex(x).getString());E.partId=A,_.link.pushBack(E)}}r._partGroups.pushBack(_.clone()),++c}r._partGroupCounts.pushBack(c)}return gt.delete(s),r}static delete(t){}updateParameters(t,i){t!=this._lastModel&&this.reset(t),this._lastModel=t,i<0&&(i=0);let s=0;for(let r=0;r<this._partGroupCounts.getSize();r++){const a=this._partGroupCounts.at(r);this.doFade(t,i,s,a),s+=a}this.copyPartOpacities(t)}reset(t){let i=0;for(let s=0;s<this._partGroupCounts.getSize();++s){const r=this._partGroupCounts.at(s);for(let a=i;a<i+r;++a){this._partGroups.at(a).initialize(t);const n=this._partGroups.at(a).partIndex,o=this._partGroups.at(a).parameterIndex;if(!(n<0)){t.setPartOpacityByIndex(n,a==i?1:0),t.setParameterValueByIndex(o,a==i?1:0);for(let l=0;l<this._partGroups.at(a).link.getSize();++l)this._partGroups.at(a).link.at(l).initialize(t)}}i+=r}}copyPartOpacities(t){for(let i=0;i<this._partGroups.getSize();++i){const s=this._partGroups.at(i);if(s.link.getSize()==0)continue;const r=this._partGroups.at(i).partIndex,a=t.getPartOpacityByIndex(r);for(let n=0;n<s.link.getSize();++n){const l=s.link.at(n).partIndex;l<0||t.setPartOpacityByIndex(l,a)}}}doFade(t,i,s,r){let a=-1,n=1;const o=.5,l=.15;for(let h=s;h<s+r;++h){const u=this._partGroups.at(h).partIndex,c=this._partGroups.at(h).parameterIndex;if(t.getParameterValueByIndex(c)>gg){if(a>=0)break;if(a=h,this._fadeTimeSeconds==0){n=1;continue}n=t.getPartOpacityByIndex(u),n+=i/this._fadeTimeSeconds,n>1&&(n=1)}}a<0&&(a=0,n=1);for(let h=s;h<s+r;++h){const u=this._partGroups.at(h).partIndex;if(a==h)t.setPartOpacityByIndex(u,n);else{let c=t.getPartOpacityByIndex(u),d;n<o?d=n*(o-1)/o+1:d=(1-n)*o/(1-o),(1-d)*(1-n)>l&&(d=1-l/(1-n)),c>d&&(c=d),t.setPartOpacityByIndex(u,c)}}}constructor(){this._fadeTimeSeconds=Tr,this._lastModel=null,this._partGroups=new y,this._partGroupCounts=new y}}class rs{constructor(t){if(this.parameterIndex=0,this.partIndex=0,this.link=new y,t!=null){this.partId=t.partId;for(const i=t.link.begin();i.notEqual(t.link.end());i.preIncrement())this.link.pushBack(i.ptr().clone())}}assignment(t){this.partId=t.partId;for(const i=t.link.begin();i.notEqual(t.link.end());i.preIncrement())this.link.pushBack(i.ptr().clone());return this}initialize(t){this.parameterIndex=t.getParameterIndex(this.partId),this.partIndex=t.getPartIndex(this.partId),t.setParameterValueByIndex(this.parameterIndex,1)}clone(){const t=new rs;t.partId=this.partId,t.parameterIndex=this.parameterIndex,t.partIndex=this.partIndex,t.link=new y;for(let i=this.link.begin();i.notEqual(this.link.end());i.increment())t.link.pushBack(i.ptr().clone());return t}}var ao;(e=>{e.CubismPose=ss,e.PartData=rs})(ao||(ao={}));class ph extends st{constructor(t,i){super(),this._width=t!==void 0?t:0,this._height=i!==void 0?i:0,this.setHeight(2)}setWidth(t){const i=t/this._width,s=i;this.scale(i,s)}setHeight(t){const i=t/this._height,s=i;this.scale(i,s)}setPosition(t,i){this.translate(t,i)}setCenterPosition(t,i){this.centerX(t),this.centerY(i)}top(t){this.setY(t)}bottom(t){const i=this._height*this.getScaleY();this.translateY(t-i)}left(t){this.setX(t)}right(t){const i=this._width*this.getScaleX();this.translateX(t-i)}centerX(t){const i=this._width*this.getScaleX();this.translateX(t-i/2)}setX(t){this.translateX(t)}centerY(t){const i=this._height*this.getScaleY();this.translateY(t-i/2)}setY(t){this.translateY(t)}setupFromLayout(t){const i="width",s="height",r="x",a="y",n="center_x",o="center_y",l="top",h="bottom",u="left",c="right";for(const d=t.begin();d.notEqual(t.end());d.preIncrement()){const g=d.ptr().first,_=d.ptr().second;g==i?this.setWidth(_):g==s&&this.setHeight(_)}for(const d=t.begin();d.notEqual(t.end());d.preIncrement()){const g=d.ptr().first,_=d.ptr().second;g==r?this.setX(_):g==a?this.setY(_):g==n?this.centerX(_):g==o?this.centerY(_):g==l?this.top(_):g==h?this.bottom(_):g==u?this.left(_):g==c&&this.right(_)}}}var no;(e=>{e.CubismModelMatrix=ph})(no||(no={}));class B{constructor(t,i){this.x=t,this.y=i,this.x=t??0,this.y=i??0}add(t){const i=new B(0,0);return i.x=this.x+t.x,i.y=this.y+t.y,i}substract(t){const i=new B(0,0);return i.x=this.x-t.x,i.y=this.y-t.y,i}multiply(t){const i=new B(0,0);return i.x=this.x*t.x,i.y=this.y*t.y,i}multiplyByScaler(t){return this.multiply(new B(t,t))}division(t){const i=new B(0,0);return i.x=this.x/t.x,i.y=this.y/t.y,i}divisionByScalar(t){return this.division(new B(t,t))}getLength(){return Math.sqrt(this.x*this.x+this.y*this.y)}getDistanceWith(t){return Math.sqrt((this.x-t.x)*(this.x-t.x)+(this.y-t.y)*(this.y-t.y))}dot(t){return this.x*t.x+this.y*t.y}normalize(){const t=Math.pow(this.x*this.x+this.y*this.y,.5);this.x=this.x/t,this.y=this.y/t}isEqual(t){return this.x==t.x&&this.y==t.y}isNotEqual(t){return!this.isEqual(t)}}var oo;(e=>{e.CubismVector2=B})(oo||(oo={}));const hi=class hi{static range(t,i,s){return t<i?t=i:t>s&&(t=s),t}static sin(t){return Math.sin(t)}static cos(t){return Math.cos(t)}static abs(t){return Math.abs(t)}static sqrt(t){return Math.sqrt(t)}static cbrt(t){if(t===0)return t;let i=t;const s=i<0;s&&(i=-i);let r;return i===1/0?r=1/0:(r=Math.exp(Math.log(i)/3),r=(i/(r*r)+2*r)/3),s?-r:r}static getEasingSine(t){return t<0?0:t>1?1:.5-.5*this.cos(t*Math.PI)}static max(t,i){return t>i?t:i}static min(t,i){return t>i?i:t}static clamp(t,i,s){return t<i?i:s<t?s:t}static degreesToRadian(t){return t/180*Math.PI}static radianToDegrees(t){return t*180/Math.PI}static directionToRadian(t,i){const s=Math.atan2(i.y,i.x),r=Math.atan2(t.y,t.x);let a=s-r;for(;a<-Math.PI;)a+=Math.PI*2;for(;a>Math.PI;)a-=Math.PI*2;return a}static directionToDegrees(t,i){const s=this.directionToRadian(t,i);let r=this.radianToDegrees(s);return i.x-t.x>0&&(r=-r),r}static radianToDirection(t){const i=new B;return i.x=this.sin(t),i.y=this.cos(t),i}static quadraticEquation(t,i,s){return this.abs(t)<hi.Epsilon?this.abs(i)<hi.Epsilon?-s:-s/i:-(i+this.sqrt(i*i-4*t*s))/(2*t)}static cardanoAlgorithmForBezier(t,i,s,r){if(this.abs(t)<hi.Epsilon)return this.range(this.quadraticEquation(i,s,r),0,1);const a=i/t,n=s/t,o=r/t,l=(3*n-a*a)/3,h=l/3,u=(2*a*a*a-9*a*n+27*o)/27,c=u/2,d=c*c+h*h*h,g=.5,_=g+.01;if(d<0){const E=-l/3,A=E*E*E,T=this.sqrt(A),M=-u/(2*T),Y=this.range(M,-1,1),xt=Math.acos(Y),Je=2*this.cbrt(T),Ke=Je*this.cos(xt/3)-a/3;if(this.abs(Ke-g)<_)return this.range(Ke,0,1);const Oi=Je*this.cos((xt+2*Math.PI)/3)-a/3;if(this.abs(Oi-g)<_)return this.range(Oi,0,1);const zc=Je*this.cos((xt+4*Math.PI)/3)-a/3;return this.range(zc,0,1)}if(d==0){let E;c<0?E=this.cbrt(-c):E=-this.cbrt(c);const A=2*E-a/3;if(this.abs(A-g)<_)return this.range(A,0,1);const T=-E-a/3;return this.range(T,0,1)}const m=this.sqrt(d),f=this.cbrt(m-c),b=this.cbrt(m+c),x=f-b-a/3;return this.range(x,0,1)}static mod(t,i){if(!isFinite(t)||i===0||isNaN(t)||isNaN(i))return console.warn(`divided: ${t}, divisor: ${i} mod() returns 'NaN'.`),NaN;const s=Math.abs(t),r=Math.abs(i);let a=s-Math.floor(s/r)*r;return a*=Math.sign(t),a}constructor(){}};hi.Epsilon=1e-5;let F=hi;var lo;(e=>{e.CubismMath=F})(lo||(lo={}));const Ar=30,ho=.01;class yh{constructor(){this._faceTargetX=0,this._faceTargetY=0,this._faceX=0,this._faceY=0,this._faceVX=0,this._faceVY=0,this._lastTimeSeconds=0,this._userTimeSeconds=0}update(t){this._userTimeSeconds+=t;const s=40/10*1/Ar;if(this._lastTimeSeconds==0){this._lastTimeSeconds=this._userTimeSeconds;return}const r=(this._userTimeSeconds-this._lastTimeSeconds)*Ar;this._lastTimeSeconds=this._userTimeSeconds;const n=.15*Ar,o=r*s/n,l=this._faceTargetX-this._faceX,h=this._faceTargetY-this._faceY;if(F.abs(l)<=ho&&F.abs(h)<=ho)return;const u=F.sqrt(l*l+h*h),c=s*l/u,d=s*h/u;let g=c-this._faceVX,_=d-this._faceVY;const m=F.sqrt(g*g+_*_);(m<-o||m>o)&&(g*=o/m,_*=o/m),this._faceVX+=g,this._faceVY+=_;{const f=.5*(F.sqrt(o*o+16*o*u-8*o*u)-o),b=F.sqrt(this._faceVX*this._faceVX+this._faceVY*this._faceVY);b>f&&(this._faceVX*=f/b,this._faceVY*=f/b)}this._faceX+=this._faceVX,this._faceY+=this._faceVY}getX(){return this._faceX}getY(){return this._faceY}set(t,i){this._faceTargetX=t,this._faceTargetY=i}}var uo;(e=>{e.CubismTargetPoint=yh})(uo||(uo={}));class Si{constructor(){this.setBeganMotionHandler=t=>this._onBeganMotion=t,this.getBeganMotionHandler=()=>this._onBeganMotion,this.setFinishedMotionHandler=t=>this._onFinishedMotion=t,this.getFinishedMotionHandler=()=>this._onFinishedMotion,this._fadeInSeconds=-1,this._fadeOutSeconds=-1,this._weight=1,this._offsetSeconds=0,this._isLoop=!1,this._isLoopFadeIn=!0,this._previousLoopState=this._isLoop,this._firedEventValues=new y}static delete(t){t.release(),t=null}release(){this._weight=0}updateParameters(t,i,s){if(!i.isAvailable()||i.isFinished())return;this.setupMotionQueueEntry(i,s);const r=this.updateFadeWeight(i,s);this.doUpdateParameters(t,s,r,i),i.getEndTime()>0&&i.getEndTime()<s&&i.setIsFinished(!0)}setupMotionQueueEntry(t,i){t==null||t.isStarted()||t.isAvailable()&&(t.setIsStarted(!0),t.setStartTime(i-this._offsetSeconds),t.setFadeInStartTime(i),t.getEndTime()<0&&this.adjustEndTime(t),t._motion._onBeganMotion&&t._motion._onBeganMotion(t._motion))}updateFadeWeight(t,i){t==null&&Ma.print(ze.LogLevel_Error,"motionQueueEntry is null.");let s=this._weight;const r=this._fadeInSeconds==0?1:F.getEasingSine((i-t.getFadeInStartTime())/this._fadeInSeconds),a=this._fadeOutSeconds==0||t.getEndTime()<0?1:F.getEasingSine((t.getEndTime()-i)/this._fadeOutSeconds);return s=s*r*a,t.setState(i,s),ft(0<=s&&s<=1),s}setFadeInTime(t){this._fadeInSeconds=t}setFadeOutTime(t){this._fadeOutSeconds=t}getFadeOutTime(){return this._fadeOutSeconds}getFadeInTime(){return this._fadeInSeconds}setWeight(t){this._weight=t}getWeight(){return this._weight}getDuration(){return-1}getLoopDuration(){return-1}setOffsetTime(t){this._offsetSeconds=t}setLoop(t){this._isLoop=t}getLoop(){return this._isLoop}setLoopFadeIn(t){this._isLoopFadeIn=t}getLoopFadeIn(){return this._isLoopFadeIn}getFiredEvent(t,i){return this._firedEventValues}isExistModelOpacity(){return!1}getModelOpacityIndex(){return-1}getModelOpacityId(t){return null}getModelOpacityValue(){return 1}adjustEndTime(t){const i=this.getDuration(),s=i<=0?-1:t.getStartTime()+i;t.setEndTime(s)}}var co;(e=>{e.ACubismMotion=Si})(co||(co={}));const fg="FadeInTime",mg="FadeOutTime",go="Parameters",pg="Id",yg="Value",Cs="Blend",Sg="Add",xg="Multiply",Cg="Overwrite",_o=1,At=class At extends Si{static create(t,i){const s=new At;return s.parse(t,i),s}doUpdateParameters(t,i,s,r){for(let a=0;a<this._parameters.getSize();++a){const n=this._parameters.at(a);switch(n.blendType){case 0:{t.addParameterValueById(n.parameterId,n.value,s);break}case 1:{t.multiplyParameterValueById(n.parameterId,n.value,s);break}case 2:{t.setParameterValueById(n.parameterId,n.value,s);break}}}}calculateExpressionParameters(t,i,s,r,a,n){if(!(s==null||r==null)&&s.isAvailable()){this._fadeWeight=this.updateFadeWeight(s,i);for(let o=0;o<r.getSize();++o){const l=r.at(o);if(l.parameterId==null)continue;const h=l.overwriteValue=t.getParameterValueById(l.parameterId),u=this.getExpressionParameters();let c=-1;for(let f=0;f<u.getSize();++f)if(l.parameterId==u.at(f).parameterId){c=f;break}if(c<0){a==0?(l.additiveValue=At.DefaultAdditiveValue,l.multiplyValue=At.DefaultMultiplyValue,l.overwriteValue=h):(l.additiveValue=this.calculateValue(l.additiveValue,At.DefaultAdditiveValue,n),l.multiplyValue=this.calculateValue(l.multiplyValue,At.DefaultMultiplyValue,n),l.overwriteValue=this.calculateValue(l.overwriteValue,h,n));continue}const d=u.at(c).value;let g,_,m;switch(u.at(c).blendType){case 0:g=d,_=At.DefaultMultiplyValue,m=h;break;case 1:g=At.DefaultAdditiveValue,_=d,m=h;break;case 2:g=At.DefaultAdditiveValue,_=At.DefaultMultiplyValue,m=d;break;default:return}a==0?(l.additiveValue=g,l.multiplyValue=_,l.overwriteValue=m):(l.additiveValue=l.additiveValue*(1-n)+g*n,l.multiplyValue=l.multiplyValue*(1-n)+_*n,l.overwriteValue=l.overwriteValue*(1-n)+m*n)}}}getExpressionParameters(){return this._parameters}getFadeWeight(){return this._fadeWeight}parse(t,i){const s=gt.create(t,i);if(!s)return;const r=s.getRoot();this.setFadeInTime(r.getValueByString(fg).toFloat(_o)),this.setFadeOutTime(r.getValueByString(mg).toFloat(_o));const a=r.getValueByString(go).getSize();this._parameters.prepareCapacity(a);for(let n=0;n<a;++n){const o=r.getValueByString(go).getValueByIndex(n),l=R.getIdManager().getId(o.getValueByString(pg).getRawString()),h=o.getValueByString(yg).toFloat();let u;o.getValueByString(Cs).isNull()||o.getValueByString(Cs).getString()==Sg?u=0:o.getValueByString(Cs).getString()==xg?u=1:o.getValueByString(Cs).getString()==Cg?u=2:u=0;const c=new xh;c.parameterId=l,c.blendType=u,c.value=h,this._parameters.pushBack(c)}gt.delete(s)}calculateValue(t,i,s){return t*(1-s)+i*s}constructor(){super(),this._parameters=new y,this._fadeWeight=0}};At.DefaultAdditiveValue=0,At.DefaultMultiplyValue=1;let Be=At;var Sh=(e=>(e[e.Additive=0]="Additive",e[e.Multiply=1]="Multiply",e[e.Overwrite=2]="Overwrite",e))(Sh||{});class xh{}var fo;(e=>{e.CubismExpressionMotion=Be,e.ExpressionBlendType=Sh,e.ExpressionParameter=xh})(fo||(fo={}));class Ch{constructor(){this._autoDelete=!1,this._motion=null,this._available=!0,this._finished=!1,this._started=!1,this._startTimeSeconds=-1,this._fadeInStartTimeSeconds=0,this._endTimeSeconds=-1,this._stateTimeSeconds=0,this._stateWeight=0,this._lastEventCheckSeconds=0,this._motionQueueEntryHandle=this,this._fadeOutSeconds=0,this._isTriggeredFadeOut=!1}release(){this._autoDelete&&this._motion&&Si.delete(this._motion)}setFadeOut(t){this._fadeOutSeconds=t,this._isTriggeredFadeOut=!0}startFadeOut(t,i){const s=i+t;this._isTriggeredFadeOut=!0,(this._endTimeSeconds<0||s<this._endTimeSeconds)&&(this._endTimeSeconds=s)}isFinished(){return this._finished}isStarted(){return this._started}getStartTime(){return this._startTimeSeconds}getFadeInStartTime(){return this._fadeInStartTimeSeconds}getEndTime(){return this._endTimeSeconds}setStartTime(t){this._startTimeSeconds=t}setFadeInStartTime(t){this._fadeInStartTimeSeconds=t}setEndTime(t){this._endTimeSeconds=t}setIsFinished(t){this._finished=t}setIsStarted(t){this._started=t}isAvailable(){return this._available}setIsAvailable(t){this._available=t}setState(t,i){this._stateTimeSeconds=t,this._stateWeight=i}getStateTime(){return this._stateTimeSeconds}getStateWeight(){return this._stateWeight}getLastCheckEventSeconds(){return this._lastEventCheckSeconds}setLastCheckEventSeconds(t){this._lastEventCheckSeconds=t}isTriggeredFadeOut(){return this._isTriggeredFadeOut}getFadeOutSeconds(){return this._fadeOutSeconds}getCubismMotion(){return this._motion}}var mo;(e=>{e.CubismMotionQueueEntry=Ch})(mo||(mo={}));class wa{constructor(){this._userTimeSeconds=0,this._eventCallBack=null,this._eventCustomData=null,this._motions=new y}release(){for(let t=0;t<this._motions.getSize();++t)this._motions.at(t)&&(this._motions.at(t).release(),this._motions.set(t,null));this._motions=null}startMotion(t,i,s){if(t==null)return Wi;let r=null;for(let a=0;a<this._motions.getSize();++a)r=this._motions.at(a),r!=null&&r.setFadeOut(r._motion.getFadeOutTime());return r=new Ch,r._autoDelete=i,r._motion=t,this._motions.pushBack(r),r._motionQueueEntryHandle}isFinished(){for(let t=this._motions.begin();t.notEqual(this._motions.end());){let i=t.ptr();if(i==null){t=this._motions.erase(t);continue}if(i._motion==null){i.release(),i=null,t=this._motions.erase(t);continue}if(i.isFinished())t.preIncrement();else return!1}return!0}isFinishedByHandle(t){for(let i=this._motions.begin();i.notEqual(this._motions.end());i.increment()){const s=i.ptr();if(s!=null&&s._motionQueueEntryHandle==t&&!s.isFinished())return!1}return!0}stopAllMotions(){for(let t=this._motions.begin();t.notEqual(this._motions.end());){let i=t.ptr();if(i==null){t=this._motions.erase(t);continue}i.release(),i=null,t=this._motions.erase(t)}}getCubismMotionQueueEntries(){return this._motions}getCubismMotionQueueEntry(t){for(let i=this._motions.begin();i.notEqual(this._motions.end());i.preIncrement()){const s=i.ptr();if(s!=null&&s._motionQueueEntryHandle==t)return s}return null}setEventCallback(t,i=null){this._eventCallBack=t,this._eventCustomData=i}doUpdateMotion(t,i){let s=!1;for(let r=this._motions.begin();r.notEqual(this._motions.end());){let a=r.ptr();if(a==null){r=this._motions.erase(r);continue}const n=a._motion;if(n==null){a.release(),a=null,r=this._motions.erase(r);continue}n.updateParameters(t,a,i),s=!0;const o=n.getFiredEvent(a.getLastCheckEventSeconds()-a.getStartTime(),i-a.getStartTime());for(let l=0;l<o.getSize();++l)this._eventCallBack(this,o.at(l),this._eventCustomData);a.setLastCheckEventSeconds(i),a.isFinished()?(a.release(),a=null,r=this._motions.erase(r)):(a.isTriggeredFadeOut()&&a.startFadeOut(a.getFadeOutSeconds(),i),r.preIncrement())}return s}}const Wi=-1;var po;(e=>{e.CubismMotionQueueManager=wa,e.InvalidMotionQueueEntryHandleValue=Wi})(po||(po={}));class vg{}class vh extends wa{constructor(){super(),this._currentPriority=0,this._reservePriority=0,this._expressionParameterValues=new y,this._fadeWeights=new y}release(){this._expressionParameterValues&&(ni(this._expressionParameterValues),this._expressionParameterValues=null),this._fadeWeights&&(ni(this._fadeWeights),this._fadeWeights=null)}getCurrentPriority(){return mt("CubismExpressionMotionManager.getCurrentPriority() is deprecated because a priority value is not actually used during expression motion playback."),this._currentPriority}getReservePriority(){return mt("CubismExpressionMotionManager.getReservePriority() is deprecated because a priority value is not actually used during expression motion playback."),this._reservePriority}getFadeWeight(t){return t<0||this._fadeWeights.getSize()<1||t>=this._fadeWeights.getSize()?(console.warn("Failed to get the fade weight value. The element at that index does not exist."),-1):this._fadeWeights.at(t)}setFadeWeight(t,i){if(t<0||this._fadeWeights.getSize()<1||this._fadeWeights.getSize()<=t){console.warn("Failed to set the fade weight value. The element at that index does not exist.");return}this._fadeWeights.set(t,i)}setReservePriority(t){mt("CubismExpressionMotionManager.setReservePriority() is deprecated because a priority value is not actually used during expression motion playback."),this._reservePriority=t}startMotionPriority(t,i,s){return mt("CubismExpressionMotionManager.startMotionPriority() is deprecated because a priority value is not actually used during expression motion playback."),s==this.getReservePriority()&&this.setReservePriority(0),this._currentPriority=s,this.startMotion(t,i)}updateMotion(t,i){this._userTimeSeconds+=i;let s=!1;const r=this.getCubismMotionQueueEntries();let a=0,n=0;if(this._fadeWeights.getSize()!==r.getSize()){const o=r.getSize()-this._fadeWeights.getSize();for(let l=0;l<o;l++)this._fadeWeights.pushBack(0)}for(let o=this._motions.begin();o.notEqual(this._motions.end());){const l=o.ptr();if(l==null){o=r.erase(o);continue}const h=l.getCubismMotion();if(h==null){ni(l),o=r.erase(o);continue}const u=h.getExpressionParameters();if(l.isAvailable())for(let c=0;c<u.getSize();++c){if(u.at(c).parameterId==null)continue;let d=-1;for(let _=0;_<this._expressionParameterValues.getSize();++_)if(this._expressionParameterValues.at(_).parameterId==u.at(c).parameterId){d=_;break}if(d>=0)continue;const g=new vg;g.parameterId=u.at(c).parameterId,g.additiveValue=Be.DefaultAdditiveValue,g.multiplyValue=Be.DefaultMultiplyValue,g.overwriteValue=t.getParameterValueById(g.parameterId),this._expressionParameterValues.pushBack(g)}h.setupMotionQueueEntry(l,this._userTimeSeconds),this.setFadeWeight(n,h.updateFadeWeight(l,this._userTimeSeconds)),h.calculateExpressionParameters(t,this._userTimeSeconds,l,this._expressionParameterValues,n,this.getFadeWeight(n)),a+=h.getFadeInTime()==0?1:F.getEasingSine((this._userTimeSeconds-l.getFadeInStartTime())/h.getFadeInTime()),s=!0,l.isTriggeredFadeOut()&&l.startFadeOut(l.getFadeOutSeconds(),this._userTimeSeconds),o.preIncrement(),++n}if(r.getSize()>1&&this.getFadeWeight(this._fadeWeights.getSize()-1)>=1)for(let l=r.getSize()-2;l>=0;--l){const h=r.at(l);ni(h),r.remove(l),this._fadeWeights.remove(l)}a>1&&(a=1);for(let o=0;o<this._expressionParameterValues.getSize();++o){const l=this._expressionParameterValues.at(o);t.setParameterValueById(l.parameterId,(l.overwriteValue+l.additiveValue)*l.multiplyValue,a),l.additiveValue=Be.DefaultAdditiveValue,l.multiplyValue=Be.DefaultMultiplyValue}return s}}var yo;(e=>{e.CubismExpressionMotionManager=vh})(yo||(yo={}));var Jt=(e=>(e[e.CubismMotionCurveTarget_Model=0]="CubismMotionCurveTarget_Model",e[e.CubismMotionCurveTarget_Parameter=1]="CubismMotionCurveTarget_Parameter",e[e.CubismMotionCurveTarget_PartOpacity=2]="CubismMotionCurveTarget_PartOpacity",e))(Jt||{}),lt=(e=>(e[e.CubismMotionSegmentType_Linear=0]="CubismMotionSegmentType_Linear",e[e.CubismMotionSegmentType_Bezier=1]="CubismMotionSegmentType_Bezier",e[e.CubismMotionSegmentType_Stepped=2]="CubismMotionSegmentType_Stepped",e[e.CubismMotionSegmentType_InverseStepped=3]="CubismMotionSegmentType_InverseStepped",e))(lt||{});class as{constructor(){this.time=0,this.value=0}}class bh{constructor(){this.evaluate=null,this.basePointIndex=0,this.segmentType=0}}class Mh{constructor(){this.type=0,this.segmentCount=0,this.baseSegmentIndex=0,this.fadeInTime=0,this.fadeOutTime=0}}class Ph{constructor(){this.fireTime=0}}class wh{constructor(){this.duration=0,this.loop=!1,this.curveCount=0,this.eventCount=0,this.fps=0,this.curves=new y,this.segments=new y,this.points=new y,this.events=new y}}var So;(e=>{e.CubismMotionCurve=Mh,e.CubismMotionCurveTarget=Jt,e.CubismMotionData=wh,e.CubismMotionEvent=Ph,e.CubismMotionPoint=as,e.CubismMotionSegment=bh,e.CubismMotionSegmentType=lt})(So||(So={}));const Bt="Meta",bg="Duration",Mg="Loop",Pg="AreBeziersRestricted",wg="CurveCount",Bg="Fps",Ig="TotalSegmentCount",Eg="TotalPointCount",ue="Curves",Fg="Target",Tg="Id",vs="FadeInTime",bs="FadeOutTime",xo="Segments",Co="UserData",Ag="UserDataCount",Rg="TotalUserDataSize",Vg="Time",Lg="Value";class Bh{constructor(t,i){this._json=gt.create(t,i)}release(){gt.delete(this._json)}getMotionDuration(){return this._json.getRoot().getValueByString(Bt).getValueByString(bg).toFloat()}isMotionLoop(){return this._json.getRoot().getValueByString(Bt).getValueByString(Mg).toBoolean()}hasConsistency(){let t=!0;if(!this._json||!this._json.getRoot())return!1;const i=this._json.getRoot().getValueByString(ue).getVector().getSize();let s=0,r=0;for(let a=0;a<i;++a)for(let n=0;n<this.getMotionCurveSegmentCount(a);){switch(n==0&&(r+=1,n+=2),this.getMotionCurveSegment(a,n)){case lt.CubismMotionSegmentType_Linear:r+=1,n+=3;break;case lt.CubismMotionSegmentType_Bezier:r+=3,n+=7;break;case lt.CubismMotionSegmentType_Stepped:r+=1,n+=3;break;case lt.CubismMotionSegmentType_InverseStepped:r+=1,n+=3;break;default:ft(0);break}++s}return i!=this.getMotionCurveCount()&&(k("The number of curves does not match the metadata."),t=!1),s!=this.getMotionTotalSegmentCount()&&(k("The number of segment does not match the metadata."),t=!1),r!=this.getMotionTotalPointCount()&&(k("The number of point does not match the metadata."),t=!1),t}getEvaluationOptionFlag(t){return t==0?this._json.getRoot().getValueByString(Bt).getValueByString(Pg).toBoolean():!1}getMotionCurveCount(){return this._json.getRoot().getValueByString(Bt).getValueByString(wg).toInt()}getMotionFps(){return this._json.getRoot().getValueByString(Bt).getValueByString(Bg).toFloat()}getMotionTotalSegmentCount(){return this._json.getRoot().getValueByString(Bt).getValueByString(Ig).toInt()}getMotionTotalPointCount(){return this._json.getRoot().getValueByString(Bt).getValueByString(Eg).toInt()}isExistMotionFadeInTime(){return!this._json.getRoot().getValueByString(Bt).getValueByString(vs).isNull()}isExistMotionFadeOutTime(){return!this._json.getRoot().getValueByString(Bt).getValueByString(bs).isNull()}getMotionFadeInTime(){return this._json.getRoot().getValueByString(Bt).getValueByString(vs).toFloat()}getMotionFadeOutTime(){return this._json.getRoot().getValueByString(Bt).getValueByString(bs).toFloat()}getMotionCurveTarget(t){return this._json.getRoot().getValueByString(ue).getValueByIndex(t).getValueByString(Fg).getRawString()}getMotionCurveId(t){return R.getIdManager().getId(this._json.getRoot().getValueByString(ue).getValueByIndex(t).getValueByString(Tg).getRawString())}isExistMotionCurveFadeInTime(t){return!this._json.getRoot().getValueByString(ue).getValueByIndex(t).getValueByString(vs).isNull()}isExistMotionCurveFadeOutTime(t){return!this._json.getRoot().getValueByString(ue).getValueByIndex(t).getValueByString(bs).isNull()}getMotionCurveFadeInTime(t){return this._json.getRoot().getValueByString(ue).getValueByIndex(t).getValueByString(vs).toFloat()}getMotionCurveFadeOutTime(t){return this._json.getRoot().getValueByString(ue).getValueByIndex(t).getValueByString(bs).toFloat()}getMotionCurveSegmentCount(t){return this._json.getRoot().getValueByString(ue).getValueByIndex(t).getValueByString(xo).getVector().getSize()}getMotionCurveSegment(t,i){return this._json.getRoot().getValueByString(ue).getValueByIndex(t).getValueByString(xo).getValueByIndex(i).toFloat()}getEventCount(){return this._json.getRoot().getValueByString(Bt).getValueByString(Ag).toInt()}getTotalEventValueSize(){return this._json.getRoot().getValueByString(Bt).getValueByString(Rg).toInt()}getEventTime(t){return this._json.getRoot().getValueByString(Co).getValueByIndex(t).getValueByString(Vg).toFloat()}getEventValue(t){return new Xt(this._json.getRoot().getValueByString(Co).getValueByIndex(t).getValueByString(Lg).getRawString())}}var Ih=(e=>(e[e.EvaluationOptionFlag_AreBeziersRistricted=0]="EvaluationOptionFlag_AreBeziersRistricted",e))(Ih||{}),vo;(e=>{e.CubismMotionJson=Bh})(vo||(vo={}));const kg="EyeBlink",Dg="LipSync",Og="Model",Ng="Parameter",Ug="PartOpacity",Ms="Opacity",zg=!1;function Ut(e,t,i){const s=new as;return s.time=e.time+(t.time-e.time)*i,s.value=e.value+(t.value-e.value)*i,s}function Eh(e,t){let i=(t-e[0].time)/(e[1].time-e[0].time);return i<0&&(i=0),e[0].value+(e[1].value-e[0].value)*i}function Gg(e,t){let i=(t-e[0].time)/(e[3].time-e[0].time);i<0&&(i=0);const s=Ut(e[0],e[1],i),r=Ut(e[1],e[2],i),a=Ut(e[2],e[3],i),n=Ut(s,r,i),o=Ut(r,a,i);return Ut(n,o,i).value}function Xg(e,t){const i=t,s=e[0].time,r=e[3].time,a=e[1].time,n=e[2].time,o=r-3*n+3*a-s,l=3*n-6*a+3*s,h=3*a-3*s,u=s-i,c=F.cardanoAlgorithmForBezier(o,l,h,u),d=Ut(e[0],e[1],c),g=Ut(e[1],e[2],c),_=Ut(e[2],e[3],c),m=Ut(d,g,c),f=Ut(g,_,c);return Ut(m,f,c).value}function Fh(e,t){return e[0].value}function Th(e,t){return e[1].value}function Rr(e,t,i,s,r){const a=e.curves.at(t);let n=-1;const o=a.baseSegmentIndex+a.segmentCount;let l=0;for(let u=a.baseSegmentIndex;u<o;++u)if(l=e.segments.at(u).basePointIndex+(e.segments.at(u).segmentType==lt.CubismMotionSegmentType_Bezier?3:1),e.points.at(l).time>i){n=u;break}if(n==-1)return s&&i<r?jg(e,o-1,e.segments.at(a.baseSegmentIndex).basePointIndex,l,i,r):e.points.at(l).value;const h=e.segments.at(n);return h.evaluate(e.points.get(h.basePointIndex),i)}function jg(e,t,i,s,r,a){const n=[new as,new as];{const o=e.points.at(s);n[0].time=o.time,n[0].value=o.value}{const o=e.points.at(i);n[1].time=a,n[1].value=o.value}switch(e.segments.at(t).segmentType){case lt.CubismMotionSegmentType_Linear:case lt.CubismMotionSegmentType_Bezier:default:return Eh(n,r);case lt.CubismMotionSegmentType_Stepped:return Fh(n);case lt.CubismMotionSegmentType_InverseStepped:return Th(n)}}class er extends Si{constructor(){super(),this._motionBehavior=1,this._sourceFrameRate=30,this._loopDurationSeconds=-1,this._isLoop=!1,this._isLoopFadeIn=!0,this._lastWeight=0,this._motionData=null,this._modelCurveIdEyeBlink=null,this._modelCurveIdLipSync=null,this._modelCurveIdOpacity=null,this._eyeBlinkParameterIds=null,this._lipSyncParameterIds=null,this._modelOpacity=1,this._debugMode=!1}static create(t,i,s,r,a=!1){const n=new er;if(n.parse(t,i,a),n._motionData)n._sourceFrameRate=n._motionData.fps,n._loopDurationSeconds=n._motionData.duration,n._onFinishedMotion=s,n._onBeganMotion=r;else return ni(n),null;return n}doUpdateParameters(t,i,s,r){this._modelCurveIdEyeBlink==null&&(this._modelCurveIdEyeBlink=R.getIdManager().getId(kg)),this._modelCurveIdLipSync==null&&(this._modelCurveIdLipSync=R.getIdManager().getId(Dg)),this._modelCurveIdOpacity==null&&(this._modelCurveIdOpacity=R.getIdManager().getId(Ms)),this._motionBehavior===1&&this._previousLoopState!==this._isLoop&&(this.adjustEndTime(r),this._previousLoopState=this._isLoop);let a=i-r.getStartTime();a<0&&(a=0);let n=Number.MAX_VALUE,o=Number.MAX_VALUE;const l=64;let h=0,u=0;this._eyeBlinkParameterIds.getSize()>l&&ts("too many eye blink targets : {0}",this._eyeBlinkParameterIds.getSize()),this._lipSyncParameterIds.getSize()>l&&ts("too many lip sync targets : {0}",this._lipSyncParameterIds.getSize());const c=this._fadeInSeconds<=0?1:F.getEasingSine((i-r.getFadeInStartTime())/this._fadeInSeconds),d=this._fadeOutSeconds<=0||r.getEndTime()<0?1:F.getEasingSine((r.getEndTime()-i)/this._fadeOutSeconds);let g,_,m,f=a,b=this._motionData.duration;const x=this._motionBehavior===1&&this._isLoop;if(this._isLoop)for(this._motionBehavior===1&&(b+=1/this._motionData.fps);f>b;)f-=b;const E=this._motionData.curves;for(_=0;_<this._motionData.curveCount&&E.at(_).type==Jt.CubismMotionCurveTarget_Model;++_)g=Rr(this._motionData,_,f,x,b),E.at(_).id==this._modelCurveIdEyeBlink?o=g:E.at(_).id==this._modelCurveIdLipSync?n=g:E.at(_).id==this._modelCurveIdOpacity&&(this._modelOpacity=g,t.setModelOapcity(this.getModelOpacityValue()));for(;_<this._motionData.curveCount&&E.at(_).type==Jt.CubismMotionCurveTarget_Parameter;++_){if(m=t.getParameterIndex(E.at(_).id),m==-1)continue;const A=t.getParameterValueByIndex(m);if(g=Rr(this._motionData,_,f,x,b),o!=Number.MAX_VALUE){for(let M=0;M<this._eyeBlinkParameterIds.getSize()&&M<l;++M)if(this._eyeBlinkParameterIds.at(M)==E.at(_).id){g*=o,u|=1<<M;break}}if(n!=Number.MAX_VALUE){for(let M=0;M<this._lipSyncParameterIds.getSize()&&M<l;++M)if(this._lipSyncParameterIds.at(M)==E.at(_).id){g+=n,h|=1<<M;break}}t.isRepeat(m)&&(g=t.getParameterRepeatValue(m,g));let T;if(E.at(_).fadeInTime<0&&E.at(_).fadeOutTime<0)T=A+(g-A)*s;else{let M,Y;E.at(_).fadeInTime<0?M=c:M=E.at(_).fadeInTime==0?1:F.getEasingSine((i-r.getFadeInStartTime())/E.at(_).fadeInTime),E.at(_).fadeOutTime<0?Y=d:Y=E.at(_).fadeOutTime==0||r.getEndTime()<0?1:F.getEasingSine((r.getEndTime()-i)/E.at(_).fadeOutTime);const xt=this._weight*M*Y;T=A+(g-A)*xt}t.setParameterValueByIndex(m,T,1)}{if(o!=Number.MAX_VALUE)for(let A=0;A<this._eyeBlinkParameterIds.getSize()&&A<l;++A){const T=t.getParameterValueById(this._eyeBlinkParameterIds.at(A));if(u>>A&1)continue;const M=T+(o-T)*s;t.setParameterValueById(this._eyeBlinkParameterIds.at(A),M)}if(n!=Number.MAX_VALUE)for(let A=0;A<this._lipSyncParameterIds.getSize()&&A<l;++A){const T=t.getParameterValueById(this._lipSyncParameterIds.at(A));if(h>>A&1)continue;const M=T+(n-T)*s;t.setParameterValueById(this._lipSyncParameterIds.at(A),M)}}for(;_<this._motionData.curveCount&&E.at(_).type==Jt.CubismMotionCurveTarget_PartOpacity;++_)m=t.getParameterIndex(E.at(_).id),m!=-1&&(g=Rr(this._motionData,_,f,x,b),t.setParameterValueByIndex(m,g));a>=b&&(this._isLoop?this.updateForNextLoop(r,i,f):(this._onFinishedMotion&&this._onFinishedMotion(this),r.setIsFinished(!0))),this._lastWeight=s}setIsLoop(t){k("setIsLoop() is a deprecated function. Please use setLoop()."),this._isLoop=t}isLoop(){return k("isLoop() is a deprecated function. Please use getLoop()."),this._isLoop}setIsLoopFadeIn(t){k("setIsLoopFadeIn() is a deprecated function. Please use setLoopFadeIn()."),this._isLoopFadeIn=t}isLoopFadeIn(){return k("isLoopFadeIn() is a deprecated function. Please use getLoopFadeIn()."),this._isLoopFadeIn}setMotionBehavior(t){this._motionBehavior=t}getMotionBehavior(){return this._motionBehavior}getDuration(){return this._isLoop?-1:this._loopDurationSeconds}getLoopDuration(){return this._loopDurationSeconds}setParameterFadeInTime(t,i){const s=this._motionData.curves;for(let r=0;r<this._motionData.curveCount;++r)if(t==s.at(r).id){s.at(r).fadeInTime=i;return}}setParameterFadeOutTime(t,i){const s=this._motionData.curves;for(let r=0;r<this._motionData.curveCount;++r)if(t==s.at(r).id){s.at(r).fadeOutTime=i;return}}getParameterFadeInTime(t){const i=this._motionData.curves;for(let s=0;s<this._motionData.curveCount;++s)if(t==i.at(s).id)return i.at(s).fadeInTime;return-1}getParameterFadeOutTime(t){const i=this._motionData.curves;for(let s=0;s<this._motionData.curveCount;++s)if(t==i.at(s).id)return i.at(s).fadeOutTime;return-1}setEffectIds(t,i){this._eyeBlinkParameterIds=t,this._lipSyncParameterIds=i}release(){this._motionData=void 0,this._motionData=null}updateForNextLoop(t,i,s){switch(this._motionBehavior){case 1:default:t.setStartTime(i-s),this._isLoopFadeIn&&t.setFadeInStartTime(i-s),this._onFinishedMotion!=null&&this._onFinishedMotion(this);break;case 0:t.setStartTime(i),this._isLoopFadeIn&&t.setFadeInStartTime(i);break}}parse(t,i,s=!1){let r=new Bh(t,i);if(!r){r.release(),r=void 0;return}if(s&&!r.hasConsistency()){r.release(),D("Inconsistent motion3.json.");return}this._motionData=new wh,this._motionData.duration=r.getMotionDuration(),this._motionData.loop=r.isMotionLoop(),this._motionData.curveCount=r.getMotionCurveCount(),this._motionData.fps=r.getMotionFps(),this._motionData.eventCount=r.getEventCount();const a=r.getEvaluationOptionFlag(Ih.EvaluationOptionFlag_AreBeziersRistricted);r.isExistMotionFadeInTime()?this._fadeInSeconds=r.getMotionFadeInTime()<0?1:r.getMotionFadeInTime():this._fadeInSeconds=1,r.isExistMotionFadeOutTime()?this._fadeOutSeconds=r.getMotionFadeOutTime()<0?1:r.getMotionFadeOutTime():this._fadeOutSeconds=1,this._motionData.curves.updateSize(this._motionData.curveCount,Mh,!0),this._motionData.segments.updateSize(r.getMotionTotalSegmentCount(),bh,!0),this._motionData.points.updateSize(r.getMotionTotalPointCount(),as,!0),this._motionData.events.updateSize(this._motionData.eventCount,Ph,!0);let n=0,o=0;for(let l=0;l<this._motionData.curveCount;++l){r.getMotionCurveTarget(l)==Og?this._motionData.curves.at(l).type=Jt.CubismMotionCurveTarget_Model:r.getMotionCurveTarget(l)==Ng?this._motionData.curves.at(l).type=Jt.CubismMotionCurveTarget_Parameter:r.getMotionCurveTarget(l)==Ug?this._motionData.curves.at(l).type=Jt.CubismMotionCurveTarget_PartOpacity:k('Warning : Unable to get segment type from Curve! The number of "CurveCount" may be incorrect!'),this._motionData.curves.at(l).id=r.getMotionCurveId(l),this._motionData.curves.at(l).baseSegmentIndex=o,this._motionData.curves.at(l).fadeInTime=r.isExistMotionCurveFadeInTime(l)?r.getMotionCurveFadeInTime(l):-1,this._motionData.curves.at(l).fadeOutTime=r.isExistMotionCurveFadeOutTime(l)?r.getMotionCurveFadeOutTime(l):-1;for(let h=0;h<r.getMotionCurveSegmentCount(l);){switch(h==0?(this._motionData.segments.at(o).basePointIndex=n,this._motionData.points.at(n).time=r.getMotionCurveSegment(l,h),this._motionData.points.at(n).value=r.getMotionCurveSegment(l,h+1),n+=1,h+=2):this._motionData.segments.at(o).basePointIndex=n-1,r.getMotionCurveSegment(l,h)){case lt.CubismMotionSegmentType_Linear:{this._motionData.segments.at(o).segmentType=lt.CubismMotionSegmentType_Linear,this._motionData.segments.at(o).evaluate=Eh,this._motionData.points.at(n).time=r.getMotionCurveSegment(l,h+1),this._motionData.points.at(n).value=r.getMotionCurveSegment(l,h+2),n+=1,h+=3;break}case lt.CubismMotionSegmentType_Bezier:{this._motionData.segments.at(o).segmentType=lt.CubismMotionSegmentType_Bezier,a||zg?this._motionData.segments.at(o).evaluate=Gg:this._motionData.segments.at(o).evaluate=Xg,this._motionData.points.at(n).time=r.getMotionCurveSegment(l,h+1),this._motionData.points.at(n).value=r.getMotionCurveSegment(l,h+2),this._motionData.points.at(n+1).time=r.getMotionCurveSegment(l,h+3),this._motionData.points.at(n+1).value=r.getMotionCurveSegment(l,h+4),this._motionData.points.at(n+2).time=r.getMotionCurveSegment(l,h+5),this._motionData.points.at(n+2).value=r.getMotionCurveSegment(l,h+6),n+=3,h+=7;break}case lt.CubismMotionSegmentType_Stepped:{this._motionData.segments.at(o).segmentType=lt.CubismMotionSegmentType_Stepped,this._motionData.segments.at(o).evaluate=Fh,this._motionData.points.at(n).time=r.getMotionCurveSegment(l,h+1),this._motionData.points.at(n).value=r.getMotionCurveSegment(l,h+2),n+=1,h+=3;break}case lt.CubismMotionSegmentType_InverseStepped:{this._motionData.segments.at(o).segmentType=lt.CubismMotionSegmentType_InverseStepped,this._motionData.segments.at(o).evaluate=Th,this._motionData.points.at(n).time=r.getMotionCurveSegment(l,h+1),this._motionData.points.at(n).value=r.getMotionCurveSegment(l,h+2),n+=1,h+=3;break}default:{ft(0);break}}++this._motionData.curves.at(l).segmentCount,++o}}for(let l=0;l<r.getEventCount();++l)this._motionData.events.at(l).fireTime=r.getEventTime(l),this._motionData.events.at(l).value=r.getEventValue(l);r.release(),r=void 0,r=null}getFiredEvent(t,i){this._firedEventValues.updateSize(0);for(let s=0;s<this._motionData.eventCount;++s)this._motionData.events.at(s).fireTime>t&&this._motionData.events.at(s).fireTime<=i&&this._firedEventValues.pushBack(new Xt(this._motionData.events.at(s).value.s));return this._firedEventValues}isExistModelOpacity(){for(let t=0;t<this._motionData.curveCount;t++){const i=this._motionData.curves.at(t);if(i.type==Jt.CubismMotionCurveTarget_Model&&i.id.getString().s.localeCompare(Ms)==0)return!0}return!1}getModelOpacityIndex(){if(this.isExistModelOpacity())for(let t=0;t<this._motionData.curveCount;t++){const i=this._motionData.curves.at(t);if(i.type==Jt.CubismMotionCurveTarget_Model&&i.id.getString().s.localeCompare(Ms)==0)return t}return-1}getModelOpacityId(t){if(t!=-1){const i=this._motionData.curves.at(t);if(i.type==Jt.CubismMotionCurveTarget_Model&&i.id.getString().s.localeCompare(Ms)==0)return R.getIdManager().getId(i.id.getString().s)}return null}getModelOpacityValue(){return this._modelOpacity}setDebugMode(t){this._debugMode=t}}var bo;(e=>{e.CubismMotion=er})(bo||(bo={}));class Ah extends wa{constructor(){super(),this._currentPriority=0,this._reservePriority=0}getCurrentPriority(){return this._currentPriority}getReservePriority(){return this._reservePriority}setReservePriority(t){this._reservePriority=t}startMotionPriority(t,i,s){return s==this._reservePriority&&(this._reservePriority=0),this._currentPriority=s,super.startMotion(t,i)}updateMotion(t,i){this._userTimeSeconds+=i;const s=super.doUpdateMotion(t,this._userTimeSeconds);return this.isFinished()&&(this._currentPriority=0),s}reserveMotion(t){return t<=this._reservePriority||t<=this._currentPriority?!1:(this._reservePriority=t,!0)}}var Mo;(e=>{e.CubismMotionManager=Ah})(Mo||(Mo={}));var Gs=(e=>(e[e.CubismPhysicsTargetType_Parameter=0]="CubismPhysicsTargetType_Parameter",e))(Gs||{}),be=(e=>(e[e.CubismPhysicsSource_X=0]="CubismPhysicsSource_X",e[e.CubismPhysicsSource_Y=1]="CubismPhysicsSource_Y",e[e.CubismPhysicsSource_Angle=2]="CubismPhysicsSource_Angle",e))(be||{});class Yg{constructor(){this.gravity=new B(0,0),this.wind=new B(0,0)}}class Ba{}class sa{}class Rh{constructor(){this.initialPosition=new B(0,0),this.position=new B(0,0),this.lastPosition=new B(0,0),this.lastGravity=new B(0,0),this.force=new B(0,0),this.velocity=new B(0,0)}}class Vh{constructor(){this.normalizationPosition=new sa,this.normalizationAngle=new sa}}class Lh{constructor(){this.source=new Ba}}class kh{constructor(){this.destination=new Ba,this.translationScale=new B(0,0)}}class Dh{constructor(){this.settings=new y,this.inputs=new y,this.outputs=new y,this.particles=new y,this.gravity=new B(0,0),this.wind=new B(0,0),this.fps=0}}var Po;(e=>{e.CubismPhysicsInput=Lh,e.CubismPhysicsNormalization=sa,e.CubismPhysicsOutput=kh,e.CubismPhysicsParameter=Ba,e.CubismPhysicsParticle=Rh,e.CubismPhysicsRig=Dh,e.CubismPhysicsSource=be,e.CubismPhysicsSubRig=Vh,e.CubismPhysicsTargetType=Gs,e.PhysicsJsonEffectiveForces=Yg})(Po||(Po={}));const zi="Position",Vr="X",Lr="Y",kr="Angle",wo="Type",Bo="Id",ce="Meta",Ps="EffectiveForces",Hg="TotalInputCount",Wg="TotalOutputCount",$g="PhysicsSettingCount",Io="Gravity",Eo="Wind",qg="VertexCount",Jg="Fps",H="PhysicsSettings",ti="Normalization",Fo="Minimum",To="Maximum",Ao="Default",Ro="Reflect",Vo="Weight",Gi="Input",Kg="Source",ke="Output",Zg="Scale",Qg="VertexIndex",td="Destination",De="Vertices",ed="Mobility",id="Delay",sd="Radius",rd="Acceleration";class Oh{constructor(t,i){this._json=gt.create(t,i)}release(){gt.delete(this._json)}getGravity(){const t=new B(0,0);return t.x=this._json.getRoot().getValueByString(ce).getValueByString(Ps).getValueByString(Io).getValueByString(Vr).toFloat(),t.y=this._json.getRoot().getValueByString(ce).getValueByString(Ps).getValueByString(Io).getValueByString(Lr).toFloat(),t}getWind(){const t=new B(0,0);return t.x=this._json.getRoot().getValueByString(ce).getValueByString(Ps).getValueByString(Eo).getValueByString(Vr).toFloat(),t.y=this._json.getRoot().getValueByString(ce).getValueByString(Ps).getValueByString(Eo).getValueByString(Lr).toFloat(),t}getFps(){return this._json.getRoot().getValueByString(ce).getValueByString(Jg).toFloat(0)}getSubRigCount(){return this._json.getRoot().getValueByString(ce).getValueByString($g).toInt()}getTotalInputCount(){return this._json.getRoot().getValueByString(ce).getValueByString(Hg).toInt()}getTotalOutputCount(){return this._json.getRoot().getValueByString(ce).getValueByString(Wg).toInt()}getVertexCount(){return this._json.getRoot().getValueByString(ce).getValueByString(qg).toInt()}getNormalizationPositionMinimumValue(t){return this._json.getRoot().getValueByString(H).getValueByIndex(t).getValueByString(ti).getValueByString(zi).getValueByString(Fo).toFloat()}getNormalizationPositionMaximumValue(t){return this._json.getRoot().getValueByString(H).getValueByIndex(t).getValueByString(ti).getValueByString(zi).getValueByString(To).toFloat()}getNormalizationPositionDefaultValue(t){return this._json.getRoot().getValueByString(H).getValueByIndex(t).getValueByString(ti).getValueByString(zi).getValueByString(Ao).toFloat()}getNormalizationAngleMinimumValue(t){return this._json.getRoot().getValueByString(H).getValueByIndex(t).getValueByString(ti).getValueByString(kr).getValueByString(Fo).toFloat()}getNormalizationAngleMaximumValue(t){return this._json.getRoot().getValueByString(H).getValueByIndex(t).getValueByString(ti).getValueByString(kr).getValueByString(To).toFloat()}getNormalizationAngleDefaultValue(t){return this._json.getRoot().getValueByString(H).getValueByIndex(t).getValueByString(ti).getValueByString(kr).getValueByString(Ao).toFloat()}getInputCount(t){return this._json.getRoot().getValueByString(H).getValueByIndex(t).getValueByString(Gi).getVector().getSize()}getInputWeight(t,i){return this._json.getRoot().getValueByString(H).getValueByIndex(t).getValueByString(Gi).getValueByIndex(i).getValueByString(Vo).toFloat()}getInputReflect(t,i){return this._json.getRoot().getValueByString(H).getValueByIndex(t).getValueByString(Gi).getValueByIndex(i).getValueByString(Ro).toBoolean()}getInputType(t,i){return this._json.getRoot().getValueByString(H).getValueByIndex(t).getValueByString(Gi).getValueByIndex(i).getValueByString(wo).getRawString()}getInputSourceId(t,i){return R.getIdManager().getId(this._json.getRoot().getValueByString(H).getValueByIndex(t).getValueByString(Gi).getValueByIndex(i).getValueByString(Kg).getValueByString(Bo).getRawString())}getOutputCount(t){return this._json.getRoot().getValueByString(H).getValueByIndex(t).getValueByString(ke).getVector().getSize()}getOutputVertexIndex(t,i){return this._json.getRoot().getValueByString(H).getValueByIndex(t).getValueByString(ke).getValueByIndex(i).getValueByString(Qg).toInt()}getOutputAngleScale(t,i){return this._json.getRoot().getValueByString(H).getValueByIndex(t).getValueByString(ke).getValueByIndex(i).getValueByString(Zg).toFloat()}getOutputWeight(t,i){return this._json.getRoot().getValueByString(H).getValueByIndex(t).getValueByString(ke).getValueByIndex(i).getValueByString(Vo).toFloat()}getOutputDestinationId(t,i){return R.getIdManager().getId(this._json.getRoot().getValueByString(H).getValueByIndex(t).getValueByString(ke).getValueByIndex(i).getValueByString(td).getValueByString(Bo).getRawString())}getOutputType(t,i){return this._json.getRoot().getValueByString(H).getValueByIndex(t).getValueByString(ke).getValueByIndex(i).getValueByString(wo).getRawString()}getOutputReflect(t,i){return this._json.getRoot().getValueByString(H).getValueByIndex(t).getValueByString(ke).getValueByIndex(i).getValueByString(Ro).toBoolean()}getParticleCount(t){return this._json.getRoot().getValueByString(H).getValueByIndex(t).getValueByString(De).getVector().getSize()}getParticleMobility(t,i){return this._json.getRoot().getValueByString(H).getValueByIndex(t).getValueByString(De).getValueByIndex(i).getValueByString(ed).toFloat()}getParticleDelay(t,i){return this._json.getRoot().getValueByString(H).getValueByIndex(t).getValueByString(De).getValueByIndex(i).getValueByString(id).toFloat()}getParticleAcceleration(t,i){return this._json.getRoot().getValueByString(H).getValueByIndex(t).getValueByString(De).getValueByIndex(i).getValueByString(rd).toFloat()}getParticleRadius(t,i){return this._json.getRoot().getValueByString(H).getValueByIndex(t).getValueByString(De).getValueByIndex(i).getValueByString(sd).toFloat()}getParticlePosition(t,i){const s=new B(0,0);return s.x=this._json.getRoot().getValueByString(H).getValueByIndex(t).getValueByString(De).getValueByIndex(i).getValueByString(zi).getValueByString(Vr).toFloat(),s.y=this._json.getRoot().getValueByString(H).getValueByIndex(t).getValueByString(De).getValueByIndex(i).getValueByString(zi).getValueByString(Lr).toFloat(),s}}var Lo;(e=>{e.CubismPhysicsJson=Oh})(Lo||(Lo={}));const ko="X",Do="Y",Oo="Angle",ad=5,ra=100,No=.001,nd=5;class ns{static create(t,i){const s=new ns;return s.parse(t,i),s._physicsRig.gravity.y=0,s}static delete(t){t!=null&&(t.release(),t=null)}parse(t,i){this._physicsRig=new Dh;let s=new Oh(t,i);this._physicsRig.gravity=s.getGravity(),this._physicsRig.wind=s.getWind(),this._physicsRig.subRigCount=s.getSubRigCount(),this._physicsRig.fps=s.getFps(),this._physicsRig.settings.updateSize(this._physicsRig.subRigCount,Vh,!0),this._physicsRig.inputs.updateSize(s.getTotalInputCount(),Lh,!0),this._physicsRig.outputs.updateSize(s.getTotalOutputCount(),kh,!0),this._physicsRig.particles.updateSize(s.getVertexCount(),Rh,!0),this._currentRigOutputs.clear(),this._previousRigOutputs.clear();let r=0,a=0,n=0;for(let o=0;o<this._physicsRig.settings.getSize();++o){this._physicsRig.settings.at(o).normalizationPosition.minimum=s.getNormalizationPositionMinimumValue(o),this._physicsRig.settings.at(o).normalizationPosition.maximum=s.getNormalizationPositionMaximumValue(o),this._physicsRig.settings.at(o).normalizationPosition.defalut=s.getNormalizationPositionDefaultValue(o),this._physicsRig.settings.at(o).normalizationAngle.minimum=s.getNormalizationAngleMinimumValue(o),this._physicsRig.settings.at(o).normalizationAngle.maximum=s.getNormalizationAngleMaximumValue(o),this._physicsRig.settings.at(o).normalizationAngle.defalut=s.getNormalizationAngleDefaultValue(o),this._physicsRig.settings.at(o).inputCount=s.getInputCount(o),this._physicsRig.settings.at(o).baseInputIndex=r;for(let u=0;u<this._physicsRig.settings.at(o).inputCount;++u)this._physicsRig.inputs.at(r+u).sourceParameterIndex=-1,this._physicsRig.inputs.at(r+u).weight=s.getInputWeight(o,u),this._physicsRig.inputs.at(r+u).reflect=s.getInputReflect(o,u),s.getInputType(o,u)==ko?(this._physicsRig.inputs.at(r+u).type=be.CubismPhysicsSource_X,this._physicsRig.inputs.at(r+u).getNormalizedParameterValue=ld):s.getInputType(o,u)==Do?(this._physicsRig.inputs.at(r+u).type=be.CubismPhysicsSource_Y,this._physicsRig.inputs.at(r+u).getNormalizedParameterValue=hd):s.getInputType(o,u)==Oo&&(this._physicsRig.inputs.at(r+u).type=be.CubismPhysicsSource_Angle,this._physicsRig.inputs.at(r+u).getNormalizedParameterValue=ud),this._physicsRig.inputs.at(r+u).source.targetType=Gs.CubismPhysicsTargetType_Parameter,this._physicsRig.inputs.at(r+u).source.id=s.getInputSourceId(o,u);r+=this._physicsRig.settings.at(o).inputCount,this._physicsRig.settings.at(o).outputCount=s.getOutputCount(o),this._physicsRig.settings.at(o).baseOutputIndex=a;const l=new Uo;l.outputs.resize(this._physicsRig.settings.at(o).outputCount);const h=new Uo;h.outputs.resize(this._physicsRig.settings.at(o).outputCount);for(let u=0;u<this._physicsRig.settings.at(o).outputCount;++u)l.outputs.set(u,0),h.outputs.set(u,0),this._physicsRig.outputs.at(a+u).destinationParameterIndex=-1,this._physicsRig.outputs.at(a+u).vertexIndex=s.getOutputVertexIndex(o,u),this._physicsRig.outputs.at(a+u).angleScale=s.getOutputAngleScale(o,u),this._physicsRig.outputs.at(a+u).weight=s.getOutputWeight(o,u),this._physicsRig.outputs.at(a+u).destination.targetType=Gs.CubismPhysicsTargetType_Parameter,this._physicsRig.outputs.at(a+u).destination.id=s.getOutputDestinationId(o,u),s.getOutputType(o,u)==ko?(this._physicsRig.outputs.at(a+u).type=be.CubismPhysicsSource_X,this._physicsRig.outputs.at(a+u).getValue=cd,this._physicsRig.outputs.at(a+u).getScale=md):s.getOutputType(o,u)==Do?(this._physicsRig.outputs.at(a+u).type=be.CubismPhysicsSource_Y,this._physicsRig.outputs.at(a+u).getValue=gd,this._physicsRig.outputs.at(a+u).getScale=pd):s.getOutputType(o,u)==Oo&&(this._physicsRig.outputs.at(a+u).type=be.CubismPhysicsSource_Angle,this._physicsRig.outputs.at(a+u).getValue=dd,this._physicsRig.outputs.at(a+u).getScale=yd),this._physicsRig.outputs.at(a+u).reflect=s.getOutputReflect(o,u);this._currentRigOutputs.pushBack(l),this._previousRigOutputs.pushBack(h),a+=this._physicsRig.settings.at(o).outputCount,this._physicsRig.settings.at(o).particleCount=s.getParticleCount(o),this._physicsRig.settings.at(o).baseParticleIndex=n;for(let u=0;u<this._physicsRig.settings.at(o).particleCount;++u)this._physicsRig.particles.at(n+u).mobility=s.getParticleMobility(o,u),this._physicsRig.particles.at(n+u).delay=s.getParticleDelay(o,u),this._physicsRig.particles.at(n+u).acceleration=s.getParticleAcceleration(o,u),this._physicsRig.particles.at(n+u).radius=s.getParticleRadius(o,u),this._physicsRig.particles.at(n+u).position=s.getParticlePosition(o,u);n+=this._physicsRig.settings.at(o).particleCount}this.initialize(),s.release(),s=void 0,s=null}stabilization(t){var m,f;let i,s,r,a;const n=new B;let o,l,h,u;const c=t.getModel().parameters.values,d=t.getModel().parameters.maximumValues,g=t.getModel().parameters.minimumValues,_=t.getModel().parameters.defaultValues;(((m=this._parameterCaches)==null?void 0:m.length)??0)<t.getParameterCount()&&(this._parameterCaches=new Float32Array(t.getParameterCount())),(((f=this._parameterInputCaches)==null?void 0:f.length)??0)<t.getParameterCount()&&(this._parameterInputCaches=new Float32Array(t.getParameterCount()));for(let b=0;b<t.getParameterCount();++b)this._parameterCaches[b]=c[b],this._parameterInputCaches[b]=c[b];for(let b=0;b<this._physicsRig.subRigCount;++b){i={angle:0},n.x=0,n.y=0,o=this._physicsRig.settings.at(b),l=this._physicsRig.inputs.get(o.baseInputIndex),h=this._physicsRig.outputs.get(o.baseOutputIndex),u=this._physicsRig.particles.get(o.baseParticleIndex);for(let x=0;x<o.inputCount;++x)s=l[x].weight/ra,l[x].sourceParameterIndex==-1&&(l[x].sourceParameterIndex=t.getParameterIndex(l[x].source.id)),l[x].getNormalizedParameterValue(n,i,c[l[x].sourceParameterIndex],g[l[x].sourceParameterIndex],d[l[x].sourceParameterIndex],_[l[x].sourceParameterIndex],o.normalizationPosition,o.normalizationAngle,l[x].reflect,s),this._parameterCaches[l[x].sourceParameterIndex]=c[l[x].sourceParameterIndex];r=F.degreesToRadian(-i.angle),n.x=n.x*F.cos(r)-n.y*F.sin(r),n.y=n.x*F.sin(r)+n.y*F.cos(r),xd(u,o.particleCount,n,i.angle,this._options.wind,No*o.normalizationPosition.maximum);for(let x=0;x<o.outputCount;++x){const E=h[x].vertexIndex;if(h[x].destinationParameterIndex==-1&&(h[x].destinationParameterIndex=t.getParameterIndex(h[x].destination.id)),E<1||E>=o.particleCount)continue;let A=new B;A=u[E].position.substract(u[E-1].position),a=h[x].getValue(A,u,E,h[x].reflect,this._options.gravity),this._currentRigOutputs.at(b).outputs.set(x,a),this._previousRigOutputs.at(b).outputs.set(x,a);const T=h[x].destinationParameterIndex,M=!Float32Array.prototype.slice&&"subarray"in Float32Array.prototype?JSON.parse(JSON.stringify(c.subarray(T))):c.slice(T);Dr(M,g[T],d[T],a,h[x]);for(let Y=T,xt=0;Y<this._parameterCaches.length;Y++,xt++)c[Y]=this._parameterCaches[Y]=M[xt]}}}evaluate(t,i){var x,E;let s,r,a,n;const o=new B;let l,h,u,c;if(0>=i)return;const d=t.getModel().parameters.values,g=t.getModel().parameters.maximumValues,_=t.getModel().parameters.minimumValues,m=t.getModel().parameters.defaultValues;let f;if(this._currentRemainTime+=i,this._currentRemainTime>nd&&(this._currentRemainTime=0),(((x=this._parameterCaches)==null?void 0:x.length)??0)<t.getParameterCount()&&(this._parameterCaches=new Float32Array(t.getParameterCount())),(((E=this._parameterInputCaches)==null?void 0:E.length)??0)<t.getParameterCount()){this._parameterInputCaches=new Float32Array(t.getParameterCount());for(let A=0;A<t.getParameterCount();++A)this._parameterInputCaches[A]=d[A]}for(this._physicsRig.fps>0?f=1/this._physicsRig.fps:f=i;this._currentRemainTime>=f;){for(let T=0;T<this._physicsRig.subRigCount;++T){l=this._physicsRig.settings.at(T),u=this._physicsRig.outputs.get(l.baseOutputIndex);for(let M=0;M<l.outputCount;++M)this._previousRigOutputs.at(T).outputs.set(M,this._currentRigOutputs.at(T).outputs.at(M))}const A=f/this._currentRemainTime;for(let T=0;T<t.getParameterCount();++T)this._parameterCaches[T]=this._parameterInputCaches[T]*(1-A)+d[T]*A,this._parameterInputCaches[T]=this._parameterCaches[T];for(let T=0;T<this._physicsRig.subRigCount;++T){s={angle:0},o.x=0,o.y=0,l=this._physicsRig.settings.at(T),h=this._physicsRig.inputs.get(l.baseInputIndex),u=this._physicsRig.outputs.get(l.baseOutputIndex),c=this._physicsRig.particles.get(l.baseParticleIndex);for(let M=0;M<l.inputCount;++M)r=h[M].weight/ra,h[M].sourceParameterIndex==-1&&(h[M].sourceParameterIndex=t.getParameterIndex(h[M].source.id)),h[M].getNormalizedParameterValue(o,s,this._parameterCaches[h[M].sourceParameterIndex],_[h[M].sourceParameterIndex],g[h[M].sourceParameterIndex],m[h[M].sourceParameterIndex],l.normalizationPosition,l.normalizationAngle,h[M].reflect,r);a=F.degreesToRadian(-s.angle),o.x=o.x*F.cos(a)-o.y*F.sin(a),o.y=o.x*F.sin(a)+o.y*F.cos(a),Sd(c,l.particleCount,o,s.angle,this._options.wind,No*l.normalizationPosition.maximum,f,ad);for(let M=0;M<l.outputCount;++M){const Y=u[M].vertexIndex;if(u[M].destinationParameterIndex==-1&&(u[M].destinationParameterIndex=t.getParameterIndex(u[M].destination.id)),Y<1||Y>=l.particleCount)continue;const xt=new B;xt.x=c[Y].position.x-c[Y-1].position.x,xt.y=c[Y].position.y-c[Y-1].position.y,n=u[M].getValue(xt,c,Y,u[M].reflect,this._options.gravity),this._currentRigOutputs.at(T).outputs.set(M,n);const he=u[M].destinationParameterIndex,Je=!Float32Array.prototype.slice&&"subarray"in Float32Array.prototype?JSON.parse(JSON.stringify(this._parameterCaches.subarray(he))):this._parameterCaches.slice(he);Dr(Je,_[he],g[he],n,u[M]);for(let Ke=he,Oi=0;Ke<this._parameterCaches.length;Ke++,Oi++)this._parameterCaches[Ke]=Je[Oi]}}this._currentRemainTime-=f}const b=this._currentRemainTime/f;this.interpolate(t,b)}interpolate(t,i){let s,r;const a=t.getModel().parameters.values,n=t.getModel().parameters.maximumValues,o=t.getModel().parameters.minimumValues;for(let l=0;l<this._physicsRig.subRigCount;++l){r=this._physicsRig.settings.at(l),s=this._physicsRig.outputs.get(r.baseOutputIndex);for(let h=0;h<r.outputCount;++h){if(s[h].destinationParameterIndex==-1)continue;const u=s[h].destinationParameterIndex,c=!Float32Array.prototype.slice&&"subarray"in Float32Array.prototype?JSON.parse(JSON.stringify(a.subarray(u))):a.slice(u);Dr(c,o[u],n[u],this._previousRigOutputs.at(l).outputs.at(h)*(1-i)+this._currentRigOutputs.at(l).outputs.at(h)*i,s[h]);for(let d=u,g=0;d<a.length;d++,g++)a[d]=c[g]}}}setOptions(t){this._options=t}getOption(){return this._options}constructor(){this._physicsRig=null,this._options=new Nh,this._options.gravity.y=-1,this._options.gravity.x=0,this._options.wind.x=0,this._options.wind.y=0,this._currentRigOutputs=new y,this._previousRigOutputs=new y,this._currentRemainTime=0,this._parameterCaches=null,this._parameterInputCaches=null}release(){this._physicsRig=void 0,this._physicsRig=null}initialize(){let t,i,s;for(let r=0;r<this._physicsRig.subRigCount;++r){i=this._physicsRig.settings.at(r),t=this._physicsRig.particles.get(i.baseParticleIndex),t[0].initialPosition=new B(0,0),t[0].lastPosition=new B(t[0].initialPosition.x,t[0].initialPosition.y),t[0].lastGravity=new B(0,-1),t[0].lastGravity.y*=-1,t[0].velocity=new B(0,0),t[0].force=new B(0,0);for(let a=1;a<i.particleCount;++a)s=new B(0,0),s.y=t[a].radius,t[a].initialPosition=new B(t[a-1].initialPosition.x+s.x,t[a-1].initialPosition.y+s.y),t[a].position=new B(t[a].initialPosition.x,t[a].initialPosition.y),t[a].lastPosition=new B(t[a].initialPosition.x,t[a].initialPosition.y),t[a].lastGravity=new B(0,-1),t[a].lastGravity.y*=-1,t[a].velocity=new B(0,0),t[a].force=new B(0,0)}}}class Nh{constructor(){this.gravity=new B(0,0),this.wind=new B(0,0)}}class Uo{constructor(){this.outputs=new y(0)}}function od(e){let t=0;return e>0?t=1:e<0&&(t=-1),t}function ld(e,t,i,s,r,a,n,o,l,h){e.x+=Ia(i,s,r,a,n.minimum,n.maximum,n.defalut,l)*h}function hd(e,t,i,s,r,a,n,o,l,h){e.y+=Ia(i,s,r,a,n.minimum,n.maximum,n.defalut,l)*h}function ud(e,t,i,s,r,a,n,o,l,h){t.angle+=Ia(i,s,r,a,o.minimum,o.maximum,o.defalut,l)*h}function cd(e,t,i,s,r){let a=e.x;return s&&(a*=-1),a}function gd(e,t,i,s,r){let a=e.y;return s&&(a*=-1),a}function dd(e,t,i,s,r){let a;return i>=2?r=t[i-1].position.substract(t[i-2].position):r=r.multiplyByScaler(-1),a=F.directionToRadian(r,e),s&&(a*=-1),a}function _d(e,t){const i=F.max(e,t),s=F.min(e,t);return F.abs(i-s)}function fd(e,t){return F.min(e,t)+_d(e,t)/2}function md(e,t){return JSON.parse(JSON.stringify(e.x))}function pd(e,t){return JSON.parse(JSON.stringify(e.y))}function yd(e,t){return JSON.parse(JSON.stringify(t))}function Sd(e,t,i,s,r,a,n,o){let l,h,u=new B(0,0),c=new B(0,0),d=new B(0,0),g=new B(0,0);e[0].position=new B(i.x,i.y);const _=F.degreesToRadian(s),m=F.radianToDirection(_);m.normalize();for(let f=1;f<t;++f)e[f].force=m.multiplyByScaler(e[f].acceleration).add(r),e[f].lastPosition=new B(e[f].position.x,e[f].position.y),l=e[f].delay*n*30,u=e[f].position.substract(e[f-1].position),h=F.directionToRadian(e[f].lastGravity,m)/o,u.x=F.cos(h)*u.x-u.y*F.sin(h),u.y=F.sin(h)*u.x+u.y*F.cos(h),e[f].position=e[f-1].position.add(u),c=e[f].velocity.multiplyByScaler(l),d=e[f].force.multiplyByScaler(l).multiplyByScaler(l),e[f].position=e[f].position.add(c).add(d),g=e[f].position.substract(e[f-1].position),g.normalize(),e[f].position=e[f-1].position.add(g.multiplyByScaler(e[f].radius)),F.abs(e[f].position.x)<a&&(e[f].position.x=0),l!=0&&(e[f].velocity=e[f].position.substract(e[f].lastPosition),e[f].velocity=e[f].velocity.divisionByScalar(l),e[f].velocity=e[f].velocity.multiplyByScaler(e[f].mobility)),e[f].force=new B(0,0),e[f].lastGravity=new B(m.x,m.y)}function xd(e,t,i,s,r,a){let n=new B(0,0);e[0].position=new B(i.x,i.y);const o=F.degreesToRadian(s),l=F.radianToDirection(o);l.normalize();for(let h=1;h<t;++h)e[h].force=l.multiplyByScaler(e[h].acceleration).add(r),e[h].lastPosition=new B(e[h].position.x,e[h].position.y),e[h].velocity=new B(0,0),n=e[h].force,n.normalize(),n=n.multiplyByScaler(e[h].radius),e[h].position=e[h-1].position.add(n),F.abs(e[h].position.x)<a&&(e[h].position.x=0),e[h].force=new B(0,0),e[h].lastGravity=new B(l.x,l.y)}function Dr(e,t,i,s,r){let a;const n=r.getScale(r.translationScale,r.angleScale);a=s*n,a<t?(a<r.valueBelowMinimum&&(r.valueBelowMinimum=a),a=t):a>i&&(a>r.valueExceededMaximum&&(r.valueExceededMaximum=a),a=i);const o=r.weight/ra;o>=1||(a=e[0]*(1-o)+a*o),e[0]=a}function Ia(e,t,i,s,r,a,n,o){let l=0;const h=F.max(i,t);h<e&&(e=h);const u=F.min(i,t);u>e&&(e=u);const c=F.min(r,a),d=F.max(r,a),g=n,_=fd(u,h),m=e-_;switch(od(m)){case 1:{const f=d-g,b=h-_;b!=0&&(l=m*(f/b),l+=g);break}case-1:{const f=c-g,b=u-_;b!=0&&(l=m*(f/b),l+=g);break}case 0:{l=g;break}}return o?l:l*-1}var zo;(e=>{e.CubismPhysics=ns,e.Options=Nh})(zo||(zo={}));const Or=4,Cd=36,vd=32;class bd{constructor(t){this._renderTextureCount=0,this._clippingMaskBufferSize=256,this._clippingContextListForMask=new y,this._clippingContextListForDraw=new y,this._channelColors=new y,this._tmpBoundsOnModel=new Os,this._tmpMatrix=new st,this._tmpMatrixForMask=new st,this._tmpMatrixForDraw=new st,this._clippingContexttConstructor=t;let i=new vt;i.r=1,i.g=0,i.b=0,i.a=0,this._channelColors.pushBack(i),i=new vt,i.r=0,i.g=1,i.b=0,i.a=0,this._channelColors.pushBack(i),i=new vt,i.r=0,i.g=0,i.b=1,i.a=0,this._channelColors.pushBack(i),i=new vt,i.r=0,i.g=0,i.b=0,i.a=1,this._channelColors.pushBack(i)}release(){for(let t=0;t<this._clippingContextListForMask.getSize();t++)this._clippingContextListForMask.at(t)&&(this._clippingContextListForMask.at(t).release(),this._clippingContextListForMask.set(t,void 0)),this._clippingContextListForMask.set(t,null);this._clippingContextListForMask=null;for(let t=0;t<this._clippingContextListForDraw.getSize();t++)this._clippingContextListForDraw.set(t,null);this._clippingContextListForDraw=null;for(let t=0;t<this._channelColors.getSize();t++)this._channelColors.set(t,null);this._channelColors=null,this._clearedFrameBufferFlags!=null&&this._clearedFrameBufferFlags.clear(),this._clearedFrameBufferFlags=null}initialize(t,i){i%1!=0&&(k("The number of render textures must be specified as an integer. The decimal point is rounded down and corrected to an integer."),i=~~i),i<1&&k("The number of render textures must be an integer greater than or equal to 1. Set the number of render textures to 1."),this._renderTextureCount=i<1?1:i,this._clearedFrameBufferFlags=new y(this._renderTextureCount);for(let s=0;s<t.getDrawableCount();s++){if(t.getDrawableMaskCounts()[s]<=0){this._clippingContextListForDraw.pushBack(null);continue}let r=this.findSameClip(t.getDrawableMasks()[s],t.getDrawableMaskCounts()[s]);r==null&&(r=new this._clippingContexttConstructor(this,t.getDrawableMasks()[s],t.getDrawableMaskCounts()[s]),this._clippingContextListForMask.pushBack(r)),r.addClippedDrawable(s),this._clippingContextListForDraw.pushBack(r)}}findSameClip(t,i){for(let s=0;s<this._clippingContextListForMask.getSize();s++){const r=this._clippingContextListForMask.at(s),a=r._clippingIdCount;if(a!=i)continue;let n=0;for(let o=0;o<a;o++){const l=r._clippingIdList[o];for(let h=0;h<a;h++)if(t[h]==l){n++;break}}if(n==a)return r}return null}setupMatrixForHighPrecision(t,i){let s=0;for(let r=0;r<this._clippingContextListForMask.getSize();r++){const a=this._clippingContextListForMask.at(r);this.calcClippedDrawTotalBounds(t,a),a._isUsing&&s++}if(s>0){if(this.setupLayoutBounds(0),this._clearedFrameBufferFlags.getSize()!=this._renderTextureCount){this._clearedFrameBufferFlags.clear();for(let r=0;r<this._renderTextureCount;r++)this._clearedFrameBufferFlags.pushBack(!1)}else for(let r=0;r<this._renderTextureCount;r++)this._clearedFrameBufferFlags.set(r,!1);for(let r=0;r<this._clippingContextListForMask.getSize();r++){const a=this._clippingContextListForMask.at(r),n=a._allClippedDrawRect,o=a._layoutBounds,l=.05;let h=0,u=0;const c=t.getPixelsPerUnit(),d=a.getClippingManager().getClippingMaskBufferSize(),g=o.width*d,_=o.height*d;this._tmpBoundsOnModel.setRect(n),this._tmpBoundsOnModel.width*c>g?(this._tmpBoundsOnModel.expand(n.width*l,0),h=o.width/this._tmpBoundsOnModel.width):h=c/g,this._tmpBoundsOnModel.height*c>_?(this._tmpBoundsOnModel.expand(0,n.height*l),u=o.height/this._tmpBoundsOnModel.height):u=c/_,this.createMatrixForMask(i,o,h,u),a._matrixForMask.setMatrix(this._tmpMatrixForMask.getArray()),a._matrixForDraw.setMatrix(this._tmpMatrixForDraw.getArray())}}}createMatrixForMask(t,i,s,r){this._tmpMatrix.loadIdentity(),this._tmpMatrix.translateRelative(-1,-1),this._tmpMatrix.scaleRelative(2,2),this._tmpMatrix.translateRelative(i.x,i.y),this._tmpMatrix.scaleRelative(s,r),this._tmpMatrix.translateRelative(-this._tmpBoundsOnModel.x,-this._tmpBoundsOnModel.y),this._tmpMatrixForMask.setMatrix(this._tmpMatrix.getArray()),this._tmpMatrix.loadIdentity(),this._tmpMatrix.translateRelative(i.x,i.y*(t?-1:1)),this._tmpMatrix.scaleRelative(s,r*(t?-1:1)),this._tmpMatrix.translateRelative(-this._tmpBoundsOnModel.x,-this._tmpBoundsOnModel.y),this._tmpMatrixForDraw.setMatrix(this._tmpMatrix.getArray())}setupLayoutBounds(t){const i=this._renderTextureCount<=1?Cd:vd*this._renderTextureCount;if(t<=0||t>i){t>i&&D(`not supported mask count : {0}
[Details] render texture count : {1}, mask count : {2}`,t-i,this._renderTextureCount,t);for(let h=0;h<this._clippingContextListForMask.getSize();h++){const u=this._clippingContextListForMask.at(h);u._layoutChannelIndex=0,u._layoutBounds.x=0,u._layoutBounds.y=0,u._layoutBounds.width=1,u._layoutBounds.height=1,u._bufferIndex=0}return}const s=this._renderTextureCount<=1?9:8;let r=t/this._renderTextureCount;const a=t%this._renderTextureCount;r=Math.ceil(r);let n=r/Or;const o=r%Or;n=~~n;let l=0;for(let h=0;h<this._renderTextureCount;h++)for(let u=0;u<Or;u++){let c=n+(u<o?1:0);const d=o+(n<1?-1:0);if(u==d&&a>0&&(c-=h<a?0:1),c!=0)if(c==1){const g=this._clippingContextListForMask.at(l++);g._layoutChannelIndex=u,g._layoutBounds.x=0,g._layoutBounds.y=0,g._layoutBounds.width=1,g._layoutBounds.height=1,g._bufferIndex=h}else if(c==2)for(let g=0;g<c;g++){let _=g%2;_=~~_;const m=this._clippingContextListForMask.at(l++);m._layoutChannelIndex=u,m._layoutBounds.x=_*.5,m._layoutBounds.y=0,m._layoutBounds.width=.5,m._layoutBounds.height=1,m._bufferIndex=h}else if(c<=4)for(let g=0;g<c;g++){let _=g%2,m=g/2;_=~~_,m=~~m;const f=this._clippingContextListForMask.at(l++);f._layoutChannelIndex=u,f._layoutBounds.x=_*.5,f._layoutBounds.y=m*.5,f._layoutBounds.width=.5,f._layoutBounds.height=.5,f._bufferIndex=h}else if(c<=s)for(let g=0;g<c;g++){let _=g%3,m=g/3;_=~~_,m=~~m;const f=this._clippingContextListForMask.at(l++);f._layoutChannelIndex=u,f._layoutBounds.x=_/3,f._layoutBounds.y=m/3,f._layoutBounds.width=1/3,f._layoutBounds.height=1/3,f._bufferIndex=h}else{D(`not supported mask count : {0}
[Details] render texture count : {1}, mask count : {2}`,t-i,this._renderTextureCount,t);for(let g=0;g<c;g++){const _=this._clippingContextListForMask.at(l++);_._layoutChannelIndex=0,_._layoutBounds.x=0,_._layoutBounds.y=0,_._layoutBounds.width=1,_._layoutBounds.height=1,_._bufferIndex=0}}}}calcClippedDrawTotalBounds(t,i){let s=Number.MAX_VALUE,r=Number.MAX_VALUE,a=Number.MIN_VALUE,n=Number.MIN_VALUE;const o=i._clippedDrawableIndexList.length;for(let l=0;l<o;l++){const h=i._clippedDrawableIndexList[l],u=t.getDrawableVertexCount(h),c=t.getDrawableVertices(h);let d=Number.MAX_VALUE,g=Number.MAX_VALUE,_=-Number.MAX_VALUE,m=-Number.MAX_VALUE;const f=u*we.vertexStep;for(let b=we.vertexOffset;b<f;b+=we.vertexStep){const x=c[b],E=c[b+1];x<d&&(d=x),x>_&&(_=x),E<g&&(g=E),E>m&&(m=E)}if(d!=Number.MAX_VALUE)if(d<s&&(s=d),g<r&&(r=g),_>a&&(a=_),m>n&&(n=m),s==Number.MAX_VALUE)i._allClippedDrawRect.x=0,i._allClippedDrawRect.y=0,i._allClippedDrawRect.width=0,i._allClippedDrawRect.height=0,i._isUsing=!1;else{i._isUsing=!0;const b=a-s,x=n-r;i._allClippedDrawRect.x=s,i._allClippedDrawRect.y=r,i._allClippedDrawRect.width=b,i._allClippedDrawRect.height=x}}}getClippingContextListForDraw(){return this._clippingContextListForDraw}getClippingMaskBufferSize(){return this._clippingMaskBufferSize}getRenderTextureCount(){return this._renderTextureCount}getChannelFlagAsColor(t){return this._channelColors.at(t)}setClippingMaskBufferSize(t){this._clippingMaskBufferSize=t}}let ei;const Md=10;class Uh{constructor(){this._shaderSets=new y}release(){this.releaseShaderProgram()}setupShaderProgramForDraw(t,i,s){t.isPremultipliedAlpha()||D("NoPremultipliedAlpha is not allowed"),this._shaderSets.getSize()==0&&this.generateShaders();let r,a,n,o;const l=t.getClippingContextBufferForDraw()!=null,h=i.getDrawableInvertedMaskBit(s),u=l?h?2:1:0;let c;switch(i.getDrawableBlendMode(s)){case Ie.CubismBlendMode_Normal:default:c=this._shaderSets.at(1+u),r=this.gl.ONE,a=this.gl.ONE_MINUS_SRC_ALPHA,n=this.gl.ONE,o=this.gl.ONE_MINUS_SRC_ALPHA;break;case Ie.CubismBlendMode_Additive:c=this._shaderSets.at(4+u),r=this.gl.ONE,a=this.gl.ONE,n=this.gl.ZERO,o=this.gl.ONE;break;case Ie.CubismBlendMode_Multiplicative:c=this._shaderSets.at(7+u),r=this.gl.DST_COLOR,a=this.gl.ONE_MINUS_SRC_ALPHA,n=this.gl.ZERO,o=this.gl.ONE;break}this.gl.useProgram(c.shaderProgram),t._bufferData.vertex==null&&(t._bufferData.vertex=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t._bufferData.vertex);const d=i.getDrawableVertices(s);this.gl.bufferData(this.gl.ARRAY_BUFFER,d,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(c.attributePositionLocation),this.gl.vertexAttribPointer(c.attributePositionLocation,2,this.gl.FLOAT,!1,0,0),t._bufferData.uv==null&&(t._bufferData.uv=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t._bufferData.uv);const g=i.getDrawableVertexUvs(s);if(this.gl.bufferData(this.gl.ARRAY_BUFFER,g,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(c.attributeTexCoordLocation),this.gl.vertexAttribPointer(c.attributeTexCoordLocation,2,this.gl.FLOAT,!1,0,0),l){this.gl.activeTexture(this.gl.TEXTURE1);const T=t.getClippingContextBufferForDraw().getClippingManager().getColorBuffer().at(t.getClippingContextBufferForDraw()._bufferIndex);this.gl.bindTexture(this.gl.TEXTURE_2D,T),this.gl.uniform1i(c.samplerTexture1Location,1),this.gl.uniformMatrix4fv(c.uniformClipMatrixLocation,!1,t.getClippingContextBufferForDraw()._matrixForDraw.getArray());const M=t.getClippingContextBufferForDraw()._layoutChannelIndex,Y=t.getClippingContextBufferForDraw().getClippingManager().getChannelFlagAsColor(M);this.gl.uniform4f(c.uniformChannelFlagLocation,Y.r,Y.g,Y.b,Y.a)}const _=i.getDrawableTextureIndex(s),m=t.getBindedTextures().getValue(_);this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,m),this.gl.uniform1i(c.samplerTexture0Location,0);const f=t.getMvpMatrix();this.gl.uniformMatrix4fv(c.uniformMatrixLocation,!1,f.getArray());const b=t.getModelColorWithOpacity(i.getDrawableOpacity(s)),x=i.getMultiplyColor(s),E=i.getScreenColor(s);this.gl.uniform4f(c.uniformBaseColorLocation,b.r,b.g,b.b,b.a),this.gl.uniform4f(c.uniformMultiplyColorLocation,x.r,x.g,x.b,x.a),this.gl.uniform4f(c.uniformScreenColorLocation,E.r,E.g,E.b,E.a),t._bufferData.index==null&&(t._bufferData.index=this.gl.createBuffer());const A=i.getDrawableVertexIndices(s);this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,t._bufferData.index),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,A,this.gl.DYNAMIC_DRAW),this.gl.blendFuncSeparate(r,a,n,o)}setupShaderProgramForMask(t,i,s){t.isPremultipliedAlpha()||D("NoPremultipliedAlpha is not allowed"),this._shaderSets.getSize()==0&&this.generateShaders();const r=this._shaderSets.at(0);this.gl.useProgram(r.shaderProgram),t._bufferData.vertex==null&&(t._bufferData.vertex=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t._bufferData.vertex);const a=i.getDrawableVertices(s);this.gl.bufferData(this.gl.ARRAY_BUFFER,a,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(r.attributePositionLocation),this.gl.vertexAttribPointer(r.attributePositionLocation,2,this.gl.FLOAT,!1,0,0),t._bufferData.uv==null&&(t._bufferData.uv=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t._bufferData.uv);const n=i.getDrawableTextureIndex(s),o=t.getBindedTextures().getValue(n);this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,o),this.gl.uniform1i(r.samplerTexture0Location,0),t._bufferData.uv==null&&(t._bufferData.uv=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t._bufferData.uv);const l=i.getDrawableVertexUvs(s);this.gl.bufferData(this.gl.ARRAY_BUFFER,l,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(r.attributeTexCoordLocation),this.gl.vertexAttribPointer(r.attributeTexCoordLocation,2,this.gl.FLOAT,!1,0,0),t.getClippingContextBufferForMask();const h=t.getClippingContextBufferForMask()._layoutChannelIndex,u=t.getClippingContextBufferForMask().getClippingManager().getChannelFlagAsColor(h);this.gl.uniform4f(r.uniformChannelFlagLocation,u.r,u.g,u.b,u.a),this.gl.uniformMatrix4fv(r.uniformClipMatrixLocation,!1,t.getClippingContextBufferForMask()._matrixForMask.getArray());const c=t.getClippingContextBufferForMask()._layoutBounds;this.gl.uniform4f(r.uniformBaseColorLocation,c.x*2-1,c.y*2-1,c.getRight()*2-1,c.getBottom()*2-1);const d=i.getMultiplyColor(s),g=i.getScreenColor(s);this.gl.uniform4f(r.uniformMultiplyColorLocation,d.r,d.g,d.b,d.a),this.gl.uniform4f(r.uniformScreenColorLocation,g.r,g.g,g.b,g.a);const _=this.gl.ZERO,m=this.gl.ONE_MINUS_SRC_COLOR,f=this.gl.ZERO,b=this.gl.ONE_MINUS_SRC_ALPHA;t._bufferData.index==null&&(t._bufferData.index=this.gl.createBuffer());const x=i.getDrawableVertexIndices(s);this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,t._bufferData.index),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,x,this.gl.DYNAMIC_DRAW),this.gl.blendFuncSeparate(_,m,f,b)}releaseShaderProgram(){for(let t=0;t<this._shaderSets.getSize();t++)this.gl.deleteProgram(this._shaderSets.at(t).shaderProgram),this._shaderSets.at(t).shaderProgram=0,this._shaderSets.set(t,void 0),this._shaderSets.set(t,null)}generateShaders(){for(let t=0;t<Md;t++)this._shaderSets.pushBack(new zh);this._shaderSets.at(0).shaderProgram=this.loadShaderProgram(Pd,wd),this._shaderSets.at(1).shaderProgram=this.loadShaderProgram(Bd,Id),this._shaderSets.at(2).shaderProgram=this.loadShaderProgram(Go,Ed),this._shaderSets.at(3).shaderProgram=this.loadShaderProgram(Go,Fd),this._shaderSets.at(4).shaderProgram=this._shaderSets.at(1).shaderProgram,this._shaderSets.at(5).shaderProgram=this._shaderSets.at(2).shaderProgram,this._shaderSets.at(6).shaderProgram=this._shaderSets.at(3).shaderProgram,this._shaderSets.at(7).shaderProgram=this._shaderSets.at(1).shaderProgram,this._shaderSets.at(8).shaderProgram=this._shaderSets.at(2).shaderProgram,this._shaderSets.at(9).shaderProgram=this._shaderSets.at(3).shaderProgram,this._shaderSets.at(0).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(0).shaderProgram,"a_position"),this._shaderSets.at(0).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(0).shaderProgram,"a_texCoord"),this._shaderSets.at(0).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"s_texture0"),this._shaderSets.at(0).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"u_clipMatrix"),this._shaderSets.at(0).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"u_channelFlag"),this._shaderSets.at(0).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"u_baseColor"),this._shaderSets.at(0).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"u_multiplyColor"),this._shaderSets.at(0).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"u_screenColor"),this._shaderSets.at(1).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(1).shaderProgram,"a_position"),this._shaderSets.at(1).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(1).shaderProgram,"a_texCoord"),this._shaderSets.at(1).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(1).shaderProgram,"s_texture0"),this._shaderSets.at(1).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(1).shaderProgram,"u_matrix"),this._shaderSets.at(1).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(1).shaderProgram,"u_baseColor"),this._shaderSets.at(1).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(1).shaderProgram,"u_multiplyColor"),this._shaderSets.at(1).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(1).shaderProgram,"u_screenColor"),this._shaderSets.at(2).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(2).shaderProgram,"a_position"),this._shaderSets.at(2).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(2).shaderProgram,"a_texCoord"),this._shaderSets.at(2).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"s_texture0"),this._shaderSets.at(2).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"s_texture1"),this._shaderSets.at(2).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_matrix"),this._shaderSets.at(2).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_clipMatrix"),this._shaderSets.at(2).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_channelFlag"),this._shaderSets.at(2).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_baseColor"),this._shaderSets.at(2).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_multiplyColor"),this._shaderSets.at(2).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_screenColor"),this._shaderSets.at(3).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(3).shaderProgram,"a_position"),this._shaderSets.at(3).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(3).shaderProgram,"a_texCoord"),this._shaderSets.at(3).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"s_texture0"),this._shaderSets.at(3).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"s_texture1"),this._shaderSets.at(3).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_matrix"),this._shaderSets.at(3).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_clipMatrix"),this._shaderSets.at(3).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_channelFlag"),this._shaderSets.at(3).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_baseColor"),this._shaderSets.at(3).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_multiplyColor"),this._shaderSets.at(3).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_screenColor"),this._shaderSets.at(4).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(4).shaderProgram,"a_position"),this._shaderSets.at(4).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(4).shaderProgram,"a_texCoord"),this._shaderSets.at(4).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(4).shaderProgram,"s_texture0"),this._shaderSets.at(4).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(4).shaderProgram,"u_matrix"),this._shaderSets.at(4).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(4).shaderProgram,"u_baseColor"),this._shaderSets.at(4).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(4).shaderProgram,"u_multiplyColor"),this._shaderSets.at(4).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(4).shaderProgram,"u_screenColor"),this._shaderSets.at(5).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(5).shaderProgram,"a_position"),this._shaderSets.at(5).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(5).shaderProgram,"a_texCoord"),this._shaderSets.at(5).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"s_texture0"),this._shaderSets.at(5).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"s_texture1"),this._shaderSets.at(5).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_matrix"),this._shaderSets.at(5).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_clipMatrix"),this._shaderSets.at(5).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_channelFlag"),this._shaderSets.at(5).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_baseColor"),this._shaderSets.at(5).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_multiplyColor"),this._shaderSets.at(5).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_screenColor"),this._shaderSets.at(6).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(6).shaderProgram,"a_position"),this._shaderSets.at(6).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(6).shaderProgram,"a_texCoord"),this._shaderSets.at(6).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"s_texture0"),this._shaderSets.at(6).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"s_texture1"),this._shaderSets.at(6).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_matrix"),this._shaderSets.at(6).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_clipMatrix"),this._shaderSets.at(6).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_channelFlag"),this._shaderSets.at(6).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_baseColor"),this._shaderSets.at(6).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_multiplyColor"),this._shaderSets.at(6).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_screenColor"),this._shaderSets.at(7).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(7).shaderProgram,"a_position"),this._shaderSets.at(7).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(7).shaderProgram,"a_texCoord"),this._shaderSets.at(7).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(7).shaderProgram,"s_texture0"),this._shaderSets.at(7).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(7).shaderProgram,"u_matrix"),this._shaderSets.at(7).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(7).shaderProgram,"u_baseColor"),this._shaderSets.at(7).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(7).shaderProgram,"u_multiplyColor"),this._shaderSets.at(7).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(7).shaderProgram,"u_screenColor"),this._shaderSets.at(8).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(8).shaderProgram,"a_position"),this._shaderSets.at(8).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(8).shaderProgram,"a_texCoord"),this._shaderSets.at(8).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"s_texture0"),this._shaderSets.at(8).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"s_texture1"),this._shaderSets.at(8).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_matrix"),this._shaderSets.at(8).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_clipMatrix"),this._shaderSets.at(8).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_channelFlag"),this._shaderSets.at(8).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_baseColor"),this._shaderSets.at(8).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_multiplyColor"),this._shaderSets.at(8).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_screenColor"),this._shaderSets.at(9).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(9).shaderProgram,"a_position"),this._shaderSets.at(9).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(9).shaderProgram,"a_texCoord"),this._shaderSets.at(9).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"s_texture0"),this._shaderSets.at(9).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"s_texture1"),this._shaderSets.at(9).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_matrix"),this._shaderSets.at(9).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_clipMatrix"),this._shaderSets.at(9).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_channelFlag"),this._shaderSets.at(9).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_baseColor"),this._shaderSets.at(9).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_multiplyColor"),this._shaderSets.at(9).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_screenColor")}loadShaderProgram(t,i){let s=this.gl.createProgram(),r=this.compileShaderSource(this.gl.VERTEX_SHADER,t);if(!r)return D("Vertex shader compile error!"),0;let a=this.compileShaderSource(this.gl.FRAGMENT_SHADER,i);return a?(this.gl.attachShader(s,r),this.gl.attachShader(s,a),this.gl.linkProgram(s),this.gl.getProgramParameter(s,this.gl.LINK_STATUS)?(this.gl.deleteShader(r),this.gl.deleteShader(a),s):(D("Failed to link program: {0}",s),this.gl.deleteShader(r),r=0,this.gl.deleteShader(a),a=0,s&&(this.gl.deleteProgram(s),s=0),0)):(D("Vertex shader compile error!"),0)}compileShaderSource(t,i){const s=i,r=this.gl.createShader(t);if(this.gl.shaderSource(r,s),this.gl.compileShader(r),!r){const n=this.gl.getShaderInfoLog(r);D("Shader compile log: {0} ",n)}return this.gl.getShaderParameter(r,this.gl.COMPILE_STATUS)?r:(this.gl.deleteShader(r),null)}setGl(t){this.gl=t}}class Ge{static getInstance(){return ei==null&&(ei=new Ge),ei}static deleteInstance(){ei&&(ei.release(),ei=null)}constructor(){this._shaderMap=new bt}release(){for(const t=this._shaderMap.begin();t.notEqual(this._shaderMap.end());t.preIncrement())t.ptr().second.release();this._shaderMap.clear()}getShader(t){return this._shaderMap.getValue(t)}setGlContext(t){if(!this._shaderMap.isExist(t)){const i=new Uh;i.setGl(t),this._shaderMap.setValue(t,i)}}}class zh{}var Gh=(e=>(e[e.ShaderNames_SetupMask=0]="ShaderNames_SetupMask",e[e.ShaderNames_NormalPremultipliedAlpha=1]="ShaderNames_NormalPremultipliedAlpha",e[e.ShaderNames_NormalMaskedPremultipliedAlpha=2]="ShaderNames_NormalMaskedPremultipliedAlpha",e[e.ShaderNames_NomralMaskedInvertedPremultipliedAlpha=3]="ShaderNames_NomralMaskedInvertedPremultipliedAlpha",e[e.ShaderNames_AddPremultipliedAlpha=4]="ShaderNames_AddPremultipliedAlpha",e[e.ShaderNames_AddMaskedPremultipliedAlpha=5]="ShaderNames_AddMaskedPremultipliedAlpha",e[e.ShaderNames_AddMaskedPremultipliedAlphaInverted=6]="ShaderNames_AddMaskedPremultipliedAlphaInverted",e[e.ShaderNames_MultPremultipliedAlpha=7]="ShaderNames_MultPremultipliedAlpha",e[e.ShaderNames_MultMaskedPremultipliedAlpha=8]="ShaderNames_MultMaskedPremultipliedAlpha",e[e.ShaderNames_MultMaskedPremultipliedAlphaInverted=9]="ShaderNames_MultMaskedPremultipliedAlphaInverted",e))(Gh||{});const Pd="attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;varying vec4       v_myPos;uniform mat4       u_clipMatrix;void main(){   gl_Position = u_clipMatrix * a_position;   v_myPos = u_clipMatrix * a_position;   v_texCoord = a_texCoord;   v_texCoord.y = 1.0 - v_texCoord.y;}",wd="precision mediump float;varying vec2       v_texCoord;varying vec4       v_myPos;uniform vec4       u_baseColor;uniform vec4       u_channelFlag;uniform sampler2D  s_texture0;void main(){   float isInside =        step(u_baseColor.x, v_myPos.x/v_myPos.w)       * step(u_baseColor.y, v_myPos.y/v_myPos.w)       * step(v_myPos.x/v_myPos.w, u_baseColor.z)       * step(v_myPos.y/v_myPos.w, u_baseColor.w);   gl_FragColor = u_channelFlag * texture2D(s_texture0, v_texCoord).a * isInside;}",Bd="attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;uniform mat4       u_matrix;void main(){   gl_Position = u_matrix * a_position;   v_texCoord = a_texCoord;   v_texCoord.y = 1.0 - v_texCoord.y;}",Go="attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;varying vec4       v_clipPos;uniform mat4       u_matrix;uniform mat4       u_clipMatrix;void main(){   gl_Position = u_matrix * a_position;   v_clipPos = u_clipMatrix * a_position;   v_texCoord = a_texCoord;   v_texCoord.y = 1.0 - v_texCoord.y;}",Id="precision mediump float;varying vec2       v_texCoord;uniform vec4       u_baseColor;uniform sampler2D  s_texture0;uniform vec4       u_multiplyColor;uniform vec4       u_screenColor;void main(){   vec4 texColor = texture2D(s_texture0, v_texCoord);   texColor.rgb = texColor.rgb * u_multiplyColor.rgb;   texColor.rgb = (texColor.rgb + u_screenColor.rgb * texColor.a) - (texColor.rgb * u_screenColor.rgb);   vec4 color = texColor * u_baseColor;   gl_FragColor = vec4(color.rgb, color.a);}",Ed="precision mediump float;varying vec2       v_texCoord;varying vec4       v_clipPos;uniform vec4       u_baseColor;uniform vec4       u_channelFlag;uniform sampler2D  s_texture0;uniform sampler2D  s_texture1;uniform vec4       u_multiplyColor;uniform vec4       u_screenColor;void main(){   vec4 texColor = texture2D(s_texture0, v_texCoord);   texColor.rgb = texColor.rgb * u_multiplyColor.rgb;   texColor.rgb = (texColor.rgb + u_screenColor.rgb * texColor.a) - (texColor.rgb * u_screenColor.rgb);   vec4 col_formask = texColor * u_baseColor;   vec4 clipMask = (1.0 - texture2D(s_texture1, v_clipPos.xy / v_clipPos.w)) * u_channelFlag;   float maskVal = clipMask.r + clipMask.g + clipMask.b + clipMask.a;   col_formask = col_formask * maskVal;   gl_FragColor = col_formask;}",Fd="precision mediump float;varying vec2      v_texCoord;varying vec4      v_clipPos;uniform sampler2D s_texture0;uniform sampler2D s_texture1;uniform vec4      u_channelFlag;uniform vec4      u_baseColor;uniform vec4      u_multiplyColor;uniform vec4      u_screenColor;void main(){   vec4 texColor = texture2D(s_texture0, v_texCoord);   texColor.rgb = texColor.rgb * u_multiplyColor.rgb;   texColor.rgb = (texColor.rgb + u_screenColor.rgb * texColor.a) - (texColor.rgb * u_screenColor.rgb);   vec4 col_formask = texColor * u_baseColor;   vec4 clipMask = (1.0 - texture2D(s_texture1, v_clipPos.xy / v_clipPos.w)) * u_channelFlag;   float maskVal = clipMask.r + clipMask.g + clipMask.b + clipMask.a;   col_formask = col_formask * (1.0 - maskVal);   gl_FragColor = col_formask;}";var Xo;(e=>{e.CubismShaderSet=zh,e.CubismShader_WebGL=Uh,e.CubismShaderManager_WebGL=Ge,e.ShaderNames=Gh})(Xo||(Xo={}));let de,Xs;class aa extends bd{getMaskRenderTexture(){if(this._maskTexture&&this._maskTexture.textures!=null)this._maskTexture.frameNo=this._currentFrameNo;else{this._maskRenderTextures!=null&&this._maskRenderTextures.clear(),this._maskRenderTextures=new y,this._maskColorBuffers!=null&&this._maskColorBuffers.clear(),this._maskColorBuffers=new y;const t=this._clippingMaskBufferSize;for(let i=0;i<this._renderTextureCount;i++)this._maskColorBuffers.pushBack(this.gl.createTexture()),this.gl.bindTexture(this.gl.TEXTURE_2D,this._maskColorBuffers.at(i)),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,t,t,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.bindTexture(this.gl.TEXTURE_2D,null),this._maskRenderTextures.pushBack(this.gl.createFramebuffer()),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this._maskRenderTextures.at(i)),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,this._maskColorBuffers.at(i),0);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,Xs),this._maskTexture=new Xh(this._currentFrameNo,this._maskRenderTextures)}return this._maskTexture.textures}setGL(t){this.gl=t}constructor(){super(jh)}setupClippingContext(t,i){this._currentFrameNo++;let s=0;for(let r=0;r<this._clippingContextListForMask.getSize();r++){const a=this._clippingContextListForMask.at(r);this.calcClippedDrawTotalBounds(t,a),a._isUsing&&s++}if(s>0){this.gl.viewport(0,0,this._clippingMaskBufferSize,this._clippingMaskBufferSize),this._currentMaskRenderTexture=this.getMaskRenderTexture().at(0),i.preDraw(),this.setupLayoutBounds(s),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this._currentMaskRenderTexture),this._clearedFrameBufferFlags.getSize()!=this._renderTextureCount&&(this._clearedFrameBufferFlags.clear(),this._clearedFrameBufferFlags=new y(this._renderTextureCount));for(let r=0;r<this._clearedFrameBufferFlags.getSize();r++)this._clearedFrameBufferFlags.set(r,!1);for(let r=0;r<this._clippingContextListForMask.getSize();r++){const a=this._clippingContextListForMask.at(r),n=a._allClippedDrawRect,o=a._layoutBounds,l=.05;let h=0,u=0;const c=this.getMaskRenderTexture().at(a._bufferIndex);this._currentMaskRenderTexture!=c&&(this._currentMaskRenderTexture=c,i.preDraw(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this._currentMaskRenderTexture)),this._tmpBoundsOnModel.setRect(n),this._tmpBoundsOnModel.expand(n.width*l,n.height*l),h=o.width/this._tmpBoundsOnModel.width,u=o.height/this._tmpBoundsOnModel.height,this._tmpMatrix.loadIdentity(),this._tmpMatrix.translateRelative(-1,-1),this._tmpMatrix.scaleRelative(2,2),this._tmpMatrix.translateRelative(o.x,o.y),this._tmpMatrix.scaleRelative(h,u),this._tmpMatrix.translateRelative(-this._tmpBoundsOnModel.x,-this._tmpBoundsOnModel.y),this._tmpMatrixForMask.setMatrix(this._tmpMatrix.getArray()),this._tmpMatrix.loadIdentity(),this._tmpMatrix.translateRelative(o.x,o.y),this._tmpMatrix.scaleRelative(h,u),this._tmpMatrix.translateRelative(-this._tmpBoundsOnModel.x,-this._tmpBoundsOnModel.y),this._tmpMatrixForDraw.setMatrix(this._tmpMatrix.getArray()),a._matrixForMask.setMatrix(this._tmpMatrixForMask.getArray()),a._matrixForDraw.setMatrix(this._tmpMatrixForDraw.getArray());const d=a._clippingIdCount;for(let g=0;g<d;g++){const _=a._clippingIdList[g];t.getDrawableDynamicFlagVertexPositionsDidChange(_)&&(i.setIsCulling(t.getDrawableCulling(_)!=!1),this._clearedFrameBufferFlags.at(a._bufferIndex)||(this.gl.clearColor(1,1,1,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this._clearedFrameBufferFlags.set(a._bufferIndex,!0)),i.setClippingContextBufferForMask(a),i.drawMeshWebGL(t,_))}}this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,Xs),i.setClippingContextBufferForMask(null),this.gl.viewport(de[0],de[1],de[2],de[3])}}getColorBuffer(){return this._maskColorBuffers}getClippingMaskCount(){return this._clippingContextListForMask.getSize()}}class Xh{constructor(t,i){this.frameNo=t,this.textures=i}}class jh extends Gc{constructor(t,i,s){super(i,s),this._owner=t}getClippingManager(){return this._owner}setGl(t){this._owner.setGL(t)}}class Td{setGlEnable(t,i){i?this.gl.enable(t):this.gl.disable(t)}setGlEnableVertexAttribArray(t,i){i?this.gl.enableVertexAttribArray(t):this.gl.disableVertexAttribArray(t)}save(){if(this.gl==null){D(`'gl' is null. WebGLRenderingContext is required.
Please call 'CubimRenderer_WebGL.startUp' function.`);return}this._lastArrayBufferBinding=this.gl.getParameter(this.gl.ARRAY_BUFFER_BINDING),this._lastElementArrayBufferBinding=this.gl.getParameter(this.gl.ELEMENT_ARRAY_BUFFER_BINDING),this._lastProgram=this.gl.getParameter(this.gl.CURRENT_PROGRAM),this._lastActiveTexture=this.gl.getParameter(this.gl.ACTIVE_TEXTURE),this.gl.activeTexture(this.gl.TEXTURE1),this._lastTexture1Binding2D=this.gl.getParameter(this.gl.TEXTURE_BINDING_2D),this.gl.activeTexture(this.gl.TEXTURE0),this._lastTexture0Binding2D=this.gl.getParameter(this.gl.TEXTURE_BINDING_2D),this._lastVertexAttribArrayEnabled[0]=this.gl.getVertexAttrib(0,this.gl.VERTEX_ATTRIB_ARRAY_ENABLED),this._lastVertexAttribArrayEnabled[1]=this.gl.getVertexAttrib(1,this.gl.VERTEX_ATTRIB_ARRAY_ENABLED),this._lastVertexAttribArrayEnabled[2]=this.gl.getVertexAttrib(2,this.gl.VERTEX_ATTRIB_ARRAY_ENABLED),this._lastVertexAttribArrayEnabled[3]=this.gl.getVertexAttrib(3,this.gl.VERTEX_ATTRIB_ARRAY_ENABLED),this._lastScissorTest=this.gl.isEnabled(this.gl.SCISSOR_TEST),this._lastStencilTest=this.gl.isEnabled(this.gl.STENCIL_TEST),this._lastDepthTest=this.gl.isEnabled(this.gl.DEPTH_TEST),this._lastCullFace=this.gl.isEnabled(this.gl.CULL_FACE),this._lastBlend=this.gl.isEnabled(this.gl.BLEND),this._lastFrontFace=this.gl.getParameter(this.gl.FRONT_FACE),this._lastColorMask=this.gl.getParameter(this.gl.COLOR_WRITEMASK),this._lastBlending[0]=this.gl.getParameter(this.gl.BLEND_SRC_RGB),this._lastBlending[1]=this.gl.getParameter(this.gl.BLEND_DST_RGB),this._lastBlending[2]=this.gl.getParameter(this.gl.BLEND_SRC_ALPHA),this._lastBlending[3]=this.gl.getParameter(this.gl.BLEND_DST_ALPHA),this._lastFBO=this.gl.getParameter(this.gl.FRAMEBUFFER_BINDING),this._lastViewport=this.gl.getParameter(this.gl.VIEWPORT)}restore(){if(this.gl==null){D(`'gl' is null. WebGLRenderingContext is required.
Please call 'CubimRenderer_WebGL.startUp' function.`);return}this.gl.useProgram(this._lastProgram),this.setGlEnableVertexAttribArray(0,this._lastVertexAttribArrayEnabled[0]),this.setGlEnableVertexAttribArray(1,this._lastVertexAttribArrayEnabled[1]),this.setGlEnableVertexAttribArray(2,this._lastVertexAttribArrayEnabled[2]),this.setGlEnableVertexAttribArray(3,this._lastVertexAttribArrayEnabled[3]),this.setGlEnable(this.gl.SCISSOR_TEST,this._lastScissorTest),this.setGlEnable(this.gl.STENCIL_TEST,this._lastStencilTest),this.setGlEnable(this.gl.DEPTH_TEST,this._lastDepthTest),this.setGlEnable(this.gl.CULL_FACE,this._lastCullFace),this.setGlEnable(this.gl.BLEND,this._lastBlend),this.gl.frontFace(this._lastFrontFace),this.gl.colorMask(this._lastColorMask[0],this._lastColorMask[1],this._lastColorMask[2],this._lastColorMask[3]),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this._lastArrayBufferBinding),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this._lastElementArrayBufferBinding),this.gl.activeTexture(this.gl.TEXTURE1),this.gl.bindTexture(this.gl.TEXTURE_2D,this._lastTexture1Binding2D),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this._lastTexture0Binding2D),this.gl.activeTexture(this._lastActiveTexture),this.gl.blendFuncSeparate(this._lastBlending[0],this._lastBlending[1],this._lastBlending[2],this._lastBlending[3])}setGl(t){this.gl=t}constructor(){this._lastVertexAttribArrayEnabled=new Array(4),this._lastColorMask=new Array(4),this._lastBlending=new Array(4),this._lastViewport=new Array(4)}}class Ea extends tr{initialize(t,i=1){t.isUsingMasking()&&(this._clippingManager=new aa,this._clippingManager.initialize(t,i)),this._sortedDrawableIndexList.resize(t.getDrawableCount(),0),super.initialize(t)}bindTexture(t,i){this._textures.setValue(t,i)}getBindedTextures(){return this._textures}setClippingMaskBufferSize(t){if(!this._model.isUsingMasking())return;const i=this._clippingManager.getRenderTextureCount();this._clippingManager.release(),this._clippingManager=void 0,this._clippingManager=null,this._clippingManager=new aa,this._clippingManager.setClippingMaskBufferSize(t),this._clippingManager.initialize(this.getModel(),i)}getClippingMaskBufferSize(){return this._model.isUsingMasking()?this._clippingManager.getClippingMaskBufferSize():-1}getRenderTextureCount(){return this._model.isUsingMasking()?this._clippingManager.getRenderTextureCount():-1}constructor(){super(),this._clippingContextBufferForMask=null,this._clippingContextBufferForDraw=null,this._rendererProfile=new Td,this.firstDraw=!0,this._textures=new bt,this._sortedDrawableIndexList=new y,this._bufferData={vertex:WebGLBuffer=null,uv:WebGLBuffer=null,index:WebGLBuffer=null},this._textures.prepareCapacity(32,!0)}release(){this._clippingManager&&(this._clippingManager.release(),this._clippingManager=void 0,this._clippingManager=null),this.gl!=null&&(this.gl.deleteBuffer(this._bufferData.vertex),this._bufferData.vertex=null,this.gl.deleteBuffer(this._bufferData.uv),this._bufferData.uv=null,this.gl.deleteBuffer(this._bufferData.index),this._bufferData.index=null,this._bufferData=null,this._textures=null)}doDrawModel(){if(this.gl==null){D(`'gl' is null. WebGLRenderingContext is required.
Please call 'CubimRenderer_WebGL.startUp' function.`);return}this._clippingManager!=null&&(this.preDraw(),this.isUsingHighPrecisionMask()?this._clippingManager.setupMatrixForHighPrecision(this.getModel(),!1):this._clippingManager.setupClippingContext(this.getModel(),this)),this.preDraw();const t=this.getModel().getDrawableCount(),i=this.getModel().getDrawableRenderOrders();for(let s=0;s<t;++s){const r=i[s];this._sortedDrawableIndexList.set(r,s)}for(let s=0;s<t;++s){const r=this._sortedDrawableIndexList.at(s);if(!this.getModel().getDrawableDynamicFlagIsVisible(r))continue;const a=this._clippingManager!=null?this._clippingManager.getClippingContextListForDraw().at(r):null;if(a!=null&&this.isUsingHighPrecisionMask()){a._isUsing&&(this.gl.viewport(0,0,this._clippingManager.getClippingMaskBufferSize(),this._clippingManager.getClippingMaskBufferSize()),this.preDraw(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,a.getClippingManager().getMaskRenderTexture().at(a._bufferIndex)),this.gl.clearColor(1,1,1,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT));{const n=a._clippingIdCount;for(let o=0;o<n;o++){const l=a._clippingIdList[o];this._model.getDrawableDynamicFlagVertexPositionsDidChange(l)&&(this.setIsCulling(this._model.getDrawableCulling(l)!=!1),this.setClippingContextBufferForMask(a),this.drawMeshWebGL(this._model,l))}}this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,Xs),this.setClippingContextBufferForMask(null),this.gl.viewport(de[0],de[1],de[2],de[3]),this.preDraw()}this.setClippingContextBufferForDraw(a),this.setIsCulling(this.getModel().getDrawableCulling(r)),this.drawMeshWebGL(this._model,r)}}drawMeshWebGL(t,i){this.isCulling()?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this.gl.frontFace(this.gl.CCW),this.isGeneratingMask()?Ge.getInstance().getShader(this.gl).setupShaderProgramForMask(this,t,i):Ge.getInstance().getShader(this.gl).setupShaderProgramForDraw(this,t,i);{const s=t.getDrawableVertexIndexCount(i);this.gl.drawElements(this.gl.TRIANGLES,s,this.gl.UNSIGNED_SHORT,0)}this.gl.useProgram(null),this.setClippingContextBufferForDraw(null),this.setClippingContextBufferForMask(null)}saveProfile(){this._rendererProfile.save()}restoreProfile(){this._rendererProfile.restore()}static doStaticRelease(){Ge.deleteInstance()}setRenderState(t,i){Xs=t,de=i}preDraw(){if(this.firstDraw&&(this.firstDraw=!1),this.gl.disable(this.gl.SCISSOR_TEST),this.gl.disable(this.gl.STENCIL_TEST),this.gl.disable(this.gl.DEPTH_TEST),this.gl.frontFace(this.gl.CW),this.gl.enable(this.gl.BLEND),this.gl.colorMask(!0,!0,!0,!0),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,null),this.getAnisotropy()>0&&this._extension)for(let t=0;t<this._textures.getSize();++t)this.gl.bindTexture(this.gl.TEXTURE_2D,this._textures.getValue(t)),this.gl.texParameterf(this.gl.TEXTURE_2D,this._extension.TEXTURE_MAX_ANISOTROPY_EXT,this.getAnisotropy())}setClippingContextBufferForMask(t){this._clippingContextBufferForMask=t}getClippingContextBufferForMask(){return this._clippingContextBufferForMask}setClippingContextBufferForDraw(t){this._clippingContextBufferForDraw=t}getClippingContextBufferForDraw(){return this._clippingContextBufferForDraw}isGeneratingMask(){return this.getClippingContextBufferForMask()!=null}startUp(t){this.gl=t,this._clippingManager&&this._clippingManager.setGL(t),Ge.getInstance().setGlContext(t),this._rendererProfile.setGl(t),this._extension=this.gl.getExtension("EXT_texture_filter_anisotropic")||this.gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this.gl.getExtension("MOZ_EXT_texture_filter_anisotropic")}}tr.staticRelease=()=>{Ea.doStaticRelease()};var jo;(e=>{e.CubismClippingContext=jh,e.CubismClippingManager_WebGL=aa,e.CubismRenderTextureResource=Xh,e.CubismRenderer_WebGL=Ea})(jo||(jo={}));class Ad{constructor(t=!1,i=!1){this.isOverridden=t,this.isParameterRepeated=i}}class Yo{constructor(t=!1,i=new vt){this.isOverridden=t,this.color=i}get isOverwritten(){return this.isOverridden}}class Ho{constructor(t=!1,i=new vt){this.isOverridden=t,this.color=i}get isOverwritten(){return this.isOverridden}}class Rd{constructor(t=!1,i=!1){this.isOverridden=t,this.isCulling=i}get isOverwritten(){return this.isOverridden}}class Yh{update(){this._model.update(),this._model.drawables.resetDynamicFlags()}getPixelsPerUnit(){return this._model==null?0:this._model.canvasinfo.PixelsPerUnit}getCanvasWidth(){return this._model==null?0:this._model.canvasinfo.CanvasWidth/this._model.canvasinfo.PixelsPerUnit}getCanvasHeight(){return this._model==null?0:this._model.canvasinfo.CanvasHeight/this._model.canvasinfo.PixelsPerUnit}saveParameters(){const t=this._model.parameters.count,i=this._savedParameters.getSize();for(let s=0;s<t;++s)s<i?this._savedParameters.set(s,this._parameterValues[s]):this._savedParameters.pushBack(this._parameterValues[s])}getMultiplyColor(t){return this.getOverrideFlagForModelMultiplyColors()||this.getOverrideFlagForDrawableMultiplyColors(t)?this._userMultiplyColors.at(t).color:this.getDrawableMultiplyColor(t)}getScreenColor(t){return this.getOverrideFlagForModelScreenColors()||this.getOverrideFlagForDrawableScreenColors(t)?this._userScreenColors.at(t).color:this.getDrawableScreenColor(t)}setMultiplyColorByTextureColor(t,i){this.setMultiplyColorByRGBA(t,i.r,i.g,i.b,i.a)}setMultiplyColorByRGBA(t,i,s,r,a=1){this._userMultiplyColors.at(t).color.r=i,this._userMultiplyColors.at(t).color.g=s,this._userMultiplyColors.at(t).color.b=r,this._userMultiplyColors.at(t).color.a=a}setScreenColorByTextureColor(t,i){this.setScreenColorByRGBA(t,i.r,i.g,i.b,i.a)}setScreenColorByRGBA(t,i,s,r,a=1){this._userScreenColors.at(t).color.r=i,this._userScreenColors.at(t).color.g=s,this._userScreenColors.at(t).color.b=r,this._userScreenColors.at(t).color.a=a}getPartMultiplyColor(t){return this._userPartMultiplyColors.at(t).color}getPartScreenColor(t){return this._userPartScreenColors.at(t).color}setPartColor(t,i,s,r,a,n,o){if(n.at(t).color.r=i,n.at(t).color.g=s,n.at(t).color.b=r,n.at(t).color.a=a,n.at(t).isOverridden)for(let l=0;l<this._partChildDrawables.at(t).getSize();++l){const h=this._partChildDrawables.at(t).at(l);o.at(h).color.r=i,o.at(h).color.g=s,o.at(h).color.b=r,o.at(h).color.a=a}}setPartMultiplyColorByTextureColor(t,i){this.setPartMultiplyColorByRGBA(t,i.r,i.g,i.b,i.a)}setPartMultiplyColorByRGBA(t,i,s,r,a){this.setPartColor(t,i,s,r,a,this._userPartMultiplyColors,this._userMultiplyColors)}setPartScreenColorByTextureColor(t,i){this.setPartScreenColorByRGBA(t,i.r,i.g,i.b,i.a)}setPartScreenColorByRGBA(t,i,s,r,a){this.setPartColor(t,i,s,r,a,this._userPartScreenColors,this._userScreenColors)}getOverrideFlagForModelParameterRepeat(){return this._isOverriddenParameterRepeat}setOverrideFlagForModelParameterRepeat(t){this._isOverriddenParameterRepeat=t}getOverrideFlagForParameterRepeat(t){return this._userParameterRepeatDataList.at(t).isOverridden}setOverrideFlagForParameterRepeat(t,i){this._userParameterRepeatDataList.at(t).isOverridden=i}getRepeatFlagForParameterRepeat(t){return this._userParameterRepeatDataList.at(t).isParameterRepeated}setRepeatFlagForParameterRepeat(t,i){this._userParameterRepeatDataList.at(t).isParameterRepeated=i}getOverwriteFlagForModelMultiplyColors(){return k("getOverwriteFlagForModelMultiplyColors() is a deprecated function. Please use getOverrideFlagForModelMultiplyColors()."),this.getOverrideFlagForModelMultiplyColors()}getOverrideFlagForModelMultiplyColors(){return this._isOverriddenModelMultiplyColors}getOverwriteFlagForModelScreenColors(){return k("getOverwriteFlagForModelScreenColors() is a deprecated function. Please use getOverrideFlagForModelScreenColors()."),this.getOverrideFlagForModelScreenColors()}getOverrideFlagForModelScreenColors(){return this._isOverriddenModelScreenColors}setOverwriteFlagForModelMultiplyColors(t){k("setOverwriteFlagForModelMultiplyColors(value: boolean) is a deprecated function. Please use setOverrideFlagForModelMultiplyColors(value: boolean)."),this.setOverrideFlagForModelMultiplyColors(t)}setOverrideFlagForModelMultiplyColors(t){this._isOverriddenModelMultiplyColors=t}setOverwriteFlagForModelScreenColors(t){k("setOverwriteFlagForModelScreenColors(value: boolean) is a deprecated function. Please use setOverrideFlagForModelScreenColors(value: boolean)."),this.setOverrideFlagForModelScreenColors(t)}setOverrideFlagForModelScreenColors(t){this._isOverriddenModelScreenColors=t}getOverwriteFlagForDrawableMultiplyColors(t){return k("getOverwriteFlagForDrawableMultiplyColors(drawableindex: number) is a deprecated function. Please use getOverrideFlagForDrawableMultiplyColors(drawableindex: number)."),this.getOverrideFlagForDrawableMultiplyColors(t)}getOverrideFlagForDrawableMultiplyColors(t){return this._userMultiplyColors.at(t).isOverridden}getOverwriteFlagForDrawableScreenColors(t){return k("getOverwriteFlagForDrawableScreenColors(drawableindex: number) is a deprecated function. Please use getOverrideFlagForDrawableScreenColors(drawableindex: number)."),this.getOverrideFlagForDrawableScreenColors(t)}getOverrideFlagForDrawableScreenColors(t){return this._userScreenColors.at(t).isOverridden}setOverwriteFlagForDrawableMultiplyColors(t,i){k("setOverwriteFlagForDrawableMultiplyColors(drawableindex: number, value: boolean) is a deprecated function. Please use setOverrideFlagForDrawableMultiplyColors(drawableindex: number, value: boolean)."),this.setOverrideFlagForDrawableMultiplyColors(t,i)}setOverrideFlagForDrawableMultiplyColors(t,i){this._userMultiplyColors.at(t).isOverridden=i}setOverwriteFlagForDrawableScreenColors(t,i){k("setOverwriteFlagForDrawableScreenColors(drawableindex: number, value: boolean) is a deprecated function. Please use setOverrideFlagForDrawableScreenColors(drawableindex: number, value: boolean)."),this.setOverrideFlagForDrawableScreenColors(t,i)}setOverrideFlagForDrawableScreenColors(t,i){this._userScreenColors.at(t).isOverridden=i}getOverwriteColorForPartMultiplyColors(t){return k("getOverwriteColorForPartMultiplyColors(partIndex: number) is a deprecated function. Please use getOverrideColorForPartMultiplyColors(partIndex: number)."),this.getOverrideColorForPartMultiplyColors(t)}getOverrideColorForPartMultiplyColors(t){return this._userPartMultiplyColors.at(t).isOverridden}getOverwriteColorForPartScreenColors(t){return k("getOverwriteColorForPartScreenColors(partIndex: number) is a deprecated function. Please use getOverrideColorForPartScreenColors(partIndex: number)."),this.getOverrideColorForPartScreenColors(t)}getOverrideColorForPartScreenColors(t){return this._userPartScreenColors.at(t).isOverridden}setOverwriteColorForPartColors(t,i,s,r){k("setOverwriteColorForPartColors(partIndex: number, value: boolean, partColors: csmVector<PartColorData>, drawableColors: csmVector<DrawableColorData>) is a deprecated function. Please use setOverrideColorForPartColors(partIndex: number, value: boolean, partColors: csmVector<PartColorData>, drawableColors: csmVector<DrawableColorData>)."),this.setOverrideColorForPartColors(t,i,s,r)}setOverrideColorForPartColors(t,i,s,r){s.at(t).isOverridden=i;for(let a=0;a<this._partChildDrawables.at(t).getSize();++a){const n=this._partChildDrawables.at(t).at(a);r.at(n).isOverridden=i,i&&(r.at(n).color.r=s.at(t).color.r,r.at(n).color.g=s.at(t).color.g,r.at(n).color.b=s.at(t).color.b,r.at(n).color.a=s.at(t).color.a)}}setOverwriteColorForPartMultiplyColors(t,i){k("setOverwriteColorForPartMultiplyColors(partIndex: number, value: boolean) is a deprecated function. Please use setOverrideColorForPartMultiplyColors(partIndex: number, value: boolean)."),this.setOverrideColorForPartMultiplyColors(t,i)}setOverrideColorForPartMultiplyColors(t,i){this._userPartMultiplyColors.at(t).isOverridden=i,this.setOverrideColorForPartColors(t,i,this._userPartMultiplyColors,this._userMultiplyColors)}setOverwriteColorForPartScreenColors(t,i){k("setOverwriteColorForPartScreenColors(partIndex: number, value: boolean) is a deprecated function. Please use setOverrideColorForPartScreenColors(partIndex: number, value: boolean)."),this.setOverrideColorForPartScreenColors(t,i)}setOverrideColorForPartScreenColors(t,i){this._userPartScreenColors.at(t).isOverridden=i,this.setOverrideColorForPartColors(t,i,this._userPartScreenColors,this._userScreenColors)}getDrawableCulling(t){if(this.getOverrideFlagForModelCullings()||this.getOverrideFlagForDrawableCullings(t))return this._userCullings.at(t).isCulling;const i=this._model.drawables.constantFlags;return!Live2DCubismCore.Utils.hasIsDoubleSidedBit(i[t])}setDrawableCulling(t,i){this._userCullings.at(t).isCulling=i}getOverwriteFlagForModelCullings(){return k("getOverwriteFlagForModelCullings() is a deprecated function. Please use getOverrideFlagForModelCullings()."),this.getOverrideFlagForModelCullings()}getOverrideFlagForModelCullings(){return this._isOverriddenCullings}setOverwriteFlagForModelCullings(t){k("setOverwriteFlagForModelCullings(isOverriddenCullings: boolean) is a deprecated function. Please use setOverrideFlagForModelCullings(isOverriddenCullings: boolean)."),this.setOverrideFlagForModelCullings(t)}setOverrideFlagForModelCullings(t){this._isOverriddenCullings=t}getOverwriteFlagForDrawableCullings(t){return k("getOverwriteFlagForDrawableCullings(drawableIndex: number) is a deprecated function. Please use getOverrideFlagForDrawableCullings(drawableIndex: number)."),this.getOverrideFlagForDrawableCullings(t)}getOverrideFlagForDrawableCullings(t){return this._userCullings.at(t).isOverridden}setOverwriteFlagForDrawableCullings(t,i){k("setOverwriteFlagForDrawableCullings(drawableIndex: number, isOverriddenCullings: boolean) is a deprecated function. Please use setOverrideFlagForDrawableCullings(drawableIndex: number, isOverriddenCullings: boolean)."),this.setOverrideFlagForDrawableCullings(t,i)}setOverrideFlagForDrawableCullings(t,i){this._userCullings.at(t).isOverridden=i}getModelOapcity(){return this._modelOpacity}setModelOapcity(t){this._modelOpacity=t}getModel(){return this._model}getPartIndex(t){let i;const s=this._model.parts.count;for(i=0;i<s;++i)if(t==this._partIds.at(i))return i;return this._notExistPartId.isExist(t)?this._notExistPartId.getValue(t):(i=s+this._notExistPartId.getSize(),this._notExistPartId.setValue(t,i),this._notExistPartOpacities.appendKey(i),i)}getPartId(t){const i=this._model.parts.ids[t];return R.getIdManager().getId(i)}getPartCount(){return this._model.parts.count}getPartParentPartIndices(){return this._model.parts.parentIndices}setPartOpacityByIndex(t,i){if(this._notExistPartOpacities.isExist(t)){this._notExistPartOpacities.setValue(t,i);return}ft(0<=t&&t<this.getPartCount()),this._partOpacities[t]=i}setPartOpacityById(t,i){const s=this.getPartIndex(t);s<0||this.setPartOpacityByIndex(s,i)}getPartOpacityByIndex(t){return this._notExistPartOpacities.isExist(t)?this._notExistPartOpacities.getValue(t):(ft(0<=t&&t<this.getPartCount()),this._partOpacities[t])}getPartOpacityById(t){const i=this.getPartIndex(t);return i<0?0:this.getPartOpacityByIndex(i)}getParameterIndex(t){let i;const s=this._model.parameters.count;for(i=0;i<s;++i)if(t==this._parameterIds.at(i))return i;return this._notExistParameterId.isExist(t)?this._notExistParameterId.getValue(t):(i=this._model.parameters.count+this._notExistParameterId.getSize(),this._notExistParameterId.setValue(t,i),this._notExistParameterValues.appendKey(i),i)}getParameterCount(){return this._model.parameters.count}getParameterType(t){return this._model.parameters.types[t]}getParameterMaximumValue(t){return this._model.parameters.maximumValues[t]}getParameterMinimumValue(t){return this._model.parameters.minimumValues[t]}getParameterDefaultValue(t){return this._model.parameters.defaultValues[t]}getParameterId(t){return R.getIdManager().getId(this._model.parameters.ids[t])}getParameterValueByIndex(t){return this._notExistParameterValues.isExist(t)?this._notExistParameterValues.getValue(t):(ft(0<=t&&t<this.getParameterCount()),this._parameterValues[t])}getParameterValueById(t){const i=this.getParameterIndex(t);return this.getParameterValueByIndex(i)}setParameterValueByIndex(t,i,s=1){if(this._notExistParameterValues.isExist(t)){this._notExistParameterValues.setValue(t,s==1?i:this._notExistParameterValues.getValue(t)*(1-s)+i*s);return}ft(0<=t&&t<this.getParameterCount()),this.isRepeat(t)?i=this.getParameterRepeatValue(t,i):i=this.getParameterClampValue(t,i),this._parameterValues[t]=s==1?i:this._parameterValues[t]=this._parameterValues[t]*(1-s)+i*s}setParameterValueById(t,i,s=1){const r=this.getParameterIndex(t);this.setParameterValueByIndex(r,i,s)}addParameterValueByIndex(t,i,s=1){this.setParameterValueByIndex(t,this.getParameterValueByIndex(t)+i*s)}addParameterValueById(t,i,s=1){const r=this.getParameterIndex(t);this.addParameterValueByIndex(r,i,s)}isRepeat(t){if(this._notExistParameterValues.isExist(t))return!1;ft(0<=t&&t<this.getParameterCount());let i;return this._isOverriddenParameterRepeat||this._userParameterRepeatDataList.at(t).isOverridden?i=this._userParameterRepeatDataList.at(t).isParameterRepeated:i=this._model.parameters.repeats[t]!=0,i}getParameterRepeatValue(t,i){if(this._notExistParameterValues.isExist(t))return i;ft(0<=t&&t<this.getParameterCount());const s=this._model.parameters.maximumValues[t],r=this._model.parameters.minimumValues[t],a=s-r;if(s<i){const n=F.mod(i-s,a);Number.isNaN(n)?i=s:i=r+n}if(i<r){const n=F.mod(r-i,a);Number.isNaN(n)?i=r:i=s-n}return i}getParameterClampValue(t,i){if(this._notExistParameterValues.isExist(t))return i;ft(0<=t&&t<this.getParameterCount());const s=this._model.parameters.maximumValues[t],r=this._model.parameters.minimumValues[t];return F.clamp(i,r,s)}getParameterRepeats(t){return this._model.parameters.repeats[t]!=0}multiplyParameterValueById(t,i,s=1){const r=this.getParameterIndex(t);this.multiplyParameterValueByIndex(r,i,s)}multiplyParameterValueByIndex(t,i,s=1){this.setParameterValueByIndex(t,this.getParameterValueByIndex(t)*(1+(i-1)*s))}getDrawableIndex(t){const i=this._model.drawables.count;for(let s=0;s<i;++s)if(this._drawableIds.at(s)==t)return s;return-1}getDrawableCount(){return this._model.drawables.count}getDrawableId(t){const i=this._model.drawables.ids;return R.getIdManager().getId(i[t])}getDrawableRenderOrders(){return this._model.drawables.renderOrders}getDrawableTextureIndices(t){return this.getDrawableTextureIndex(t)}getDrawableTextureIndex(t){return this._model.drawables.textureIndices[t]}getDrawableDynamicFlagVertexPositionsDidChange(t){const i=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasVertexPositionsDidChangeBit(i[t])}getDrawableVertexIndexCount(t){return this._model.drawables.indexCounts[t]}getDrawableVertexCount(t){return this._model.drawables.vertexCounts[t]}getDrawableVertices(t){return this.getDrawableVertexPositions(t)}getDrawableVertexIndices(t){return this._model.drawables.indices[t]}getDrawableVertexPositions(t){return this._model.drawables.vertexPositions[t]}getDrawableVertexUvs(t){return this._model.drawables.vertexUvs[t]}getDrawableOpacity(t){return this._model.drawables.opacities[t]}getDrawableMultiplyColor(t){const i=this._model.drawables.multiplyColors,s=t*4,r=new vt;return r.r=i[s],r.g=i[s+1],r.b=i[s+2],r.a=i[s+3],r}getDrawableScreenColor(t){const i=this._model.drawables.screenColors,s=t*4,r=new vt;return r.r=i[s],r.g=i[s+1],r.b=i[s+2],r.a=i[s+3],r}getDrawableParentPartIndex(t){return this._model.drawables.parentPartIndices[t]}getDrawableBlendMode(t){const i=this._model.drawables.constantFlags;return Live2DCubismCore.Utils.hasBlendAdditiveBit(i[t])?Ie.CubismBlendMode_Additive:Live2DCubismCore.Utils.hasBlendMultiplicativeBit(i[t])?Ie.CubismBlendMode_Multiplicative:Ie.CubismBlendMode_Normal}getDrawableInvertedMaskBit(t){const i=this._model.drawables.constantFlags;return Live2DCubismCore.Utils.hasIsInvertedMaskBit(i[t])}getDrawableMasks(){return this._model.drawables.masks}getDrawableMaskCounts(){return this._model.drawables.maskCounts}isUsingMasking(){for(let t=0;t<this._model.drawables.count;++t)if(!(this._model.drawables.maskCounts[t]<=0))return!0;return!1}getDrawableDynamicFlagIsVisible(t){const i=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasIsVisibleBit(i[t])}getDrawableDynamicFlagVisibilityDidChange(t){const i=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasVisibilityDidChangeBit(i[t])}getDrawableDynamicFlagOpacityDidChange(t){const i=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasOpacityDidChangeBit(i[t])}getDrawableDynamicFlagRenderOrderDidChange(t){const i=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasRenderOrderDidChangeBit(i[t])}getDrawableDynamicFlagBlendColorDidChange(t){const i=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasBlendColorDidChangeBit(i[t])}loadParameters(){let t=this._model.parameters.count;const i=this._savedParameters.getSize();t>i&&(t=i);for(let s=0;s<t;++s)this._parameterValues[s]=this._savedParameters.at(s)}initialize(){ft(this._model),this._parameterValues=this._model.parameters.values,this._partOpacities=this._model.parts.opacities,this._parameterMaximumValues=this._model.parameters.maximumValues,this._parameterMinimumValues=this._model.parameters.minimumValues;{const i=this._model.parameters.ids,s=this._model.parameters.count;this._parameterIds.prepareCapacity(s),this._userParameterRepeatDataList.prepareCapacity(s);for(let r=0;r<s;++r)this._parameterIds.pushBack(R.getIdManager().getId(i[r])),this._userParameterRepeatDataList.pushBack(new Ad(!1,!1))}const t=this._model.parts.count;{const i=this._model.parts.ids;this._partIds.prepareCapacity(t);for(let s=0;s<t;++s)this._partIds.pushBack(R.getIdManager().getId(i[s]));this._userPartMultiplyColors.prepareCapacity(t),this._userPartScreenColors.prepareCapacity(t),this._partChildDrawables.prepareCapacity(t)}{const i=this._model.drawables.ids,s=this._model.drawables.count;this._userMultiplyColors.prepareCapacity(s),this._userScreenColors.prepareCapacity(s),this._userCullings.prepareCapacity(s);const r=new Rd(!1,!1);for(let a=0;a<t;++a){const n=new vt(1,1,1,1),o=new vt(0,0,0,1),l=new Ho(!1,n),h=new Ho(!1,o);this._userPartMultiplyColors.pushBack(l),this._userPartScreenColors.pushBack(h),this._partChildDrawables.pushBack(new y),this._partChildDrawables.at(a).prepareCapacity(s)}for(let a=0;a<s;++a){const n=new vt(1,1,1,1),o=new vt(0,0,0,1),l=new Yo(!1,n),h=new Yo(!1,o);this._drawableIds.pushBack(R.getIdManager().getId(i[a])),this._userMultiplyColors.pushBack(l),this._userScreenColors.pushBack(h),this._userCullings.pushBack(r);const u=this.getDrawableParentPartIndex(a);u>=0&&this._partChildDrawables.at(u).pushBack(a)}}}constructor(t){this._model=t,this._parameterValues=null,this._parameterMaximumValues=null,this._parameterMinimumValues=null,this._partOpacities=null,this._savedParameters=new y,this._parameterIds=new y,this._drawableIds=new y,this._partIds=new y,this._isOverriddenParameterRepeat=!0,this._isOverriddenModelMultiplyColors=!1,this._isOverriddenModelScreenColors=!1,this._isOverriddenCullings=!1,this._modelOpacity=1,this._userParameterRepeatDataList=new y,this._userMultiplyColors=new y,this._userScreenColors=new y,this._userCullings=new y,this._userPartMultiplyColors=new y,this._userPartScreenColors=new y,this._partChildDrawables=new y,this._notExistPartId=new bt,this._notExistParameterId=new bt,this._notExistParameterValues=new bt,this._notExistPartOpacities=new bt}release(){this._model.release(),this._model=null}}var Wo;(e=>{e.CubismModel=Yh})(Wo||(Wo={}));class _s{static create(t,i){let s=null;if(i&&!this.hasMocConsistency(t))return D("Inconsistent MOC3."),s;const r=Live2DCubismCore.Moc.fromArrayBuffer(t);return r&&(s=new _s(r),s._mocVersion=Live2DCubismCore.Version.csmGetMocVersion(r,t)),s}static delete(t){t._moc._release(),t._moc=null,t=null}createModel(){let t=null;const i=Live2DCubismCore.Model.fromMoc(this._moc);return i&&(t=new Yh(i),t.initialize(),++this._modelCount),t}deleteModel(t){t!=null&&(t.release(),t=null,--this._modelCount)}constructor(t){this._moc=t,this._modelCount=0,this._mocVersion=0}release(){ft(this._modelCount==0),this._moc._release(),this._moc=null}getLatestMocVersion(){return Live2DCubismCore.Version.csmGetLatestMocVersion()}getMocVersion(){return this._mocVersion}static hasMocConsistency(t){return Live2DCubismCore.Moc.prototype.hasMocConsistency(t)===1}}var $o;(e=>{e.CubismMoc=_s})($o||($o={}));const qo="Meta",Vd="UserDataCount",Ld="TotalUserDataSize",Nr="UserData",kd="Target",Dd="Id",Od="Value";class Hh{constructor(t,i){this._json=gt.create(t,i)}release(){gt.delete(this._json)}getUserDataCount(){return this._json.getRoot().getValueByString(qo).getValueByString(Vd).toInt()}getTotalUserDataSize(){return this._json.getRoot().getValueByString(qo).getValueByString(Ld).toInt()}getUserDataTargetType(t){return this._json.getRoot().getValueByString(Nr).getValueByIndex(t).getValueByString(kd).getRawString()}getUserDataId(t){return R.getIdManager().getId(this._json.getRoot().getValueByString(Nr).getValueByIndex(t).getValueByString(Dd).getRawString())}getUserDataValue(t){return this._json.getRoot().getValueByString(Nr).getValueByIndex(t).getValueByString(Od).getRawString()}}var Jo;(e=>{e.CubismModelUserDataJson=Hh})(Jo||(Jo={}));const Nd="ArtMesh";class Wh{}class os{static create(t,i){const s=new os;return s.parseUserData(t,i),s}static delete(t){t!=null&&(t.release(),t=null)}getArtMeshUserDatas(){return this._artMeshUserDataNode}parseUserData(t,i){let s=new Hh(t,i);if(!s){s.release(),s=void 0;return}const r=R.getIdManager().getId(Nd),a=s.getUserDataCount();for(let n=0;n<a;n++){const o=new Wh;o.targetId=s.getUserDataId(n),o.targetType=R.getIdManager().getId(s.getUserDataTargetType(n)),o.value=new Xt(s.getUserDataValue(n)),this._userDataNodes.pushBack(o),o.targetType==r&&this._artMeshUserDataNode.pushBack(o)}s.release(),s=void 0}constructor(){this._userDataNodes=new y,this._artMeshUserDataNode=new y}release(){for(let t=0;t<this._userDataNodes.getSize();++t)this._userDataNodes.set(t,null);this._userDataNodes=null}}var Ko;(e=>{e.CubismModelUserData=os,e.CubismModelUserDataNode=Wh})(Ko||(Ko={}));class ir{isInitialized(){return this._initialized}setInitialized(t){this._initialized=t}isUpdating(){return this._updating}setUpdating(t){this._updating=t}setDragging(t,i){this._dragManager.set(t,i)}setAcceleration(t,i,s){this._accelerationX=t,this._accelerationY=i,this._accelerationZ=s}getModelMatrix(){return this._modelMatrix}setOpacity(t){this._opacity=t}getOpacity(){return this._opacity}loadModel(t,i=!1){if(this._moc=_s.create(t,i),this._moc==null){D("Failed to CubismMoc.create().");return}if(this._model=this._moc.createModel(),this._model==null){D("Failed to CreateModel().");return}this._model.saveParameters(),this._modelMatrix=new ph(this._model.getCanvasWidth(),this._model.getCanvasHeight())}loadMotion(t,i,s,r,a,n,o,l,h=!1){if(t==null||i==0)return D("Failed to loadMotion()."),null;const u=er.create(t,i,r,a,h);if(u==null)return D("Failed to create motion from buffer in LoadMotion()"),null;if(n){const c=n.getMotionFadeInTimeValue(o,l);c>=0&&u.setFadeInTime(c);const d=n.getMotionFadeOutTimeValue(o,l);d>=0&&u.setFadeOutTime(d)}return u}loadExpression(t,i,s){return t==null||i==0?(D("Failed to loadExpression()."),null):Be.create(t,i)}loadPose(t,i){if(t==null||i==0){D("Failed to loadPose().");return}this._pose=ss.create(t,i)}loadUserData(t,i){if(t==null||i==0){D("Failed to loadUserData().");return}this._modelUserData=os.create(t,i)}loadPhysics(t,i){if(t==null||i==0){D("Failed to loadPhysics().");return}this._physics=ns.create(t,i)}isHit(t,i,s){const r=this._model.getDrawableIndex(t);if(r<0)return!1;const a=this._model.getDrawableVertexCount(r),n=this._model.getDrawableVertices(r);let o=n[0],l=n[0],h=n[1],u=n[1];for(let g=1;g<a;++g){const _=n[we.vertexOffset+g*we.vertexStep],m=n[we.vertexOffset+g*we.vertexStep+1];_<o&&(o=_),_>l&&(l=_),m<h&&(h=m),m>u&&(u=m)}const c=this._modelMatrix.invertTransformX(i),d=this._modelMatrix.invertTransformY(s);return o<=c&&c<=l&&h<=d&&d<=u}getModel(){return this._model}getRenderer(){return this._renderer}createRenderer(t=1){this._renderer&&this.deleteRenderer(),this._renderer=new Ea,this._renderer.initialize(this._model,t)}deleteRenderer(){this._renderer!=null&&(this._renderer.release(),this._renderer=null)}motionEventFired(t){mt("{0}",t.s)}static cubismDefaultMotionEventCallback(t,i,s){const r=s;r!=null&&r.motionEventFired(i)}constructor(){this._moc=null,this._model=null,this._motionManager=null,this._expressionManager=null,this._eyeBlink=null,this._breath=null,this._modelMatrix=null,this._pose=null,this._dragManager=null,this._physics=null,this._modelUserData=null,this._initialized=!1,this._updating=!1,this._opacity=1,this._lipsync=!0,this._lastLipSyncValue=0,this._dragX=0,this._dragY=0,this._accelerationX=0,this._accelerationY=0,this._accelerationZ=0,this._mocConsistency=!1,this._debugMode=!1,this._renderer=null,this._motionManager=new Ah,this._motionManager.setEventCallback(ir.cubismDefaultMotionEventCallback,this),this._expressionManager=new vh,this._dragManager=new yh}release(){this._motionManager!=null&&(this._motionManager.release(),this._motionManager=null),this._expressionManager!=null&&(this._expressionManager.release(),this._expressionManager=null),this._moc!=null&&(this._moc.deleteModel(this._model),this._moc.release(),this._moc=null),this._modelMatrix=null,ss.delete(this._pose),is.delete(this._eyeBlink),ds.delete(this._breath),this._dragManager=null,ns.delete(this._physics),os.delete(this._modelUserData),this.deleteRenderer()}}var Zo;(e=>{e.CubismUserModel=ir})(Zo||(Zo={}));let ii=null;class Fa{constructor(){this.loadFiletoBytes=(t,i)=>{this._byteReader._fileByte=t,this._byteReader._fileDataView=new DataView(this._byteReader._fileByte),this._byteReader._fileSize=i},this._pcmData=null,this._userTimeSeconds=0,this._lastRms=0,this._sampleOffset=0,this._wavFileInfo=new Ud,this._byteReader=new zd}static getInstance(){return ii==null&&(ii=new Fa),ii}static releaseInstance(){ii!=null&&(ii=void 0),ii=null}update(t){let i,s;if(this._pcmData==null||this._sampleOffset>=this._wavFileInfo._samplesPerChannel)return this._lastRms=0,!1;this._userTimeSeconds+=t,i=Math.floor(this._userTimeSeconds*this._wavFileInfo._samplingRate),i>this._wavFileInfo._samplesPerChannel&&(i=this._wavFileInfo._samplesPerChannel),s=0;for(let r=0;r<this._wavFileInfo._numberOfChannels;r++)for(let a=this._sampleOffset;a<i;a++){const n=this._pcmData[r][a];s+=n*n}return s=Math.sqrt(s/(this._wavFileInfo._numberOfChannels*(i-this._sampleOffset))),this._lastRms=s,this._sampleOffset=i,!0}start(t){this._sampleOffset=0,this._userTimeSeconds=0,this._lastRms=0,this.loadWavFile(t)}getRms(){return this._lastRms}loadWavFile(t){return new Promise(i=>{let s=!1;this._pcmData!=null&&this.releasePcmData();const r=async()=>fetch(t).then(a=>a.arrayBuffer());(async()=>{if(this._byteReader._fileByte=await r(),this._byteReader._fileDataView=new DataView(this._byteReader._fileByte),this._byteReader._fileSize=this._byteReader._fileByte.byteLength,this._byteReader._readOffset=0,this._byteReader._fileByte==null||this._byteReader._fileSize<4){i(!1);return}this._wavFileInfo._fileName=t;try{if(!this._byteReader.getCheckSignature("RIFF"))throw s=!1,new Error('Cannot find Signeture "RIFF".');if(this._byteReader.get32LittleEndian(),!this._byteReader.getCheckSignature("WAVE"))throw s=!1,new Error('Cannot find Signeture "WAVE".');if(!this._byteReader.getCheckSignature("fmt "))throw s=!1,new Error('Cannot find Signeture "fmt".');const a=this._byteReader.get32LittleEndian();if(this._byteReader.get16LittleEndian()!=1)throw s=!1,new Error("File is not linear PCM.");for(this._wavFileInfo._numberOfChannels=this._byteReader.get16LittleEndian(),this._wavFileInfo._samplingRate=this._byteReader.get32LittleEndian(),this._byteReader.get32LittleEndian(),this._byteReader.get16LittleEndian(),this._wavFileInfo._bitsPerSample=this._byteReader.get16LittleEndian(),a>16&&(this._byteReader._readOffset+=a-16);!this._byteReader.getCheckSignature("data")&&this._byteReader._readOffset<this._byteReader._fileSize;)this._byteReader._readOffset+=this._byteReader.get32LittleEndian()+4;if(this._byteReader._readOffset>=this._byteReader._fileSize)throw s=!1,new Error('Cannot find "data" Chunk.');{const n=this._byteReader.get32LittleEndian();this._wavFileInfo._samplesPerChannel=n*8/(this._wavFileInfo._bitsPerSample*this._wavFileInfo._numberOfChannels)}this._pcmData=new Array(this._wavFileInfo._numberOfChannels);for(let n=0;n<this._wavFileInfo._numberOfChannels;n++)this._pcmData[n]=new Float32Array(this._wavFileInfo._samplesPerChannel);for(let n=0;n<this._wavFileInfo._samplesPerChannel;n++)for(let o=0;o<this._wavFileInfo._numberOfChannels;o++)this._pcmData[o][n]=this.getPcmSample();s=!0,i(s)}catch(a){console.log(a)}})().then(()=>{i(s)})})}getPcmSample(){let t;switch(this._wavFileInfo._bitsPerSample){case 8:t=this._byteReader.get8()-128,t<<=24;break;case 16:t=this._byteReader.get16LittleEndian()<<16;break;case 24:t=this._byteReader.get24LittleEndian()<<8;break;default:t=0;break}return t/2147483647}getPcmDataChannel(t){return!this._pcmData||!(t<this._pcmData.length)?null:Float32Array.from(this._pcmData[t])}getWavSamplingRate(){return!this._wavFileInfo||this._wavFileInfo._samplingRate<1?null:this._wavFileInfo._samplingRate}releasePcmData(){for(let t=0;t<this._wavFileInfo._numberOfChannels;t++)this._pcmData[t]=null;delete this._pcmData,this._pcmData=null}}class Ud{constructor(){this._fileName="",this._numberOfChannels=0,this._bitsPerSample=0,this._samplingRate=0,this._samplesPerChannel=0}}class zd{constructor(){this._fileByte=null,this._fileDataView=null,this._fileSize=0,this._readOffset=0}get8(){const t=this._fileDataView.getUint8(this._readOffset);return this._readOffset++,t}get16LittleEndian(){const t=this._fileDataView.getUint8(this._readOffset+1)<<8|this._fileDataView.getUint8(this._readOffset);return this._readOffset+=2,t}get24LittleEndian(){const t=this._fileDataView.getUint8(this._readOffset+2)<<16|this._fileDataView.getUint8(this._readOffset+1)<<8|this._fileDataView.getUint8(this._readOffset);return this._readOffset+=3,t}get32LittleEndian(){const t=this._fileDataView.getUint8(this._readOffset+3)<<24|this._fileDataView.getUint8(this._readOffset+2)<<16|this._fileDataView.getUint8(this._readOffset+1)<<8|this._fileDataView.getUint8(this._readOffset);return this._readOffset+=4,t}getCheckSignature(t){const i=new Uint8Array(4),s=new TextEncoder().encode(t);if(t.length!=4)return!1;for(let r=0;r<4;r++)i[r]=this.get8();return i[0]==s[0]&&i[1]==s[1]&&i[2]==s[2]&&i[3]==s[3]}}var We=typeof self<"u"?self:{};function Oe(){throw Error("Invalid UTF8")}function Qo(e,t){return t=String.fromCharCode.apply(null,t),e==null?t:e+t}let ws,Ur;const Gd=typeof TextDecoder<"u";let Xd;const jd=typeof TextEncoder<"u";function $h(e){if(jd)e=(Xd||(Xd=new TextEncoder)).encode(e);else{let i=0;const s=new Uint8Array(3*e.length);for(let r=0;r<e.length;r++){var t=e.charCodeAt(r);if(t<128)s[i++]=t;else{if(t<2048)s[i++]=t>>6|192;else{if(t>=55296&&t<=57343){if(t<=56319&&r<e.length){const a=e.charCodeAt(++r);if(a>=56320&&a<=57343){t=1024*(t-55296)+a-56320+65536,s[i++]=t>>18|240,s[i++]=t>>12&63|128,s[i++]=t>>6&63|128,s[i++]=63&t|128;continue}r--}t=65533}s[i++]=t>>12|224,s[i++]=t>>6&63|128}s[i++]=63&t|128}}e=i===s.length?s:s.subarray(0,i)}return e}var Ta,js;t:{for(var tl=["CLOSURE_FLAGS"],zr=We,Gr=0;Gr<tl.length;Gr++)if((zr=zr[tl[Gr]])==null){js=null;break t}js=zr}var ls,el=js&&js[610401301];Ta=el!=null&&el;const il=We.navigator;function na(e){return!!Ta&&!!ls&&ls.brands.some(({brand:t})=>t&&t.indexOf(e)!=-1)}function zt(e){var t;return(t=We.navigator)&&(t=t.userAgent)||(t=""),t.indexOf(e)!=-1}function Me(){return!!Ta&&!!ls&&ls.brands.length>0}function Xr(){return Me()?na("Chromium"):(zt("Chrome")||zt("CriOS"))&&!(!Me()&&zt("Edge"))||zt("Silk")}function Aa(e){return Aa[" "](e),e}ls=il&&il.userAgentData||null,Aa[" "]=function(){};var Yd=!Me()&&(zt("Trident")||zt("MSIE"));!zt("Android")||Xr(),Xr(),zt("Safari")&&(Xr()||!Me()&&zt("Coast")||!Me()&&zt("Opera")||!Me()&&zt("Edge")||(Me()?na("Microsoft Edge"):zt("Edg/"))||Me()&&na("Opera"));var qh={},Yi=null;function Hd(e){const t=e.length;let i=3*t/4;i%3?i=Math.floor(i):"=.".indexOf(e[t-1])!=-1&&(i="=.".indexOf(e[t-2])!=-1?i-2:i-1);const s=new Uint8Array(i);let r=0;return function(a,n){function o(h){for(;l<a.length;){const u=a.charAt(l++),c=Yi[u];if(c!=null)return c;if(!/^[\s\xa0]*$/.test(u))throw Error("Unknown base64 encoding at char: "+u)}return h}Jh();let l=0;for(;;){const h=o(-1),u=o(0),c=o(64),d=o(64);if(d===64&&h===-1)break;n(h<<2|u>>4),c!=64&&(n(u<<4&240|c>>2),d!=64&&n(c<<6&192|d))}}(e,function(a){s[r++]=a}),r!==i?s.subarray(0,r):s}function Jh(){if(!Yi){Yi={};var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),t=["+/=","+/","-_=","-_.","-_"];for(let i=0;i<5;i++){const s=e.concat(t[i].split(""));qh[i]=s;for(let r=0;r<s.length;r++){const a=s[r];Yi[a]===void 0&&(Yi[a]=r)}}}}var Kh=typeof Uint8Array<"u",Zh=!Yd&&typeof btoa=="function";function sl(e){if(!Zh){var t;t===void 0&&(t=0),Jh(),t=qh[t];var i=Array(Math.floor(e.length/3)),s=t[64]||"";let l=0,h=0;for(;l<e.length-2;l+=3){var r=e[l],a=e[l+1],n=e[l+2],o=t[r>>2];r=t[(3&r)<<4|a>>4],a=t[(15&a)<<2|n>>6],n=t[63&n],i[h++]=o+r+a+n}switch(o=0,n=s,e.length-l){case 2:n=t[(15&(o=e[l+1]))<<2]||s;case 1:e=e[l],i[h]=t[e>>2]+t[(3&e)<<4|o>>4]+n+s}return i.join("")}for(t="",i=0,s=e.length-10240;i<s;)t+=String.fromCharCode.apply(null,e.subarray(i,i+=10240));return t+=String.fromCharCode.apply(null,i?e.subarray(i):e),btoa(t)}const rl=/[-_.]/g,Wd={"-":"+",_:"/",".":"="};function $d(e){return Wd[e]||""}function Qh(e){if(!Zh)return Hd(e);rl.test(e)&&(e=e.replace(rl,$d)),e=atob(e);const t=new Uint8Array(e.length);for(let i=0;i<e.length;i++)t[i]=e.charCodeAt(i);return t}function fs(e){return Kh&&e!=null&&e instanceof Uint8Array}var xi={};function $e(){return qd||(qd=new me(null,xi))}function Ra(e){tu(xi);var t=e.g;return(t=t==null||fs(t)?t:typeof t=="string"?Qh(t):null)==null?t:e.g=t}var me=class{h(){return new Uint8Array(Ra(this)||0)}constructor(e,t){if(tu(t),this.g=e,e!=null&&e.length===0)throw Error("ByteString should be constructed with non-empty values")}};let qd,Jd;function tu(e){if(e!==xi)throw Error("illegal external caller")}function eu(e,t){e.__closure__error__context__984382||(e.__closure__error__context__984382={}),e.__closure__error__context__984382.severity=t}function oa(e){return eu(e=Error(e),"warning"),e}var sr=typeof Symbol=="function"&&typeof Symbol()=="symbol",Kd=new Set;function ms(e,t,i=!1,s=!1){return e=typeof Symbol=="function"&&typeof Symbol()=="symbol"?s&&Symbol.for&&e?Symbol.for(e):e!=null?Symbol(e):Symbol():t,i&&Kd.add(e),e}var Zd=ms("jas",void 0,!0,!0),al=ms(void 0,"0di"),jr=ms(void 0,"2ex"),Xi=ms(void 0,"1oa",!0),Ci=ms(void 0,Symbol(),!0);const w=sr?Zd:"Ga",iu={Ga:{value:0,configurable:!0,writable:!0,enumerable:!1}},su=Object.defineProperties;function rr(e,t){sr||w in e||su(e,iu),e[w]|=t}function at(e,t){sr||w in e||su(e,iu),e[w]=t}function Fi(e){return rr(e,34),e}function Qd(e,t){at(t,-30975&(0|e))}function la(e,t){at(t,-30941&(34|e))}function Va(){return typeof BigInt=="function"}function Mt(e){return Array.prototype.slice.call(e)}var La,ps={},ru={};function nl(e){return!(!e||typeof e!="object"||e.Ia!==ru)}function ka(e){return e!==null&&typeof e=="object"&&!Array.isArray(e)&&e.constructor===Object}function Da(e,t){if(e!=null){if(typeof e=="string")e=e?new me(e,xi):$e();else if(e.constructor!==me)if(fs(e))e=e.length?new me(new Uint8Array(e),xi):$e();else{if(!t)throw Error();e=void 0}}return e}function Ys(e){return!(!Array.isArray(e)||e.length)&&!!(1&(0|e[w]))}const ol=[];function Re(e){if(2&e)throw Error()}at(ol,55),La=Object.freeze(ol);class Hs{constructor(t,i,s){this.l=0,this.g=t,this.h=i,this.m=s}next(){if(this.l<this.g.length){const t=this.g[this.l++];return{done:!1,value:this.h?this.h.call(this.m,t):t}}return{done:!0,value:void 0}}[Symbol.iterator](){return new Hs(this.g,this.h,this.m)}}function Oa(e){return Ci?e[Ci]:void 0}var t_=Object.freeze({});function ar(e){return e.Qa=!0,e}var e_=ar(e=>typeof e=="number"),ll=ar(e=>typeof e=="string"),i_=ar(e=>typeof e=="boolean"),nr=typeof We.BigInt=="function"&&typeof We.BigInt(0)=="bigint",ha=ar(e=>nr?e>=r_&&e<=n_:e[0]==="-"?hl(e,s_):hl(e,a_));const s_=Number.MIN_SAFE_INTEGER.toString(),r_=nr?BigInt(Number.MIN_SAFE_INTEGER):void 0,a_=Number.MAX_SAFE_INTEGER.toString(),n_=nr?BigInt(Number.MAX_SAFE_INTEGER):void 0;function hl(e,t){if(e.length>t.length)return!1;if(e.length<t.length||e===t)return!0;for(let i=0;i<e.length;i++){const s=e[i],r=t[i];if(s>r)return!1;if(s<r)return!0}}const o_=typeof Uint8Array.prototype.slice=="function";let au,G=0,tt=0;function ul(e){const t=e>>>0;G=t,tt=(e-t)/4294967296>>>0}function vi(e){if(e<0){ul(-e);const[t,i]=Ga(G,tt);G=t>>>0,tt=i>>>0}else ul(e)}function Na(e){const t=au||(au=new DataView(new ArrayBuffer(8)));t.setFloat32(0,+e,!0),tt=0,G=t.getUint32(0,!0)}function Ua(e,t){const i=4294967296*t+(e>>>0);return Number.isSafeInteger(i)?i:hs(e,t)}function za(e,t){const i=2147483648&t;return i&&(t=~t>>>0,(e=1+~e>>>0)==0&&(t=t+1>>>0)),typeof(e=Ua(e,t))=="number"?i?-e:e:i?"-"+e:e}function hs(e,t){if(e>>>=0,(t>>>=0)<=2097151)var i=""+(4294967296*t+e);else Va()?i=""+(BigInt(t)<<BigInt(32)|BigInt(e)):(e=(16777215&e)+6777216*(i=16777215&(e>>>24|t<<8))+6710656*(t=t>>16&65535),i+=8147497*t,t*=2,e>=1e7&&(i+=e/1e7>>>0,e%=1e7),i>=1e7&&(t+=i/1e7>>>0,i%=1e7),i=t+cl(i)+cl(e));return i}function cl(e){return e=String(e),"0000000".slice(e.length)+e}function or(e){if(e.length<16)vi(Number(e));else if(Va())e=BigInt(e),G=Number(e&BigInt(4294967295))>>>0,tt=Number(e>>BigInt(32)&BigInt(4294967295));else{const t=+(e[0]==="-");tt=G=0;const i=e.length;for(let s=t,r=(i-t)%6+t;r<=i;s=r,r+=6){const a=Number(e.slice(s,r));tt*=1e6,G=1e6*G+a,G>=4294967296&&(tt+=Math.trunc(G/4294967296),tt>>>=0,G>>>=0)}if(t){const[s,r]=Ga(G,tt);G=s,tt=r}}}function Ga(e,t){return t=~t,e?e=1+~e:t+=1,[e,t]}const Xa=typeof BigInt=="function"?BigInt.asIntN:void 0,l_=typeof BigInt=="function"?BigInt.asUintN:void 0,di=Number.isSafeInteger,lr=Number.isFinite,Ws=Math.trunc;function Ve(e){return e==null||typeof e=="number"?e:e==="NaN"||e==="Infinity"||e==="-Infinity"?Number(e):void 0}function nu(e){return e==null||typeof e=="boolean"?e:typeof e=="number"?!!e:void 0}const h_=/^-?([1-9][0-9]*|0)(\.[0-9]+)?$/;function hr(e){switch(typeof e){case"bigint":return!0;case"number":return lr(e);case"string":return h_.test(e);default:return!1}}function Ti(e){if(e==null)return e;if(typeof e=="string"&&e)e=+e;else if(typeof e!="number")return;return lr(e)?0|e:void 0}function ou(e){if(e==null)return e;if(typeof e=="string"&&e)e=+e;else if(typeof e!="number")return;return lr(e)?e>>>0:void 0}function gl(e){if(e[0]==="-")return!1;const t=e.length;return t<20||t===20&&Number(e.substring(0,6))<184467}function ja(e){return e=Ws(e),di(e)||(vi(e),e=za(G,tt)),e}function Ya(e){var t=Ws(Number(e));if(di(t))return String(t);if((t=e.indexOf("."))!==-1&&(e=e.substring(0,t)),t=e.length,!(e[0]==="-"?t<20||t===20&&Number(e.substring(0,7))>-922337:t<19||t===19&&Number(e.substring(0,6))<922337))if(or(e),e=G,2147483648&(t=tt))if(Va())e=""+(BigInt(0|t)<<BigInt(32)|BigInt(e>>>0));else{const[i,s]=Ga(e,t);e="-"+hs(i,s)}else e=hs(e,t);return e}function $s(e){return e==null?e:typeof e=="bigint"?(ha(e)?e=Number(e):(e=Xa(64,e),e=ha(e)?Number(e):String(e)),e):hr(e)?typeof e=="number"?ja(e):Ya(e):void 0}function u_(e){if(e==null)return e;var t=typeof e;if(t==="bigint")return String(l_(64,e));if(hr(e)){if(t==="string")return t=Ws(Number(e)),di(t)&&t>=0?e=String(t):((t=e.indexOf("."))!==-1&&(e=e.substring(0,t)),gl(e)||(or(e),e=hs(G,tt))),e;if(t==="number")return(e=Ws(e))>=0&&di(e)?e:function(i){if(i<0){vi(i);var s=hs(G,tt);return i=Number(s),di(i)?i:s}return gl(s=String(i))?s:(vi(i),Ua(G,tt))}(e)}}function lu(e){if(typeof e!="string")throw Error();return e}function Ai(e){if(e!=null&&typeof e!="string")throw Error();return e}function bi(e){return e==null||typeof e=="string"?e:void 0}function Ha(e,t,i,s){if(e!=null&&typeof e=="object"&&e.W===ps)return e;if(!Array.isArray(e))return i?2&s?((e=t[al])||(Fi((e=new t).u),e=t[al]=e),t=e):t=new t:t=void 0,t;let r=i=0|e[w];return r===0&&(r|=32&s),r|=2&s,r!==i&&at(e,r),new t(e)}function c_(e,t,i){if(t)t:{if(!hr(t=e))throw oa("int64");switch(typeof t){case"string":t=Ya(t);break t;case"bigint":if(e=t=Xa(64,t),ll(e)){if(!/^\s*(?:-?[1-9]\d*|0)?\s*$/.test(e))throw Error(String(e))}else if(e_(e)&&!Number.isSafeInteger(e))throw Error(String(e));t=nr?BigInt(t):i_(t)?t?"1":"0":ll(t)?t.trim()||"0":String(t);break t;default:t=ja(t)}}else t=$s(e);return typeof(i=(e=t)==null?i?0:void 0:e)=="string"&&di(t=+i)?t:i}const g_={};let d_=function(){try{return Aa(new class extends Map{constructor(){super()}}),!1}catch{return!0}}();class Yr{constructor(){this.g=new Map}get(t){return this.g.get(t)}set(t,i){return this.g.set(t,i),this.size=this.g.size,this}delete(t){return t=this.g.delete(t),this.size=this.g.size,t}clear(){this.g.clear(),this.size=this.g.size}has(t){return this.g.has(t)}entries(){return this.g.entries()}keys(){return this.g.keys()}values(){return this.g.values()}forEach(t,i){return this.g.forEach(t,i)}[Symbol.iterator](){return this.entries()}}const __=d_?(Object.setPrototypeOf(Yr.prototype,Map.prototype),Object.defineProperties(Yr.prototype,{size:{value:0,configurable:!0,enumerable:!0,writable:!0}}),Yr):class extends Map{constructor(){super()}};function dl(e){return e}function Hr(e){if(2&e.L)throw Error("Cannot mutate an immutable Map")}var jt=class extends __{constructor(e,t,i=dl,s=dl){super();let r=0|e[w];r|=64,at(e,r),this.L=r,this.S=t,this.R=i,this.Y=this.S?f_:s;for(let a=0;a<e.length;a++){const n=e[a],o=i(n[0],!1,!0);let l=n[1];t?l===void 0&&(l=null):l=s(n[1],!1,!0,void 0,void 0,r),super.set(o,l)}}na(e=_l){if(this.size!==0)return this.X(e)}X(e=_l){const t=[],i=super.entries();for(var s;!(s=i.next()).done;)(s=s.value)[0]=e(s[0]),s[1]=e(s[1]),t.push(s);return t}clear(){Hr(this),super.clear()}delete(e){return Hr(this),super.delete(this.R(e,!0,!1))}entries(){var e=this.ma();return new Hs(e,m_,this)}keys(){return this.Ha()}values(){var e=this.ma();return new Hs(e,jt.prototype.get,this)}forEach(e,t){super.forEach((i,s)=>{e.call(t,this.get(s),s,this)})}set(e,t){return Hr(this),(e=this.R(e,!0,!1))==null?this:t==null?(super.delete(e),this):super.set(e,this.Y(t,!0,!0,this.S,!1,this.L))}Na(e){const t=this.R(e[0],!1,!0);e=e[1],e=this.S?e===void 0?null:e:this.Y(e,!1,!0,void 0,!1,this.L),super.set(t,e)}has(e){return super.has(this.R(e,!1,!1))}get(e){e=this.R(e,!1,!1);const t=super.get(e);if(t!==void 0){var i=this.S;return i?((i=this.Y(t,!1,!0,i,this.ra,this.L))!==t&&super.set(e,i),i):t}}ma(){return Array.from(super.keys())}Ha(){return super.keys()}[Symbol.iterator](){return this.entries()}};function f_(e,t,i,s,r,a){return e=Ha(e,s,i,a),r&&(e=cr(e)),e}function _l(e){return e}function m_(e){return[e,this.get(e)]}let p_,hu,y_;function fl(){return p_||(p_=new jt(Fi([]),void 0,void 0,void 0,g_))}function Wa(e,t,i,s,r){if(e!=null){if(Array.isArray(e))e=Ys(e)?void 0:r&&2&(0|e[w])?e:$a(e,t,i,s!==void 0,r);else if(ka(e)){const a={};for(let n in e)a[n]=Wa(e[n],t,i,s,r);e=a}else e=t(e,s);return e}}function $a(e,t,i,s,r){const a=s||i?0|e[w]:0,n=s?!!(32&a):void 0;s=Mt(e);for(let o=0;o<s.length;o++)s[o]=Wa(s[o],t,i,n,r);return i&&((e=Oa(e))&&(s[Ci]=Mt(e)),i(a,s)),s}function S_(e){return Wa(e,uu,void 0,void 0,!1)}function uu(e){return e.W===ps?e.toJSON():e instanceof jt?e.na(S_):function(t){switch(typeof t){case"number":return isFinite(t)?t:String(t);case"bigint":return ha(t)?Number(t):String(t);case"boolean":return t?1:0;case"object":if(t)if(Array.isArray(t)){if(Ys(t))return}else{if(fs(t))return sl(t);if(t instanceof me){const i=t.g;return i==null?"":typeof i=="string"?i:t.g=sl(i)}if(t instanceof jt)return t.na()}}return t}(e)}function cu(e){return $a(e,uu,void 0,void 0,!1)}function Ee(e,t,i){return e=gu(e,t[0],t[1],i?1:2),t!==hu&&i&&rr(e,16384),e}function gu(e,t,i,s){if(e==null){var r=96;i?(e=[i],r|=512):e=[],t&&(r=-33521665&r|(1023&t)<<15)}else{if(!Array.isArray(e))throw Error("narr");if(2048&(r=0|e[w]))throw Error("farr");if(64&r)return e;if(s===1||s===2||(r|=64),i&&(r|=512,i!==e[0]))throw Error("mid");t:{if(s=(i=e).length){const a=s-1;if(ka(i[a])){if((t=a-(512&(r|=256)?0:-1))>=1024)throw Error("pvtlmt");r=-33521665&r|(1023&t)<<15;break t}}if(t){if((t=Math.max(t,s-(512&r?0:-1)))>1024)throw Error("spvt");r=-33521665&r|(1023&t)<<15}}}return at(e,r),e}function ua(e,t,i=la){if(e!=null){if(Kh&&e instanceof Uint8Array)return t?e:new Uint8Array(e);if(Array.isArray(e)){var s=0|e[w];return 2&s?e:(t&&(t=s===0||!!(32&s)&&!(64&s||!(16&s))),t?(at(e,-12293&(34|s)),e):$a(e,ua,4&s?la:i,!0,!0))}return e.W===ps?e=2&(s=0|(i=e.u)[w])?e:new e.constructor(ur(i,s,!0)):e instanceof jt&&!(2&e.L)&&(i=Fi(e.X(ua)),e=new jt(i,e.S,e.R,e.Y)),e}}function ur(e,t,i){const s=i||2&t?la:Qd,r=!!(32&t);return e=function(a,n,o){const l=Mt(a);var h=l.length;const u=256&n?l[h-1]:void 0;for(h+=u?-1:0,n=512&n?1:0;n<h;n++)l[n]=o(l[n]);if(u){n=l[n]={};for(const c in u)n[c]=o(u[c])}return(a=Oa(a))&&(l[Ci]=Mt(a)),l}(e,t,a=>ua(a,r,s)),rr(e,32|(i?2:0)),e}function cr(e){const t=e.u,i=0|t[w];return 2&i?new e.constructor(ur(t,i,!1)):e}function Mi(e,t){return Ce(e=e.u,0|e[w],t)}function Ce(e,t,i,s){if(i===-1)return null;var r=i+(512&t?0:-1);const a=e.length-1;return r>=a&&256&t?e[a][i]:s&&256&t&&(t=e[a][i])!=null?(e[r]!=null&&jr!=null&&((r=(e=Jd??(Jd={}))[jr]||0)>=4||(e[jr]=r+1,eu(e=Error(),"incident"),function(n){We.setTimeout(()=>{throw n},0)}(e))),t):r<=a?e[r]:void 0}function X(e,t,i){const s=e.u;let r=0|s[w];return Re(r),Q(s,r,t,i),e}function Q(e,t,i,s){const r=512&t?0:-1,a=i+r;var n=e.length-1;return a>=n&&256&t?(e[n][i]=s,t):a<=n?(e[a]=s,256&t&&i in(e=e[n])&&delete e[i],t):(s!==void 0&&(i>=(n=t>>15&1023||536870912)?s!=null&&(e[n+r]={[i]:s},at(e,t|=256)):e[a]=s),t)}function As(e,t){let i=0|(e=e.u)[w];const s=Ce(e,i,t),r=Ve(s);return r!=null&&r!==s&&Q(e,i,t,r),r}function du(e){let t=0|(e=e.u)[w];const i=Ce(e,t,1),s=Da(i,!0);return s!=null&&s!==i&&Q(e,t,1,s),s}function Xe(){return t_===void 0?2:4}function je(e,t,i,s,r){const a=e.u,n=2&(e=0|a[w])?1:s;r=!!r;let o=0|(s=qa(a,e,t))[w];if(!(4&o)){4&o&&(s=Mt(s),o=pe(o,e),e=Q(a,e,t,s));let l=0,h=0;for(;l<s.length;l++){const u=i(s[l]);u!=null&&(s[h++]=u)}h<l&&(s.length=h),o=Ja(o,e),i=-4097&(20|o),o=i&=-8193,at(s,o),2&o&&Object.freeze(s)}return n===1||n===4&&32&o?fe(o)||(r=o,o|=2,o!==r&&at(s,o),Object.freeze(s)):(n===2&&fe(o)&&(s=Mt(s),o=pe(o,e),o=Fe(o,e,r),at(s,o),e=Q(a,e,t,s)),fe(o)||(t=o,o=Fe(o,e,r),o!==t&&at(s,o))),s}function qa(e,t,i,s){return e=Ce(e,t,i,s),Array.isArray(e)?e:La}function Ja(e,t){return e===0&&(e=pe(e,t)),1|e}function fe(e){return!!(2&e)&&!!(4&e)||!!(2048&e)}function _u(e){e=Mt(e);for(let t=0;t<e.length;t++){const i=e[t]=Mt(e[t]);Array.isArray(i[1])&&(i[1]=Fi(i[1]))}return e}function ca(e,t,i,s){let r=0|(e=e.u)[w];Re(r),Q(e,r,t,(s==="0"?Number(i)===0:i===s)?void 0:i)}function Ri(e,t,i,s,r){Re(t);var a=!(!(64&t)&&16384&t);const n=(r=qa(e,t,i,r))!==La;if(a||!n){let o=a=n?0|r[w]:0;(!n||2&o||fe(o)||4&o&&!(32&o))&&(r=Mt(r),o=pe(o,t),t=Q(e,t,i,r)),o=-13&Ja(o,t),o=Fe(s?-17&o:16|o,t,!0),o!==a&&at(r,o)}return r}function Wr(e,t){var i=sc;return Za(Ka(e=e.u),e,0|e[w],i)===t?t:-1}function Ka(e){if(sr)return e[Xi]??(e[Xi]=new Map);if(Xi in e)return e[Xi];const t=new Map;return Object.defineProperty(e,Xi,{value:t}),t}function fu(e,t,i,s){const r=Ka(e),a=Za(r,e,t,i);return a!==s&&(a&&(t=Q(e,t,a)),r.set(i,s)),t}function Za(e,t,i,s){let r=e.get(s);if(r!=null)return r;r=0;for(let a=0;a<s.length;a++){const n=s[a];Ce(t,i,n)!=null&&(r!==0&&(i=Q(t,i,r)),r=n)}return e.set(s,r),r}function Qa(e,t,i,s){let r,a=0|e[w];if((s=Ce(e,a,i,s))!=null&&s.W===ps)return(t=cr(s))!==s&&Q(e,a,i,t),t.u;if(Array.isArray(s)){const n=0|s[w];r=2&n?Ee(ur(s,n,!1),t,!0):64&n?s:Ee(r,t,!0)}else r=Ee(void 0,t,!0);return r!==s&&Q(e,a,i,r),r}function mu(e,t,i,s){let r=0|(e=e.u)[w];return(t=Ha(s=Ce(e,r,i,s),t,!1,r))!==s&&t!=null&&Q(e,r,i,t),t}function O(e,t,i,s=!1){if((t=mu(e,t,i,s))==null)return t;if(!(2&(s=0|(e=e.u)[w]))){const r=cr(t);r!==t&&Q(e,s,i,t=r)}return t}function pu(e,t,i,s,r,a,n){e=e.u;var o=!!(2&t);const l=o?1:r;a=!!a,n&&(n=!o);var h=0|(r=qa(e,t,s))[w];if(!(o=!!(4&h))){var u=r,c=t;const d=!!(2&(h=Ja(h,t)));d&&(c|=2);let g=!d,_=!0,m=0,f=0;for(;m<u.length;m++){const b=Ha(u[m],i,!1,c);if(b instanceof i){if(!d){const x=!!(2&(0|b.u[w]));g&&(g=!x),_&&(_=x)}u[f++]=b}}f<m&&(u.length=f),h|=4,h=_?16|h:-17&h,at(u,h=g?8|h:-9&h),d&&Object.freeze(u)}if(n&&!(8&h||!r.length&&(l===1||l===4&&32&h))){for(fe(h)&&(r=Mt(r),h=pe(h,t),t=Q(e,t,s,r)),i=r,n=h,u=0;u<i.length;u++)(h=i[u])!==(c=cr(h))&&(i[u]=c);n|=8,at(i,n=i.length?-17&n:16|n),h=n}return l===1||l===4&&32&h?fe(h)||(t=h,(h|=!r.length||16&h&&(!o||32&h)?2:2048)!==t&&at(r,h),Object.freeze(r)):(l===2&&fe(h)&&(at(r=Mt(r),h=Fe(h=pe(h,t),t,a)),t=Q(e,t,s,r)),fe(h)||(s=h,(h=Fe(h,t,a))!==s&&at(r,h))),r}function Se(e,t,i){const s=0|e.u[w];return pu(e,s,t,i,Xe(),!1,!(2&s))}function I(e,t,i,s){return s==null&&(s=void 0),X(e,i,s)}function $i(e,t,i,s){s==null&&(s=void 0);t:{let r=0|(e=e.u)[w];if(Re(r),s==null){const a=Ka(e);if(Za(a,e,r,i)!==t)break t;a.set(i,0)}else r=fu(e,r,i,t);Q(e,r,t,s)}}function pe(e,t){return-2049&(e=32|(2&t?2|e:-3&e))}function Fe(e,t,i){return 32&t&&i||(e&=-33),e}function qs(e,t,i,s){const r=0|e.u[w];Re(r),e=pu(e,r,i,t,2,!0),s=s??new i,e.push(s),e[w]=2&(0|s.u[w])?-9&e[w]:-17&e[w]}function Gt(e,t){return Ti(Mi(e,t))}function Yt(e,t){return bi(Mi(e,t))}function it(e,t){return As(e,t)??0}function us(e,t,i){if(i!=null&&typeof i!="boolean")throw e=typeof i,Error(`Expected boolean but got ${e!="object"?e:i?Array.isArray(i)?"array":e:"null"}: ${i}`);X(e,t,i)}function oe(e,t,i){if(i!=null){if(typeof i!="number"||!lr(i))throw oa("int32");i|=0}X(e,t,i)}function v(e,t,i){if(i!=null&&typeof i!="number")throw Error(`Value of float/double field must be a number, found ${typeof i}: ${i}`);X(e,t,i)}function Js(e,t,i){{const n=e.u;let o=0|n[w];if(Re(o),i==null)Q(n,o,t);else{var s=e=0|i[w],r=fe(e),a=r||Object.isFrozen(i);for(r||(e=0),a||(i=Mt(i),s=0,e=Fe(e=pe(e,o),o,!0),a=!1),e|=21,r=0;r<i.length;r++){const l=i[r],h=lu(l);Object.is(l,h)||(a&&(i=Mt(i),s=0,e=Fe(e=pe(e,o),o,!0),a=!1),i[r]=h)}e!==s&&(a&&(i=Mt(i),e=Fe(e=pe(e,o),o,!0)),at(i,e)),Q(n,o,t,i)}}}function gr(e,t,i){Re(0|e.u[w]),je(e,t,bi,2,!0).push(lu(i))}function yu(e,t){return Error(`Invalid wire type: ${e} (at position ${t})`)}function tn(){return Error("Failed to read varint, encoding is invalid.")}function Su(e,t){return Error(`Tried to read past the end of the data ${t} > ${e}`)}function en(e){if(typeof e=="string")return{buffer:Qh(e),N:!1};if(Array.isArray(e))return{buffer:new Uint8Array(e),N:!1};if(e.constructor===Uint8Array)return{buffer:e,N:!1};if(e.constructor===ArrayBuffer)return{buffer:new Uint8Array(e),N:!1};if(e.constructor===me)return{buffer:Ra(e)||new Uint8Array(0),N:!0};if(e instanceof Uint8Array)return{buffer:new Uint8Array(e.buffer,e.byteOffset,e.byteLength),N:!1};throw Error("Type not convertible to a Uint8Array, expected a Uint8Array, an ArrayBuffer, a base64 encoded string, a ByteString or an Array of numbers")}function sn(e,t){let i,s=0,r=0,a=0;const n=e.h;let o=e.g;do i=n[o++],s|=(127&i)<<a,a+=7;while(a<32&&128&i);for(a>32&&(r|=(127&i)>>4),a=3;a<32&&128&i;a+=7)i=n[o++],r|=(127&i)<<a;if(He(e,o),i<128)return t(s>>>0,r>>>0);throw tn()}function rn(e){let t=0,i=e.g;const s=i+10,r=e.h;for(;i<s;){const a=r[i++];if(t|=a,(128&a)==0)return He(e,i),!!(127&t)}throw tn()}function Te(e){const t=e.h;let i=e.g,s=t[i++],r=127&s;if(128&s&&(s=t[i++],r|=(127&s)<<7,128&s&&(s=t[i++],r|=(127&s)<<14,128&s&&(s=t[i++],r|=(127&s)<<21,128&s&&(s=t[i++],r|=s<<28,128&s&&128&t[i++]&&128&t[i++]&&128&t[i++]&&128&t[i++]&&128&t[i++])))))throw tn();return He(e,i),r}function xe(e){return Te(e)>>>0}function ga(e){var t=e.h;const i=e.g,s=t[i],r=t[i+1],a=t[i+2];return t=t[i+3],He(e,e.g+4),(s<<0|r<<8|a<<16|t<<24)>>>0}function da(e){var t=ga(e);e=2*(t>>31)+1;const i=t>>>23&255;return t&=8388607,i==255?t?NaN:e*(1/0):i==0?1401298464324817e-60*e*t:e*Math.pow(2,i-150)*(t+8388608)}function x_(e){return Te(e)}function $r(e,t,{ba:i=!1}={}){e.ba=i,t&&(t=en(t),e.h=t.buffer,e.m=t.N,e.j=0,e.l=e.h.length,e.g=e.j)}function He(e,t){if(e.g=t,t>e.l)throw Su(e.l,t)}function xu(e,t){if(t<0)throw Error(`Tried to read a negative byte length: ${t}`);const i=e.g,s=i+t;if(s>e.l)throw Su(t,e.l-i);return e.g=s,i}function Cu(e,t){if(t==0)return $e();var i=xu(e,t);return e.ba&&e.m?i=e.h.subarray(i,i+t):(e=e.h,i=i===(t=i+t)?new Uint8Array(0):o_?e.slice(i,t):new Uint8Array(e.subarray(i,t))),i.length==0?$e():new me(i,xi)}jt.prototype.toJSON=void 0,jt.prototype.Ia=ru;var ml=[];function vu(e){var t=e.g;if(t.g==t.l)return!1;e.l=e.g.g;var i=xe(e.g);if(t=i>>>3,!((i&=7)>=0&&i<=5))throw yu(i,e.l);if(t<1)throw Error(`Invalid field number: ${t} (at position ${e.l})`);return e.m=t,e.h=i,!0}function Rs(e){switch(e.h){case 0:e.h!=0?Rs(e):rn(e.g);break;case 1:He(e=e.g,e.g+8);break;case 2:if(e.h!=2)Rs(e);else{var t=xe(e.g);He(e=e.g,e.g+t)}break;case 5:He(e=e.g,e.g+4);break;case 3:for(t=e.m;;){if(!vu(e))throw Error("Unmatched start-group tag: stream EOF");if(e.h==4){if(e.m!=t)throw Error("Unmatched end-group tag");break}Rs(e)}break;default:throw yu(e.h,e.l)}}function ys(e,t,i){const s=e.g.l,r=xe(e.g),a=e.g.g+r;let n=a-s;if(n<=0&&(e.g.l=a,i(t,e,void 0,void 0,void 0),n=a-e.g.g),n)throw Error(`Message parsing ended unexpectedly. Expected to read ${r} bytes, instead read ${r-n} bytes, either the data ended unexpectedly or the message misreported its own length`);return e.g.g=a,e.g.l=s,t}function an(e){var t=xe(e.g),i=xu(e=e.g,t);if(e=e.h,Gd){var s,r=e;(s=Ur)||(s=Ur=new TextDecoder("utf-8",{fatal:!0})),t=i+t,r=i===0&&t===r.length?r:r.subarray(i,t);try{var a=s.decode(r)}catch(o){if(ws===void 0){try{s.decode(new Uint8Array([128]))}catch{}try{s.decode(new Uint8Array([97])),ws=!0}catch{ws=!1}}throw!ws&&(Ur=void 0),o}}else{t=(a=i)+t,i=[];let o,l=null;for(;a<t;){var n=e[a++];n<128?i.push(n):n<224?a>=t?Oe():(o=e[a++],n<194||(192&o)!=128?(a--,Oe()):i.push((31&n)<<6|63&o)):n<240?a>=t-1?Oe():(o=e[a++],(192&o)!=128||n===224&&o<160||n===237&&o>=160||(192&(s=e[a++]))!=128?(a--,Oe()):i.push((15&n)<<12|(63&o)<<6|63&s)):n<=244?a>=t-2?Oe():(o=e[a++],(192&o)!=128||o-144+(n<<28)>>30!=0||(192&(s=e[a++]))!=128||(192&(r=e[a++]))!=128?(a--,Oe()):(n=(7&n)<<18|(63&o)<<12|(63&s)<<6|63&r,n-=65536,i.push(55296+(n>>10&1023),56320+(1023&n)))):Oe(),i.length>=8192&&(l=Qo(l,i),i.length=0)}a=Qo(l,i)}return a}function bu(e){const t=xe(e.g);return Cu(e.g,t)}function dr(e,t,i){var s=xe(e.g);for(s=e.g.g+s;e.g.g<s;)i.push(t(e.g))}var Bs=[];function C_(e){return e}let _i;function Zt(e,t,i){t.g?t.m(e,t.g,t.h,i):t.m(e,t.h,i)}var S=class{constructor(e,t){this.u=gu(e,t)}toJSON(){const e=!_i;try{return e&&(_i=cu),Mu(this)}finally{e&&(_i=void 0)}}l(){var e=rf;return e.g?e.l(this,e.g,e.h,!0):e.l(this,e.h,e.defaultValue,!0)}clone(){const e=this.u;return new this.constructor(ur(e,0|e[w],!1))}N(){return!!(2&(0|this.u[w]))}};function Mu(e){var t=e.u;{t=(e=_i(t))!==t;let h=e.length;if(h){var i=e[h-1],s=ka(i);s?h--:i=void 0;var r=e;if(s){t:{var a,n=i,o=!1;if(n)for(let u in n)isNaN(+u)?(a??(a={}))[u]=n[u]:(s=n[u],Array.isArray(s)&&(Ys(s)||nl(s)&&s.size===0)&&(s=null),s==null&&(o=!0),s!=null&&((a??(a={}))[u]=s));if(o||(a=n),a)for(let u in a){o=a;break t}o=null}n=o==null?i!=null:o!==i}for(;h>0&&((a=r[h-1])==null||Ys(a)||nl(a)&&a.size===0);h--)var l=!0;(r!==e||n||l)&&(t?(l||n||o)&&(r.length=h):r=Array.prototype.slice.call(r,0,h),o&&r.push(o)),l=r}else l=e}return l}function pl(e){return e?/^\d+$/.test(e)?(or(e),new _a(G,tt)):null:v_||(v_=new _a(0,0))}S.prototype.W=ps,S.prototype.toString=function(){try{return _i=C_,Mu(this).toString()}finally{_i=void 0}};var _a=class{constructor(e,t){this.h=e>>>0,this.g=t>>>0}};let v_;function yl(e){return e?/^-?\d+$/.test(e)?(or(e),new fa(G,tt)):null:b_||(b_=new fa(0,0))}var fa=class{constructor(e,t){this.h=e>>>0,this.g=t>>>0}};let b_;function fi(e,t,i){for(;i>0||t>127;)e.g.push(127&t|128),t=(t>>>7|i<<25)>>>0,i>>>=7;e.g.push(t)}function Vi(e,t){for(;t>127;)e.g.push(127&t|128),t>>>=7;e.g.push(t)}function _r(e,t){if(t>=0)Vi(e,t);else{for(let i=0;i<9;i++)e.g.push(127&t|128),t>>=7;e.g.push(1)}}function cs(e,t){e.g.push(t>>>0&255),e.g.push(t>>>8&255),e.g.push(t>>>16&255),e.g.push(t>>>24&255)}function Pi(e,t){t.length!==0&&(e.l.push(t),e.h+=t.length)}function Vt(e,t,i){Vi(e.g,8*t+i)}function nn(e,t){return Vt(e,t,2),t=e.g.end(),Pi(e,t),t.push(e.h),t}function on(e,t){var i=t.pop();for(i=e.h+e.g.length()-i;i>127;)t.push(127&i|128),i>>>=7,e.h++;t.push(i),e.h++}function fr(e,t,i){Vt(e,t,2),Vi(e.g,i.length),Pi(e,e.g.end()),Pi(e,i)}function Ks(e,t,i,s){i!=null&&(t=nn(e,t),s(i,e),on(e,t))}function Qt(){const e=class{constructor(){throw Error()}};return Object.setPrototypeOf(e,e.prototype),e}var ln=Qt(),Pu=Qt(),hn=Qt(),un=Qt(),wu=Qt(),Bu=Qt(),cn=Qt(),Iu=Qt(),Eu=Qt(),Li=class{constructor(e,t,i){this.g=e,this.h=t,e=ln,this.l=!!e&&i===e||!1}};function mr(e,t){return new Li(e,t,ln)}function Fu(e,t,i,s,r){Ks(e,i,Vu(t,s),r)}const M_=mr(function(e,t,i,s,r){return e.h===2&&(ys(e,Qa(t,s,i),r),!0)},Fu),P_=mr(function(e,t,i,s,r){return e.h===2&&(ys(e,Qa(t,s,i,!0),r),!0)},Fu);var pr=Symbol(),gn=Symbol(),Sl=Symbol(),xl=Symbol();let Tu,Au;function qe(e,t,i,s){var r=s[e];if(r)return r;(r={}).Pa=s,r.V=function(c){switch(typeof c){case"boolean":return hu||(hu=[0,void 0,!0]);case"number":return c>0?void 0:c===0?y_||(y_=[0,void 0]):[-c,void 0];case"string":return[0,c];case"object":return c}}(s[0]);var a=s[1];let n=1;a&&a.constructor===Object&&(r.ga=a,typeof(a=s[++n])=="function"&&(r.la=!0,Tu??(Tu=a),Au??(Au=s[n+1]),a=s[n+=2]));const o={};for(;a&&Array.isArray(a)&&a.length&&typeof a[0]=="number"&&a[0]>0;){for(var l=0;l<a.length;l++)o[a[l]]=a;a=s[++n]}for(l=1;a!==void 0;){let c;typeof a=="number"&&(l+=a,a=s[++n]);var h=void 0;if(a instanceof Li?c=a:(c=M_,n--),c==null?void 0:c.l){a=s[++n],h=s;var u=n;typeof a=="function"&&(a=a(),h[u]=a),h=a}for(u=l+1,typeof(a=s[++n])=="number"&&a<0&&(u-=a,a=s[++n]);l<u;l++){const d=o[l];h?i(r,l,c,h,d):t(r,l,c,d)}}return s[e]=r}function Ru(e){return Array.isArray(e)?e[0]instanceof Li?e:[P_,e]:[e,void 0]}function Vu(e,t){return e instanceof S?e.u:Array.isArray(e)?Ee(e,t,!1):void 0}function dn(e,t,i,s){const r=i.g;e[t]=s?(a,n,o)=>r(a,n,o,s):r}function _n(e,t,i,s,r){const a=i.g;let n,o;e[t]=(l,h,u)=>a(l,h,u,o||(o=qe(gn,dn,_n,s).V),n||(n=fn(s)),r)}function fn(e){let t=e[Sl];if(t!=null)return t;const i=qe(gn,dn,_n,e);return t=i.la?(s,r)=>Tu(s,r,i):(s,r)=>{const a=0|s[w];for(;vu(r)&&r.h!=4;){var n=r.m,o=i[n];if(o==null){var l=i.ga;l&&(l=l[n])&&(l=w_(l))!=null&&(o=i[n]=l)}o!=null&&o(r,s,n)||(n=(o=r).l,Rs(o),o.fa?o=void 0:(l=o.g.g-n,o.g.g=n,o=Cu(o.g,l)),n=s,o&&((l=n[Ci])?l.push(o):n[Ci]=[o]))}return 16384&a&&Fi(s),!0},e[Sl]=t}function w_(e){const t=(e=Ru(e))[0].g;if(e=e[1]){const i=fn(e),s=qe(gn,dn,_n,e).V;return(r,a,n)=>t(r,a,n,s,i)}return t}function yr(e,t,i){e[t]=i.h}function Sr(e,t,i,s){let r,a;const n=i.h;e[t]=(o,l,h)=>n(o,l,h,a||(a=qe(pr,yr,Sr,s).V),r||(r=Lu(s)))}function Lu(e){let t=e[xl];if(!t){const i=qe(pr,yr,Sr,e);t=(s,r)=>ku(s,r,i),e[xl]=t}return t}function ku(e,t,i){for(var s=0|e[w],r=512&s?0:-1,a=e.length,n=512&s?1:0,o=a+(256&s?-1:0);n<o;n++){const l=e[n];if(l==null)continue;const h=n-r,u=Cl(i,h);u&&u(t,l,h)}if(256&s){s=e[a-1];for(const l in s)r=+l,Number.isNaN(r)||(a=s[r])!=null&&(o=Cl(i,r))&&o(t,a,r)}if(e=Oa(e))for(Pi(t,t.g.end()),i=0;i<e.length;i++)Pi(t,Ra(e[i])||new Uint8Array(0))}function Cl(e,t){var i=e[t];if(i)return i;if((i=e.ga)&&(i=i[t])){var s=(i=Ru(i))[0].h;if(i=i[1]){const r=Lu(i),a=qe(pr,yr,Sr,i).V;i=e.la?Au(a,r):(n,o,l)=>s(n,o,l,a,r)}else i=s;return e[t]=i}}function ki(e,t){if(Array.isArray(t)){var i=0|t[w];if(4&i)return t;for(var s=0,r=0;s<t.length;s++){const a=e(t[s]);a!=null&&(t[r++]=a)}return r<s&&(t.length=r),at(t,-12289&(5|i)),2&i&&Object.freeze(t),t}}function yt(e,t,i){return new Li(e,t,i)}function Di(e,t,i){return new Li(e,t,i)}function St(e,t,i){Q(e,0|e[w],t,i)}var B_=mr(function(e,t,i,s,r){return e.h===2&&(e=ys(e,Ee([void 0,void 0],s,!0),r),Re(s=0|t[w]),(r=Ce(t,s,i))instanceof jt?(2&r.L)!=0?((r=r.X()).push(e),Q(t,s,i,r)):r.Na(e):Array.isArray(r)?(2&(0|r[w])&&Q(t,s,i,r=_u(r)),r.push(e)):Q(t,s,i,[e]),!0)},function(e,t,i,s,r){if(t instanceof jt)t.forEach((a,n)=>{Ks(e,i,Ee([n,a],s,!1),r)});else if(Array.isArray(t))for(let a=0;a<t.length;a++){const n=t[a];Array.isArray(n)&&Ks(e,i,Ee(n,s,!1),r)}});function Du(e,t,i){if(t=function(s){if(s==null)return s;const r=typeof s;if(r==="bigint")return String(Xa(64,s));if(hr(s)){if(r==="string")return Ya(s);if(r==="number")return ja(s)}}(t),t!=null&&(typeof t=="string"&&yl(t),t!=null))switch(Vt(e,i,0),typeof t){case"number":e=e.g,vi(t),fi(e,G,tt);break;case"bigint":i=BigInt.asUintN(64,t),i=new fa(Number(i&BigInt(4294967295)),Number(i>>BigInt(32))),fi(e.g,i.h,i.g);break;default:i=yl(t),fi(e.g,i.h,i.g)}}function Ou(e,t,i){(t=Ti(t))!=null&&t!=null&&(Vt(e,i,0),_r(e.g,t))}function Nu(e,t,i){(t=nu(t))!=null&&(Vt(e,i,0),e.g.g.push(t?1:0))}function Uu(e,t,i){(t=bi(t))!=null&&fr(e,i,$h(t))}function zu(e,t,i,s,r){Ks(e,i,Vu(t,s),r)}function Gu(e,t,i){(t=t==null||typeof t=="string"||fs(t)||t instanceof me?t:void 0)!=null&&fr(e,i,en(t).buffer)}function Xu(e,t,i){return(e.h===5||e.h===2)&&(t=Ri(t,0|t[w],i,!1,!1),e.h==2?dr(e,da,t):t.push(da(e.g)),!0)}var ge=yt(function(e,t,i){if(e.h!==1)return!1;var s=e.g;e=ga(s);const r=ga(s);s=2*(r>>31)+1;const a=r>>>20&2047;return e=4294967296*(1048575&r)+e,St(t,i,a==2047?e?NaN:s*(1/0):a==0?5e-324*s*e:s*Math.pow(2,a-1075)*(e+4503599627370496)),!0},function(e,t,i){(t=Ve(t))!=null&&(Vt(e,i,1),e=e.g,(i=au||(au=new DataView(new ArrayBuffer(8)))).setFloat64(0,+t,!0),G=i.getUint32(0,!0),tt=i.getUint32(4,!0),cs(e,G),cs(e,tt))},Qt()),nt=yt(function(e,t,i){return e.h===5&&(St(t,i,da(e.g)),!0)},function(e,t,i){(t=Ve(t))!=null&&(Vt(e,i,5),e=e.g,Na(t),cs(e,G))},cn),I_=Di(Xu,function(e,t,i){if((t=ki(Ve,t))!=null)for(let n=0;n<t.length;n++){var s=e,r=i,a=t[n];a!=null&&(Vt(s,r,5),s=s.g,Na(a),cs(s,G))}},cn),mn=Di(Xu,function(e,t,i){if((t=ki(Ve,t))!=null&&t.length){Vt(e,i,2),Vi(e.g,4*t.length);for(let s=0;s<t.length;s++)i=e.g,Na(t[s]),cs(i,G)}},cn),Ae=yt(function(e,t,i){return e.h===0&&(St(t,i,sn(e.g,za)),!0)},Du,Bu),qr=yt(function(e,t,i){return e.h===0&&(St(t,i,(e=sn(e.g,za))===0?void 0:e),!0)},Du,Bu),E_=yt(function(e,t,i){return e.h===0&&(St(t,i,sn(e.g,Ua)),!0)},function(e,t,i){if((t=u_(t))!=null&&(typeof t=="string"&&pl(t),t!=null))switch(Vt(e,i,0),typeof t){case"number":e=e.g,vi(t),fi(e,G,tt);break;case"bigint":i=BigInt.asUintN(64,t),i=new _a(Number(i&BigInt(4294967295)),Number(i>>BigInt(32))),fi(e.g,i.h,i.g);break;default:i=pl(t),fi(e.g,i.h,i.g)}},Qt()),et=yt(function(e,t,i){return e.h===0&&(St(t,i,Te(e.g)),!0)},Ou,un),xr=Di(function(e,t,i){return(e.h===0||e.h===2)&&(t=Ri(t,0|t[w],i,!1,!1),e.h==2?dr(e,Te,t):t.push(Te(e.g)),!0)},function(e,t,i){if((t=ki(Ti,t))!=null&&t.length){i=nn(e,i);for(let s=0;s<t.length;s++)_r(e.g,t[s]);on(e,i)}},un),oi=yt(function(e,t,i){return e.h===0&&(St(t,i,(e=Te(e.g))===0?void 0:e),!0)},Ou,un),J=yt(function(e,t,i){return e.h===0&&(St(t,i,rn(e.g)),!0)},Nu,Pu),mi=yt(function(e,t,i){return e.h===0&&(St(t,i,(e=rn(e.g))===!1?void 0:e),!0)},Nu,Pu),dt=Di(function(e,t,i){return e.h===2&&(e=an(e),Ri(t,0|t[w],i,!1).push(e),!0)},function(e,t,i){if((t=ki(bi,t))!=null)for(let n=0;n<t.length;n++){var s=e,r=i,a=t[n];a!=null&&fr(s,r,$h(a))}},hn),Pe=yt(function(e,t,i){return e.h===2&&(St(t,i,(e=an(e))===""?void 0:e),!0)},Uu,hn),U=yt(function(e,t,i){return e.h===2&&(St(t,i,an(e)),!0)},Uu,hn),ht=function(e,t,i=ln){return new Li(e,t,i)}(function(e,t,i,s,r){return e.h===2&&(s=Ee(void 0,s,!0),Ri(t,0|t[w],i,!0).push(s),ys(e,s,r),!0)},function(e,t,i,s,r){if(Array.isArray(t))for(let a=0;a<t.length;a++)zu(e,t[a],i,s,r)}),z=mr(function(e,t,i,s,r,a){return e.h===2&&(fu(t,0|t[w],a,i),ys(e,t=Qa(t,s,i),r),!0)},zu),ju=yt(function(e,t,i){return e.h===2&&(St(t,i,bu(e)),!0)},Gu,Iu),F_=Di(function(e,t,i){return(e.h===0||e.h===2)&&(t=Ri(t,0|t[w],i,!1,!1),e.h==2?dr(e,xe,t):t.push(xe(e.g)),!0)},function(e,t,i){if((t=ki(ou,t))!=null)for(let n=0;n<t.length;n++){var s=e,r=i,a=t[n];a!=null&&(Vt(s,r,0),Vi(s.g,a))}},wu),T_=yt(function(e,t,i){return e.h===0&&(St(t,i,(e=xe(e.g))===0?void 0:e),!0)},function(e,t,i){(t=ou(t))!=null&&t!=null&&(Vt(e,i,0),Vi(e.g,t))},wu),Ht=yt(function(e,t,i){return e.h===0&&(St(t,i,Te(e.g)),!0)},function(e,t,i){(t=Ti(t))!=null&&(t=parseInt(t,10),Vt(e,i,0),_r(e.g,t))},Eu);class A_{constructor(t,i){this.h=t,this.g=i,this.l=O,this.m=I,this.defaultValue=void 0}}function te(e,t){return new A_(e,t)}function Le(e,t){return(i,s)=>{if(Bs.length){const a=Bs.pop();a.o(s),$r(a.g,i,s),i=a}else i=new class{constructor(a,n){if(ml.length){const o=ml.pop();$r(o,a,n),a=o}else a=new class{constructor(o,l){this.h=null,this.m=!1,this.g=this.l=this.j=0,$r(this,o,l)}clear(){this.h=null,this.m=!1,this.g=this.l=this.j=0,this.ba=!1}}(a,n);this.g=a,this.l=this.g.g,this.h=this.m=-1,this.o(n)}o({fa:a=!1}={}){this.fa=a}}(i,s);try{const a=new e,n=a.u;fn(t)(n,i);var r=a}finally{i.g.clear(),i.m=-1,i.h=-1,Bs.length<100&&Bs.push(i)}return r}}function Cr(e){return function(){const t=new class{constructor(){this.l=[],this.h=0,this.g=new class{constructor(){this.g=[]}length(){return this.g.length}end(){const n=this.g;return this.g=[],n}}}};ku(this.u,t,qe(pr,yr,Sr,e)),Pi(t,t.g.end());const i=new Uint8Array(t.h),s=t.l,r=s.length;let a=0;for(let n=0;n<r;n++){const o=s[n];i.set(o,a),a+=o.length}return t.l=[i],i}}var vl=class extends S{constructor(e){super(e)}},bl=[0,Pe,yt(function(e,t,i){return e.h===2&&(St(t,i,(e=bu(e))===$e()?void 0:e),!0)},function(e,t,i){if(t!=null){if(t instanceof S){const s=t.Ra;return void(s&&(t=s(t),t!=null&&fr(e,i,en(t).buffer)))}if(Array.isArray(t))return}Gu(e,t,i)},Iu)];let Jr,Ml=globalThis.trustedTypes;function Pl(e){Jr===void 0&&(Jr=function(){let i=null;if(!Ml)return i;try{const s=r=>r;i=Ml.createPolicy("goog#html",{createHTML:s,createScript:s,createScriptURL:s})}catch{}return i}());var t=Jr;return new class{constructor(i){this.g=i}toString(){return this.g+""}}(t?t.createScriptURL(e):e)}function R_(e,...t){if(t.length===0)return Pl(e[0]);let i=e[0];for(let s=0;s<t.length;s++)i+=encodeURIComponent(t[s])+e[s+1];return Pl(i)}var Yu=[0,et,Ht,J,-1,xr,Ht,-1],V_=class extends S{constructor(e){super(e)}},Hu=[0,J,U,J,Ht,-1,Di(function(e,t,i){return(e.h===0||e.h===2)&&(t=Ri(t,0|t[w],i,!1,!1),e.h==2?dr(e,x_,t):t.push(Te(e.g)),!0)},function(e,t,i){if((t=ki(Ti,t))!=null&&t.length){i=nn(e,i);for(let s=0;s<t.length;s++)_r(e.g,t[s]);on(e,i)}},Eu),U,-1,[0,J,-1],Ht,J,-1],Wu=[0,U,-2],wl=class extends S{constructor(e){super(e)}},$u=[0],qu=[0,et,J,1,J,-3],Rt=class extends S{constructor(e){super(e,2)}},ot={};ot[336783863]=[0,U,J,-1,et,[0,[1,2,3,4,5,6,7,8],z,$u,z,Hu,z,Wu,z,qu,z,Yu,z,[0,U,-2],z,[0,U,Ht],z,[0,Ht,U]],[0,U],J,[0,[1,3],[2,4],z,[0,xr],-1,z,[0,dt],-1,ht,[0,U,-1]],U];var Bl=[0,qr,-1,mi,-3,qr,xr,Pe,oi,qr,-1,mi,oi,mi,-2,Pe];function Lt(e,t){ca(e,2,Ai(t),"")}function j(e,t){gr(e,3,t)}function L(e,t){gr(e,4,t)}var pt=class extends S{constructor(e){super(e,500)}o(e){return I(this,0,7,e)}},qi=[-1,{}],Il=[0,U,1,qi],El=[0,U,dt,qi];function kt(e,t){qs(e,1,pt,t)}function W(e,t){gr(e,10,t)}function N(e,t){gr(e,15,t)}var wt=class extends S{constructor(e){super(e,500)}o(e){return I(this,0,1001,e)}},Ju=[-500,ht,[-500,Pe,-1,dt,-3,[-2,ot,J],ht,bl,oi,-1,Il,El,ht,[0,Pe,mi],Pe,Bl,oi,dt,987,dt],4,ht,[-500,U,-1,[-1,{}],998,U],ht,[-500,U,dt,-1,[-2,{},J],997,dt,-1],oi,ht,[-500,U,dt,qi,998,dt],dt,oi,Il,El,ht,[0,Pe,-1,qi],dt,-2,Bl,Pe,-1,mi,[0,mi,T_],978,qi,ht,bl];wt.prototype.g=Cr(Ju);var L_=Le(wt,Ju),k_=class extends S{constructor(e){super(e)}},Ku=class extends S{constructor(e){super(e)}g(){return Se(this,k_,1)}},Zu=[0,ht,[0,et,nt,U,-1]],vr=Le(Ku,Zu),D_=class extends S{constructor(e){super(e)}},O_=class extends S{constructor(e){super(e)}},Kr=class extends S{constructor(e){super(e)}h(){return O(this,D_,2)}g(){return Se(this,O_,5)}},Qu=Le(class extends S{constructor(e){super(e)}},[0,dt,xr,mn,[0,Ht,[0,et,-3],[0,nt,-3],[0,et,-1,[0,ht,[0,et,-2]]],ht,[0,nt,-1,U,nt]],U,-1,Ae,ht,[0,et,nt],dt,Ae]),tc=class extends S{constructor(e){super(e)}},pi=Le(class extends S{constructor(e){super(e)}},[0,ht,[0,nt,-4]]),ec=class extends S{constructor(e){super(e)}},Ss=Le(class extends S{constructor(e){super(e)}},[0,ht,[0,nt,-4]]),N_=class extends S{constructor(e){super(e)}},U_=[0,et,-1,mn,Ht],ic=class extends S{constructor(e){super(e)}};ic.prototype.g=Cr([0,nt,-4,Ae]);var z_=class extends S{constructor(e){super(e)}},G_=Le(class extends S{constructor(e){super(e)}},[0,ht,[0,1,et,U,Zu],Ae]),Fl=class extends S{constructor(e){super(e)}},X_=class extends S{constructor(e){super(e)}oa(){const e=du(this);return e??$e()}},j_=class extends S{constructor(e){super(e)}},sc=[1,2],Y_=Le(class extends S{constructor(e){super(e)}},[0,ht,[0,sc,z,[0,mn],z,[0,ju],et,U],Ae]),pn=class extends S{constructor(e){super(e)}},rc=[0,U,et,nt,dt,-1],Tl=class extends S{constructor(e){super(e)}},H_=[0,J,-1],Al=class extends S{constructor(e){super(e)}},Vs=[1,2,3,4,5],Zs=class extends S{constructor(e){super(e)}g(){return du(this)!=null}h(){return Yt(this,2)!=null}},K=class extends S{constructor(e){super(e)}g(){return nu(Mi(this,2))??!1}},ac=[0,ju,U,[0,et,Ae,-1],[0,E_,Ae]],rt=[0,ac,J,[0,Vs,z,qu,z,Hu,z,Yu,z,$u,z,Wu],Ht],br=class extends S{constructor(e){super(e)}},yn=[0,rt,nt,-1,et],W_=te(502141897,br);ot[502141897]=yn;var $_=Le(class extends S{constructor(e){super(e)}},[0,[0,Ht,-1,I_,F_],U_]),nc=class extends S{constructor(e){super(e)}},oc=class extends S{constructor(e){super(e)}},Sn=[0,rt,nt,[0,rt],J],lc=[0,rt,yn,Sn,nt,[0,[0,ac]]],q_=te(508968150,oc);ot[508968150]=lc,ot[508968149]=Sn;var hc=class extends S{constructor(e){super(e)}},J_=te(513916220,hc);ot[513916220]=[0,rt,lc,et];var si=class extends S{constructor(e){super(e)}h(){return O(this,pn,2)}g(){X(this,2)}},uc=[0,rt,rc];ot[478825465]=uc;var K_=class extends S{constructor(e){super(e)}},cc=class extends S{constructor(e){super(e)}},xn=class extends S{constructor(e){super(e)}},Cn=class extends S{constructor(e){super(e)}},gc=class extends S{constructor(e){super(e)}},Rl=[0,rt,[0,rt],uc,-1],dc=[0,rt,nt,et],vn=[0,rt,nt],_c=[0,rt,dc,vn,nt],Z_=te(479097054,gc);ot[479097054]=[0,rt,_c,Rl],ot[463370452]=Rl,ot[464864288]=dc;var Q_=te(462713202,Cn);ot[462713202]=_c,ot[474472470]=vn;var tf=class extends S{constructor(e){super(e)}},fc=class extends S{constructor(e){super(e)}},mc=class extends S{constructor(e){super(e)}},pc=class extends S{constructor(e){super(e)}},bn=[0,rt,nt,-1,et],ma=[0,rt,nt,J];pc.prototype.g=Cr([0,rt,vn,[0,rt],yn,Sn,bn,ma]);var yc=class extends S{constructor(e){super(e)}},ef=te(456383383,yc);ot[456383383]=[0,rt,rc];var Sc=class extends S{constructor(e){super(e)}},sf=te(476348187,Sc);ot[476348187]=[0,rt,H_];var xc=class extends S{constructor(e){super(e)}},Vl=class extends S{constructor(e){super(e)}},Cc=[0,Ht,-1],rf=te(458105876,class extends S{constructor(e){super(e)}g(){var e=this.u;const t=0|e[w],i=2&t;return e=function(s,r,a){var n=Vl;const o=2&r;let l=!1;if(a==null){if(o)return fl();a=[]}else if(a.constructor===jt){if((2&a.L)==0||o)return a;a=a.X()}else Array.isArray(a)?l=!!(2&(0|a[w])):a=[];if(o){if(!a.length)return fl();l||(l=!0,Fi(a))}else l&&(l=!1,a=_u(a));return l||(64&(0|a[w])?a[w]&=-33:32&r&&rr(a,32)),Q(s,r,2,n=new jt(a,n,c_,void 0)),n}(e,t,Ce(e,t,2)),!i&&Vl&&(e.ra=!0),e}});ot[458105876]=[0,Cc,B_,[!0,Ae,[0,U,-1,dt]]];var Mn=class extends S{constructor(e){super(e)}},vc=te(458105758,Mn);ot[458105758]=[0,rt,U,Cc];var bc=class extends S{constructor(e){super(e)}},af=te(443442058,bc);ot[443442058]=[0,rt,U,et,nt,dt,-1,J,nt],ot[514774813]=bn;var Mc=class extends S{constructor(e){super(e)}},nf=te(516587230,Mc);function pa(e,t){return t=t?t.clone():new pn,e.displayNamesLocale!==void 0?X(t,1,Ai(e.displayNamesLocale)):e.displayNamesLocale===void 0&&X(t,1),e.maxResults!==void 0?oe(t,2,e.maxResults):"maxResults"in e&&X(t,2),e.scoreThreshold!==void 0?v(t,3,e.scoreThreshold):"scoreThreshold"in e&&X(t,3),e.categoryAllowlist!==void 0?Js(t,4,e.categoryAllowlist):"categoryAllowlist"in e&&X(t,4),e.categoryDenylist!==void 0?Js(t,5,e.categoryDenylist):"categoryDenylist"in e&&X(t,5),t}function Pn(e,t=-1,i=""){return{categories:e.map(s=>({index:Gt(s,1)??0??-1,score:it(s,2)??0,categoryName:Yt(s,3)??""??"",displayName:Yt(s,4)??""??""})),headIndex:t,headName:i}}function Pc(e){var n,o;var t=je(e,3,Ve,Xe()),i=je(e,2,Ti,Xe()),s=je(e,1,bi,Xe()),r=je(e,9,bi,Xe());const a={categories:[],keypoints:[]};for(let l=0;l<t.length;l++)a.categories.push({score:t[l],index:i[l]??-1,categoryName:s[l]??"",displayName:r[l]??""});if((t=(n=O(e,Kr,4))==null?void 0:n.h())&&(a.boundingBox={originX:Gt(t,1)??0,originY:Gt(t,2)??0,width:Gt(t,3)??0,height:Gt(t,4)??0,angle:0}),(o=O(e,Kr,4))==null?void 0:o.g().length)for(const l of O(e,Kr,4).g())a.keypoints.push({x:As(l,1)??0,y:As(l,2)??0,score:As(l,4)??0,label:Yt(l,3)??""});return a}function Mr(e){const t=[];for(const i of Se(e,ec,1))t.push({x:it(i,1)??0,y:it(i,2)??0,z:it(i,3)??0,visibility:it(i,4)??0});return t}function Ji(e){const t=[];for(const i of Se(e,tc,1))t.push({x:it(i,1)??0,y:it(i,2)??0,z:it(i,3)??0,visibility:it(i,4)??0});return t}function Ll(e){return Array.from(e,t=>t>127?t-256:t)}function kl(e,t){if(e.length!==t.length)throw Error(`Cannot compute cosine similarity between embeddings of different sizes (${e.length} vs. ${t.length}).`);let i=0,s=0,r=0;for(let a=0;a<e.length;a++)i+=e[a]*t[a],s+=e[a]*e[a],r+=t[a]*t[a];if(s<=0||r<=0)throw Error("Cannot compute cosine similarity on embedding with 0 norm.");return i/Math.sqrt(s*r)}let Is;ot[516587230]=[0,rt,bn,ma,nt],ot[518928384]=ma;const of=new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11]);async function wc(){if(Is===void 0)try{await WebAssembly.instantiate(of),Is=!0}catch{Is=!1}return Is}async function ji(e,t=R_``){const i=await wc()?"wasm_internal":"wasm_nosimd_internal";return{wasmLoaderPath:`${t}/${e}_${i}.js`,wasmBinaryPath:`${t}/${e}_${i}.wasm`}}var Ue=class{};function Bc(){var e=navigator;return typeof OffscreenCanvas<"u"&&(!function(t=navigator){return(t=t.userAgent).includes("Safari")&&!t.includes("Chrome")}(e)||!!((e=e.userAgent.match(/Version\/([\d]+).*Safari/))&&e.length>=1&&Number(e[1])>=17))}async function Dl(e){if(typeof importScripts!="function"){const t=document.createElement("script");return t.src=e.toString(),t.crossOrigin="anonymous",new Promise((i,s)=>{t.addEventListener("load",()=>{i()},!1),t.addEventListener("error",r=>{s(r)},!1),document.body.appendChild(t)})}importScripts(e.toString())}function Ic(e){return e.videoWidth!==void 0?[e.videoWidth,e.videoHeight]:e.naturalWidth!==void 0?[e.naturalWidth,e.naturalHeight]:e.displayWidth!==void 0?[e.displayWidth,e.displayHeight]:[e.width,e.height]}function P(e,t,i){e.m||console.error("No wasm multistream support detected: ensure dependency inclusion of :gl_graph_runner_internal_multi_input target"),i(t=e.i.stringToNewUTF8(t)),e.i._free(t)}function Ol(e,t,i){if(!e.i.canvas)throw Error("No OpenGL canvas configured.");if(i?e.i._bindTextureToStream(i):e.i._bindTextureToCanvas(),!(i=e.i.canvas.getContext("webgl2")||e.i.canvas.getContext("webgl")))throw Error("Failed to obtain WebGL context from the provided canvas. `getContext()` should only be invoked with `webgl` or `webgl2`.");e.i.gpuOriginForWebTexturesIsBottomLeft&&i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!0),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,t),e.i.gpuOriginForWebTexturesIsBottomLeft&&i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!1);const[s,r]=Ic(t);return!e.l||s===e.i.canvas.width&&r===e.i.canvas.height||(e.i.canvas.width=s,e.i.canvas.height=r),[s,r]}function Nl(e,t,i){e.m||console.error("No wasm multistream support detected: ensure dependency inclusion of :gl_graph_runner_internal_multi_input target");const s=new Uint32Array(t.length);for(let r=0;r<t.length;r++)s[r]=e.i.stringToNewUTF8(t[r]);t=e.i._malloc(4*s.length),e.i.HEAPU32.set(s,t>>2),i(t);for(const r of s)e.i._free(r);e.i._free(t)}function ie(e,t,i){e.i.simpleListeners=e.i.simpleListeners||{},e.i.simpleListeners[t]=i}function ve(e,t,i){let s=[];e.i.simpleListeners=e.i.simpleListeners||{},e.i.simpleListeners[t]=(r,a,n)=>{a?(i(s,n),s=[]):s.push(r)}}Ue.forVisionTasks=function(e){return ji("vision",e)},Ue.forTextTasks=function(e){return ji("text",e)},Ue.forGenAiExperimentalTasks=function(e){return ji("genai_experimental",e)},Ue.forGenAiTasks=function(e){return ji("genai",e)},Ue.forAudioTasks=function(e){return ji("audio",e)},Ue.isSimdSupported=function(){return wc()};async function lf(e,t,i,s){return e=await(async(r,a,n,o,l)=>{if(a&&await Dl(a),!self.ModuleFactory||n&&(await Dl(n),!self.ModuleFactory))throw Error("ModuleFactory not set.");return self.Module&&l&&((a=self.Module).locateFile=l.locateFile,l.mainScriptUrlOrBlob&&(a.mainScriptUrlOrBlob=l.mainScriptUrlOrBlob)),l=await self.ModuleFactory(self.Module||l),self.ModuleFactory=self.Module=void 0,new r(l,o)})(e,i.wasmLoaderPath,i.assetLoaderPath,t,{locateFile:r=>r.endsWith(".wasm")?i.wasmBinaryPath.toString():i.assetBinaryPath&&r.endsWith(".data")?i.assetBinaryPath.toString():r}),await e.o(s),e}function Zr(e,t){const i=O(e.baseOptions,Zs,1)||new Zs;typeof t=="string"?(X(i,2,Ai(t)),X(i,1)):t instanceof Uint8Array&&(X(i,1,Da(t,!1)),X(i,2)),I(e.baseOptions,0,1,i)}function Ul(e){try{const t=e.G.length;if(t===1)throw Error(e.G[0].message);if(t>1)throw Error("Encountered multiple errors: "+e.G.map(i=>i.message).join(", "))}finally{e.G=[]}}function p(e,t){e.B=Math.max(e.B,t)}function Pr(e,t){e.A=new pt,Lt(e.A,"PassThroughCalculator"),j(e.A,"free_memory"),L(e.A,"free_memory_unused_out"),W(t,"free_memory"),kt(t,e.A)}function wi(e,t){j(e.A,t),L(e.A,t+"_unused_out")}function wr(e){e.g.addBoolToStream(!0,"free_memory",e.B)}var Ls=class{constructor(e){this.g=e,this.G=[],this.B=0,this.g.setAutoRenderToScreen(!1)}l(e,t=!0){var i,s,r,a,n,o;if(t){const l=e.baseOptions||{};if((i=e.baseOptions)!=null&&i.modelAssetBuffer&&((s=e.baseOptions)!=null&&s.modelAssetPath))throw Error("Cannot set both baseOptions.modelAssetPath and baseOptions.modelAssetBuffer");if(!((r=O(this.baseOptions,Zs,1))!=null&&r.g()||(a=O(this.baseOptions,Zs,1))!=null&&a.h()||(n=e.baseOptions)!=null&&n.modelAssetBuffer||(o=e.baseOptions)!=null&&o.modelAssetPath))throw Error("Either baseOptions.modelAssetPath or baseOptions.modelAssetBuffer must be set");if(function(h,u){let c=O(h.baseOptions,Al,3);if(!c){var d=c=new Al,g=new wl;$i(d,4,Vs,g)}"delegate"in u&&(u.delegate==="GPU"?(u=c,d=new V_,$i(u,2,Vs,d)):(u=c,d=new wl,$i(u,4,Vs,d))),I(h.baseOptions,0,3,c)}(this,l),l.modelAssetPath)return fetch(l.modelAssetPath.toString()).then(h=>{if(h.ok)return h.arrayBuffer();throw Error(`Failed to fetch model: ${l.modelAssetPath} (${h.status})`)}).then(h=>{try{this.g.i.FS_unlink("/model.dat")}catch{}this.g.i.FS_createDataFile("/","model.dat",new Uint8Array(h),!0,!1,!1),Zr(this,"/model.dat"),this.m(),this.I()});if(l.modelAssetBuffer instanceof Uint8Array)Zr(this,l.modelAssetBuffer);else if(l.modelAssetBuffer)return async function(h){const u=[];for(var c=0;;){const{done:d,value:g}=await h.read();if(d)break;u.push(g),c+=g.length}if(u.length===0)return new Uint8Array(0);if(u.length===1)return u[0];h=new Uint8Array(c),c=0;for(const d of u)h.set(d,c),c+=d.length;return h}(l.modelAssetBuffer).then(h=>{Zr(this,h),this.m(),this.I()})}return this.m(),this.I(),Promise.resolve()}I(){}da(){let e;if(this.g.da(t=>{e=L_(t)}),!e)throw Error("Failed to retrieve CalculatorGraphConfig");return e}setGraph(e,t){this.g.attachErrorListener((i,s)=>{this.G.push(Error(s))}),this.g.La(),this.g.setGraph(e,t),this.A=void 0,Ul(this)}finishProcessing(){this.g.finishProcessing(),Ul(this)}close(){this.A=void 0,this.g.closeGraph()}};function ye(e,t){if(!e)throw Error(`Unable to obtain required WebGL resource: ${t}`);return e}Ls.prototype.close=Ls.prototype.close,function(e,t){e=e.split(".");var i,s=We;for((e[0]in s)||s.execScript===void 0||s.execScript("var "+e[0]);e.length&&(i=e.shift());)e.length||t===void 0?s=s[i]&&s[i]!==Object.prototype[i]?s[i]:s[i]={}:s[i]=t}("TaskRunner",Ls);class hf{constructor(t,i,s,r){this.g=t,this.h=i,this.m=s,this.l=r}bind(){this.g.bindVertexArray(this.h)}close(){this.g.deleteVertexArray(this.h),this.g.deleteBuffer(this.m),this.g.deleteBuffer(this.l)}}function zl(e,t,i){const s=e.g;if(i=ye(s.createShader(i),"Failed to create WebGL shader"),s.shaderSource(i,t),s.compileShader(i),!s.getShaderParameter(i,s.COMPILE_STATUS))throw Error(`Could not compile WebGL shader: ${s.getShaderInfoLog(i)}`);return s.attachShader(e.h,i),i}function Gl(e,t){const i=e.g,s=ye(i.createVertexArray(),"Failed to create vertex array");i.bindVertexArray(s);const r=ye(i.createBuffer(),"Failed to create buffer");i.bindBuffer(i.ARRAY_BUFFER,r),i.enableVertexAttribArray(e.O),i.vertexAttribPointer(e.O,2,i.FLOAT,!1,0,0),i.bufferData(i.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,1,1,-1]),i.STATIC_DRAW);const a=ye(i.createBuffer(),"Failed to create buffer");return i.bindBuffer(i.ARRAY_BUFFER,a),i.enableVertexAttribArray(e.I),i.vertexAttribPointer(e.I,2,i.FLOAT,!1,0,0),i.bufferData(i.ARRAY_BUFFER,new Float32Array(t?[0,1,0,0,1,0,1,1]:[0,0,0,1,1,1,1,0]),i.STATIC_DRAW),i.bindBuffer(i.ARRAY_BUFFER,null),i.bindVertexArray(null),new hf(i,s,r,a)}function wn(e,t){if(e.g){if(t!==e.g)throw Error("Cannot change GL context once initialized")}else e.g=t}function Bn(e,t,i,s){return wn(e,t),e.h||(e.m(),e.C()),i?(e.s||(e.s=Gl(e,!0)),i=e.s):(e.v||(e.v=Gl(e,!1)),i=e.v),t.useProgram(e.h),i.bind(),e.l(),e=s(),i.g.bindVertexArray(null),e}function Br(e,t,i){return wn(e,t),e=ye(t.createTexture(),"Failed to create texture"),t.bindTexture(t.TEXTURE_2D,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,i??t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,i??t.LINEAR),t.bindTexture(t.TEXTURE_2D,null),e}function Ir(e,t,i){wn(e,t),e.A||(e.A=ye(t.createFramebuffer(),"Failed to create framebuffe.")),t.bindFramebuffer(t.FRAMEBUFFER,e.A),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,i,0)}function In(e){var t;(t=e.g)==null||t.bindFramebuffer(e.g.FRAMEBUFFER,null)}var En=class{G(){return`
  precision mediump float;
  varying vec2 vTex;
  uniform sampler2D inputTexture;
  void main() {
    gl_FragColor = texture2D(inputTexture, vTex);
  }
 `}m(){const e=this.g;if(this.h=ye(e.createProgram(),"Failed to create WebGL program"),this.aa=zl(this,`
  attribute vec2 aVertex;
  attribute vec2 aTex;
  varying vec2 vTex;
  void main(void) {
    gl_Position = vec4(aVertex, 0.0, 1.0);
    vTex = aTex;
  }`,e.VERTEX_SHADER),this.Z=zl(this,this.G(),e.FRAGMENT_SHADER),e.linkProgram(this.h),!e.getProgramParameter(this.h,e.LINK_STATUS))throw Error(`Error during program linking: ${e.getProgramInfoLog(this.h)}`);this.O=e.getAttribLocation(this.h,"aVertex"),this.I=e.getAttribLocation(this.h,"aTex")}C(){}l(){}close(){if(this.h){const e=this.g;e.deleteProgram(this.h),e.deleteShader(this.aa),e.deleteShader(this.Z)}this.A&&this.g.deleteFramebuffer(this.A),this.v&&this.v.close(),this.s&&this.s.close()}};function _e(e,t){switch(t){case 0:return e.g.find(i=>i instanceof Uint8Array);case 1:return e.g.find(i=>i instanceof Float32Array);case 2:return e.g.find(i=>typeof WebGLTexture<"u"&&i instanceof WebGLTexture);default:throw Error(`Type is not supported: ${t}`)}}function ya(e){var t=_e(e,1);if(!t){if(t=_e(e,0))t=new Float32Array(t).map(s=>s/255);else{t=new Float32Array(e.width*e.height);const s=Bi(e);var i=Fn(e);if(Ir(i,s,Ec(e)),"iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";").includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"document"in self&&"ontouchend"in self.document){i=new Float32Array(e.width*e.height*4),s.readPixels(0,0,e.width,e.height,s.RGBA,s.FLOAT,i);for(let r=0,a=0;r<t.length;++r,a+=4)t[r]=i[a]}else s.readPixels(0,0,e.width,e.height,s.RED,s.FLOAT,t)}e.g.push(t)}return t}function Ec(e){let t=_e(e,2);if(!t){const i=Bi(e);t=Tc(e);const s=ya(e),r=Fc(e);i.texImage2D(i.TEXTURE_2D,0,r,e.width,e.height,0,i.RED,i.FLOAT,s),Sa(e)}return t}function Bi(e){if(!e.canvas)throw Error("Conversion to different image formats require that a canvas is passed when initializing the image.");return e.h||(e.h=ye(e.canvas.getContext("webgl2"),"You cannot use a canvas that is already bound to a different type of rendering context.")),e.h}function Fc(e){if(e=Bi(e),!Es)if(e.getExtension("EXT_color_buffer_float")&&e.getExtension("OES_texture_float_linear")&&e.getExtension("EXT_float_blend"))Es=e.R32F;else{if(!e.getExtension("EXT_color_buffer_half_float"))throw Error("GPU does not fully support 4-channel float32 or float16 formats");Es=e.R16F}return Es}function Fn(e){return e.l||(e.l=new En),e.l}function Tc(e){const t=Bi(e);t.viewport(0,0,e.width,e.height),t.activeTexture(t.TEXTURE0);let i=_e(e,2);return i||(i=Br(Fn(e),t,e.m?t.LINEAR:t.NEAREST),e.g.push(i),e.j=!0),t.bindTexture(t.TEXTURE_2D,i),i}function Sa(e){e.h.bindTexture(e.h.TEXTURE_2D,null)}var Es,ut=class{constructor(e,t,i,s,r,a,n){this.g=e,this.m=t,this.j=i,this.canvas=s,this.l=r,this.width=a,this.height=n,this.j&&--Xl===0&&console.error("You seem to be creating MPMask instances without invoking .close(). This leaks resources.")}Fa(){return!!_e(this,0)}ja(){return!!_e(this,1)}P(){return!!_e(this,2)}ia(){return(t=_e(e=this,0))||(t=ya(e),t=new Uint8Array(t.map(i=>255*i)),e.g.push(t)),t;var e,t}ha(){return ya(this)}M(){return Ec(this)}clone(){const e=[];for(const t of this.g){let i;if(t instanceof Uint8Array)i=new Uint8Array(t);else if(t instanceof Float32Array)i=new Float32Array(t);else{if(!(t instanceof WebGLTexture))throw Error(`Type is not supported: ${t}`);{const s=Bi(this),r=Fn(this);s.activeTexture(s.TEXTURE1),i=Br(r,s,this.m?s.LINEAR:s.NEAREST),s.bindTexture(s.TEXTURE_2D,i);const a=Fc(this);s.texImage2D(s.TEXTURE_2D,0,a,this.width,this.height,0,s.RED,s.FLOAT,null),s.bindTexture(s.TEXTURE_2D,null),Ir(r,s,i),Bn(r,s,!1,()=>{Tc(this),s.clearColor(0,0,0,0),s.clear(s.COLOR_BUFFER_BIT),s.drawArrays(s.TRIANGLE_FAN,0,4),Sa(this)}),In(r),Sa(this)}}e.push(i)}return new ut(e,this.m,this.P(),this.canvas,this.l,this.width,this.height)}close(){this.j&&Bi(this).deleteTexture(_e(this,2)),Xl=-1}};ut.prototype.close=ut.prototype.close,ut.prototype.clone=ut.prototype.clone,ut.prototype.getAsWebGLTexture=ut.prototype.M,ut.prototype.getAsFloat32Array=ut.prototype.ha,ut.prototype.getAsUint8Array=ut.prototype.ia,ut.prototype.hasWebGLTexture=ut.prototype.P,ut.prototype.hasFloat32Array=ut.prototype.ja,ut.prototype.hasUint8Array=ut.prototype.Fa;var Xl=250;function ne(e,t){switch(t){case 0:return e.g.find(i=>i instanceof ImageData);case 1:return e.g.find(i=>typeof ImageBitmap<"u"&&i instanceof ImageBitmap);case 2:return e.g.find(i=>typeof WebGLTexture<"u"&&i instanceof WebGLTexture);default:throw Error(`Type is not supported: ${t}`)}}function Ac(e){var t=ne(e,0);if(!t){t=Ii(e);const i=Er(e),s=new Uint8Array(e.width*e.height*4);Ir(i,t,ks(e)),t.readPixels(0,0,e.width,e.height,t.RGBA,t.UNSIGNED_BYTE,s),In(i),t=new ImageData(new Uint8ClampedArray(s.buffer),e.width,e.height),e.g.push(t)}return t}function ks(e){let t=ne(e,2);if(!t){const i=Ii(e);t=Ds(e);const s=ne(e,1)||Ac(e);i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,s),Hi(e)}return t}function Ii(e){if(!e.canvas)throw Error("Conversion to different image formats require that a canvas is passed when initializing the image.");return e.h||(e.h=ye(e.canvas.getContext("webgl2"),"You cannot use a canvas that is already bound to a different type of rendering context.")),e.h}function Er(e){return e.l||(e.l=new En),e.l}function Ds(e){const t=Ii(e);t.viewport(0,0,e.width,e.height),t.activeTexture(t.TEXTURE0);let i=ne(e,2);return i||(i=Br(Er(e),t),e.g.push(i),e.m=!0),t.bindTexture(t.TEXTURE_2D,i),i}function Hi(e){e.h.bindTexture(e.h.TEXTURE_2D,null)}function jl(e){const t=Ii(e);return Bn(Er(e),t,!0,()=>function(i,s){const r=i.canvas;if(r.width===i.width&&r.height===i.height)return s();const a=r.width,n=r.height;return r.width=i.width,r.height=i.height,i=s(),r.width=a,r.height=n,i}(e,()=>{if(t.bindFramebuffer(t.FRAMEBUFFER,null),t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT),t.drawArrays(t.TRIANGLE_FAN,0,4),!(e.canvas instanceof OffscreenCanvas))throw Error("Conversion to ImageBitmap requires that the MediaPipe Tasks is initialized with an OffscreenCanvas");return e.canvas.transferToImageBitmap()}))}var ct=class{constructor(e,t,i,s,r,a,n){this.g=e,this.j=t,this.m=i,this.canvas=s,this.l=r,this.width=a,this.height=n,(this.j||this.m)&&--Yl===0&&console.error("You seem to be creating MPImage instances without invoking .close(). This leaks resources.")}Ea(){return!!ne(this,0)}ka(){return!!ne(this,1)}P(){return!!ne(this,2)}Ca(){return Ac(this)}Ba(){var e=ne(this,1);return e||(ks(this),Ds(this),e=jl(this),Hi(this),this.g.push(e),this.j=!0),e}M(){return ks(this)}clone(){const e=[];for(const t of this.g){let i;if(t instanceof ImageData)i=new ImageData(t.data,this.width,this.height);else if(t instanceof WebGLTexture){const s=Ii(this),r=Er(this);s.activeTexture(s.TEXTURE1),i=Br(r,s),s.bindTexture(s.TEXTURE_2D,i),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,this.width,this.height,0,s.RGBA,s.UNSIGNED_BYTE,null),s.bindTexture(s.TEXTURE_2D,null),Ir(r,s,i),Bn(r,s,!1,()=>{Ds(this),s.clearColor(0,0,0,0),s.clear(s.COLOR_BUFFER_BIT),s.drawArrays(s.TRIANGLE_FAN,0,4),Hi(this)}),In(r),Hi(this)}else{if(!(t instanceof ImageBitmap))throw Error(`Type is not supported: ${t}`);ks(this),Ds(this),i=jl(this),Hi(this)}e.push(i)}return new ct(e,this.ka(),this.P(),this.canvas,this.l,this.width,this.height)}close(){this.j&&ne(this,1).close(),this.m&&Ii(this).deleteTexture(ne(this,2)),Yl=-1}};ct.prototype.close=ct.prototype.close,ct.prototype.clone=ct.prototype.clone,ct.prototype.getAsWebGLTexture=ct.prototype.M,ct.prototype.getAsImageBitmap=ct.prototype.Ba,ct.prototype.getAsImageData=ct.prototype.Ca,ct.prototype.hasWebGLTexture=ct.prototype.P,ct.prototype.hasImageBitmap=ct.prototype.ka,ct.prototype.hasImageData=ct.prototype.Ea;var Yl=250;function ee(...e){return e.map(([t,i])=>({start:t,end:i}))}const uf=function(e){return class extends e{La(){this.i._registerModelResourcesGraphService()}}}((Hl=class{constructor(e,t){this.l=!0,this.i=e,this.g=null,this.h=0,this.m=typeof this.i._addIntToInputStream=="function",t!==void 0?this.i.canvas=t:Bc()?this.i.canvas=new OffscreenCanvas(1,1):(console.warn("OffscreenCanvas not supported and GraphRunner constructor glCanvas parameter is undefined. Creating backup canvas."),this.i.canvas=document.createElement("canvas"))}async initializeGraph(e){const t=await(await fetch(e)).arrayBuffer();e=!(e.endsWith(".pbtxt")||e.endsWith(".textproto")),this.setGraph(new Uint8Array(t),e)}setGraphFromString(e){this.setGraph(new TextEncoder().encode(e),!1)}setGraph(e,t){const i=e.length,s=this.i._malloc(i);this.i.HEAPU8.set(e,s),t?this.i._changeBinaryGraph(i,s):this.i._changeTextGraph(i,s),this.i._free(s)}configureAudio(e,t,i,s,r){this.i._configureAudio||console.warn('Attempting to use configureAudio without support for input audio. Is build dep ":gl_graph_runner_audio" missing?'),P(this,s||"input_audio",a=>{P(this,r=r||"audio_header",n=>{this.i._configureAudio(a,n,e,t??0,i)})})}setAutoResizeCanvas(e){this.l=e}setAutoRenderToScreen(e){this.i._setAutoRenderToScreen(e)}setGpuBufferVerticalFlip(e){this.i.gpuOriginForWebTexturesIsBottomLeft=e}da(e){ie(this,"__graph_config__",t=>{e(t)}),P(this,"__graph_config__",t=>{this.i._getGraphConfig(t,void 0)}),delete this.i.simpleListeners.__graph_config__}attachErrorListener(e){this.i.errorListener=e}attachEmptyPacketListener(e,t){this.i.emptyPacketListeners=this.i.emptyPacketListeners||{},this.i.emptyPacketListeners[e]=t}addAudioToStream(e,t,i){this.addAudioToStreamWithShape(e,0,0,t,i)}addAudioToStreamWithShape(e,t,i,s,r){const a=4*e.length;this.h!==a&&(this.g&&this.i._free(this.g),this.g=this.i._malloc(a),this.h=a),this.i.HEAPF32.set(e,this.g/4),P(this,s,n=>{this.i._addAudioToInputStream(this.g,t,i,n,r)})}addGpuBufferToStream(e,t,i){P(this,t,s=>{const[r,a]=Ol(this,e,s);this.i._addBoundTextureToStream(s,r,a,i)})}addBoolToStream(e,t,i){P(this,t,s=>{this.i._addBoolToInputStream(e,s,i)})}addDoubleToStream(e,t,i){P(this,t,s=>{this.i._addDoubleToInputStream(e,s,i)})}addFloatToStream(e,t,i){P(this,t,s=>{this.i._addFloatToInputStream(e,s,i)})}addIntToStream(e,t,i){P(this,t,s=>{this.i._addIntToInputStream(e,s,i)})}addUintToStream(e,t,i){P(this,t,s=>{this.i._addUintToInputStream(e,s,i)})}addStringToStream(e,t,i){P(this,t,s=>{P(this,e,r=>{this.i._addStringToInputStream(r,s,i)})})}addStringRecordToStream(e,t,i){P(this,t,s=>{Nl(this,Object.keys(e),r=>{Nl(this,Object.values(e),a=>{this.i._addFlatHashMapToInputStream(r,a,Object.keys(e).length,s,i)})})})}addProtoToStream(e,t,i,s){P(this,i,r=>{P(this,t,a=>{const n=this.i._malloc(e.length);this.i.HEAPU8.set(e,n),this.i._addProtoToInputStream(n,e.length,a,r,s),this.i._free(n)})})}addEmptyPacketToStream(e,t){P(this,e,i=>{this.i._addEmptyPacketToInputStream(i,t)})}addBoolVectorToStream(e,t,i){P(this,t,s=>{const r=this.i._allocateBoolVector(e.length);if(!r)throw Error("Unable to allocate new bool vector on heap.");for(const a of e)this.i._addBoolVectorEntry(r,a);this.i._addBoolVectorToInputStream(r,s,i)})}addDoubleVectorToStream(e,t,i){P(this,t,s=>{const r=this.i._allocateDoubleVector(e.length);if(!r)throw Error("Unable to allocate new double vector on heap.");for(const a of e)this.i._addDoubleVectorEntry(r,a);this.i._addDoubleVectorToInputStream(r,s,i)})}addFloatVectorToStream(e,t,i){P(this,t,s=>{const r=this.i._allocateFloatVector(e.length);if(!r)throw Error("Unable to allocate new float vector on heap.");for(const a of e)this.i._addFloatVectorEntry(r,a);this.i._addFloatVectorToInputStream(r,s,i)})}addIntVectorToStream(e,t,i){P(this,t,s=>{const r=this.i._allocateIntVector(e.length);if(!r)throw Error("Unable to allocate new int vector on heap.");for(const a of e)this.i._addIntVectorEntry(r,a);this.i._addIntVectorToInputStream(r,s,i)})}addUintVectorToStream(e,t,i){P(this,t,s=>{const r=this.i._allocateUintVector(e.length);if(!r)throw Error("Unable to allocate new unsigned int vector on heap.");for(const a of e)this.i._addUintVectorEntry(r,a);this.i._addUintVectorToInputStream(r,s,i)})}addStringVectorToStream(e,t,i){P(this,t,s=>{const r=this.i._allocateStringVector(e.length);if(!r)throw Error("Unable to allocate new string vector on heap.");for(const a of e)P(this,a,n=>{this.i._addStringVectorEntry(r,n)});this.i._addStringVectorToInputStream(r,s,i)})}addBoolToInputSidePacket(e,t){P(this,t,i=>{this.i._addBoolToInputSidePacket(e,i)})}addDoubleToInputSidePacket(e,t){P(this,t,i=>{this.i._addDoubleToInputSidePacket(e,i)})}addFloatToInputSidePacket(e,t){P(this,t,i=>{this.i._addFloatToInputSidePacket(e,i)})}addIntToInputSidePacket(e,t){P(this,t,i=>{this.i._addIntToInputSidePacket(e,i)})}addUintToInputSidePacket(e,t){P(this,t,i=>{this.i._addUintToInputSidePacket(e,i)})}addStringToInputSidePacket(e,t){P(this,t,i=>{P(this,e,s=>{this.i._addStringToInputSidePacket(s,i)})})}addProtoToInputSidePacket(e,t,i){P(this,i,s=>{P(this,t,r=>{const a=this.i._malloc(e.length);this.i.HEAPU8.set(e,a),this.i._addProtoToInputSidePacket(a,e.length,r,s),this.i._free(a)})})}addBoolVectorToInputSidePacket(e,t){P(this,t,i=>{const s=this.i._allocateBoolVector(e.length);if(!s)throw Error("Unable to allocate new bool vector on heap.");for(const r of e)this.i._addBoolVectorEntry(s,r);this.i._addBoolVectorToInputSidePacket(s,i)})}addDoubleVectorToInputSidePacket(e,t){P(this,t,i=>{const s=this.i._allocateDoubleVector(e.length);if(!s)throw Error("Unable to allocate new double vector on heap.");for(const r of e)this.i._addDoubleVectorEntry(s,r);this.i._addDoubleVectorToInputSidePacket(s,i)})}addFloatVectorToInputSidePacket(e,t){P(this,t,i=>{const s=this.i._allocateFloatVector(e.length);if(!s)throw Error("Unable to allocate new float vector on heap.");for(const r of e)this.i._addFloatVectorEntry(s,r);this.i._addFloatVectorToInputSidePacket(s,i)})}addIntVectorToInputSidePacket(e,t){P(this,t,i=>{const s=this.i._allocateIntVector(e.length);if(!s)throw Error("Unable to allocate new int vector on heap.");for(const r of e)this.i._addIntVectorEntry(s,r);this.i._addIntVectorToInputSidePacket(s,i)})}addUintVectorToInputSidePacket(e,t){P(this,t,i=>{const s=this.i._allocateUintVector(e.length);if(!s)throw Error("Unable to allocate new unsigned int vector on heap.");for(const r of e)this.i._addUintVectorEntry(s,r);this.i._addUintVectorToInputSidePacket(s,i)})}addStringVectorToInputSidePacket(e,t){P(this,t,i=>{const s=this.i._allocateStringVector(e.length);if(!s)throw Error("Unable to allocate new string vector on heap.");for(const r of e)P(this,r,a=>{this.i._addStringVectorEntry(s,a)});this.i._addStringVectorToInputSidePacket(s,i)})}attachBoolListener(e,t){ie(this,e,t),P(this,e,i=>{this.i._attachBoolListener(i)})}attachBoolVectorListener(e,t){ve(this,e,t),P(this,e,i=>{this.i._attachBoolVectorListener(i)})}attachIntListener(e,t){ie(this,e,t),P(this,e,i=>{this.i._attachIntListener(i)})}attachIntVectorListener(e,t){ve(this,e,t),P(this,e,i=>{this.i._attachIntVectorListener(i)})}attachUintListener(e,t){ie(this,e,t),P(this,e,i=>{this.i._attachUintListener(i)})}attachUintVectorListener(e,t){ve(this,e,t),P(this,e,i=>{this.i._attachUintVectorListener(i)})}attachDoubleListener(e,t){ie(this,e,t),P(this,e,i=>{this.i._attachDoubleListener(i)})}attachDoubleVectorListener(e,t){ve(this,e,t),P(this,e,i=>{this.i._attachDoubleVectorListener(i)})}attachFloatListener(e,t){ie(this,e,t),P(this,e,i=>{this.i._attachFloatListener(i)})}attachFloatVectorListener(e,t){ve(this,e,t),P(this,e,i=>{this.i._attachFloatVectorListener(i)})}attachStringListener(e,t){ie(this,e,t),P(this,e,i=>{this.i._attachStringListener(i)})}attachStringVectorListener(e,t){ve(this,e,t),P(this,e,i=>{this.i._attachStringVectorListener(i)})}attachProtoListener(e,t,i){ie(this,e,t),P(this,e,s=>{this.i._attachProtoListener(s,i||!1)})}attachProtoVectorListener(e,t,i){ve(this,e,t),P(this,e,s=>{this.i._attachProtoVectorListener(s,i||!1)})}attachAudioListener(e,t,i){this.i._attachAudioListener||console.warn('Attempting to use attachAudioListener without support for output audio. Is build dep ":gl_graph_runner_audio_out" missing?'),ie(this,e,(s,r)=>{s=new Float32Array(s.buffer,s.byteOffset,s.length/4),t(s,r)}),P(this,e,s=>{this.i._attachAudioListener(s,i||!1)})}finishProcessing(){this.i._waitUntilIdle()}closeGraph(){this.i._closeGraph(),this.i.simpleListeners=void 0,this.i.emptyPacketListeners=void 0}},class extends Hl{get ea(){return this.i}qa(e,t,i){P(this,t,s=>{const[r,a]=Ol(this,e,s);this.ea._addBoundTextureAsImageToStream(s,r,a,i)})}U(e,t){ie(this,e,t),P(this,e,i=>{this.ea._attachImageListener(i)})}ca(e,t){ve(this,e,t),P(this,e,i=>{this.ea._attachImageVectorListener(i)})}}));var Hl,Wt=class extends uf{};async function V(e,t,i){return async function(s,r,a,n){return lf(s,r,a,n)}(e,i.canvas??(Bc()?void 0:document.createElement("canvas")),t,i)}function Rc(e,t,i,s){if(e.T){const a=new ic;if(i!=null&&i.regionOfInterest){if(!e.pa)throw Error("This task doesn't support region-of-interest.");var r=i.regionOfInterest;if(r.left>=r.right||r.top>=r.bottom)throw Error("Expected RectF with left < right and top < bottom.");if(r.left<0||r.top<0||r.right>1||r.bottom>1)throw Error("Expected RectF values to be in [0,1].");v(a,1,(r.left+r.right)/2),v(a,2,(r.top+r.bottom)/2),v(a,4,r.right-r.left),v(a,3,r.bottom-r.top)}else v(a,1,.5),v(a,2,.5),v(a,4,1),v(a,3,1);if(i!=null&&i.rotationDegrees){if((i==null?void 0:i.rotationDegrees)%90!=0)throw Error("Expected rotation to be a multiple of 90.");if(v(a,5,-Math.PI*i.rotationDegrees/180),(i==null?void 0:i.rotationDegrees)%180!=0){const[n,o]=Ic(t);i=it(a,3)*o/n,r=it(a,4)*n/o,v(a,4,i),v(a,3,r)}}e.g.addProtoToStream(a.g(),"mediapipe.NormalizedRect",e.T,s)}e.g.qa(t,e.aa,s??performance.now()),e.finishProcessing()}function $t(e,t,i){var s;if((s=e.baseOptions)!=null&&s.g())throw Error("Task is not initialized with image mode. 'runningMode' must be set to 'IMAGE'.");Rc(e,t,i,e.B+1)}function le(e,t,i,s){var r;if(!((r=e.baseOptions)!=null&&r.g()))throw Error("Task is not initialized with video mode. 'runningMode' must be set to 'VIDEO'.");Rc(e,t,i,s)}function Ei(e,t,i,s){var r=t.data;const a=t.width,n=a*(t=t.height);if((r instanceof Uint8Array||r instanceof Float32Array)&&r.length!==n)throw Error("Unsupported channel count: "+r.length/n);return e=new ut([r],i,!1,e.g.i.canvas,e.O,a,t),s?e.clone():e}var Pt=class extends Ls{constructor(e,t,i,s){super(e),this.g=e,this.aa=t,this.T=i,this.pa=s,this.O=new En}l(e,t=!0){if("runningMode"in e&&us(this.baseOptions,2,!!e.runningMode&&e.runningMode!=="IMAGE"),e.canvas!==void 0&&this.g.i.canvas!==e.canvas)throw Error("You must create a new task to reset the canvas.");return super.l(e,t)}close(){this.O.close(),super.close()}};Pt.prototype.close=Pt.prototype.close;var Dt=class extends Pt{constructor(e,t){super(new Wt(e,t),"image_in","norm_rect_in",!1),this.j={detections:[]},I(e=this.h=new br,0,1,t=new K),v(this.h,2,.5),v(this.h,3,.3)}get baseOptions(){return O(this.h,K,1)}set baseOptions(e){I(this.h,0,1,e)}o(e){return"minDetectionConfidence"in e&&v(this.h,2,e.minDetectionConfidence??.5),"minSuppressionThreshold"in e&&v(this.h,3,e.minSuppressionThreshold??.3),this.l(e)}D(e,t){return this.j={detections:[]},$t(this,e,t),this.j}F(e,t,i){return this.j={detections:[]},le(this,e,i,t),this.j}m(){var e=new wt;W(e,"image_in"),W(e,"norm_rect_in"),N(e,"detections");const t=new Rt;Zt(t,W_,this.h);const i=new pt;Lt(i,"mediapipe.tasks.vision.face_detector.FaceDetectorGraph"),j(i,"IMAGE:image_in"),j(i,"NORM_RECT:norm_rect_in"),L(i,"DETECTIONS:detections"),i.o(t),kt(e,i),this.g.attachProtoVectorListener("detections",(s,r)=>{for(const a of s)s=Qu(a),this.j.detections.push(Pc(s));p(this,r)}),this.g.attachEmptyPacketListener("detections",s=>{p(this,s)}),e=e.g(),this.setGraph(new Uint8Array(e),!0)}};Dt.prototype.detectForVideo=Dt.prototype.F,Dt.prototype.detect=Dt.prototype.D,Dt.prototype.setOptions=Dt.prototype.o,Dt.createFromModelPath=async function(e,t){return V(Dt,e,{baseOptions:{modelAssetPath:t}})},Dt.createFromModelBuffer=function(e,t){return V(Dt,e,{baseOptions:{modelAssetBuffer:t}})},Dt.createFromOptions=function(e,t){return V(Dt,e,t)};var Tn=ee([61,146],[146,91],[91,181],[181,84],[84,17],[17,314],[314,405],[405,321],[321,375],[375,291],[61,185],[185,40],[40,39],[39,37],[37,0],[0,267],[267,269],[269,270],[270,409],[409,291],[78,95],[95,88],[88,178],[178,87],[87,14],[14,317],[317,402],[402,318],[318,324],[324,308],[78,191],[191,80],[80,81],[81,82],[82,13],[13,312],[312,311],[311,310],[310,415],[415,308]),An=ee([263,249],[249,390],[390,373],[373,374],[374,380],[380,381],[381,382],[382,362],[263,466],[466,388],[388,387],[387,386],[386,385],[385,384],[384,398],[398,362]),Rn=ee([276,283],[283,282],[282,295],[295,285],[300,293],[293,334],[334,296],[296,336]),Vc=ee([474,475],[475,476],[476,477],[477,474]),Vn=ee([33,7],[7,163],[163,144],[144,145],[145,153],[153,154],[154,155],[155,133],[33,246],[246,161],[161,160],[160,159],[159,158],[158,157],[157,173],[173,133]),Ln=ee([46,53],[53,52],[52,65],[65,55],[70,63],[63,105],[105,66],[66,107]),Lc=ee([469,470],[470,471],[471,472],[472,469]),kn=ee([10,338],[338,297],[297,332],[332,284],[284,251],[251,389],[389,356],[356,454],[454,323],[323,361],[361,288],[288,397],[397,365],[365,379],[379,378],[378,400],[400,377],[377,152],[152,148],[148,176],[176,149],[149,150],[150,136],[136,172],[172,58],[58,132],[132,93],[93,234],[234,127],[127,162],[162,21],[21,54],[54,103],[103,67],[67,109],[109,10]),kc=[...Tn,...An,...Rn,...Vn,...Ln,...kn],Dc=ee([127,34],[34,139],[139,127],[11,0],[0,37],[37,11],[232,231],[231,120],[120,232],[72,37],[37,39],[39,72],[128,121],[121,47],[47,128],[232,121],[121,128],[128,232],[104,69],[69,67],[67,104],[175,171],[171,148],[148,175],[118,50],[50,101],[101,118],[73,39],[39,40],[40,73],[9,151],[151,108],[108,9],[48,115],[115,131],[131,48],[194,204],[204,211],[211,194],[74,40],[40,185],[185,74],[80,42],[42,183],[183,80],[40,92],[92,186],[186,40],[230,229],[229,118],[118,230],[202,212],[212,214],[214,202],[83,18],[18,17],[17,83],[76,61],[61,146],[146,76],[160,29],[29,30],[30,160],[56,157],[157,173],[173,56],[106,204],[204,194],[194,106],[135,214],[214,192],[192,135],[203,165],[165,98],[98,203],[21,71],[71,68],[68,21],[51,45],[45,4],[4,51],[144,24],[24,23],[23,144],[77,146],[146,91],[91,77],[205,50],[50,187],[187,205],[201,200],[200,18],[18,201],[91,106],[106,182],[182,91],[90,91],[91,181],[181,90],[85,84],[84,17],[17,85],[206,203],[203,36],[36,206],[148,171],[171,140],[140,148],[92,40],[40,39],[39,92],[193,189],[189,244],[244,193],[159,158],[158,28],[28,159],[247,246],[246,161],[161,247],[236,3],[3,196],[196,236],[54,68],[68,104],[104,54],[193,168],[168,8],[8,193],[117,228],[228,31],[31,117],[189,193],[193,55],[55,189],[98,97],[97,99],[99,98],[126,47],[47,100],[100,126],[166,79],[79,218],[218,166],[155,154],[154,26],[26,155],[209,49],[49,131],[131,209],[135,136],[136,150],[150,135],[47,126],[126,217],[217,47],[223,52],[52,53],[53,223],[45,51],[51,134],[134,45],[211,170],[170,140],[140,211],[67,69],[69,108],[108,67],[43,106],[106,91],[91,43],[230,119],[119,120],[120,230],[226,130],[130,247],[247,226],[63,53],[53,52],[52,63],[238,20],[20,242],[242,238],[46,70],[70,156],[156,46],[78,62],[62,96],[96,78],[46,53],[53,63],[63,46],[143,34],[34,227],[227,143],[123,117],[117,111],[111,123],[44,125],[125,19],[19,44],[236,134],[134,51],[51,236],[216,206],[206,205],[205,216],[154,153],[153,22],[22,154],[39,37],[37,167],[167,39],[200,201],[201,208],[208,200],[36,142],[142,100],[100,36],[57,212],[212,202],[202,57],[20,60],[60,99],[99,20],[28,158],[158,157],[157,28],[35,226],[226,113],[113,35],[160,159],[159,27],[27,160],[204,202],[202,210],[210,204],[113,225],[225,46],[46,113],[43,202],[202,204],[204,43],[62,76],[76,77],[77,62],[137,123],[123,116],[116,137],[41,38],[38,72],[72,41],[203,129],[129,142],[142,203],[64,98],[98,240],[240,64],[49,102],[102,64],[64,49],[41,73],[73,74],[74,41],[212,216],[216,207],[207,212],[42,74],[74,184],[184,42],[169,170],[170,211],[211,169],[170,149],[149,176],[176,170],[105,66],[66,69],[69,105],[122,6],[6,168],[168,122],[123,147],[147,187],[187,123],[96,77],[77,90],[90,96],[65,55],[55,107],[107,65],[89,90],[90,180],[180,89],[101,100],[100,120],[120,101],[63,105],[105,104],[104,63],[93,137],[137,227],[227,93],[15,86],[86,85],[85,15],[129,102],[102,49],[49,129],[14,87],[87,86],[86,14],[55,8],[8,9],[9,55],[100,47],[47,121],[121,100],[145,23],[23,22],[22,145],[88,89],[89,179],[179,88],[6,122],[122,196],[196,6],[88,95],[95,96],[96,88],[138,172],[172,136],[136,138],[215,58],[58,172],[172,215],[115,48],[48,219],[219,115],[42,80],[80,81],[81,42],[195,3],[3,51],[51,195],[43,146],[146,61],[61,43],[171,175],[175,199],[199,171],[81,82],[82,38],[38,81],[53,46],[46,225],[225,53],[144,163],[163,110],[110,144],[52,65],[65,66],[66,52],[229,228],[228,117],[117,229],[34,127],[127,234],[234,34],[107,108],[108,69],[69,107],[109,108],[108,151],[151,109],[48,64],[64,235],[235,48],[62,78],[78,191],[191,62],[129,209],[209,126],[126,129],[111,35],[35,143],[143,111],[117,123],[123,50],[50,117],[222,65],[65,52],[52,222],[19,125],[125,141],[141,19],[221,55],[55,65],[65,221],[3,195],[195,197],[197,3],[25,7],[7,33],[33,25],[220,237],[237,44],[44,220],[70,71],[71,139],[139,70],[122,193],[193,245],[245,122],[247,130],[130,33],[33,247],[71,21],[21,162],[162,71],[170,169],[169,150],[150,170],[188,174],[174,196],[196,188],[216,186],[186,92],[92,216],[2,97],[97,167],[167,2],[141,125],[125,241],[241,141],[164,167],[167,37],[37,164],[72,38],[38,12],[12,72],[38,82],[82,13],[13,38],[63,68],[68,71],[71,63],[226,35],[35,111],[111,226],[101,50],[50,205],[205,101],[206,92],[92,165],[165,206],[209,198],[198,217],[217,209],[165,167],[167,97],[97,165],[220,115],[115,218],[218,220],[133,112],[112,243],[243,133],[239,238],[238,241],[241,239],[214,135],[135,169],[169,214],[190,173],[173,133],[133,190],[171,208],[208,32],[32,171],[125,44],[44,237],[237,125],[86,87],[87,178],[178,86],[85,86],[86,179],[179,85],[84,85],[85,180],[180,84],[83,84],[84,181],[181,83],[201,83],[83,182],[182,201],[137,93],[93,132],[132,137],[76,62],[62,183],[183,76],[61,76],[76,184],[184,61],[57,61],[61,185],[185,57],[212,57],[57,186],[186,212],[214,207],[207,187],[187,214],[34,143],[143,156],[156,34],[79,239],[239,237],[237,79],[123,137],[137,177],[177,123],[44,1],[1,4],[4,44],[201,194],[194,32],[32,201],[64,102],[102,129],[129,64],[213,215],[215,138],[138,213],[59,166],[166,219],[219,59],[242,99],[99,97],[97,242],[2,94],[94,141],[141,2],[75,59],[59,235],[235,75],[24,110],[110,228],[228,24],[25,130],[130,226],[226,25],[23,24],[24,229],[229,23],[22,23],[23,230],[230,22],[26,22],[22,231],[231,26],[112,26],[26,232],[232,112],[189,190],[190,243],[243,189],[221,56],[56,190],[190,221],[28,56],[56,221],[221,28],[27,28],[28,222],[222,27],[29,27],[27,223],[223,29],[30,29],[29,224],[224,30],[247,30],[30,225],[225,247],[238,79],[79,20],[20,238],[166,59],[59,75],[75,166],[60,75],[75,240],[240,60],[147,177],[177,215],[215,147],[20,79],[79,166],[166,20],[187,147],[147,213],[213,187],[112,233],[233,244],[244,112],[233,128],[128,245],[245,233],[128,114],[114,188],[188,128],[114,217],[217,174],[174,114],[131,115],[115,220],[220,131],[217,198],[198,236],[236,217],[198,131],[131,134],[134,198],[177,132],[132,58],[58,177],[143,35],[35,124],[124,143],[110,163],[163,7],[7,110],[228,110],[110,25],[25,228],[356,389],[389,368],[368,356],[11,302],[302,267],[267,11],[452,350],[350,349],[349,452],[302,303],[303,269],[269,302],[357,343],[343,277],[277,357],[452,453],[453,357],[357,452],[333,332],[332,297],[297,333],[175,152],[152,377],[377,175],[347,348],[348,330],[330,347],[303,304],[304,270],[270,303],[9,336],[336,337],[337,9],[278,279],[279,360],[360,278],[418,262],[262,431],[431,418],[304,408],[408,409],[409,304],[310,415],[415,407],[407,310],[270,409],[409,410],[410,270],[450,348],[348,347],[347,450],[422,430],[430,434],[434,422],[313,314],[314,17],[17,313],[306,307],[307,375],[375,306],[387,388],[388,260],[260,387],[286,414],[414,398],[398,286],[335,406],[406,418],[418,335],[364,367],[367,416],[416,364],[423,358],[358,327],[327,423],[251,284],[284,298],[298,251],[281,5],[5,4],[4,281],[373,374],[374,253],[253,373],[307,320],[320,321],[321,307],[425,427],[427,411],[411,425],[421,313],[313,18],[18,421],[321,405],[405,406],[406,321],[320,404],[404,405],[405,320],[315,16],[16,17],[17,315],[426,425],[425,266],[266,426],[377,400],[400,369],[369,377],[322,391],[391,269],[269,322],[417,465],[465,464],[464,417],[386,257],[257,258],[258,386],[466,260],[260,388],[388,466],[456,399],[399,419],[419,456],[284,332],[332,333],[333,284],[417,285],[285,8],[8,417],[346,340],[340,261],[261,346],[413,441],[441,285],[285,413],[327,460],[460,328],[328,327],[355,371],[371,329],[329,355],[392,439],[439,438],[438,392],[382,341],[341,256],[256,382],[429,420],[420,360],[360,429],[364,394],[394,379],[379,364],[277,343],[343,437],[437,277],[443,444],[444,283],[283,443],[275,440],[440,363],[363,275],[431,262],[262,369],[369,431],[297,338],[338,337],[337,297],[273,375],[375,321],[321,273],[450,451],[451,349],[349,450],[446,342],[342,467],[467,446],[293,334],[334,282],[282,293],[458,461],[461,462],[462,458],[276,353],[353,383],[383,276],[308,324],[324,325],[325,308],[276,300],[300,293],[293,276],[372,345],[345,447],[447,372],[352,345],[345,340],[340,352],[274,1],[1,19],[19,274],[456,248],[248,281],[281,456],[436,427],[427,425],[425,436],[381,256],[256,252],[252,381],[269,391],[391,393],[393,269],[200,199],[199,428],[428,200],[266,330],[330,329],[329,266],[287,273],[273,422],[422,287],[250,462],[462,328],[328,250],[258,286],[286,384],[384,258],[265,353],[353,342],[342,265],[387,259],[259,257],[257,387],[424,431],[431,430],[430,424],[342,353],[353,276],[276,342],[273,335],[335,424],[424,273],[292,325],[325,307],[307,292],[366,447],[447,345],[345,366],[271,303],[303,302],[302,271],[423,266],[266,371],[371,423],[294,455],[455,460],[460,294],[279,278],[278,294],[294,279],[271,272],[272,304],[304,271],[432,434],[434,427],[427,432],[272,407],[407,408],[408,272],[394,430],[430,431],[431,394],[395,369],[369,400],[400,395],[334,333],[333,299],[299,334],[351,417],[417,168],[168,351],[352,280],[280,411],[411,352],[325,319],[319,320],[320,325],[295,296],[296,336],[336,295],[319,403],[403,404],[404,319],[330,348],[348,349],[349,330],[293,298],[298,333],[333,293],[323,454],[454,447],[447,323],[15,16],[16,315],[315,15],[358,429],[429,279],[279,358],[14,15],[15,316],[316,14],[285,336],[336,9],[9,285],[329,349],[349,350],[350,329],[374,380],[380,252],[252,374],[318,402],[402,403],[403,318],[6,197],[197,419],[419,6],[318,319],[319,325],[325,318],[367,364],[364,365],[365,367],[435,367],[367,397],[397,435],[344,438],[438,439],[439,344],[272,271],[271,311],[311,272],[195,5],[5,281],[281,195],[273,287],[287,291],[291,273],[396,428],[428,199],[199,396],[311,271],[271,268],[268,311],[283,444],[444,445],[445,283],[373,254],[254,339],[339,373],[282,334],[334,296],[296,282],[449,347],[347,346],[346,449],[264,447],[447,454],[454,264],[336,296],[296,299],[299,336],[338,10],[10,151],[151,338],[278,439],[439,455],[455,278],[292,407],[407,415],[415,292],[358,371],[371,355],[355,358],[340,345],[345,372],[372,340],[346,347],[347,280],[280,346],[442,443],[443,282],[282,442],[19,94],[94,370],[370,19],[441,442],[442,295],[295,441],[248,419],[419,197],[197,248],[263,255],[255,359],[359,263],[440,275],[275,274],[274,440],[300,383],[383,368],[368,300],[351,412],[412,465],[465,351],[263,467],[467,466],[466,263],[301,368],[368,389],[389,301],[395,378],[378,379],[379,395],[412,351],[351,419],[419,412],[436,426],[426,322],[322,436],[2,164],[164,393],[393,2],[370,462],[462,461],[461,370],[164,0],[0,267],[267,164],[302,11],[11,12],[12,302],[268,12],[12,13],[13,268],[293,300],[300,301],[301,293],[446,261],[261,340],[340,446],[330,266],[266,425],[425,330],[426,423],[423,391],[391,426],[429,355],[355,437],[437,429],[391,327],[327,326],[326,391],[440,457],[457,438],[438,440],[341,382],[382,362],[362,341],[459,457],[457,461],[461,459],[434,430],[430,394],[394,434],[414,463],[463,362],[362,414],[396,369],[369,262],[262,396],[354,461],[461,457],[457,354],[316,403],[403,402],[402,316],[315,404],[404,403],[403,315],[314,405],[405,404],[404,314],[313,406],[406,405],[405,313],[421,418],[418,406],[406,421],[366,401],[401,361],[361,366],[306,408],[408,407],[407,306],[291,409],[409,408],[408,291],[287,410],[410,409],[409,287],[432,436],[436,410],[410,432],[434,416],[416,411],[411,434],[264,368],[368,383],[383,264],[309,438],[438,457],[457,309],[352,376],[376,401],[401,352],[274,275],[275,4],[4,274],[421,428],[428,262],[262,421],[294,327],[327,358],[358,294],[433,416],[416,367],[367,433],[289,455],[455,439],[439,289],[462,370],[370,326],[326,462],[2,326],[326,370],[370,2],[305,460],[460,455],[455,305],[254,449],[449,448],[448,254],[255,261],[261,446],[446,255],[253,450],[450,449],[449,253],[252,451],[451,450],[450,252],[256,452],[452,451],[451,256],[341,453],[453,452],[452,341],[413,464],[464,463],[463,413],[441,413],[413,414],[414,441],[258,442],[442,441],[441,258],[257,443],[443,442],[442,257],[259,444],[444,443],[443,259],[260,445],[445,444],[444,260],[467,342],[342,445],[445,467],[459,458],[458,250],[250,459],[289,392],[392,290],[290,289],[290,328],[328,460],[460,290],[376,433],[433,435],[435,376],[250,290],[290,392],[392,250],[411,416],[416,433],[433,411],[341,463],[463,464],[464,341],[453,464],[464,465],[465,453],[357,465],[465,412],[412,357],[343,412],[412,399],[399,343],[360,363],[363,440],[440,360],[437,399],[399,456],[456,437],[420,456],[456,363],[363,420],[401,435],[435,288],[288,401],[372,383],[383,353],[353,372],[339,255],[255,249],[249,339],[448,261],[261,255],[255,448],[133,243],[243,190],[190,133],[133,155],[155,112],[112,133],[33,246],[246,247],[247,33],[33,130],[130,25],[25,33],[398,384],[384,286],[286,398],[362,398],[398,414],[414,362],[362,463],[463,341],[341,362],[263,359],[359,467],[467,263],[263,249],[249,255],[255,263],[466,467],[467,260],[260,466],[75,60],[60,166],[166,75],[238,239],[239,79],[79,238],[162,127],[127,139],[139,162],[72,11],[11,37],[37,72],[121,232],[232,120],[120,121],[73,72],[72,39],[39,73],[114,128],[128,47],[47,114],[233,232],[232,128],[128,233],[103,104],[104,67],[67,103],[152,175],[175,148],[148,152],[119,118],[118,101],[101,119],[74,73],[73,40],[40,74],[107,9],[9,108],[108,107],[49,48],[48,131],[131,49],[32,194],[194,211],[211,32],[184,74],[74,185],[185,184],[191,80],[80,183],[183,191],[185,40],[40,186],[186,185],[119,230],[230,118],[118,119],[210,202],[202,214],[214,210],[84,83],[83,17],[17,84],[77,76],[76,146],[146,77],[161,160],[160,30],[30,161],[190,56],[56,173],[173,190],[182,106],[106,194],[194,182],[138,135],[135,192],[192,138],[129,203],[203,98],[98,129],[54,21],[21,68],[68,54],[5,51],[51,4],[4,5],[145,144],[144,23],[23,145],[90,77],[77,91],[91,90],[207,205],[205,187],[187,207],[83,201],[201,18],[18,83],[181,91],[91,182],[182,181],[180,90],[90,181],[181,180],[16,85],[85,17],[17,16],[205,206],[206,36],[36,205],[176,148],[148,140],[140,176],[165,92],[92,39],[39,165],[245,193],[193,244],[244,245],[27,159],[159,28],[28,27],[30,247],[247,161],[161,30],[174,236],[236,196],[196,174],[103,54],[54,104],[104,103],[55,193],[193,8],[8,55],[111,117],[117,31],[31,111],[221,189],[189,55],[55,221],[240,98],[98,99],[99,240],[142,126],[126,100],[100,142],[219,166],[166,218],[218,219],[112,155],[155,26],[26,112],[198,209],[209,131],[131,198],[169,135],[135,150],[150,169],[114,47],[47,217],[217,114],[224,223],[223,53],[53,224],[220,45],[45,134],[134,220],[32,211],[211,140],[140,32],[109,67],[67,108],[108,109],[146,43],[43,91],[91,146],[231,230],[230,120],[120,231],[113,226],[226,247],[247,113],[105,63],[63,52],[52,105],[241,238],[238,242],[242,241],[124,46],[46,156],[156,124],[95,78],[78,96],[96,95],[70,46],[46,63],[63,70],[116,143],[143,227],[227,116],[116,123],[123,111],[111,116],[1,44],[44,19],[19,1],[3,236],[236,51],[51,3],[207,216],[216,205],[205,207],[26,154],[154,22],[22,26],[165,39],[39,167],[167,165],[199,200],[200,208],[208,199],[101,36],[36,100],[100,101],[43,57],[57,202],[202,43],[242,20],[20,99],[99,242],[56,28],[28,157],[157,56],[124,35],[35,113],[113,124],[29,160],[160,27],[27,29],[211,204],[204,210],[210,211],[124,113],[113,46],[46,124],[106,43],[43,204],[204,106],[96,62],[62,77],[77,96],[227,137],[137,116],[116,227],[73,41],[41,72],[72,73],[36,203],[203,142],[142,36],[235,64],[64,240],[240,235],[48,49],[49,64],[64,48],[42,41],[41,74],[74,42],[214,212],[212,207],[207,214],[183,42],[42,184],[184,183],[210,169],[169,211],[211,210],[140,170],[170,176],[176,140],[104,105],[105,69],[69,104],[193,122],[122,168],[168,193],[50,123],[123,187],[187,50],[89,96],[96,90],[90,89],[66,65],[65,107],[107,66],[179,89],[89,180],[180,179],[119,101],[101,120],[120,119],[68,63],[63,104],[104,68],[234,93],[93,227],[227,234],[16,15],[15,85],[85,16],[209,129],[129,49],[49,209],[15,14],[14,86],[86,15],[107,55],[55,9],[9,107],[120,100],[100,121],[121,120],[153,145],[145,22],[22,153],[178,88],[88,179],[179,178],[197,6],[6,196],[196,197],[89,88],[88,96],[96,89],[135,138],[138,136],[136,135],[138,215],[215,172],[172,138],[218,115],[115,219],[219,218],[41,42],[42,81],[81,41],[5,195],[195,51],[51,5],[57,43],[43,61],[61,57],[208,171],[171,199],[199,208],[41,81],[81,38],[38,41],[224,53],[53,225],[225,224],[24,144],[144,110],[110,24],[105,52],[52,66],[66,105],[118,229],[229,117],[117,118],[227,34],[34,234],[234,227],[66,107],[107,69],[69,66],[10,109],[109,151],[151,10],[219,48],[48,235],[235,219],[183,62],[62,191],[191,183],[142,129],[129,126],[126,142],[116,111],[111,143],[143,116],[118,117],[117,50],[50,118],[223,222],[222,52],[52,223],[94,19],[19,141],[141,94],[222,221],[221,65],[65,222],[196,3],[3,197],[197,196],[45,220],[220,44],[44,45],[156,70],[70,139],[139,156],[188,122],[122,245],[245,188],[139,71],[71,162],[162,139],[149,170],[170,150],[150,149],[122,188],[188,196],[196,122],[206,216],[216,92],[92,206],[164,2],[2,167],[167,164],[242,141],[141,241],[241,242],[0,164],[164,37],[37,0],[11,72],[72,12],[12,11],[12,38],[38,13],[13,12],[70,63],[63,71],[71,70],[31,226],[226,111],[111,31],[36,101],[101,205],[205,36],[203,206],[206,165],[165,203],[126,209],[209,217],[217,126],[98,165],[165,97],[97,98],[237,220],[220,218],[218,237],[237,239],[239,241],[241,237],[210,214],[214,169],[169,210],[140,171],[171,32],[32,140],[241,125],[125,237],[237,241],[179,86],[86,178],[178,179],[180,85],[85,179],[179,180],[181,84],[84,180],[180,181],[182,83],[83,181],[181,182],[194,201],[201,182],[182,194],[177,137],[137,132],[132,177],[184,76],[76,183],[183,184],[185,61],[61,184],[184,185],[186,57],[57,185],[185,186],[216,212],[212,186],[186,216],[192,214],[214,187],[187,192],[139,34],[34,156],[156,139],[218,79],[79,237],[237,218],[147,123],[123,177],[177,147],[45,44],[44,4],[4,45],[208,201],[201,32],[32,208],[98,64],[64,129],[129,98],[192,213],[213,138],[138,192],[235,59],[59,219],[219,235],[141,242],[242,97],[97,141],[97,2],[2,141],[141,97],[240,75],[75,235],[235,240],[229,24],[24,228],[228,229],[31,25],[25,226],[226,31],[230,23],[23,229],[229,230],[231,22],[22,230],[230,231],[232,26],[26,231],[231,232],[233,112],[112,232],[232,233],[244,189],[189,243],[243,244],[189,221],[221,190],[190,189],[222,28],[28,221],[221,222],[223,27],[27,222],[222,223],[224,29],[29,223],[223,224],[225,30],[30,224],[224,225],[113,247],[247,225],[225,113],[99,60],[60,240],[240,99],[213,147],[147,215],[215,213],[60,20],[20,166],[166,60],[192,187],[187,213],[213,192],[243,112],[112,244],[244,243],[244,233],[233,245],[245,244],[245,128],[128,188],[188,245],[188,114],[114,174],[174,188],[134,131],[131,220],[220,134],[174,217],[217,236],[236,174],[236,198],[198,134],[134,236],[215,177],[177,58],[58,215],[156,143],[143,124],[124,156],[25,110],[110,7],[7,25],[31,228],[228,25],[25,31],[264,356],[356,368],[368,264],[0,11],[11,267],[267,0],[451,452],[452,349],[349,451],[267,302],[302,269],[269,267],[350,357],[357,277],[277,350],[350,452],[452,357],[357,350],[299,333],[333,297],[297,299],[396,175],[175,377],[377,396],[280,347],[347,330],[330,280],[269,303],[303,270],[270,269],[151,9],[9,337],[337,151],[344,278],[278,360],[360,344],[424,418],[418,431],[431,424],[270,304],[304,409],[409,270],[272,310],[310,407],[407,272],[322,270],[270,410],[410,322],[449,450],[450,347],[347,449],[432,422],[422,434],[434,432],[18,313],[313,17],[17,18],[291,306],[306,375],[375,291],[259,387],[387,260],[260,259],[424,335],[335,418],[418,424],[434,364],[364,416],[416,434],[391,423],[423,327],[327,391],[301,251],[251,298],[298,301],[275,281],[281,4],[4,275],[254,373],[373,253],[253,254],[375,307],[307,321],[321,375],[280,425],[425,411],[411,280],[200,421],[421,18],[18,200],[335,321],[321,406],[406,335],[321,320],[320,405],[405,321],[314,315],[315,17],[17,314],[423,426],[426,266],[266,423],[396,377],[377,369],[369,396],[270,322],[322,269],[269,270],[413,417],[417,464],[464,413],[385,386],[386,258],[258,385],[248,456],[456,419],[419,248],[298,284],[284,333],[333,298],[168,417],[417,8],[8,168],[448,346],[346,261],[261,448],[417,413],[413,285],[285,417],[326,327],[327,328],[328,326],[277,355],[355,329],[329,277],[309,392],[392,438],[438,309],[381,382],[382,256],[256,381],[279,429],[429,360],[360,279],[365,364],[364,379],[379,365],[355,277],[277,437],[437,355],[282,443],[443,283],[283,282],[281,275],[275,363],[363,281],[395,431],[431,369],[369,395],[299,297],[297,337],[337,299],[335,273],[273,321],[321,335],[348,450],[450,349],[349,348],[359,446],[446,467],[467,359],[283,293],[293,282],[282,283],[250,458],[458,462],[462,250],[300,276],[276,383],[383,300],[292,308],[308,325],[325,292],[283,276],[276,293],[293,283],[264,372],[372,447],[447,264],[346,352],[352,340],[340,346],[354,274],[274,19],[19,354],[363,456],[456,281],[281,363],[426,436],[436,425],[425,426],[380,381],[381,252],[252,380],[267,269],[269,393],[393,267],[421,200],[200,428],[428,421],[371,266],[266,329],[329,371],[432,287],[287,422],[422,432],[290,250],[250,328],[328,290],[385,258],[258,384],[384,385],[446,265],[265,342],[342,446],[386,387],[387,257],[257,386],[422,424],[424,430],[430,422],[445,342],[342,276],[276,445],[422,273],[273,424],[424,422],[306,292],[292,307],[307,306],[352,366],[366,345],[345,352],[268,271],[271,302],[302,268],[358,423],[423,371],[371,358],[327,294],[294,460],[460,327],[331,279],[279,294],[294,331],[303,271],[271,304],[304,303],[436,432],[432,427],[427,436],[304,272],[272,408],[408,304],[395,394],[394,431],[431,395],[378,395],[395,400],[400,378],[296,334],[334,299],[299,296],[6,351],[351,168],[168,6],[376,352],[352,411],[411,376],[307,325],[325,320],[320,307],[285,295],[295,336],[336,285],[320,319],[319,404],[404,320],[329,330],[330,349],[349,329],[334,293],[293,333],[333,334],[366,323],[323,447],[447,366],[316,15],[15,315],[315,316],[331,358],[358,279],[279,331],[317,14],[14,316],[316,317],[8,285],[285,9],[9,8],[277,329],[329,350],[350,277],[253,374],[374,252],[252,253],[319,318],[318,403],[403,319],[351,6],[6,419],[419,351],[324,318],[318,325],[325,324],[397,367],[367,365],[365,397],[288,435],[435,397],[397,288],[278,344],[344,439],[439,278],[310,272],[272,311],[311,310],[248,195],[195,281],[281,248],[375,273],[273,291],[291,375],[175,396],[396,199],[199,175],[312,311],[311,268],[268,312],[276,283],[283,445],[445,276],[390,373],[373,339],[339,390],[295,282],[282,296],[296,295],[448,449],[449,346],[346,448],[356,264],[264,454],[454,356],[337,336],[336,299],[299,337],[337,338],[338,151],[151,337],[294,278],[278,455],[455,294],[308,292],[292,415],[415,308],[429,358],[358,355],[355,429],[265,340],[340,372],[372,265],[352,346],[346,280],[280,352],[295,442],[442,282],[282,295],[354,19],[19,370],[370,354],[285,441],[441,295],[295,285],[195,248],[248,197],[197,195],[457,440],[440,274],[274,457],[301,300],[300,368],[368,301],[417,351],[351,465],[465,417],[251,301],[301,389],[389,251],[394,395],[395,379],[379,394],[399,412],[412,419],[419,399],[410,436],[436,322],[322,410],[326,2],[2,393],[393,326],[354,370],[370,461],[461,354],[393,164],[164,267],[267,393],[268,302],[302,12],[12,268],[312,268],[268,13],[13,312],[298,293],[293,301],[301,298],[265,446],[446,340],[340,265],[280,330],[330,425],[425,280],[322,426],[426,391],[391,322],[420,429],[429,437],[437,420],[393,391],[391,326],[326,393],[344,440],[440,438],[438,344],[458,459],[459,461],[461,458],[364,434],[434,394],[394,364],[428,396],[396,262],[262,428],[274,354],[354,457],[457,274],[317,316],[316,402],[402,317],[316,315],[315,403],[403,316],[315,314],[314,404],[404,315],[314,313],[313,405],[405,314],[313,421],[421,406],[406,313],[323,366],[366,361],[361,323],[292,306],[306,407],[407,292],[306,291],[291,408],[408,306],[291,287],[287,409],[409,291],[287,432],[432,410],[410,287],[427,434],[434,411],[411,427],[372,264],[264,383],[383,372],[459,309],[309,457],[457,459],[366,352],[352,401],[401,366],[1,274],[274,4],[4,1],[418,421],[421,262],[262,418],[331,294],[294,358],[358,331],[435,433],[433,367],[367,435],[392,289],[289,439],[439,392],[328,462],[462,326],[326,328],[94,2],[2,370],[370,94],[289,305],[305,455],[455,289],[339,254],[254,448],[448,339],[359,255],[255,446],[446,359],[254,253],[253,449],[449,254],[253,252],[252,450],[450,253],[252,256],[256,451],[451,252],[256,341],[341,452],[452,256],[414,413],[413,463],[463,414],[286,441],[441,414],[414,286],[286,258],[258,441],[441,286],[258,257],[257,442],[442,258],[257,259],[259,443],[443,257],[259,260],[260,444],[444,259],[260,467],[467,445],[445,260],[309,459],[459,250],[250,309],[305,289],[289,290],[290,305],[305,290],[290,460],[460,305],[401,376],[376,435],[435,401],[309,250],[250,392],[392,309],[376,411],[411,433],[433,376],[453,341],[341,464],[464,453],[357,453],[453,465],[465,357],[343,357],[357,412],[412,343],[437,343],[343,399],[399,437],[344,360],[360,440],[440,344],[420,437],[437,456],[456,420],[360,420],[420,363],[363,360],[361,401],[401,288],[288,361],[265,372],[372,353],[353,265],[390,339],[339,249],[249,390],[339,448],[448,255],[255,339]);function Wl(e){e.j={faceLandmarks:[],faceBlendshapes:[],facialTransformationMatrixes:[]}}var Z=class extends Pt{constructor(e,t){super(new Wt(e,t),"image_in","norm_rect",!1),this.j={faceLandmarks:[],faceBlendshapes:[],facialTransformationMatrixes:[]},this.outputFacialTransformationMatrixes=this.outputFaceBlendshapes=!1,I(e=this.h=new oc,0,1,t=new K),this.v=new nc,I(this.h,0,3,this.v),this.s=new br,I(this.h,0,2,this.s),oe(this.s,4,1),v(this.s,2,.5),v(this.v,2,.5),v(this.h,4,.5)}get baseOptions(){return O(this.h,K,1)}set baseOptions(e){I(this.h,0,1,e)}o(e){return"numFaces"in e&&oe(this.s,4,e.numFaces??1),"minFaceDetectionConfidence"in e&&v(this.s,2,e.minFaceDetectionConfidence??.5),"minTrackingConfidence"in e&&v(this.h,4,e.minTrackingConfidence??.5),"minFacePresenceConfidence"in e&&v(this.v,2,e.minFacePresenceConfidence??.5),"outputFaceBlendshapes"in e&&(this.outputFaceBlendshapes=!!e.outputFaceBlendshapes),"outputFacialTransformationMatrixes"in e&&(this.outputFacialTransformationMatrixes=!!e.outputFacialTransformationMatrixes),this.l(e)}D(e,t){return Wl(this),$t(this,e,t),this.j}F(e,t,i){return Wl(this),le(this,e,i,t),this.j}m(){var e=new wt;W(e,"image_in"),W(e,"norm_rect"),N(e,"face_landmarks");const t=new Rt;Zt(t,q_,this.h);const i=new pt;Lt(i,"mediapipe.tasks.vision.face_landmarker.FaceLandmarkerGraph"),j(i,"IMAGE:image_in"),j(i,"NORM_RECT:norm_rect"),L(i,"NORM_LANDMARKS:face_landmarks"),i.o(t),kt(e,i),this.g.attachProtoVectorListener("face_landmarks",(s,r)=>{for(const a of s)s=Ss(a),this.j.faceLandmarks.push(Mr(s));p(this,r)}),this.g.attachEmptyPacketListener("face_landmarks",s=>{p(this,s)}),this.outputFaceBlendshapes&&(N(e,"blendshapes"),L(i,"BLENDSHAPES:blendshapes"),this.g.attachProtoVectorListener("blendshapes",(s,r)=>{if(this.outputFaceBlendshapes)for(const a of s)s=vr(a),this.j.faceBlendshapes.push(Pn(s.g()??[]));p(this,r)}),this.g.attachEmptyPacketListener("blendshapes",s=>{p(this,s)})),this.outputFacialTransformationMatrixes&&(N(e,"face_geometry"),L(i,"FACE_GEOMETRY:face_geometry"),this.g.attachProtoVectorListener("face_geometry",(s,r)=>{if(this.outputFacialTransformationMatrixes)for(const a of s)(s=O($_(a),N_,2))&&this.j.facialTransformationMatrixes.push({rows:Gt(s,1)??0??0,columns:Gt(s,2)??0??0,data:je(s,3,Ve,Xe()).slice()??[]});p(this,r)}),this.g.attachEmptyPacketListener("face_geometry",s=>{p(this,s)})),e=e.g(),this.setGraph(new Uint8Array(e),!0)}};Z.prototype.detectForVideo=Z.prototype.F,Z.prototype.detect=Z.prototype.D,Z.prototype.setOptions=Z.prototype.o,Z.createFromModelPath=function(e,t){return V(Z,e,{baseOptions:{modelAssetPath:t}})},Z.createFromModelBuffer=function(e,t){return V(Z,e,{baseOptions:{modelAssetBuffer:t}})},Z.createFromOptions=function(e,t){return V(Z,e,t)},Z.FACE_LANDMARKS_LIPS=Tn,Z.FACE_LANDMARKS_LEFT_EYE=An,Z.FACE_LANDMARKS_LEFT_EYEBROW=Rn,Z.FACE_LANDMARKS_LEFT_IRIS=Vc,Z.FACE_LANDMARKS_RIGHT_EYE=Vn,Z.FACE_LANDMARKS_RIGHT_EYEBROW=Ln,Z.FACE_LANDMARKS_RIGHT_IRIS=Lc,Z.FACE_LANDMARKS_FACE_OVAL=kn,Z.FACE_LANDMARKS_CONTOURS=kc,Z.FACE_LANDMARKS_TESSELATION=Dc;var se=class extends Pt{constructor(e,t){super(new Wt(e,t),"image_in","norm_rect",!0),I(e=this.j=new hc,0,1,t=new K)}get baseOptions(){return O(this.j,K,1)}set baseOptions(e){I(this.j,0,1,e)}o(e){return super.l(e)}Oa(e,t,i){const s=typeof t!="function"?t:{};if(this.h=typeof t=="function"?t:i,$t(this,e,s??{}),!this.h)return this.s}m(){var e=new wt;W(e,"image_in"),W(e,"norm_rect"),N(e,"stylized_image");const t=new Rt;Zt(t,J_,this.j);const i=new pt;Lt(i,"mediapipe.tasks.vision.face_stylizer.FaceStylizerGraph"),j(i,"IMAGE:image_in"),j(i,"NORM_RECT:norm_rect"),L(i,"STYLIZED_IMAGE:stylized_image"),i.o(t),kt(e,i),this.g.U("stylized_image",(s,r)=>{var a=!this.h,n=s.data,o=s.width;const l=o*(s=s.height);if(n instanceof Uint8Array)if(n.length===3*l){const h=new Uint8ClampedArray(4*l);for(let u=0;u<l;++u)h[4*u]=n[3*u],h[4*u+1]=n[3*u+1],h[4*u+2]=n[3*u+2],h[4*u+3]=255;n=new ImageData(h,o,s)}else{if(n.length!==4*l)throw Error("Unsupported channel count: "+n.length/l);n=new ImageData(new Uint8ClampedArray(n.buffer,n.byteOffset,n.length),o,s)}else if(!(n instanceof WebGLTexture))throw Error(`Unsupported format: ${n.constructor.name}`);o=new ct([n],!1,!1,this.g.i.canvas,this.O,o,s),this.s=a=a?o.clone():o,this.h&&this.h(a),p(this,r)}),this.g.attachEmptyPacketListener("stylized_image",s=>{this.s=null,this.h&&this.h(null),p(this,s)}),e=e.g(),this.setGraph(new Uint8Array(e),!0)}};se.prototype.stylize=se.prototype.Oa,se.prototype.setOptions=se.prototype.o,se.createFromModelPath=function(e,t){return V(se,e,{baseOptions:{modelAssetPath:t}})},se.createFromModelBuffer=function(e,t){return V(se,e,{baseOptions:{modelAssetBuffer:t}})},se.createFromOptions=function(e,t){return V(se,e,t)};var Dn=ee([0,1],[1,2],[2,3],[3,4],[0,5],[5,6],[6,7],[7,8],[5,9],[9,10],[10,11],[11,12],[9,13],[13,14],[14,15],[15,16],[13,17],[0,17],[17,18],[18,19],[19,20]);function $l(e){e.gestures=[],e.landmarks=[],e.worldLandmarks=[],e.handedness=[]}function ql(e){return e.gestures.length===0?{gestures:[],landmarks:[],worldLandmarks:[],handedness:[],handednesses:[]}:{gestures:e.gestures,landmarks:e.landmarks,worldLandmarks:e.worldLandmarks,handedness:e.handedness,handednesses:e.handedness}}function Jl(e,t=!0){const i=[];for(const r of e){var s=vr(r);e=[];for(const a of s.g())s=t&&Gt(a,1)!=null?Gt(a,1)??0:-1,e.push({score:it(a,2)??0,index:s,categoryName:Yt(a,3)??""??"",displayName:Yt(a,4)??""??""});i.push(e)}return i}var It=class extends Pt{constructor(e,t){super(new Wt(e,t),"image_in","norm_rect",!1),this.gestures=[],this.landmarks=[],this.worldLandmarks=[],this.handedness=[],I(e=this.j=new gc,0,1,t=new K),this.s=new Cn,I(this.j,0,2,this.s),this.C=new xn,I(this.s,0,3,this.C),this.v=new cc,I(this.s,0,2,this.v),this.h=new K_,I(this.j,0,3,this.h),v(this.v,2,.5),v(this.s,4,.5),v(this.C,2,.5)}get baseOptions(){return O(this.j,K,1)}set baseOptions(e){I(this.j,0,1,e)}o(e){var r,a,n,o;if(oe(this.v,3,e.numHands??1),"minHandDetectionConfidence"in e&&v(this.v,2,e.minHandDetectionConfidence??.5),"minTrackingConfidence"in e&&v(this.s,4,e.minTrackingConfidence??.5),"minHandPresenceConfidence"in e&&v(this.C,2,e.minHandPresenceConfidence??.5),e.cannedGesturesClassifierOptions){var t=new si,i=t,s=pa(e.cannedGesturesClassifierOptions,(r=O(this.h,si,3))==null?void 0:r.h());I(i,0,2,s),I(this.h,0,3,t)}else e.cannedGesturesClassifierOptions===void 0&&((a=O(this.h,si,3))==null||a.g());return e.customGesturesClassifierOptions?(I(i=t=new si,0,2,s=pa(e.customGesturesClassifierOptions,(n=O(this.h,si,4))==null?void 0:n.h())),I(this.h,0,4,t)):e.customGesturesClassifierOptions===void 0&&((o=O(this.h,si,4))==null||o.g()),this.l(e)}Ja(e,t){return $l(this),$t(this,e,t),ql(this)}Ka(e,t,i){return $l(this),le(this,e,i,t),ql(this)}m(){var e=new wt;W(e,"image_in"),W(e,"norm_rect"),N(e,"hand_gestures"),N(e,"hand_landmarks"),N(e,"world_hand_landmarks"),N(e,"handedness");const t=new Rt;Zt(t,Z_,this.j);const i=new pt;Lt(i,"mediapipe.tasks.vision.gesture_recognizer.GestureRecognizerGraph"),j(i,"IMAGE:image_in"),j(i,"NORM_RECT:norm_rect"),L(i,"HAND_GESTURES:hand_gestures"),L(i,"LANDMARKS:hand_landmarks"),L(i,"WORLD_LANDMARKS:world_hand_landmarks"),L(i,"HANDEDNESS:handedness"),i.o(t),kt(e,i),this.g.attachProtoVectorListener("hand_landmarks",(s,r)=>{for(const a of s){s=Ss(a);const n=[];for(const o of Se(s,ec,1))n.push({x:it(o,1)??0,y:it(o,2)??0,z:it(o,3)??0,visibility:it(o,4)??0});this.landmarks.push(n)}p(this,r)}),this.g.attachEmptyPacketListener("hand_landmarks",s=>{p(this,s)}),this.g.attachProtoVectorListener("world_hand_landmarks",(s,r)=>{for(const a of s){s=pi(a);const n=[];for(const o of Se(s,tc,1))n.push({x:it(o,1)??0,y:it(o,2)??0,z:it(o,3)??0,visibility:it(o,4)??0});this.worldLandmarks.push(n)}p(this,r)}),this.g.attachEmptyPacketListener("world_hand_landmarks",s=>{p(this,s)}),this.g.attachProtoVectorListener("hand_gestures",(s,r)=>{this.gestures.push(...Jl(s,!1)),p(this,r)}),this.g.attachEmptyPacketListener("hand_gestures",s=>{p(this,s)}),this.g.attachProtoVectorListener("handedness",(s,r)=>{this.handedness.push(...Jl(s)),p(this,r)}),this.g.attachEmptyPacketListener("handedness",s=>{p(this,s)}),e=e.g(),this.setGraph(new Uint8Array(e),!0)}};function Kl(e){return{landmarks:e.landmarks,worldLandmarks:e.worldLandmarks,handednesses:e.handedness,handedness:e.handedness}}It.prototype.recognizeForVideo=It.prototype.Ka,It.prototype.recognize=It.prototype.Ja,It.prototype.setOptions=It.prototype.o,It.createFromModelPath=function(e,t){return V(It,e,{baseOptions:{modelAssetPath:t}})},It.createFromModelBuffer=function(e,t){return V(It,e,{baseOptions:{modelAssetBuffer:t}})},It.createFromOptions=function(e,t){return V(It,e,t)},It.HAND_CONNECTIONS=Dn;var Et=class extends Pt{constructor(e,t){super(new Wt(e,t),"image_in","norm_rect",!1),this.landmarks=[],this.worldLandmarks=[],this.handedness=[],I(e=this.h=new Cn,0,1,t=new K),this.s=new xn,I(this.h,0,3,this.s),this.j=new cc,I(this.h,0,2,this.j),oe(this.j,3,1),v(this.j,2,.5),v(this.s,2,.5),v(this.h,4,.5)}get baseOptions(){return O(this.h,K,1)}set baseOptions(e){I(this.h,0,1,e)}o(e){return"numHands"in e&&oe(this.j,3,e.numHands??1),"minHandDetectionConfidence"in e&&v(this.j,2,e.minHandDetectionConfidence??.5),"minTrackingConfidence"in e&&v(this.h,4,e.minTrackingConfidence??.5),"minHandPresenceConfidence"in e&&v(this.s,2,e.minHandPresenceConfidence??.5),this.l(e)}D(e,t){return this.landmarks=[],this.worldLandmarks=[],this.handedness=[],$t(this,e,t),Kl(this)}F(e,t,i){return this.landmarks=[],this.worldLandmarks=[],this.handedness=[],le(this,e,i,t),Kl(this)}m(){var e=new wt;W(e,"image_in"),W(e,"norm_rect"),N(e,"hand_landmarks"),N(e,"world_hand_landmarks"),N(e,"handedness");const t=new Rt;Zt(t,Q_,this.h);const i=new pt;Lt(i,"mediapipe.tasks.vision.hand_landmarker.HandLandmarkerGraph"),j(i,"IMAGE:image_in"),j(i,"NORM_RECT:norm_rect"),L(i,"LANDMARKS:hand_landmarks"),L(i,"WORLD_LANDMARKS:world_hand_landmarks"),L(i,"HANDEDNESS:handedness"),i.o(t),kt(e,i),this.g.attachProtoVectorListener("hand_landmarks",(s,r)=>{for(const a of s)s=Ss(a),this.landmarks.push(Mr(s));p(this,r)}),this.g.attachEmptyPacketListener("hand_landmarks",s=>{p(this,s)}),this.g.attachProtoVectorListener("world_hand_landmarks",(s,r)=>{for(const a of s)s=pi(a),this.worldLandmarks.push(Ji(s));p(this,r)}),this.g.attachEmptyPacketListener("world_hand_landmarks",s=>{p(this,s)}),this.g.attachProtoVectorListener("handedness",(s,r)=>{var a=this.handedness,n=a.push;const o=[];for(const l of s){s=vr(l);const h=[];for(const u of s.g())h.push({score:it(u,2)??0,index:Gt(u,1)??0??-1,categoryName:Yt(u,3)??""??"",displayName:Yt(u,4)??""??""});o.push(h)}n.call(a,...o),p(this,r)}),this.g.attachEmptyPacketListener("handedness",s=>{p(this,s)}),e=e.g(),this.setGraph(new Uint8Array(e),!0)}};Et.prototype.detectForVideo=Et.prototype.F,Et.prototype.detect=Et.prototype.D,Et.prototype.setOptions=Et.prototype.o,Et.createFromModelPath=function(e,t){return V(Et,e,{baseOptions:{modelAssetPath:t}})},Et.createFromModelBuffer=function(e,t){return V(Et,e,{baseOptions:{modelAssetBuffer:t}})},Et.createFromOptions=function(e,t){return V(Et,e,t)},Et.HAND_CONNECTIONS=Dn;var Oc=ee([0,1],[1,2],[2,3],[3,7],[0,4],[4,5],[5,6],[6,8],[9,10],[11,12],[11,13],[13,15],[15,17],[15,19],[15,21],[17,19],[12,14],[14,16],[16,18],[16,20],[16,22],[18,20],[11,23],[12,24],[23,24],[23,25],[24,26],[25,27],[26,28],[27,29],[28,30],[29,31],[30,32],[27,31],[28,32]);function Zl(e){e.h={faceLandmarks:[],faceBlendshapes:[],poseLandmarks:[],poseWorldLandmarks:[],poseSegmentationMasks:[],leftHandLandmarks:[],leftHandWorldLandmarks:[],rightHandLandmarks:[],rightHandWorldLandmarks:[]}}function Ql(e){try{if(!e.C)return e.h;e.C(e.h)}finally{wr(e)}}function Fs(e,t){e=Ss(e),t.push(Mr(e))}var $=class extends Pt{constructor(e,t){super(new Wt(e,t),"input_frames_image",null,!1),this.h={faceLandmarks:[],faceBlendshapes:[],poseLandmarks:[],poseWorldLandmarks:[],poseSegmentationMasks:[],leftHandLandmarks:[],leftHandWorldLandmarks:[],rightHandLandmarks:[],rightHandWorldLandmarks:[]},this.outputPoseSegmentationMasks=this.outputFaceBlendshapes=!1,I(e=this.j=new pc,0,1,t=new K),this.J=new xn,I(this.j,0,2,this.J),this.Z=new tf,I(this.j,0,3,this.Z),this.s=new br,I(this.j,0,4,this.s),this.H=new nc,I(this.j,0,5,this.H),this.v=new fc,I(this.j,0,6,this.v),this.K=new mc,I(this.j,0,7,this.K),v(this.s,2,.5),v(this.s,3,.3),v(this.H,2,.5),v(this.v,2,.5),v(this.v,3,.3),v(this.K,2,.5),v(this.J,2,.5)}get baseOptions(){return O(this.j,K,1)}set baseOptions(e){I(this.j,0,1,e)}o(e){return"minFaceDetectionConfidence"in e&&v(this.s,2,e.minFaceDetectionConfidence??.5),"minFaceSuppressionThreshold"in e&&v(this.s,3,e.minFaceSuppressionThreshold??.3),"minFacePresenceConfidence"in e&&v(this.H,2,e.minFacePresenceConfidence??.5),"outputFaceBlendshapes"in e&&(this.outputFaceBlendshapes=!!e.outputFaceBlendshapes),"minPoseDetectionConfidence"in e&&v(this.v,2,e.minPoseDetectionConfidence??.5),"minPoseSuppressionThreshold"in e&&v(this.v,3,e.minPoseSuppressionThreshold??.3),"minPosePresenceConfidence"in e&&v(this.K,2,e.minPosePresenceConfidence??.5),"outputPoseSegmentationMasks"in e&&(this.outputPoseSegmentationMasks=!!e.outputPoseSegmentationMasks),"minHandLandmarksConfidence"in e&&v(this.J,2,e.minHandLandmarksConfidence??.5),this.l(e)}D(e,t,i){const s=typeof t!="function"?t:{};return this.C=typeof t=="function"?t:i,Zl(this),$t(this,e,s),Ql(this)}F(e,t,i,s){const r=typeof i!="function"?i:{};return this.C=typeof i=="function"?i:s,Zl(this),le(this,e,r,t),Ql(this)}m(){var e=new wt;W(e,"input_frames_image"),N(e,"pose_landmarks"),N(e,"pose_world_landmarks"),N(e,"face_landmarks"),N(e,"left_hand_landmarks"),N(e,"left_hand_world_landmarks"),N(e,"right_hand_landmarks"),N(e,"right_hand_world_landmarks");const t=new Rt,i=new vl;ca(i,1,Ai("type.googleapis.com/mediapipe.tasks.vision.holistic_landmarker.proto.HolisticLandmarkerGraphOptions"),""),function(r,a){if(a!=null)if(Array.isArray(a))X(r,2,cu(a));else{if(!(typeof a=="string"||a instanceof me||fs(a)))throw Error("invalid value in Any.value field: "+a+" expected a ByteString, a base64 encoded string, a Uint8Array or a jspb array");ca(r,2,Da(a,!1),$e())}}(i,this.j.g());const s=new pt;Lt(s,"mediapipe.tasks.vision.holistic_landmarker.HolisticLandmarkerGraph"),qs(s,8,vl,i),j(s,"IMAGE:input_frames_image"),L(s,"POSE_LANDMARKS:pose_landmarks"),L(s,"POSE_WORLD_LANDMARKS:pose_world_landmarks"),L(s,"FACE_LANDMARKS:face_landmarks"),L(s,"LEFT_HAND_LANDMARKS:left_hand_landmarks"),L(s,"LEFT_HAND_WORLD_LANDMARKS:left_hand_world_landmarks"),L(s,"RIGHT_HAND_LANDMARKS:right_hand_landmarks"),L(s,"RIGHT_HAND_WORLD_LANDMARKS:right_hand_world_landmarks"),s.o(t),kt(e,s),Pr(this,e),this.g.attachProtoListener("pose_landmarks",(r,a)=>{Fs(r,this.h.poseLandmarks),p(this,a)}),this.g.attachEmptyPacketListener("pose_landmarks",r=>{p(this,r)}),this.g.attachProtoListener("pose_world_landmarks",(r,a)=>{var n=this.h.poseWorldLandmarks;r=pi(r),n.push(Ji(r)),p(this,a)}),this.g.attachEmptyPacketListener("pose_world_landmarks",r=>{p(this,r)}),this.outputPoseSegmentationMasks&&(L(s,"POSE_SEGMENTATION_MASK:pose_segmentation_mask"),wi(this,"pose_segmentation_mask"),this.g.U("pose_segmentation_mask",(r,a)=>{this.h.poseSegmentationMasks=[Ei(this,r,!0,!this.C)],p(this,a)}),this.g.attachEmptyPacketListener("pose_segmentation_mask",r=>{this.h.poseSegmentationMasks=[],p(this,r)})),this.g.attachProtoListener("face_landmarks",(r,a)=>{Fs(r,this.h.faceLandmarks),p(this,a)}),this.g.attachEmptyPacketListener("face_landmarks",r=>{p(this,r)}),this.outputFaceBlendshapes&&(N(e,"extra_blendshapes"),L(s,"FACE_BLENDSHAPES:extra_blendshapes"),this.g.attachProtoListener("extra_blendshapes",(r,a)=>{var n=this.h.faceBlendshapes;this.outputFaceBlendshapes&&(r=vr(r),n.push(Pn(r.g()??[]))),p(this,a)}),this.g.attachEmptyPacketListener("extra_blendshapes",r=>{p(this,r)})),this.g.attachProtoListener("left_hand_landmarks",(r,a)=>{Fs(r,this.h.leftHandLandmarks),p(this,a)}),this.g.attachEmptyPacketListener("left_hand_landmarks",r=>{p(this,r)}),this.g.attachProtoListener("left_hand_world_landmarks",(r,a)=>{var n=this.h.leftHandWorldLandmarks;r=pi(r),n.push(Ji(r)),p(this,a)}),this.g.attachEmptyPacketListener("left_hand_world_landmarks",r=>{p(this,r)}),this.g.attachProtoListener("right_hand_landmarks",(r,a)=>{Fs(r,this.h.rightHandLandmarks),p(this,a)}),this.g.attachEmptyPacketListener("right_hand_landmarks",r=>{p(this,r)}),this.g.attachProtoListener("right_hand_world_landmarks",(r,a)=>{var n=this.h.rightHandWorldLandmarks;r=pi(r),n.push(Ji(r)),p(this,a)}),this.g.attachEmptyPacketListener("right_hand_world_landmarks",r=>{p(this,r)}),e=e.g(),this.setGraph(new Uint8Array(e),!0)}};$.prototype.detectForVideo=$.prototype.F,$.prototype.detect=$.prototype.D,$.prototype.setOptions=$.prototype.o,$.createFromModelPath=function(e,t){return V($,e,{baseOptions:{modelAssetPath:t}})},$.createFromModelBuffer=function(e,t){return V($,e,{baseOptions:{modelAssetBuffer:t}})},$.createFromOptions=function(e,t){return V($,e,t)},$.HAND_CONNECTIONS=Dn,$.POSE_CONNECTIONS=Oc,$.FACE_LANDMARKS_LIPS=Tn,$.FACE_LANDMARKS_LEFT_EYE=An,$.FACE_LANDMARKS_LEFT_EYEBROW=Rn,$.FACE_LANDMARKS_LEFT_IRIS=Vc,$.FACE_LANDMARKS_RIGHT_EYE=Vn,$.FACE_LANDMARKS_RIGHT_EYEBROW=Ln,$.FACE_LANDMARKS_RIGHT_IRIS=Lc,$.FACE_LANDMARKS_FACE_OVAL=kn,$.FACE_LANDMARKS_CONTOURS=kc,$.FACE_LANDMARKS_TESSELATION=Dc;var Ot=class extends Pt{constructor(e,t){super(new Wt(e,t),"input_image","norm_rect",!0),this.j={classifications:[]},I(e=this.h=new yc,0,1,t=new K)}get baseOptions(){return O(this.h,K,1)}set baseOptions(e){I(this.h,0,1,e)}o(e){return I(this.h,0,2,pa(e,O(this.h,pn,2))),this.l(e)}sa(e,t){return this.j={classifications:[]},$t(this,e,t),this.j}ta(e,t,i){return this.j={classifications:[]},le(this,e,i,t),this.j}m(){var e=new wt;W(e,"input_image"),W(e,"norm_rect"),N(e,"classifications");const t=new Rt;Zt(t,ef,this.h);const i=new pt;Lt(i,"mediapipe.tasks.vision.image_classifier.ImageClassifierGraph"),j(i,"IMAGE:input_image"),j(i,"NORM_RECT:norm_rect"),L(i,"CLASSIFICATIONS:classifications"),i.o(t),kt(e,i),this.g.attachProtoListener("classifications",(s,r)=>{this.j=function(a){const n={classifications:Se(a,z_,1).map(o=>{var l;return Pn(((l=O(o,Ku,4))==null?void 0:l.g())??[],Gt(o,2)??0,Yt(o,3)??"")})};return $s(Mi(a,2))!=null&&(n.timestampMs=$s(Mi(a,2))??0),n}(G_(s)),p(this,r)}),this.g.attachEmptyPacketListener("classifications",s=>{p(this,s)}),e=e.g(),this.setGraph(new Uint8Array(e),!0)}};Ot.prototype.classifyForVideo=Ot.prototype.ta,Ot.prototype.classify=Ot.prototype.sa,Ot.prototype.setOptions=Ot.prototype.o,Ot.createFromModelPath=function(e,t){return V(Ot,e,{baseOptions:{modelAssetPath:t}})},Ot.createFromModelBuffer=function(e,t){return V(Ot,e,{baseOptions:{modelAssetBuffer:t}})},Ot.createFromOptions=function(e,t){return V(Ot,e,t)};var Ft=class extends Pt{constructor(e,t){super(new Wt(e,t),"image_in","norm_rect",!0),this.h=new Sc,this.embeddings={embeddings:[]},I(e=this.h,0,1,t=new K)}get baseOptions(){return O(this.h,K,1)}set baseOptions(e){I(this.h,0,1,e)}o(e){var t=this.h,i=O(this.h,Tl,2);return i=i?i.clone():new Tl,e.l2Normalize!==void 0?us(i,1,e.l2Normalize):"l2Normalize"in e&&X(i,1),e.quantize!==void 0?us(i,2,e.quantize):"quantize"in e&&X(i,2),I(t,0,2,i),this.l(e)}za(e,t){return $t(this,e,t),this.embeddings}Aa(e,t,i){return le(this,e,i,t),this.embeddings}m(){var e=new wt;W(e,"image_in"),W(e,"norm_rect"),N(e,"embeddings_out");const t=new Rt;Zt(t,sf,this.h);const i=new pt;Lt(i,"mediapipe.tasks.vision.image_embedder.ImageEmbedderGraph"),j(i,"IMAGE:image_in"),j(i,"NORM_RECT:norm_rect"),L(i,"EMBEDDINGS:embeddings_out"),i.o(t),kt(e,i),this.g.attachProtoListener("embeddings_out",(s,r)=>{s=Y_(s),this.embeddings=function(a){return{embeddings:Se(a,j_,1).map(n=>{var l,h;const o={headIndex:Gt(n,3)??0??-1,headName:Yt(n,4)??""??""};if(mu(n,Fl,Wr(n,1))!==void 0)n=je(n=O(n,Fl,Wr(n,1)),1,Ve,Xe()),o.floatEmbedding=n.slice();else{const u=new Uint8Array(0);o.quantizedEmbedding=((h=(l=O(n,X_,Wr(n,2)))==null?void 0:l.oa())==null?void 0:h.h())??u}return o}),timestampMs:$s(Mi(a,2))??0}}(s),p(this,r)}),this.g.attachEmptyPacketListener("embeddings_out",s=>{p(this,s)}),e=e.g(),this.setGraph(new Uint8Array(e),!0)}};Ft.cosineSimilarity=function(e,t){if(e.floatEmbedding&&t.floatEmbedding)e=kl(e.floatEmbedding,t.floatEmbedding);else{if(!e.quantizedEmbedding||!t.quantizedEmbedding)throw Error("Cannot compute cosine similarity between quantized and float embeddings.");e=kl(Ll(e.quantizedEmbedding),Ll(t.quantizedEmbedding))}return e},Ft.prototype.embedForVideo=Ft.prototype.Aa,Ft.prototype.embed=Ft.prototype.za,Ft.prototype.setOptions=Ft.prototype.o,Ft.createFromModelPath=function(e,t){return V(Ft,e,{baseOptions:{modelAssetPath:t}})},Ft.createFromModelBuffer=function(e,t){return V(Ft,e,{baseOptions:{modelAssetBuffer:t}})},Ft.createFromOptions=function(e,t){return V(Ft,e,t)};var xa=class{constructor(e,t,i){this.confidenceMasks=e,this.categoryMask=t,this.qualityScores=i}close(){var e,t;(e=this.confidenceMasks)==null||e.forEach(i=>{i.close()}),(t=this.categoryMask)==null||t.close()}};function th(e){e.categoryMask=void 0,e.confidenceMasks=void 0,e.qualityScores=void 0}function eh(e){try{const t=new xa(e.confidenceMasks,e.categoryMask,e.qualityScores);if(!e.j)return t;e.j(t)}finally{wr(e)}}xa.prototype.close=xa.prototype.close;var Ct=class extends Pt{constructor(e,t){super(new Wt(e,t),"image_in","norm_rect",!1),this.s=[],this.outputCategoryMask=!1,this.outputConfidenceMasks=!0,this.h=new Mn,this.v=new xc,I(this.h,0,3,this.v),I(e=this.h,0,1,t=new K)}get baseOptions(){return O(this.h,K,1)}set baseOptions(e){I(this.h,0,1,e)}o(e){return e.displayNamesLocale!==void 0?X(this.h,2,Ai(e.displayNamesLocale)):"displayNamesLocale"in e&&X(this.h,2),"outputCategoryMask"in e&&(this.outputCategoryMask=e.outputCategoryMask??!1),"outputConfidenceMasks"in e&&(this.outputConfidenceMasks=e.outputConfidenceMasks??!0),super.l(e)}I(){(function(e){var i,s;const t=Se(e.da(),pt,1).filter(r=>(Yt(r,1)??"").includes("mediapipe.tasks.TensorsToSegmentationCalculator"));if(e.s=[],t.length>1)throw Error("The graph has more than one mediapipe.tasks.TensorsToSegmentationCalculator.");t.length===1&&(((s=(i=O(t[0],Rt,7))==null?void 0:i.l())==null?void 0:s.g())??new Map).forEach((r,a)=>{e.s[Number(a)]=Yt(r,1)??""})})(this)}segment(e,t,i){const s=typeof t!="function"?t:{};return this.j=typeof t=="function"?t:i,th(this),$t(this,e,s),eh(this)}Ma(e,t,i,s){const r=typeof i!="function"?i:{};return this.j=typeof i=="function"?i:s,th(this),le(this,e,r,t),eh(this)}Da(){return this.s}m(){var e=new wt;W(e,"image_in"),W(e,"norm_rect");const t=new Rt;Zt(t,vc,this.h);const i=new pt;Lt(i,"mediapipe.tasks.vision.image_segmenter.ImageSegmenterGraph"),j(i,"IMAGE:image_in"),j(i,"NORM_RECT:norm_rect"),i.o(t),kt(e,i),Pr(this,e),this.outputConfidenceMasks&&(N(e,"confidence_masks"),L(i,"CONFIDENCE_MASKS:confidence_masks"),wi(this,"confidence_masks"),this.g.ca("confidence_masks",(s,r)=>{this.confidenceMasks=s.map(a=>Ei(this,a,!0,!this.j)),p(this,r)}),this.g.attachEmptyPacketListener("confidence_masks",s=>{this.confidenceMasks=[],p(this,s)})),this.outputCategoryMask&&(N(e,"category_mask"),L(i,"CATEGORY_MASK:category_mask"),wi(this,"category_mask"),this.g.U("category_mask",(s,r)=>{this.categoryMask=Ei(this,s,!1,!this.j),p(this,r)}),this.g.attachEmptyPacketListener("category_mask",s=>{this.categoryMask=void 0,p(this,s)})),N(e,"quality_scores"),L(i,"QUALITY_SCORES:quality_scores"),this.g.attachFloatVectorListener("quality_scores",(s,r)=>{this.qualityScores=s,p(this,r)}),this.g.attachEmptyPacketListener("quality_scores",s=>{this.categoryMask=void 0,p(this,s)}),e=e.g(),this.setGraph(new Uint8Array(e),!0)}};Ct.prototype.getLabels=Ct.prototype.Da,Ct.prototype.segmentForVideo=Ct.prototype.Ma,Ct.prototype.segment=Ct.prototype.segment,Ct.prototype.setOptions=Ct.prototype.o,Ct.createFromModelPath=function(e,t){return V(Ct,e,{baseOptions:{modelAssetPath:t}})},Ct.createFromModelBuffer=function(e,t){return V(Ct,e,{baseOptions:{modelAssetBuffer:t}})},Ct.createFromOptions=function(e,t){return V(Ct,e,t)};var Ca=class{constructor(e,t,i){this.confidenceMasks=e,this.categoryMask=t,this.qualityScores=i}close(){var e,t;(e=this.confidenceMasks)==null||e.forEach(i=>{i.close()}),(t=this.categoryMask)==null||t.close()}};Ca.prototype.close=Ca.prototype.close;var cf=class extends S{constructor(e){super(e)}},ri=[0,et,-2],Qs=[0,ge,-3,J,ge,-1],ih=[0,Qs],sh=[0,Qs,et,-1],Qr=class extends S{constructor(e){super(e)}},rh=[0,ge,-1,J],gf=class extends S{constructor(e){super(e)}},ah=class extends S{constructor(e){super(e)}},va=[1,2,3,4,5,6,7,8,9,10,14,15],Nc=class extends S{constructor(e){super(e)}};Nc.prototype.g=Cr([0,ht,[0,va,z,Qs,z,[0,Qs,ri],z,ih,z,[0,ih,ri],z,rh,z,[0,ge,-3,J,Ht],z,[0,ge,-3,J],z,[0,U,ge,-2,J,et,J,-1,2,ge,ri],z,sh,z,[0,sh,ri],ge,ri,U,z,[0,ge,-3,J,ri,-1],z,[0,ht,rh]],U,[0,U,et,-1,J]]);var re=class extends Pt{constructor(e,t){super(new Wt(e,t),"image_in","norm_rect_in",!1),this.outputCategoryMask=!1,this.outputConfidenceMasks=!0,this.h=new Mn,this.s=new xc,I(this.h,0,3,this.s),I(e=this.h,0,1,t=new K)}get baseOptions(){return O(this.h,K,1)}set baseOptions(e){I(this.h,0,1,e)}o(e){return"outputCategoryMask"in e&&(this.outputCategoryMask=e.outputCategoryMask??!1),"outputConfidenceMasks"in e&&(this.outputConfidenceMasks=e.outputConfidenceMasks??!0),super.l(e)}segment(e,t,i,s){const r=typeof i!="function"?i:{};this.j=typeof i=="function"?i:s,this.qualityScores=this.categoryMask=this.confidenceMasks=void 0,i=this.B+1,s=new Nc;const a=new ah;var n=new cf;if(oe(n,1,255),I(a,0,12,n),t.keypoint&&t.scribble)throw Error("Cannot provide both keypoint and scribble.");if(t.keypoint){var o=new Qr;us(o,3,!0),v(o,1,t.keypoint.x),v(o,2,t.keypoint.y),$i(a,5,va,o)}else{if(!t.scribble)throw Error("Must provide either a keypoint or a scribble.");for(o of(n=new gf,t.scribble))us(t=new Qr,3,!0),v(t,1,o.x),v(t,2,o.y),qs(n,1,Qr,t);$i(a,15,va,n)}qs(s,1,ah,a),this.g.addProtoToStream(s.g(),"drishti.RenderData","roi_in",i),$t(this,e,r);t:{try{const h=new Ca(this.confidenceMasks,this.categoryMask,this.qualityScores);if(!this.j){var l=h;break t}this.j(h)}finally{wr(this)}l=void 0}return l}m(){var e=new wt;W(e,"image_in"),W(e,"roi_in"),W(e,"norm_rect_in");const t=new Rt;Zt(t,vc,this.h);const i=new pt;Lt(i,"mediapipe.tasks.vision.interactive_segmenter.InteractiveSegmenterGraph"),j(i,"IMAGE:image_in"),j(i,"ROI:roi_in"),j(i,"NORM_RECT:norm_rect_in"),i.o(t),kt(e,i),Pr(this,e),this.outputConfidenceMasks&&(N(e,"confidence_masks"),L(i,"CONFIDENCE_MASKS:confidence_masks"),wi(this,"confidence_masks"),this.g.ca("confidence_masks",(s,r)=>{this.confidenceMasks=s.map(a=>Ei(this,a,!0,!this.j)),p(this,r)}),this.g.attachEmptyPacketListener("confidence_masks",s=>{this.confidenceMasks=[],p(this,s)})),this.outputCategoryMask&&(N(e,"category_mask"),L(i,"CATEGORY_MASK:category_mask"),wi(this,"category_mask"),this.g.U("category_mask",(s,r)=>{this.categoryMask=Ei(this,s,!1,!this.j),p(this,r)}),this.g.attachEmptyPacketListener("category_mask",s=>{this.categoryMask=void 0,p(this,s)})),N(e,"quality_scores"),L(i,"QUALITY_SCORES:quality_scores"),this.g.attachFloatVectorListener("quality_scores",(s,r)=>{this.qualityScores=s,p(this,r)}),this.g.attachEmptyPacketListener("quality_scores",s=>{this.categoryMask=void 0,p(this,s)}),e=e.g(),this.setGraph(new Uint8Array(e),!0)}};re.prototype.segment=re.prototype.segment,re.prototype.setOptions=re.prototype.o,re.createFromModelPath=function(e,t){return V(re,e,{baseOptions:{modelAssetPath:t}})},re.createFromModelBuffer=function(e,t){return V(re,e,{baseOptions:{modelAssetBuffer:t}})},re.createFromOptions=function(e,t){return V(re,e,t)};var Nt=class extends Pt{constructor(e,t){super(new Wt(e,t),"input_frame_gpu","norm_rect",!1),this.j={detections:[]},I(e=this.h=new bc,0,1,t=new K)}get baseOptions(){return O(this.h,K,1)}set baseOptions(e){I(this.h,0,1,e)}o(e){return e.displayNamesLocale!==void 0?X(this.h,2,Ai(e.displayNamesLocale)):"displayNamesLocale"in e&&X(this.h,2),e.maxResults!==void 0?oe(this.h,3,e.maxResults):"maxResults"in e&&X(this.h,3),e.scoreThreshold!==void 0?v(this.h,4,e.scoreThreshold):"scoreThreshold"in e&&X(this.h,4),e.categoryAllowlist!==void 0?Js(this.h,5,e.categoryAllowlist):"categoryAllowlist"in e&&X(this.h,5),e.categoryDenylist!==void 0?Js(this.h,6,e.categoryDenylist):"categoryDenylist"in e&&X(this.h,6),this.l(e)}D(e,t){return this.j={detections:[]},$t(this,e,t),this.j}F(e,t,i){return this.j={detections:[]},le(this,e,i,t),this.j}m(){var e=new wt;W(e,"input_frame_gpu"),W(e,"norm_rect"),N(e,"detections");const t=new Rt;Zt(t,af,this.h);const i=new pt;Lt(i,"mediapipe.tasks.vision.ObjectDetectorGraph"),j(i,"IMAGE:input_frame_gpu"),j(i,"NORM_RECT:norm_rect"),L(i,"DETECTIONS:detections"),i.o(t),kt(e,i),this.g.attachProtoVectorListener("detections",(s,r)=>{for(const a of s)s=Qu(a),this.j.detections.push(Pc(s));p(this,r)}),this.g.attachEmptyPacketListener("detections",s=>{p(this,s)}),e=e.g(),this.setGraph(new Uint8Array(e),!0)}};Nt.prototype.detectForVideo=Nt.prototype.F,Nt.prototype.detect=Nt.prototype.D,Nt.prototype.setOptions=Nt.prototype.o,Nt.createFromModelPath=async function(e,t){return V(Nt,e,{baseOptions:{modelAssetPath:t}})},Nt.createFromModelBuffer=function(e,t){return V(Nt,e,{baseOptions:{modelAssetBuffer:t}})},Nt.createFromOptions=function(e,t){return V(Nt,e,t)};var ba=class{constructor(e,t,i){this.landmarks=e,this.worldLandmarks=t,this.segmentationMasks=i}close(){var e;(e=this.segmentationMasks)==null||e.forEach(t=>{t.close()})}};function nh(e){e.landmarks=[],e.worldLandmarks=[],e.segmentationMasks=void 0}function oh(e){try{const t=new ba(e.landmarks,e.worldLandmarks,e.segmentationMasks);if(!e.s)return t;e.s(t)}finally{wr(e)}}ba.prototype.close=ba.prototype.close;var Tt=class extends Pt{constructor(e,t){super(new Wt(e,t),"image_in","norm_rect",!1),this.landmarks=[],this.worldLandmarks=[],this.outputSegmentationMasks=!1,I(e=this.h=new Mc,0,1,t=new K),this.v=new mc,I(this.h,0,3,this.v),this.j=new fc,I(this.h,0,2,this.j),oe(this.j,4,1),v(this.j,2,.5),v(this.v,2,.5),v(this.h,4,.5)}get baseOptions(){return O(this.h,K,1)}set baseOptions(e){I(this.h,0,1,e)}o(e){return"numPoses"in e&&oe(this.j,4,e.numPoses??1),"minPoseDetectionConfidence"in e&&v(this.j,2,e.minPoseDetectionConfidence??.5),"minTrackingConfidence"in e&&v(this.h,4,e.minTrackingConfidence??.5),"minPosePresenceConfidence"in e&&v(this.v,2,e.minPosePresenceConfidence??.5),"outputSegmentationMasks"in e&&(this.outputSegmentationMasks=e.outputSegmentationMasks??!1),this.l(e)}D(e,t,i){const s=typeof t!="function"?t:{};return this.s=typeof t=="function"?t:i,nh(this),$t(this,e,s),oh(this)}F(e,t,i,s){const r=typeof i!="function"?i:{};return this.s=typeof i=="function"?i:s,nh(this),le(this,e,r,t),oh(this)}m(){var e=new wt;W(e,"image_in"),W(e,"norm_rect"),N(e,"normalized_landmarks"),N(e,"world_landmarks"),N(e,"segmentation_masks");const t=new Rt;Zt(t,nf,this.h);const i=new pt;Lt(i,"mediapipe.tasks.vision.pose_landmarker.PoseLandmarkerGraph"),j(i,"IMAGE:image_in"),j(i,"NORM_RECT:norm_rect"),L(i,"NORM_LANDMARKS:normalized_landmarks"),L(i,"WORLD_LANDMARKS:world_landmarks"),i.o(t),kt(e,i),Pr(this,e),this.g.attachProtoVectorListener("normalized_landmarks",(s,r)=>{this.landmarks=[];for(const a of s)s=Ss(a),this.landmarks.push(Mr(s));p(this,r)}),this.g.attachEmptyPacketListener("normalized_landmarks",s=>{this.landmarks=[],p(this,s)}),this.g.attachProtoVectorListener("world_landmarks",(s,r)=>{this.worldLandmarks=[];for(const a of s)s=pi(a),this.worldLandmarks.push(Ji(s));p(this,r)}),this.g.attachEmptyPacketListener("world_landmarks",s=>{this.worldLandmarks=[],p(this,s)}),this.outputSegmentationMasks&&(L(i,"SEGMENTATION_MASK:segmentation_masks"),wi(this,"segmentation_masks"),this.g.ca("segmentation_masks",(s,r)=>{this.segmentationMasks=s.map(a=>Ei(this,a,!0,!this.s)),p(this,r)}),this.g.attachEmptyPacketListener("segmentation_masks",s=>{this.segmentationMasks=[],p(this,s)})),e=e.g(),this.setGraph(new Uint8Array(e),!0)}};Tt.prototype.detectForVideo=Tt.prototype.F,Tt.prototype.detect=Tt.prototype.D,Tt.prototype.setOptions=Tt.prototype.o,Tt.createFromModelPath=function(e,t){return V(Tt,e,{baseOptions:{modelAssetPath:t}})},Tt.createFromModelBuffer=function(e,t){return V(Tt,e,{baseOptions:{modelAssetBuffer:t}})},Tt.createFromOptions=function(e,t){return V(Tt,e,t)},Tt.POSE_CONNECTIONS=Oc;class df{constructor(){this.faceLandmarker=null,this.video=null,this.isInitialized=!1,this.lastVideoTime=-1,this._trackingData={faceAngleX:0,faceAngleY:0,faceAngleZ:0,eyeOpenL:1,eyeOpenR:1,browY:0,mouthOpenY:0,mouthForm:0,eyeBallX:0,eyeBallY:0,bodyAngleX:0,bodyAngleY:0,isDetected:!1},this.prevData=null,this.smoothingFactor=.5}get trackingData(){return this._trackingData}get initialized(){return this.isInitialized}async initialize(){try{console.log("[FaceTracker] Initializing MediaPipe Face Landmarker...");const t=await Ue.forVisionTasks("https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@latest/wasm");return this.faceLandmarker=await Z.createFromOptions(t,{baseOptions:{modelAssetPath:"https://storage.googleapis.com/mediapipe-models/face_landmarker/face_landmarker/float16/1/face_landmarker.task",delegate:"GPU"},runningMode:"VIDEO",numFaces:1,minFaceDetectionConfidence:.5,minFacePresenceConfidence:.5,minTrackingConfidence:.5,outputFaceBlendshapes:!0,outputFacialTransformationMatrixes:!0}),console.log("[FaceTracker] MediaPipe initialized successfully"),await this.initializeCamera(),this.isInitialized=!0,!0}catch(t){return console.error("[FaceTracker] Initialization failed:",t),!1}}async initializeCamera(){console.log("[FaceTracker] Initializing webcam..."),this.video=document.createElement("video"),this.video.setAttribute("autoplay",""),this.video.setAttribute("playsinline",""),this.video.style.position="fixed",this.video.style.bottom="10px",this.video.style.right="10px",this.video.style.width="200px",this.video.style.height="150px",this.video.style.borderRadius="8px",this.video.style.border="2px solid #fff",this.video.style.zIndex="1000",this.video.style.transform="scaleX(-1)",document.body.appendChild(this.video);const t=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:640},height:{ideal:480},facingMode:"user"},audio:!1});this.video.srcObject=t,await new Promise(i=>{this.video&&(this.video.onloadedmetadata=()=>{this.video.play(),i()})}),console.log("[FaceTracker] Webcam initialized successfully")}update(){if(!this.isInitialized||!this.faceLandmarker||!this.video||this.video.readyState<2)return;const t=this.video.currentTime;if(t===this.lastVideoTime)return;this.lastVideoTime=t;const i=this.faceLandmarker.detectForVideo(this.video,performance.now());this.processResult(i)}processResult(t){if(!t.faceLandmarks||t.faceLandmarks.length===0||!t.faceBlendshapes||t.faceBlendshapes.length===0){this._trackingData.isDetected=!1;return}this._trackingData.isDetected=!0;const i=t.faceLandmarks[0],s=t.faceBlendshapes[0].categories,r=new Map;for(const he of s)r.set(he.categoryName,he.score);this.calculateFaceAngles(i);const a=r.get("eyeBlinkLeft")??0,n=r.get("eyeBlinkRight")??0;this._trackingData.eyeOpenL=1-a,this._trackingData.eyeOpenR=1-n;const o=r.get("browInnerUp")??0,l=r.get("browDownLeft")??0,h=r.get("browDownRight")??0;this._trackingData.browY=o-(l+h)/2;const u=r.get("jawOpen")??0,c=r.get("mouthSmileLeft")??0,d=r.get("mouthSmileRight")??0;this._trackingData.mouthOpenY=u,this._trackingData.mouthForm=(c+d)/2;const g=r.get("eyeLookInLeft")??0,_=r.get("eyeLookOutLeft")??0,m=r.get("eyeLookInRight")??0,f=r.get("eyeLookOutRight")??0,b=r.get("eyeLookUpLeft")??0,x=r.get("eyeLookDownLeft")??0,E=r.get("eyeLookUpRight")??0,A=r.get("eyeLookDownRight")??0,T=(_+m)/2,M=(g+f)/2,Y=(b+E)/2,xt=(x+A)/2;this._trackingData.eyeBallX=(T-M)*2,this._trackingData.eyeBallY=(Y-xt)*2,this.applySmoothing()}calculateFaceAngles(t){const i=t[1],s=t[33],r=t[263];t[10],t[152];const a=(i.x-.5)*-60,n=(i.y-.5)*-60,o=r.y-s.y,l=r.x-s.x,h=Math.atan2(o,l)*(180/Math.PI);this._trackingData.faceAngleX=this.clamp(a,-30,30),this._trackingData.faceAngleY=this.clamp(n,-30,30),this._trackingData.faceAngleZ=this.clamp(h,-30,30),this._trackingData.bodyAngleX=a*.3,this._trackingData.bodyAngleY=n*.3}applySmoothing(){if(this.prevData===null){this.prevData={...this._trackingData};return}const t=(s,r,a)=>s+(r-s)*a,i=1-this.smoothingFactor;this._trackingData.faceAngleX=t(this.prevData.faceAngleX,this._trackingData.faceAngleX,i),this._trackingData.faceAngleY=t(this.prevData.faceAngleY,this._trackingData.faceAngleY,i),this._trackingData.faceAngleZ=t(this.prevData.faceAngleZ,this._trackingData.faceAngleZ,i),this._trackingData.eyeOpenL=t(this.prevData.eyeOpenL,this._trackingData.eyeOpenL,i),this._trackingData.eyeOpenR=t(this.prevData.eyeOpenR,this._trackingData.eyeOpenR,i),this._trackingData.mouthOpenY=t(this.prevData.mouthOpenY,this._trackingData.mouthOpenY,i),this._trackingData.eyeBallX=t(this.prevData.eyeBallX,this._trackingData.eyeBallX,i),this._trackingData.eyeBallY=t(this.prevData.eyeBallY,this._trackingData.eyeBallY,i),this.prevData={...this._trackingData}}clamp(t,i,s){return Math.max(i,Math.min(s,t))}release(){if(this.video){const t=this.video.srcObject;t&&t.getTracks().forEach(i=>i.stop()),this.video.remove(),this.video=null}this.faceLandmarker&&(this.faceLandmarker.close(),this.faceLandmarker=null),this.isInitialized=!1,console.log("[FaceTracker] Released")}}let ta=null;function Fr(){return ta||(ta=new df),ta}class _f extends ir{loadAssets(t,i){this._modelHomeDir=t,fetch(`${this._modelHomeDir}${i}`).then(s=>s.arrayBuffer()).then(s=>{const r=new fh(s,s.byteLength);this._state=1,this.setupModel(r)}).catch(s=>{D(`Failed to load file ${this._modelHomeDir}${i}`)})}setupModel(t){if(this._updating=!0,this._initialized=!1,this._modelSetting=t,this._modelSetting.getModelFileName()!=""){const d=this._modelSetting.getModelFileName();fetch(`${this._modelHomeDir}${d}`).then(g=>{if(g.ok)return g.arrayBuffer();if(g.status>=400)return D(`Failed to load file ${this._modelHomeDir}${d}`),new ArrayBuffer(0)}).then(g=>{this.loadModel(g,this._mocConsistency),this._state=3,i()}),this._state=2}else q.printMessage("Model data does not exist.");const i=()=>{if(this._modelSetting.getExpressionCount()>0){const d=this._modelSetting.getExpressionCount();for(let g=0;g<d;g++){const _=this._modelSetting.getExpressionName(g),m=this._modelSetting.getExpressionFileName(g);fetch(`${this._modelHomeDir}${m}`).then(f=>{if(f.ok)return f.arrayBuffer();if(f.status>=400)return D(`Failed to load file ${this._modelHomeDir}${m}`),new ArrayBuffer(0)}).then(f=>{const b=this.loadExpression(f,f.byteLength,_);this._expressions.getValue(_)!=null&&(Si.delete(this._expressions.getValue(_)),this._expressions.setValue(_,null)),this._expressions.setValue(_,b),this._expressionCount++,this._expressionCount>=d&&(this._state=5,s())})}this._state=4}else this._state=5,s()},s=()=>{if(this._modelSetting.getPhysicsFileName()!=""){const d=this._modelSetting.getPhysicsFileName();fetch(`${this._modelHomeDir}${d}`).then(g=>{if(g.ok)return g.arrayBuffer();if(g.status>=400)return D(`Failed to load file ${this._modelHomeDir}${d}`),new ArrayBuffer(0)}).then(g=>{this.loadPhysics(g,g.byteLength),this._state=7,r()}),this._state=6}else this._state=7,r()},r=()=>{if(this._modelSetting.getPoseFileName()!=""){const d=this._modelSetting.getPoseFileName();fetch(`${this._modelHomeDir}${d}`).then(g=>{if(g.ok)return g.arrayBuffer();if(g.status>=400)return D(`Failed to load file ${this._modelHomeDir}${d}`),new ArrayBuffer(0)}).then(g=>{this.loadPose(g,g.byteLength),this._state=9,a()}),this._state=8}else this._state=9,a()},a=()=>{this._modelSetting.getEyeBlinkParameterCount()>0&&(this._eyeBlink=is.create(this._modelSetting),this._state=10),n()},n=()=>{this._breath=ds.create();const d=new y;d.pushBack(new ai(this._idParamAngleX,0,15,6.5345,.5)),d.pushBack(new ai(this._idParamAngleY,0,8,3.5345,.5)),d.pushBack(new ai(this._idParamAngleZ,0,10,5.5345,.5)),d.pushBack(new ai(this._idParamBodyAngleX,0,4,15.5345,.5)),d.pushBack(new ai(R.getIdManager().getId(C.ParamBreath),.5,.5,3.2345,1)),this._breath.setParameters(d),this._state=11,o()},o=()=>{if(this._modelSetting.getUserDataFile()!=""){const d=this._modelSetting.getUserDataFile();fetch(`${this._modelHomeDir}${d}`).then(g=>{if(g.ok)return g.arrayBuffer();if(g.status>=400)return D(`Failed to load file ${this._modelHomeDir}${d}`),new ArrayBuffer(0)}).then(g=>{this.loadUserData(g,g.byteLength),this._state=13,l()}),this._state=12}else this._state=13,l()},l=()=>{const d=this._modelSetting.getEyeBlinkParameterCount();for(let g=0;g<d;++g)this._eyeBlinkIds.pushBack(this._modelSetting.getEyeBlinkParameterId(g));this._state=14,h()},h=()=>{const d=this._modelSetting.getLipSyncParameterCount();for(let g=0;g<d;++g)this._lipSyncIds.pushBack(this._modelSetting.getLipSyncParameterId(g));this._state=15,u()},u=()=>{const d=new bt;if(this._modelSetting==null||this._modelMatrix==null){D("Failed to setupLayout().");return}this._modelSetting.getLayoutMap(d),this._modelMatrix.setupFromLayout(d),this._state=16,c()},c=()=>{this._state=17,this._model.saveParameters(),this._allMotionCount=0,this._motionCount=0;const d=[],g=this._modelSetting.getMotionGroupCount();for(let _=0;_<g;_++)d[_]=this._modelSetting.getMotionGroupName(_),this._allMotionCount+=this._modelSetting.getMotionCount(d[_]);for(let _=0;_<g;_++)this.preLoadMotionGroup(d[_]);g==0&&(this._state=20,this._motionManager.stopAllMotions(),this._updating=!1,this._initialized=!0,this.createRenderer(),this.setupTextures(),this.getRenderer().startUp(this._subdelegate.getGlManager().getGl()))}}setupTextures(){if(this._state==20){const i=this._modelSetting.getTextureCount();for(let s=0;s<i;s++){if(this._modelSetting.getTextureFileName(s)==""){console.log("getTextureFileName null");continue}let r=this._modelSetting.getTextureFileName(s);r=this._modelHomeDir+r;const a=n=>{this.getRenderer().bindTexture(s,n.id),this._textureCount++,this._textureCount>=i&&(this._state=22)};this._subdelegate.getTextureManager().createTextureFromPngFile(r,!0,a),this.getRenderer().setIsPremultipliedAlpha(!0)}this._state=21}}reloadRenderer(){this.deleteRenderer(),this.createRenderer(),this.setupTextures()}update(){if(this._state!=22)return;const t=q.getDeltaTime();this._userTimeSeconds+=t,this._dragManager.update(t),this._dragX=this._dragManager.getX(),this._dragY=this._dragManager.getY();let i=!1;this._model.loadParameters(),this._motionManager.isFinished()?this.startRandomMotion(rg,og):i=this._motionManager.updateMotion(this._model,t),this._model.saveParameters();const s=Fr(),r=s.initialized&&s.trackingData.isDetected;if(!i&&!r&&this._eyeBlink!=null&&this._eyeBlink.updateParameters(this._model,t),this._expressionManager!=null&&this._expressionManager.updateMotion(this._model,t),r){const a=s.trackingData;this._model.setParameterValueById(this._idParamAngleX,a.faceAngleX),this._model.setParameterValueById(this._idParamAngleY,a.faceAngleY),this._model.setParameterValueById(this._idParamAngleZ,a.faceAngleZ),this._model.setParameterValueById(this._idParamBodyAngleX,a.bodyAngleX),this._model.setParameterValueById(this._idParamEyeBallX,a.eyeBallX),this._model.setParameterValueById(this._idParamEyeBallY,a.eyeBallY);const n=R.getIdManager().getId(C.ParamEyeLOpen),o=R.getIdManager().getId(C.ParamEyeROpen);this._model.setParameterValueById(n,a.eyeOpenL),this._model.setParameterValueById(o,a.eyeOpenR);const l=R.getIdManager().getId(C.ParamMouthOpenY);this._model.setParameterValueById(l,a.mouthOpenY);const h=R.getIdManager().getId(C.ParamMouthForm);this._model.setParameterValueById(h,a.mouthForm)}else this._model.addParameterValueById(this._idParamAngleX,this._dragX*30),this._model.addParameterValueById(this._idParamAngleY,this._dragY*30),this._model.addParameterValueById(this._idParamAngleZ,this._dragX*this._dragY*-30),this._model.addParameterValueById(this._idParamBodyAngleX,this._dragX*10),this._model.addParameterValueById(this._idParamEyeBallX,this._dragX),this._model.addParameterValueById(this._idParamEyeBallY,this._dragY);if(this._breath!=null&&this._breath.updateParameters(this._model,t),this._physics!=null&&this._physics.evaluate(this._model,t),this._lipsync){let a=0;this._wavFileHandler.update(t),a=this._wavFileHandler.getRms();for(let n=0;n<this._lipSyncIds.getSize();++n)this._model.addParameterValueById(this._lipSyncIds.at(n),a,.8)}this._pose!=null&&this._pose.updateParameters(this._model,t),this._model.update()}startMotion(t,i,s,r,a){if(s==hg)this._motionManager.setReservePriority(s);else if(!this._motionManager.reserveMotion(s))return this._debugMode&&q.printMessage("[APP]can't start motion."),Wi;const n=this._modelSetting.getMotionFileName(t,i),o=`${t}_${i}`;let l=this._motions.getValue(o),h=!1;if(l==null)if(fetch(`${this._modelHomeDir}${n}`).then(c=>{if(c.ok)return c.arrayBuffer();if(c.status>=400)return D(`Failed to load file ${this._modelHomeDir}${n}`),new ArrayBuffer(0)}).then(c=>{l=this.loadMotion(c,c.byteLength,null,r,a,this._modelSetting,t,i,this._motionConsistency)}),l)l.setEffectIds(this._eyeBlinkIds,this._lipSyncIds),h=!0;else return D("Can't start motion {0} .",n),this._motionManager.setReservePriority(ng),Wi;else l.setBeganMotionHandler(a),l.setFinishedMotionHandler(r);const u=this._modelSetting.getMotionSoundFileName(t,i);if(u.localeCompare("")!=0){let c=u;c=this._modelHomeDir+c,this._wavFileHandler.start(c)}return this._debugMode&&q.printMessage(`[APP]start motion: [${t}_${i}]`),this._motionManager.startMotionPriority(l,h,s)}startRandomMotion(t,i,s,r){if(this._modelSetting.getMotionCount(t)==0)return Wi;const a=Math.floor(Math.random()*this._modelSetting.getMotionCount(t));return this.startMotion(t,a,i,s,r)}setExpression(t){const i=this._expressions.getValue(t);this._debugMode&&q.printMessage(`[APP]expression: [${t}]`),i!=null?this._expressionManager.startMotion(i,!1):this._debugMode&&q.printMessage(`[APP]expression[${t}] is null`)}setRandomExpression(){if(this._expressions.getSize()==0)return;const t=Math.floor(Math.random()*this._expressions.getSize());for(let i=0;i<this._expressions.getSize();i++)if(i==t){const s=this._expressions._keyValues[i].first;this.setExpression(s);return}}motionEventFired(t){mt("{0} is fired on LAppModel!!",t.s)}hitTest(t,i,s){if(this._opacity<1)return!1;const r=this._modelSetting.getHitAreasCount();for(let a=0;a<r;a++)if(this._modelSetting.getHitAreaName(a)==t){const n=this._modelSetting.getHitAreaId(a);return this.isHit(n,i,s)}return!1}preLoadMotionGroup(t){for(let i=0;i<this._modelSetting.getMotionCount(t);i++){const s=this._modelSetting.getMotionFileName(t,i),r=`${t}_${i}`;this._debugMode&&q.printMessage(`[APP]load motion: ${s} => [${r}]`),fetch(`${this._modelHomeDir}${s}`).then(a=>{if(a.ok)return a.arrayBuffer();if(a.status>=400)return D(`Failed to load file ${this._modelHomeDir}${s}`),new ArrayBuffer(0)}).then(a=>{const n=this.loadMotion(a,a.byteLength,r,null,null,this._modelSetting,t,i,this._motionConsistency);n!=null?(n.setEffectIds(this._eyeBlinkIds,this._lipSyncIds),this._motions.getValue(r)!=null&&Si.delete(this._motions.getValue(r)),this._motions.setValue(r,n),this._motionCount++):this._allMotionCount--,this._motionCount>=this._allMotionCount&&(this._state=20,this._motionManager.stopAllMotions(),this._updating=!1,this._initialized=!0,this.createRenderer(),this.setupTextures(),this.getRenderer().startUp(this._subdelegate.getGlManager().getGl()))})}}releaseMotions(){this._motions.clear()}releaseExpressions(){this._expressions.clear()}doDraw(){if(this._model==null)return;const t=this._subdelegate.getCanvas(),i=[0,0,t.width,t.height];this.getRenderer().setRenderState(this._subdelegate.getFrameBuffer(),i),this.getRenderer().drawModel()}draw(t){this._model!=null&&this._state==22&&(t.multiplyByMatrix(this._modelMatrix),this.getRenderer().setMvpMatrix(t),this.doDraw())}async hasMocConsistencyFromFile(){if(ft(this._modelSetting.getModelFileName().localeCompare("")),this._modelSetting.getModelFileName()!=""){const t=this._modelSetting.getModelFileName(),s=await(await fetch(`${this._modelHomeDir}${t}`)).arrayBuffer();return this._consistency=_s.hasMocConsistency(s),this._consistency?mt("Consistent MOC3."):mt("Inconsistent MOC3."),this._consistency}else q.printMessage("Model data does not exist.")}setSubdelegate(t){this._subdelegate=t}constructor(){super(),this._modelSetting=null,this._modelHomeDir=null,this._userTimeSeconds=0,this._eyeBlinkIds=new y,this._lipSyncIds=new y,this._motions=new bt,this._expressions=new bt,this._hitArea=new y,this._userArea=new y,this._idParamAngleX=R.getIdManager().getId(C.ParamAngleX),this._idParamAngleY=R.getIdManager().getId(C.ParamAngleY),this._idParamAngleZ=R.getIdManager().getId(C.ParamAngleZ),this._idParamEyeBallX=R.getIdManager().getId(C.ParamEyeBallX),this._idParamEyeBallY=R.getIdManager().getId(C.ParamEyeBallY),this._idParamBodyAngleX=R.getIdManager().getId(C.ParamBodyAngleX),this._mocConsistency=!0,this._motionConsistency=!0,this._state=0,this._expressionCount=0,this._textureCount=0,this._motionCount=0,this._allMotionCount=0,this._wavFileHandler=new Fa,this._consistency=!1}}class ff{constructor(){this.beganMotion=t=>{q.printMessage("Motion Began:"),console.log(t)},this.finishedMotion=t=>{q.printMessage("Motion Finished:"),console.log(t)},this._subdelegate=null,this._viewMatrix=new st,this._models=new y,this._sceneIndex=0}releaseAllModel(){this._models.clear()}onDrag(t,i){const s=this._models.at(0);s&&s.setDragging(t,i)}onTap(t,i){q.printMessage(`[APP]tap point: {x: ${t.toFixed(2)} y: ${i.toFixed(2)}}`);const s=this._models.at(0);s.hitTest(Jn,t,i)?(q.printMessage(`[APP]hit area: [${Jn}]`),s.setRandomExpression()):s.hitTest(Kn,t,i)&&(q.printMessage(`[APP]hit area: [${Kn}]`),s.startRandomMotion(ag,lg,this.finishedMotion,this.beganMotion))}onUpdate(){const{width:t,height:i}=this._subdelegate.getCanvas(),s=new st,r=this._models.at(0);r.getModel()&&(r.getModel().getCanvasWidth()>1&&t<i?(r.getModelMatrix().setWidth(2),s.scale(1,t/i)):s.scale(i/t,1),this._viewMatrix!=null&&s.multiplyByMatrix(this._viewMatrix)),r.update(),r.draw(s)}nextScene(){const t=(this._sceneIndex+1)%sg;this.changeScene(t)}changeScene(t){this._sceneIndex=t,q.printMessage(`[APP]model index: ${this._sceneIndex}`);const i=ia[t],s=gh+i+"/";let r=ia[t];r+=".model3.json",this.releaseAllModel();const a=new _f;a.setSubdelegate(this._subdelegate),a.loadAssets(s,r),this._models.pushBack(a)}setViewMatrix(t){for(let i=0;i<16;i++)this._viewMatrix.getArray()[i]=t.getArray()[i]}addModel(t=0){this._sceneIndex=t,this.changeScene(this._sceneIndex)}release(){}initialize(t){this._subdelegate=t,this.changeScene(this._sceneIndex)}}class mf{constructor(){this._textures=new y}release(){for(let t=this._textures.begin();t.notEqual(this._textures.end());t.preIncrement())this._glManager.getGl().deleteTexture(t.ptr().id);this._textures=null}createTextureFromPngFile(t,i,s){for(let a=this._textures.begin();a.notEqual(this._textures.end());a.preIncrement())if(a.ptr().fileName==t&&a.ptr().usePremultply==i){a.ptr().img=new Image,a.ptr().img.addEventListener("load",()=>s(a.ptr()),{passive:!0}),a.ptr().img.src=t;return}const r=new Image;r.addEventListener("load",()=>{const a=this._glManager.getGl().createTexture();this._glManager.getGl().bindTexture(this._glManager.getGl().TEXTURE_2D,a),this._glManager.getGl().texParameteri(this._glManager.getGl().TEXTURE_2D,this._glManager.getGl().TEXTURE_MIN_FILTER,this._glManager.getGl().LINEAR_MIPMAP_LINEAR),this._glManager.getGl().texParameteri(this._glManager.getGl().TEXTURE_2D,this._glManager.getGl().TEXTURE_MAG_FILTER,this._glManager.getGl().LINEAR),i&&this._glManager.getGl().pixelStorei(this._glManager.getGl().UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),this._glManager.getGl().texImage2D(this._glManager.getGl().TEXTURE_2D,0,this._glManager.getGl().RGBA,this._glManager.getGl().RGBA,this._glManager.getGl().UNSIGNED_BYTE,r),this._glManager.getGl().generateMipmap(this._glManager.getGl().TEXTURE_2D),this._glManager.getGl().bindTexture(this._glManager.getGl().TEXTURE_2D,null);const n=new pf;n!=null&&(n.fileName=t,n.width=r.width,n.height=r.height,n.id=a,n.img=r,n.usePremultply=i,this._textures!=null&&this._textures.pushBack(n)),s(n)},{passive:!0}),r.src=t}releaseTextures(){for(let t=0;t<this._textures.getSize();t++)this._glManager.getGl().deleteTexture(this._textures.at(t).id),this._textures.set(t,null);this._textures.clear()}releaseTextureByTexture(t){for(let i=0;i<this._textures.getSize();i++)if(this._textures.at(i).id==t){this._glManager.getGl().deleteTexture(this._textures.at(i).id),this._textures.set(i,null),this._textures.remove(i);break}}releaseTextureByFilePath(t){for(let i=0;i<this._textures.getSize();i++)if(this._textures.at(i).fileName==t){this._glManager.getGl().deleteTexture(this._textures.at(i).id),this._textures.set(i,null),this._textures.remove(i);break}}setGlManager(t){this._glManager=t}}class pf{constructor(){this.id=null,this.width=0,this.height=0}}class Uc extends st{constructor(){super(),this._screenLeft=0,this._screenRight=0,this._screenTop=0,this._screenBottom=0,this._maxLeft=0,this._maxRight=0,this._maxTop=0,this._maxBottom=0,this._maxScale=0,this._minScale=0}adjustTranslate(t,i){this._tr[0]*this._maxLeft+(this._tr[12]+t)>this._screenLeft&&(t=this._screenLeft-this._tr[0]*this._maxLeft-this._tr[12]),this._tr[0]*this._maxRight+(this._tr[12]+t)<this._screenRight&&(t=this._screenRight-this._tr[0]*this._maxRight-this._tr[12]),this._tr[5]*this._maxTop+(this._tr[13]+i)<this._screenTop&&(i=this._screenTop-this._tr[5]*this._maxTop-this._tr[13]),this._tr[5]*this._maxBottom+(this._tr[13]+i)>this._screenBottom&&(i=this._screenBottom-this._tr[5]*this._maxBottom-this._tr[13]);const s=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,t,i,0,1]);st.multiply(s,this._tr,this._tr)}adjustScale(t,i,s){const r=this.getMaxScale(),a=this.getMinScale(),n=s*this._tr[0];n<a?this._tr[0]>0&&(s=a/this._tr[0]):n>r&&this._tr[0]>0&&(s=r/this._tr[0]);const o=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,t,i,0,1]),l=new Float32Array([s,0,0,0,0,s,0,0,0,0,1,0,0,0,0,1]),h=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,-t,-i,0,1]);st.multiply(h,this._tr,this._tr),st.multiply(l,this._tr,this._tr),st.multiply(o,this._tr,this._tr)}setScreenRect(t,i,s,r){this._screenLeft=t,this._screenRight=i,this._screenBottom=s,this._screenTop=r}setMaxScreenRect(t,i,s,r){this._maxLeft=t,this._maxRight=i,this._maxTop=r,this._maxBottom=s}setMaxScale(t){this._maxScale=t}setMinScale(t){this._minScale=t}getMaxScale(){return this._maxScale}getMinScale(){return this._minScale}isMaxScale(){return this.getScaleX()>=this._maxScale}isMinScale(){return this.getScaleX()<=this._minScale}getScreenLeft(){return this._screenLeft}getScreenRight(){return this._screenRight}getScreenBottom(){return this._screenBottom}getScreenTop(){return this._screenTop}getMaxLeft(){return this._maxLeft}getMaxRight(){return this._maxRight}getMaxBottom(){return this._maxBottom}getMaxTop(){return this._maxTop}}var lh;(e=>{e.CubismViewMatrix=Uc})(lh||(lh={}));class hh{constructor(t,i,s,r,a){this._rect=new yf,this._rect.left=t-s*.5,this._rect.right=t+s*.5,this._rect.up=i+r*.5,this._rect.down=i-r*.5,this._texture=a,this._vertexBuffer=null,this._uvBuffer=null,this._indexBuffer=null,this._positionLocation=null,this._uvLocation=null,this._textureLocation=null,this._positionArray=null,this._uvArray=null,this._indexArray=null,this._firstDraw=!0}release(){this._rect=null;const t=this._subdelegate.getGlManager().getGl();t.deleteTexture(this._texture),this._texture=null,t.deleteBuffer(this._uvBuffer),this._uvBuffer=null,t.deleteBuffer(this._vertexBuffer),this._vertexBuffer=null,t.deleteBuffer(this._indexBuffer),this._indexBuffer=null}getTexture(){return this._texture}render(t){if(this._texture==null)return;const i=this._subdelegate.getGlManager().getGl();if(this._firstDraw){this._positionLocation=i.getAttribLocation(t,"position"),i.enableVertexAttribArray(this._positionLocation),this._uvLocation=i.getAttribLocation(t,"uv"),i.enableVertexAttribArray(this._uvLocation),this._textureLocation=i.getUniformLocation(t,"texture"),i.uniform1i(this._textureLocation,0),this._uvArray=new Float32Array([1,0,0,0,0,1,1,1]),this._uvBuffer=i.createBuffer();{const s=this._subdelegate.getCanvas().width,r=this._subdelegate.getCanvas().height;this._positionArray=new Float32Array([(this._rect.right-s*.5)/(s*.5),(this._rect.up-r*.5)/(r*.5),(this._rect.left-s*.5)/(s*.5),(this._rect.up-r*.5)/(r*.5),(this._rect.left-s*.5)/(s*.5),(this._rect.down-r*.5)/(r*.5),(this._rect.right-s*.5)/(s*.5),(this._rect.down-r*.5)/(r*.5)]),this._vertexBuffer=i.createBuffer()}this._indexArray=new Uint16Array([0,1,2,3,2,0]),this._indexBuffer=i.createBuffer(),this._firstDraw=!1}i.bindBuffer(i.ARRAY_BUFFER,this._uvBuffer),i.bufferData(i.ARRAY_BUFFER,this._uvArray,i.STATIC_DRAW),i.vertexAttribPointer(this._uvLocation,2,i.FLOAT,!1,0,0),i.bindBuffer(i.ARRAY_BUFFER,this._vertexBuffer),i.bufferData(i.ARRAY_BUFFER,this._positionArray,i.STATIC_DRAW),i.vertexAttribPointer(this._positionLocation,2,i.FLOAT,!1,0,0),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this._indexBuffer),i.bufferData(i.ELEMENT_ARRAY_BUFFER,this._indexArray,i.DYNAMIC_DRAW),i.bindTexture(i.TEXTURE_2D,this._texture),i.drawElements(i.TRIANGLES,this._indexArray.length,i.UNSIGNED_SHORT,0)}isHit(t,i){const{height:s}=this._subdelegate.getCanvas(),r=s-i;return t>=this._rect.left&&t<=this._rect.right&&r<=this._rect.up&&r>=this._rect.down}setSubdelegate(t){this._subdelegate=t}}class yf{}class Sf{constructor(){this._startX=0,this._startY=0,this._lastX=0,this._lastY=0,this._lastX1=0,this._lastY1=0,this._lastX2=0,this._lastY2=0,this._lastTouchDistance=0,this._deltaX=0,this._deltaY=0,this._scale=1,this._touchSingle=!1,this._flipAvailable=!1}getCenterX(){return this._lastX}getCenterY(){return this._lastY}getDeltaX(){return this._deltaX}getDeltaY(){return this._deltaY}getStartX(){return this._startX}getStartY(){return this._startY}getScale(){return this._scale}getX(){return this._lastX}getY(){return this._lastY}getX1(){return this._lastX1}getY1(){return this._lastY1}getX2(){return this._lastX2}getY2(){return this._lastY2}isSingleTouch(){return this._touchSingle}isFlickAvailable(){return this._flipAvailable}disableFlick(){this._flipAvailable=!1}touchesBegan(t,i){this._lastX=t,this._lastY=i,this._startX=t,this._startY=i,this._lastTouchDistance=-1,this._flipAvailable=!0,this._touchSingle=!0}touchesMoved(t,i){this._lastX=t,this._lastY=i,this._lastTouchDistance=-1,this._touchSingle=!0}getFlickDistance(){return this.calculateDistance(this._startX,this._startY,this._lastX,this._lastY)}calculateDistance(t,i,s,r){return Math.sqrt((t-s)*(t-s)+(i-r)*(i-r))}calculateMovingAmount(t,i){if(t>0!=i>0)return 0;const s=t>0?1:-1,r=Math.abs(t),a=Math.abs(i);return s*(r<a?r:a)}}class xf{constructor(){this._programId=null,this._back=null,this._gear=null,this._touchManager=new Sf,this._deviceToScreen=new st,this._viewMatrix=new Uc}initialize(t){this._subdelegate=t;const{width:i,height:s}=t.getCanvas(),r=i/s,a=-r,n=r,o=qc,l=Jc;if(this._viewMatrix.setScreenRect(a,n,o,l),this._viewMatrix.scale(qn,qn),this._deviceToScreen.loadIdentity(),i>s){const h=Math.abs(n-a);this._deviceToScreen.scaleRelative(h/i,-h/i)}else{const h=Math.abs(l-o);this._deviceToScreen.scaleRelative(h/s,-h/s)}this._deviceToScreen.translateRelative(-i*.5,-s*.5),this._viewMatrix.setMaxScale(Wc),this._viewMatrix.setMinScale($c),this._viewMatrix.setMaxScreenRect(Kc,Zc,Qc,tg)}release(){this._viewMatrix=null,this._touchManager=null,this._deviceToScreen=null,this._gear.release(),this._gear=null,this._back.release(),this._back=null,this._subdelegate.getGlManager().getGl().deleteProgram(this._programId),this._programId=null}render(){this._subdelegate.getGlManager().getGl().useProgram(this._programId),this._back&&this._back.render(this._programId),this._gear&&this._gear.render(this._programId),this._subdelegate.getGlManager().getGl().flush();const t=this._subdelegate.getLive2DManager();t!=null&&(t.setViewMatrix(this._viewMatrix),t.onUpdate())}initializeSprite(){const t=this._subdelegate.getCanvas().width,i=this._subdelegate.getCanvas().height,s=this._subdelegate.getTextureManager(),r=gh;let a="";a=eg;const n=l=>{const h=t*.5,u=i*.5,c=l.width*2,d=i*.95;this._back=new hh(h,u,c,d,l.id),this._back.setSubdelegate(this._subdelegate)};s.createTextureFromPngFile(r+a,!1,n),a=ig;const o=l=>{const h=t-l.width*.5,u=i-l.height*.5,c=l.width,d=l.height;this._gear=new hh(h,u,c,d,l.id),this._gear.setSubdelegate(this._subdelegate)};s.createTextureFromPngFile(r+a,!1,o),this._programId==null&&(this._programId=this._subdelegate.createShader())}onTouchesBegan(t,i){this._touchManager.touchesBegan(t*window.devicePixelRatio,i*window.devicePixelRatio)}onTouchesMoved(t,i){const s=t*window.devicePixelRatio,r=i*window.devicePixelRatio,a=this._subdelegate.getLive2DManager(),n=this.transformViewX(this._touchManager.getX()),o=this.transformViewY(this._touchManager.getY());this._touchManager.touchesMoved(s,r),a.onDrag(n,o)}onTouchesEnded(t,i){const s=t*window.devicePixelRatio,r=i*window.devicePixelRatio,a=this._subdelegate.getLive2DManager();a.onDrag(0,0);const n=this.transformViewX(s),o=this.transformViewY(r);a.onTap(n,o),this._gear.isHit(s,r)&&a.nextScene()}transformViewX(t){const i=this._deviceToScreen.transformX(t);return this._viewMatrix.invertTransformX(i)}transformViewY(t){const i=this._deviceToScreen.transformY(t);return this._viewMatrix.invertTransformY(i)}transformScreenX(t){return this._deviceToScreen.transformX(t)}transformScreenY(t){return this._deviceToScreen.transformY(t)}}class Cf{constructor(){this._canvas=null,this._glManager=new cg,this._textureManager=new mf,this._live2dManager=new ff,this._view=new xf,this._frameBuffer=null,this._captured=!1}release(){this._resizeObserver.unobserve(this._canvas),this._resizeObserver.disconnect(),this._resizeObserver=null,this._live2dManager.release(),this._live2dManager=null,this._view.release(),this._view=null,this._textureManager.release(),this._textureManager=null,this._glManager.release(),this._glManager=null}initialize(t){if(!this._glManager.initialize(t))return!1;this._canvas=t,this.resizeCanvas(),this._textureManager.setGlManager(this._glManager);const i=this._glManager.getGl();return this._frameBuffer||(this._frameBuffer=i.getParameter(i.FRAMEBUFFER_BINDING)),i.enable(i.BLEND),i.blendFunc(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA),this._view.initialize(this),this._view.initializeSprite(),this._live2dManager.initialize(this),this._resizeObserver=new ResizeObserver((s,r)=>this.resizeObserverCallback.call(this,s,r)),this._resizeObserver.observe(this._canvas),!0}onResize(){this.resizeCanvas(),this._view.initialize(this),this._view.initializeSprite()}resizeObserverCallback(t,i){this._needResize=!0}update(){if(this._glManager.getGl().isContextLost())return;this._needResize&&(this.onResize(),this._needResize=!1);const t=this._glManager.getGl();t.clearColor(0,0,0,1),t.enable(t.DEPTH_TEST),t.depthFunc(t.LEQUAL),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),t.clearDepth(1),t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),this._view.render()}createShader(){const t=this._glManager.getGl(),i=t.createShader(t.VERTEX_SHADER);if(i==null)return q.printMessage("failed to create vertexShader"),null;t.shaderSource(i,"precision mediump float;attribute vec3 position;attribute vec2 uv;varying vec2 vuv;void main(void){   gl_Position = vec4(position, 1.0);   vuv = uv;}"),t.compileShader(i);const r=t.createShader(t.FRAGMENT_SHADER);if(r==null)return q.printMessage("failed to create fragmentShader"),null;t.shaderSource(r,"precision mediump float;varying vec2 vuv;uniform sampler2D texture;void main(void){   gl_FragColor = texture2D(texture, vuv);}"),t.compileShader(r);const n=t.createProgram();return t.attachShader(n,i),t.attachShader(n,r),t.deleteShader(i),t.deleteShader(r),t.linkProgram(n),t.useProgram(n),n}getTextureManager(){return this._textureManager}getFrameBuffer(){return this._frameBuffer}getCanvas(){return this._canvas}getGlManager(){return this._glManager}getLive2DManager(){return this._live2dManager}resizeCanvas(){this._canvas.width=this._canvas.clientWidth*window.devicePixelRatio,this._canvas.height=this._canvas.clientHeight*window.devicePixelRatio;const t=this._glManager.getGl();t.viewport(0,0,t.drawingBufferWidth,t.drawingBufferHeight)}onPointBegan(t,i){if(!this._view){q.printMessage("view notfound");return}this._captured=!0;const s=t-this._canvas.offsetLeft,r=i-this._canvas.offsetTop;this._view.onTouchesBegan(s,r)}onPointMoved(t,i){if(!this._captured)return;const s=t-this._canvas.offsetLeft,r=i-this._canvas.offsetTop;this._view.onTouchesMoved(s,r)}onPointEnded(t,i){if(this._captured=!1,!this._view){q.printMessage("view notfound");return}const s=t-this._canvas.offsetLeft,r=i-this._canvas.offsetTop;this._view.onTouchesEnded(s,r)}onTouchCancel(t,i){if(this._captured=!1,!this._view){q.printMessage("view notfound");return}const s=t-this._canvas.offsetLeft,r=i-this._canvas.offsetTop;this._view.onTouchesEnded(s,r)}isContextLost(){return this._glManager.getGl().isContextLost()}}let Ne=null;class gs{static getInstance(){return Ne==null&&(Ne=new gs),Ne}static releaseInstance(){Ne!=null&&Ne.release(),Ne=null}onPointerBegan(t){for(let i=this._subdelegates.begin();i.notEqual(this._subdelegates.end());i.preIncrement())i.ptr().onPointBegan(t.pageX,t.pageY)}onPointerMoved(t){for(let i=this._subdelegates.begin();i.notEqual(this._subdelegates.end());i.preIncrement())i.ptr().onPointMoved(t.pageX,t.pageY)}onPointerEnded(t){for(let i=this._subdelegates.begin();i.notEqual(this._subdelegates.end());i.preIncrement())i.ptr().onPointEnded(t.pageX,t.pageY)}onPointerCancel(t){for(let i=this._subdelegates.begin();i.notEqual(this._subdelegates.end());i.preIncrement())i.ptr().onTouchCancel(t.pageX,t.pageY)}onResize(){for(let t=0;t<this._subdelegates.getSize();t++)this._subdelegates.at(t).onResize()}run(){const t=()=>{if(Ne!=null){q.updateTime(),Fr().update();for(let i=0;i<this._subdelegates.getSize();i++)this._subdelegates.at(i).update();requestAnimationFrame(t)}};t()}release(){this.releaseEventListener(),this.releaseSubdelegates(),R.dispose(),this._cubismOption=null}releaseEventListener(){document.removeEventListener("pointerup",this.pointBeganEventListener),this.pointBeganEventListener=null,document.removeEventListener("pointermove",this.pointMovedEventListener),this.pointMovedEventListener=null,document.removeEventListener("pointerdown",this.pointEndedEventListener),this.pointEndedEventListener=null,document.removeEventListener("pointerdown",this.pointCancelEventListener),this.pointCancelEventListener=null}releaseSubdelegates(){for(let t=this._subdelegates.begin();t.notEqual(this._subdelegates.end());t.preIncrement())t.ptr().release();this._subdelegates.clear(),this._subdelegates=null}initialize(){return this.initializeCubism(),this.initializeSubdelegates(),this.initializeEventListener(),!0}initializeEventListener(){this.pointBeganEventListener=this.onPointerBegan.bind(this),this.pointMovedEventListener=this.onPointerMoved.bind(this),this.pointEndedEventListener=this.onPointerEnded.bind(this),this.pointCancelEventListener=this.onPointerCancel.bind(this),document.addEventListener("pointerdown",this.pointBeganEventListener,{passive:!0}),document.addEventListener("pointermove",this.pointMovedEventListener,{passive:!0}),document.addEventListener("pointerup",this.pointEndedEventListener,{passive:!0}),document.addEventListener("pointercancel",this.pointCancelEventListener,{passive:!0})}initializeCubism(){q.updateTime(),this._cubismOption.logFunction=q.printMessage,this._cubismOption.loggingLevel=ug,R.startUp(this._cubismOption),R.initialize()}initializeSubdelegates(){let t=100,i=100;t=100/Ui,this._canvases.prepareCapacity(Ui),this._subdelegates.prepareCapacity(Ui);for(let s=0;s<Ui;s++){const r=document.createElement("canvas");this._canvases.pushBack(r),r.style.width=`${t}vw`,r.style.height=`${i}vh`,document.body.appendChild(r)}for(let s=0;s<this._canvases.getSize();s++){const r=new Cf;r.initialize(this._canvases.at(s)),this._subdelegates.pushBack(r)}for(let s=0;s<Ui;s++)this._subdelegates.at(s).isContextLost()&&D(`The context for Canvas at index ${s} was lost, possibly because the acquisition limit for WebGLRenderingContext was reached.`)}constructor(){this._cubismOption=new Hc,this._subdelegates=new y,this._canvases=new y}}window.addEventListener("load",async()=>{if(gs.getInstance().initialize()){{console.log("[Main] Initializing Face Tracker...");const e=Fr();try{await e.initialize()?console.log("[Main] Face Tracker initialized successfully"):console.warn("[Main] Face Tracker initialization failed, using drag mode")}catch(t){console.error("[Main] Face Tracker initialization error:",t)}}gs.getInstance().run()}},{passive:!0});window.addEventListener("beforeunload",()=>{Fr().release(),gs.releaseInstance()},{passive:!0});
//# sourceMappingURL=index-BeAobEfg.js.map
